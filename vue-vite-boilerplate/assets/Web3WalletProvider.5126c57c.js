import{l as w,e as E,W as y,b as g}from"./index.ff75fa43.js";var d=globalThis&&globalThis.__awaiter||function(c,r,e,n){function o(t){return t instanceof e?t:new e(function(s){s(t)})}return new(e||(e=Promise))(function(t,s){function u(l){try{i(n.next(l))}catch(f){s(f)}}function a(l){try{i(n.throw(l))}catch(f){s(f)}}function i(l){l.done?t(l.value):o(l.value).then(u,a)}i((n=n.apply(c,r||[])).next())})},h=globalThis&&globalThis.__generator||function(c,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},n,o,t,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(i){return function(l){return a([i,l])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(e=0)),e;)try{if(n=1,o&&(t=i[0]&2?o.return:i[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,i[1])).done)return t;switch(o=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,o=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(c,e)}catch(l){i=[6,l],o=0}finally{n=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},W=function(){function c(r,e,n){this.client=r,this.walletOptions=e,this.safeConnectOptions=n,this.connections={}}return c.prototype.saveConnections=function(){var r={};for(var e in this.connections){var n=this.connections[e];r[e]={address:n.address,chainId:n.chainId,providerType:n.providerType,blockchain:n.blockchain}}localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(r))},c.prototype.emitSavedConnection=function(r){return Object.keys(this.connections).length&&r?(this.client.eventSender("connected-wallet",this.connections[r.toLocaleLowerCase()]),this.connections[r.toLocaleLowerCase()]):null},c.prototype.emitNetworkChange=function(r){if(r)return this.client.eventSender("network-change",r),r},c.prototype.deleteConnections=function(){this.connections={},localStorage.removeItem(c.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect"),sessionStorage.removeItem("CURRENT_USER")},c.prototype.loadConnections=function(){return d(this,void 0,void 0,function(){var r,e,n,o,t,s,u,a,i;return h(this,function(l){switch(l.label){case 0:if(r=localStorage.getItem(c.LOCAL_STORAGE_KEY),!r)return[2];if(e=JSON.parse(r),!e)return[2];n=e,o=[];for(t in n)o.push(t);s=0,l.label=1;case 1:if(!(s<o.length))return[3,6];if(t=o[s],!(t in n))return[3,5];u=t,a=e[u],l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this.connectWith(a.providerType,!0)];case 3:return l.sent(),[3,5];case 4:return i=l.sent(),console.log("Wallet couldn't connect: "+i.message),delete e[u],this.saveConnections(),this.emitSavedConnection(u),[3,5];case 5:return s++,[3,1];case 6:return[2]}})})},c.prototype.connectWith=function(r,e){return e===void 0&&(e=!1),d(this,void 0,void 0,function(){var n;return h(this,function(o){switch(o.label){case 0:if(!r)throw new Error("Please provide a Wallet type to connect with.");return this[r]?[4,this[r](e)]:[3,2];case 1:return n=o.sent(),w(2,"address",n),this.saveConnections(),this.emitSavedConnection(n),[2,n];case 2:throw new Error("Wallet type not found")}})})},c.prototype.signMessage=function(r,e){return d(this,void 0,void 0,function(){var n,o;return h(this,function(t){switch(t.label){case 0:return n=this.getWalletProvider(r),o=n.getSigner(r),[4,o.signMessage(e)];case 1:return[2,t.sent()]}})})},c.prototype.getWalletProvider=function(r){var e;if(r=r.toLowerCase(),!(!((e=this.connections[r])===null||e===void 0)&&e.provider))throw new Error("Wallet provider not found for address");return this.connections[r].provider},c.prototype.getConnectedWalletData=function(){return Object.values(this.connections)},c.prototype.registerNewWalletAddress=function(r,e,n,o,t){return t===void 0&&(t="evm"),this.connections[r.toLowerCase()]={address:r,chainId:e,providerType:n,provider:o,blockchain:t,ethers:E},r},c.prototype.registerProvider=function(r,e){return d(this,void 0,void 0,function(){var n,o,t,s=this;return h(this,function(u){switch(u.label){case 0:return[4,r.listAccounts()];case 1:return n=u.sent(),[4,r.detectNetwork()];case 2:if(o=u.sent().chainId,n.length===0)throw new Error("No accounts found via wallet-connect.");return t=n[0],this.registerNewWalletAddress(t,o,e,r),r.provider.on("accountsChanged",function(a){if(!a||a.length===0){s.client.disconnectWallet();return}t!==a[0]&&(delete s.connections[t.toLowerCase()],t=a[0],s.registerNewWalletAddress(t,o,e,r),s.saveConnections(),s.emitSavedConnection(t),s.client.getTokenStore().clearCachedTokens(),s.client.enrichTokenLookupDataOnChainTokens())}),r.provider.on("chainChanged",function(a){s.registerNewWalletAddress(n[0],a,e,r),s.saveConnections(),s.emitNetworkChange(a)}),r.provider.on("disconnect",function(a){a?.message&&a.message.indexOf("MetaMask: Disconnected from chain")>-1||s.client.disconnectWallet()}),[2,n[0]]}})})},c.prototype.MetaMask=function(r){return d(this,void 0,void 0,function(){var e;return h(this,function(n){switch(n.label){case 0:return w(2,"connect MetaMask"),typeof window.ethereum<"u"?[4,window.ethereum.enable()]:[3,2];case 1:return n.sent(),e=new y(window.ethereum,"any"),[2,this.registerProvider(e,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},c.prototype.WalletConnect=function(r){return d(this,void 0,void 0,function(){var e,n,o=this;return h(this,function(t){switch(t.label){case 0:return w(2,"connect Wallet Connect"),[4,g(()=>import("./WalletConnectProvider.acf0452e.js"),["assets/WalletConnectProvider.acf0452e.js","assets/index.ff75fa43.js","assets/index.83e4cba3.css","assets/WalletConnectV2Provider.e48ade96.js"])];case 1:return e=t.sent(),[4,e.getWalletConnectProviderInstance(r)];case 2:return n=t.sent(),[2,new Promise(function(s,u){r&&n.connector.on("display_uri",function(a,i){u(new Error("Connection expired"))}),n.enable().then(function(){var a=new y(n,"any");s(o.registerProvider(a,"WalletConnect"))}).catch(function(a){return u(a)})})]}})})},c.prototype.WalletConnectV2=function(r){var e,n,o,t,s,u;return d(this,void 0,void 0,function(){var a,i,l,f,b=this;return h(this,function(C){switch(C.label){case 0:return w(2,"connect Wallet Connect V2"),[4,g(()=>import("./WalletConnectV2Provider.e48ade96.js"),["assets/WalletConnectV2Provider.e48ade96.js","assets/index.ff75fa43.js","assets/index.83e4cba3.css"])];case 1:return a=C.sent(),[4,a.getWalletConnectV2ProviderInstance()];case 2:return i=C.sent(),i.on("display_uri",function(v){return d(b,void 0,void 0,function(){var _=this;return h(this,function(p){switch(p.label){case 0:return console.log("EVENT","QR Code Modal open"),[4,g(()=>import("./index.0112629c.js").then(m=>m.i),["assets/index.0112629c.js","assets/index.ff75fa43.js","assets/index.83e4cba3.css"])];case 1:return l=p.sent().default,l.open(v,function(){_.client.getUi().showError("User closed modal")}),[2]}})})}),i.on("session_delete",function(v){v.id,v.topic,console.log("WC V2 EVENT","session_deleted"),b.client.disconnectWallet()}),r?[3,4]:(f=void 0,[4,i.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:(o=(n=(e=this.walletOptions)===null||e===void 0?void 0:e.walletConnectV2)===null||n===void 0?void 0:n.chains)!==null&&o!==void 0?o:a.WC_V2_DEFAULT_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:(u=(s=(t=this.walletOptions)===null||t===void 0?void 0:t.walletConnectV2)===null||s===void 0?void 0:s.rpcMap)!==null&&u!==void 0?u:a.WC_DEFAULT_RPC_MAP}},pairingTopic:f?.topic})]);case 3:C.sent(),l.close(),C.label=4;case 4:return[2,new Promise(function(v,_){i.enable().then(function(){var p=new y(i,"any");v(b.registerProvider(p,"WalletConnectV2"))}).catch(function(p){_(p)})})]}})})},c.prototype.Torus=function(r){return d(this,void 0,void 0,function(){var e,n,o;return h(this,function(t){switch(t.label){case 0:return[4,g(()=>import("./TorusProvider.50cc6878.js"),["assets/TorusProvider.50cc6878.js","assets/index.ff75fa43.js","assets/index.83e4cba3.css"])];case 1:return e=t.sent(),[4,e.getTorusProviderInstance()];case 2:return n=t.sent(),[4,n.init()];case 3:return t.sent(),[4,n.login()];case 4:return t.sent(),o=new y(n.provider,"any"),[2,this.registerProvider(o,"Torus")]}})})},c.prototype.Phantom=function(r){return d(this,void 0,void 0,function(){var e,n;return h(this,function(o){switch(o.label){case 0:return w(2,"connect Phantom"),typeof window.solana<"u"?[4,window.solana.connect()]:[3,2];case 1:return e=o.sent(),n=e.publicKey.toBase58(),[2,this.registerNewWalletAddress(n,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("Phantom is not available. Please check the extension is supported and active.")}})})},c.prototype.SafeConnect=function(r){return d(this,void 0,void 0,function(){var e,n;return h(this,function(o){switch(o.label){case 0:return w(2,"connect SafeConnect"),[4,this.getSafeConnectProvider()];case 1:return e=o.sent(),[4,e.initSafeConnect()];case 2:return n=o.sent(),this.registerNewWalletAddress(n,1,"SafeConnect",e),[2,n]}})})},c.prototype.Flow=function(r){return d(this,void 0,void 0,function(){var e,n,o;return h(this,function(t){switch(t.label){case 0:return[4,g(()=>import("./FlowProvider.a6ecf7c4.js"),["assets/FlowProvider.a6ecf7c4.js","assets/index.ff75fa43.js","assets/index.83e4cba3.css"])];case 1:return e=t.sent(),n=e.getFlowProvider(),[4,n.currentUser.authenticate()];case 2:return t.sent(),[4,n.currentUser.snapshot()];case 3:if(o=t.sent(),!o.addr)throw new Error("Failed to connect Flow wallet");return this.registerNewWalletAddress(o.addr,1,"flow",n),[2,o.addr]}})})},c.prototype.safeConnectAvailable=function(){return this.safeConnectOptions!==void 0},c.prototype.getSafeConnectProvider=function(){return d(this,void 0,void 0,function(){var r;return h(this,function(e){switch(e.label){case 0:return[4,g(()=>import("./index.ff75fa43.js").then(n=>n.S),["assets/index.ff75fa43.js","assets/index.83e4cba3.css"])];case 1:return r=e.sent().SafeConnectProvider,[2,new r(this.client.getUi(),this.safeConnectOptions)]}})})},c.LOCAL_STORAGE_KEY="tn-wallet-connections",c}();export{W as Web3WalletProvider,W as default};
