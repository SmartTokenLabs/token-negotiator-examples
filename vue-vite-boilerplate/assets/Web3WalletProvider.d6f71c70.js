import{e as g,l as f,W as w,b as v}from"./index.65a213fa.js";var d=globalThis&&globalThis.__awaiter||function(a,r,e,n){function o(t){return t instanceof e?t:new e(function(s){s(t)})}return new(e||(e=Promise))(function(t,s){function u(l){try{i(n.next(l))}catch(p){s(p)}}function c(l){try{i(n.throw(l))}catch(p){s(p)}}function i(l){l.done?t(l.value):o(l.value).then(u,c)}i((n=n.apply(a,r||[])).next())})},h=globalThis&&globalThis.__generator||function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},n,o,t,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(i){return function(l){return c([i,l])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(e=0)),e;)try{if(n=1,o&&(t=i[0]&2?o.return:i[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,i[1])).done)return t;switch(o=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,o=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1],t=i;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(i);break}t[2]&&e.ops.pop(),e.trys.pop();continue}i=r.call(a,e)}catch(l){i=[6,l],o=0}finally{n=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},b=function(){function a(r,e){this.connections={},this.client=r,this.safeConnectOptions=e}return a.prototype.saveConnections=function(){var r={};for(var e in this.connections){var n=this.connections[e];r[e]={address:n.address,chainId:n.chainId,providerType:n.providerType,blockchain:n.blockchain,ethers:g}}localStorage.setItem(a.LOCAL_STORAGE_KEY,JSON.stringify(r))},a.prototype.emitSavedConnection=function(r){return Object.keys(this.connections).length&&r?(this.client.eventSender("connected-wallet",this.connections[r.toLocaleLowerCase()]),this.connections[r.toLocaleLowerCase()]):null},a.prototype.emitNetworkChange=function(r){if(r)return this.client.eventSender("network-change",r),r},a.prototype.deleteConnections=function(){this.connections={},localStorage.removeItem(a.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect"),sessionStorage.removeItem("CURRENT_USER")},a.prototype.loadConnections=function(){return d(this,void 0,void 0,function(){var r,e,n,o,t,s,u,c,i;return h(this,function(l){switch(l.label){case 0:if(r=localStorage.getItem(a.LOCAL_STORAGE_KEY),!r)return[2];if(e=JSON.parse(r),!e)return[2];n=e,o=[];for(t in n)o.push(t);s=0,l.label=1;case 1:if(!(s<o.length))return[3,6];if(t=o[s],!(t in n))return[3,5];u=t,c=e[u],l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this.connectWith(c.providerType,!0)];case 3:return l.sent(),[3,5];case 4:return i=l.sent(),console.log("Wallet couldn't connect: "+i.message),delete e[u],this.saveConnections(),this.emitSavedConnection(u),[3,5];case 5:return s++,[3,1];case 6:return[2]}})})},a.prototype.connectWith=function(r,e){return e===void 0&&(e=!1),d(this,void 0,void 0,function(){var n;return h(this,function(o){switch(o.label){case 0:if(!r)throw new Error("Please provide a Wallet type to connect with.");return this[r]?[4,this[r](e)]:[3,2];case 1:return n=o.sent(),f(2,"address",n),this.saveConnections(),this.emitSavedConnection(n),[2,n];case 2:throw new Error("Wallet type not found")}})})},a.prototype.signMessage=function(r,e){return d(this,void 0,void 0,function(){var n,o;return h(this,function(t){switch(t.label){case 0:return n=this.getWalletProvider(r),o=n.getSigner(r),[4,o.signMessage(e)];case 1:return[2,t.sent()]}})})},a.prototype.getWalletProvider=function(r){var e;if(r=r.toLowerCase(),!(!((e=this.connections[r])===null||e===void 0)&&e.provider))throw new Error("Wallet provider not found for address");return this.connections[r].provider},a.prototype.getConnectedWalletData=function(){return Object.values(this.connections)},a.prototype.registerNewWalletAddress=function(r,e,n,o,t){return t===void 0&&(t="evm"),this.connections[r.toLowerCase()]={address:r,chainId:e,providerType:n,provider:o,blockchain:t,ethers:g},r},a.prototype.registerProvider=function(r,e){return d(this,void 0,void 0,function(){var n,o,t,s=this;return h(this,function(u){switch(u.label){case 0:return[4,r.listAccounts()];case 1:return n=u.sent(),[4,r.detectNetwork()];case 2:if(o=u.sent().chainId,n.length===0)throw new Error("No accounts found via wallet-connect.");return t=n[0],this.registerNewWalletAddress(t,o,e,r),r.provider.on("accountsChanged",function(c){if(!c||c.length===0){s.client.disconnectWallet();return}t!==c[0]&&(delete s.connections[t.toLowerCase()],t=c[0],s.registerNewWalletAddress(t,o,e,r),s.saveConnections(),s.emitSavedConnection(t),s.client.getTokenStore().clearCachedTokens(),s.client.enrichTokenLookupDataOnChainTokens())}),r.provider.on("chainChanged",function(c){s.registerNewWalletAddress(n[0],c,e,r),s.saveConnections(),s.emitNetworkChange(c)}),r.provider.on("disconnect",function(c){c?.message&&c.message.indexOf("MetaMask: Disconnected from chain")>-1||s.client.disconnectWallet()}),[2,n[0]]}})})},a.prototype.MetaMask=function(r){return d(this,void 0,void 0,function(){var e;return h(this,function(n){switch(n.label){case 0:return f(2,"connect MetaMask"),typeof window.ethereum<"u"?[4,window.ethereum.enable()]:[3,2];case 1:return n.sent(),e=new w(window.ethereum,"any"),[2,this.registerProvider(e,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},a.prototype.WalletConnect=function(r){return d(this,void 0,void 0,function(){var e,n,o=this;return h(this,function(t){switch(t.label){case 0:return f(2,"connect Wallet Connect"),[4,v(()=>import("./WalletConnectProvider.8c3eb9fc.js"),["assets/WalletConnectProvider.8c3eb9fc.js","assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return e=t.sent(),[4,e.getWalletConnectProviderInstance(r)];case 2:return n=t.sent(),[2,new Promise(function(s,u){r&&n.connector.on("display_uri",function(c,i){u(new Error("Connection expired"))}),n.enable().then(function(){var c=new w(n,"any");s(o.registerProvider(c,"WalletConnect"))}).catch(function(c){return u(c)})})]}})})},a.prototype.WalletConnectV2=function(r){return d(this,void 0,void 0,function(){var e,n,o,t,s=this;return h(this,function(u){switch(u.label){case 0:return f(2,"connect Wallet Connect V2"),[4,v(()=>import("./WalletConnectV2Provider.c497ea74.js"),["assets/WalletConnectV2Provider.c497ea74.js","assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return e=u.sent(),[4,e.getWalletConnectV2ProviderInstance()];case 2:return n=u.sent(),n.on("display_uri",function(c){return d(s,void 0,void 0,function(){var i=this;return h(this,function(l){switch(l.label){case 0:return console.log("EVENT","QR Code Modal open"),[4,v(()=>import("./index.88c2e85a.js").then(p=>p.i),["assets/index.88c2e85a.js","assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return o=l.sent().default,o.open(c,function(){i.client.getUi().showError("User closed modal")}),[2]}})})}),n.on("session_delete",function(c){c.id,c.topic,console.log("WC V2 EVENT","session_deleted"),s.client.disconnectWallet()}),r?[3,4]:(t=void 0,[4,n.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:e.WC_V2_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:e.CUSTOM_RPCS_FOR_WC_V2}},pairingTopic:t?.topic})]);case 3:u.sent(),o.close(),u.label=4;case 4:return[2,new Promise(function(c,i){n.enable().then(function(){var l=new w(n,"any");c(s.registerProvider(l,"WalletConnectV2"))}).catch(function(l){i(l)})})]}})})},a.prototype.Torus=function(r){return d(this,void 0,void 0,function(){var e,n,o;return h(this,function(t){switch(t.label){case 0:return[4,v(()=>import("./TorusProvider.6e8f5b9f.js"),["assets/TorusProvider.6e8f5b9f.js","assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return e=t.sent(),[4,e.getTorusProviderInstance()];case 2:return n=t.sent(),[4,n.init()];case 3:return t.sent(),[4,n.login()];case 4:return t.sent(),o=new w(n.provider,"any"),[2,this.registerProvider(o,"Torus")]}})})},a.prototype.Phantom=function(){return d(this,void 0,void 0,function(){var r,e;return h(this,function(n){switch(n.label){case 0:return f(2,"connect Phantom"),typeof window.solana<"u"?[4,window.solana.connect()]:[3,2];case 1:return r=n.sent(),e=r.publicKey.toBase58(),[2,this.registerNewWalletAddress(e,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},a.prototype.SafeConnect=function(){return d(this,void 0,void 0,function(){var r,e;return h(this,function(n){switch(n.label){case 0:return f(2,"connect SafeConnect"),[4,this.getSafeConnectProvider()];case 1:return r=n.sent(),[4,r.initSafeConnect()];case 2:return e=n.sent(),this.registerNewWalletAddress(e,1,"SafeConnect",r),[2,e]}})})},a.prototype.flowSubscribe=function(r,e){return d(this,void 0,void 0,function(){var n;return h(this,function(o){try{e.addr&&(this.registerNewWalletAddress(e.addr,1,"flow",r),n=this.client.getUi(),n&&n.dismissLoader(),this.client.enrichTokenLookupDataOnChainTokens(),n&&n.updateUI("main"))}catch(t){console.error("flow wallet connection error ==>",t),this.client.getUi().showError("Flow wallet connection error.")}return[2]})})},a.prototype.Flow=function(){return d(this,void 0,void 0,function(){var r,e,n,o=this;return h(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,v(()=>import("./FlowProvider.92302f16.js"),["assets/FlowProvider.92302f16.js","assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return r=t.sent(),e=r.getFlowProvider(),e.currentUser.subscribe(function(s){return o.flowSubscribe(e,s)}),e.authenticate(),[3,3];case 2:return n=t.sent(),console.error("error ==>",n),[3,3];case 3:return[2,""]}})})},a.prototype.safeConnectAvailable=function(){return this.safeConnectOptions!==void 0},a.prototype.getSafeConnectProvider=function(){return d(this,void 0,void 0,function(){var r;return h(this,function(e){switch(e.label){case 0:return[4,v(()=>import("./index.65a213fa.js").then(n=>n.S),["assets/index.65a213fa.js","assets/index.e35c9ec5.css"])];case 1:return r=e.sent().SafeConnectProvider,[2,new r(this.client.getUi(),this.safeConnectOptions)]}})})},a.LOCAL_STORAGE_KEY="tn-wallet-connections",a}();export{b as Web3WalletProvider,b as default};
