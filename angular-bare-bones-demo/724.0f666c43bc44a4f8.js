"use strict";(self.webpackChunkAngular_bare_bones_demo=self.webpackChunkAngular_bare_bones_demo||[]).push([[724],{3724:(W,C,d)=>{d.r(C),d.d(C,{Web3WalletProvider:()=>y,default:()=>b});var p=d(4266),g=d(9267),v=d(4033),h=function(a,o,e,t){return new(e||(e=Promise))(function(n,s){function u(l){try{r(t.next(l))}catch(w){s(w)}}function c(l){try{r(t.throw(l))}catch(w){s(w)}}function r(l){l.done?n(l.value):function i(n){return n instanceof e?n:new e(function(s){s(n)})}(l.value).then(u,c)}r((t=t.apply(a,o||[])).next())})},f=function(a,o){var t,i,n,s,e={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(r){return function(l){return function c(r){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(e=0)),e;)try{if(t=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return e.label++,{value:r[1],done:!1};case 5:e.label++,i=r[1],r=[0];continue;case 7:r=e.ops.pop(),e.trys.pop();continue;default:if(!(n=(n=e.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){e=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){e.label=r[1];break}if(6===r[0]&&e.label<n[1]){e.label=n[1],n=r;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(r);break}n[2]&&e.ops.pop(),e.trys.pop();continue}r=o.call(a,e)}catch(l){r=[6,l],i=0}finally{t=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},y=function(){function a(o,e){this.connections={},this.client=o,this.safeConnectOptions=e}return a.prototype.saveConnections=function(){var o={};for(var e in this.connections){var t=this.connections[e];o[e]={address:t.address,chainId:t.chainId,providerType:t.providerType,blockchain:t.blockchain,ethers:p}}localStorage.setItem(a.LOCAL_STORAGE_KEY,JSON.stringify(o))},a.prototype.emitSavedConnection=function(o){return Object.keys(this.connections).length&&o?(this.client.eventSender("connected-wallet",{data:this.connections[o.toLocaleLowerCase()]}),this.connections[o.toLocaleLowerCase()]):null},a.prototype.emitNetworkChange=function(o){if(o)return this.client.eventSender("network-change",o),o},a.prototype.deleteConnections=function(){this.connections={},localStorage.removeItem(a.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect"),sessionStorage.removeItem("CURRENT_USER")},a.prototype.loadConnections=function(){return h(this,void 0,void 0,function(){var o,e,t,i,n,s,u,c,r;return f(this,function(l){switch(l.label){case 0:if(!(o=localStorage.getItem(a.LOCAL_STORAGE_KEY)))return[2];if(!(e=JSON.parse(o)))return[2];for(n in i=[],t=e)i.push(n);s=0,l.label=1;case 1:if(!(s<i.length))return[3,6];if(!((n=i[s])in t))return[3,5];c=e[u=n],l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this.connectWith(c.providerType,!0)];case 3:return l.sent(),[3,5];case 4:return r=l.sent(),console.log("Wallet couldn't connect: "+r.message),delete e[u],this.saveConnections(),this.emitSavedConnection(u),[3,5];case 5:return s++,[3,1];case 6:return[2]}})})},a.prototype.connectWith=function(o,e){return void 0===e&&(e=!1),h(this,void 0,void 0,function(){var t;return f(this,function(i){switch(i.label){case 0:if(!o)throw new Error("Please provide a Wallet type to connect with.");return this[o]?[4,this[o](e)]:[3,2];case 1:return t=i.sent(),(0,v.kg)(2,"address",t),this.saveConnections(),this.emitSavedConnection(t),[2,t];case 2:throw new Error("Wallet type not found")}})})},a.prototype.signMessage=function(o,e){return h(this,void 0,void 0,function(){return f(this,function(n){switch(n.label){case 0:return[4,this.getWalletProvider(o).getSigner(o).signMessage(e)];case 1:return[2,n.sent()]}})})},a.prototype.getWalletProvider=function(o){var e;if(o=o.toLowerCase(),!(null===(e=this.connections[o])||void 0===e?void 0:e.provider))throw new Error("Wallet provider not found for address");return this.connections[o].provider},a.prototype.getConnectedWalletData=function(){return Object.values(this.connections)},a.prototype.registerNewWalletAddress=function(o,e,t,i,n){return void 0===n&&(n="evm"),this.connections[o.toLowerCase()]={address:o,chainId:e,providerType:t,provider:i,blockchain:n,ethers:p},o},a.prototype.registerProvider=function(o,e){return h(this,void 0,void 0,function(){var t,i,n,s=this;return f(this,function(u){switch(u.label){case 0:return[4,o.listAccounts()];case 1:return t=u.sent(),[4,o.detectNetwork()];case 2:if(i=u.sent().chainId,0===t.length)throw new Error("No accounts found via wallet-connect.");return this.registerNewWalletAddress(n=t[0],i,e,o),o.provider.on("accountsChanged",function(c){c&&0!==c.length?n!==c[0]&&(delete s.connections[n.toLowerCase()],s.registerNewWalletAddress(n=c[0],i,e,o),s.saveConnections(),s.emitSavedConnection(n),s.client.getTokenStore().clearCachedTokens(),s.client.enrichTokenLookupDataOnChainTokens()):s.client.disconnectWallet()}),o.provider.on("chainChanged",function(c){s.registerNewWalletAddress(t[0],c,e,o),s.saveConnections(),s.emitNetworkChange(c)}),o.provider.on("disconnect",function(c){(null==c?void 0:c.message)&&c.message.indexOf("MetaMask: Disconnected from chain")>-1||s.client.disconnectWallet()}),[2,t[0]]}})})},a.prototype.MetaMask=function(o){return h(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(0,v.kg)(2,"connect MetaMask"),typeof window.ethereum<"u"?[4,window.ethereum.enable()]:[3,2];case 1:return t.sent(),e=new g.Q(window.ethereum,"any"),[2,this.registerProvider(e,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},a.prototype.WalletConnect=function(o){return h(this,void 0,void 0,function(){var t,i=this;return f(this,function(n){switch(n.label){case 0:return(0,v.kg)(2,"connect Wallet Connect"),[4,d.e(110).then(d.bind(d,4110))];case 1:return[4,n.sent().getWalletConnectProviderInstance(o)];case 2:return t=n.sent(),[2,new Promise(function(s,u){o&&t.connector.on("display_uri",function(c,r){u(new Error("Connection expired"))}),t.enable().then(function(){var c=new g.Q(t,"any");s(i.registerProvider(c,"WalletConnect"))}).catch(function(c){return u(c)})})]}})})},a.prototype.WalletConnectV2=function(o){return h(this,void 0,void 0,function(){var e,t,i,s=this;return f(this,function(u){switch(u.label){case 0:return(0,v.kg)(2,"connect Wallet Connect V2"),[4,d.e(66).then(d.bind(d,6066))];case 1:return[4,(e=u.sent()).getWalletConnectV2ProviderInstance()];case 2:return(t=u.sent()).on("display_uri",function(c){return h(s,void 0,void 0,function(){var r=this;return f(this,function(l){switch(l.label){case 0:return console.log("EVENT","QR Code Modal open"),[4,d.e(475).then(d.t.bind(d,5475,23))];case 1:return(i=l.sent().default).open(c,function(){r.client.getUi().showError("User closed modal")}),[2]}})})}),t.on("session_delete",function(c){console.log("WC V2 EVENT","session_deleted"),s.client.disconnectWallet()}),o?[3,4]:[4,t.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:e.WC_V2_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:e.CUSTOM_RPCS_FOR_WC_V2}},pairingTopic:void 0})];case 3:u.sent(),i.close(),u.label=4;case 4:return[2,new Promise(function(c,r){t.enable().then(function(){var l=new g.Q(t,"any");c(s.registerProvider(l,"WalletConnectV2"))}).catch(function(l){r(l)})})]}})})},a.prototype.Torus=function(o){return h(this,void 0,void 0,function(){var t,i;return f(this,function(n){switch(n.label){case 0:return[4,d.e(795).then(d.bind(d,8795))];case 1:return[4,n.sent().getTorusProviderInstance()];case 2:return[4,(t=n.sent()).init()];case 3:return n.sent(),[4,t.login()];case 4:return n.sent(),i=new g.Q(t.provider,"any"),[2,this.registerProvider(i,"Torus")]}})})},a.prototype.Phantom=function(){return h(this,void 0,void 0,function(){var o,e;return f(this,function(t){switch(t.label){case 0:return(0,v.kg)(2,"connect Phantom"),typeof window.solana<"u"?[4,window.solana.connect()]:[3,2];case 1:return o=t.sent(),e=o.publicKey.toBase58(),[2,this.registerNewWalletAddress(e,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},a.prototype.SafeConnect=function(){return h(this,void 0,void 0,function(){var o,e;return f(this,function(t){switch(t.label){case 0:return(0,v.kg)(2,"connect SafeConnect"),[4,this.getSafeConnectProvider()];case 1:return[4,(o=t.sent()).initSafeConnect()];case 2:return e=t.sent(),this.registerNewWalletAddress(e,1,"SafeConnect",o),[2,e]}})})},a.prototype.flowSubscribe=function(o,e){return h(this,void 0,void 0,function(){var t;return f(this,function(i){try{e.addr&&(this.registerNewWalletAddress(e.addr,1,"flow",o),(t=this.client.getUi())&&t.dismissLoader(),this.client.enrichTokenLookupDataOnChainTokens(),t&&t.updateUI("main"))}catch(n){console.error("flow wallet connection error ==>",n),this.client.getUi().showError("Flow wallet connection error.")}return[2]})})},a.prototype.Flow=function(){return h(this,void 0,void 0,function(){var o,e,t,i=this;return f(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,d.e(952).then(d.bind(d,4952))];case 1:return o=n.sent(),(e=o.getFlowProvider()).currentUser.subscribe(function(s){return i.flowSubscribe(e,s)}),e.authenticate(),[3,3];case 2:return t=n.sent(),console.error("error ==>",t),[3,3];case 3:return[2,""]}})})},a.prototype.safeConnectAvailable=function(){return void 0!==this.safeConnectOptions},a.prototype.getSafeConnectProvider=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(d.bind(d,7747))];case 1:return[2,new(0,e.sent().SafeConnectProvider)(this.client.getUi(),this.safeConnectOptions)]}})})},a.LOCAL_STORAGE_KEY="tn-wallet-connections",a}();const b=y}}]);