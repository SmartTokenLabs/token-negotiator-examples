"use strict";(self.webpackChunkAngular_bare_bones_demo=self.webpackChunkAngular_bare_bones_demo||[]).push([[724],{3724:(A,m,l)=>{l.r(m),l.d(m,{Web3WalletProvider:()=>E,default:()=>S});var b=l(4266),y=l(9267),C=l(4033),h=function(c,o,e,t){return new(e||(e=Promise))(function(n,s){function d(u){try{i(t.next(u))}catch(v){s(v)}}function a(u){try{i(t.throw(u))}catch(v){s(v)}}function i(u){u.done?n(u.value):function r(n){return n instanceof e?n:new e(function(s){s(n)})}(u.value).then(d,a)}i((t=t.apply(c,o||[])).next())})},f=function(c,o){var t,r,n,s,e={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function d(i){return function(u){return function a(i){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(e=0)),e;)try{if(t=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return e.label++,{value:i[1],done:!1};case 5:e.label++,r=i[1],i=[0];continue;case 7:i=e.ops.pop(),e.trys.pop();continue;default:if(!(n=(n=e.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){e=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){e.label=i[1];break}if(6===i[0]&&e.label<n[1]){e.label=n[1],n=i;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(i);break}n[2]&&e.ops.pop(),e.trys.pop();continue}i=o.call(c,e)}catch(u){i=[6,u],r=0}finally{t=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},E=function(){function c(o,e,t){this.client=o,this.walletOptions=e,this.safeConnectOptions=t,this.connections={}}return c.prototype.saveConnections=function(){var o={};for(var e in this.connections){var t=this.connections[e];o[e]={address:t.address,chainId:t.chainId,providerType:t.providerType,blockchain:t.blockchain}}localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(o))},c.prototype.emitSavedConnection=function(o){return Object.keys(this.connections).length&&o?(this.client.eventSender("connected-wallet",this.connections[o.toLocaleLowerCase()]),this.connections[o.toLocaleLowerCase()]):null},c.prototype.emitNetworkChange=function(o){if(o)return this.client.eventSender("network-change",o),o},c.prototype.deleteConnections=function(){this.connections={},localStorage.removeItem(c.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect"),sessionStorage.removeItem("CURRENT_USER")},c.prototype.loadConnections=function(){return h(this,void 0,void 0,function(){var o,e,t,r,n,s,d,a,i;return f(this,function(u){switch(u.label){case 0:if(!(o=localStorage.getItem(c.LOCAL_STORAGE_KEY)))return[2];if(!(e=JSON.parse(o)))return[2];for(n in r=[],t=e)r.push(n);s=0,u.label=1;case 1:if(!(s<r.length))return[3,6];if(!((n=r[s])in t))return[3,5];a=e[d=n],u.label=2;case 2:return u.trys.push([2,4,,5]),[4,this.connectWith(a.providerType,!0)];case 3:return u.sent(),[3,5];case 4:return i=u.sent(),console.log("Wallet couldn't connect: "+i.message),delete e[d],this.saveConnections(),this.emitSavedConnection(d),[3,5];case 5:return s++,[3,1];case 6:return[2]}})})},c.prototype.connectWith=function(o,e){return void 0===e&&(e=!1),h(this,void 0,void 0,function(){var t;return f(this,function(r){switch(r.label){case 0:if(!o)throw new Error("Please provide a Wallet type to connect with.");return this[o]?[4,this[o](e)]:[3,2];case 1:return t=r.sent(),(0,C.kg)(2,"address",t),this.saveConnections(),this.emitSavedConnection(t),[2,t];case 2:throw new Error("Wallet type not found")}})})},c.prototype.signMessage=function(o,e){return h(this,void 0,void 0,function(){return f(this,function(n){switch(n.label){case 0:return[4,this.getWalletProvider(o).getSigner(o).signMessage(e)];case 1:return[2,n.sent()]}})})},c.prototype.getWalletProvider=function(o){var e;if(o=o.toLowerCase(),!(null===(e=this.connections[o])||void 0===e?void 0:e.provider))throw new Error("Wallet provider not found for address");return this.connections[o].provider},c.prototype.getConnectedWalletData=function(){return Object.values(this.connections)},c.prototype.registerNewWalletAddress=function(o,e,t,r,n){return void 0===n&&(n="evm"),this.connections[o.toLowerCase()]={address:o,chainId:e,providerType:t,provider:r,blockchain:n,ethers:b},o},c.prototype.registerProvider=function(o,e){return h(this,void 0,void 0,function(){var t,r,n,s=this;return f(this,function(d){switch(d.label){case 0:return[4,o.listAccounts()];case 1:return t=d.sent(),[4,o.detectNetwork()];case 2:if(r=d.sent().chainId,0===t.length)throw new Error("No accounts found via wallet-connect.");return this.registerNewWalletAddress(n=t[0],r,e,o),o.provider.on("accountsChanged",function(a){a&&0!==a.length?n!==a[0]&&(delete s.connections[n.toLowerCase()],s.registerNewWalletAddress(n=a[0],r,e,o),s.saveConnections(),s.emitSavedConnection(n),s.client.getTokenStore().clearCachedTokens(),s.client.enrichTokenLookupDataOnChainTokens()):s.client.disconnectWallet()}),o.provider.on("chainChanged",function(a){s.registerNewWalletAddress(t[0],a,e,o),s.saveConnections(),s.emitNetworkChange(a)}),o.provider.on("disconnect",function(a){(null==a?void 0:a.message)&&a.message.indexOf("MetaMask: Disconnected from chain")>-1||s.client.disconnectWallet()}),[2,t[0]]}})})},c.prototype.MetaMask=function(o){return h(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(0,C.kg)(2,"connect MetaMask"),typeof window.ethereum<"u"?[4,window.ethereum.enable()]:[3,2];case 1:return t.sent(),e=new y.Q(window.ethereum,"any"),[2,this.registerProvider(e,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},c.prototype.WalletConnect=function(o){return h(this,void 0,void 0,function(){var t,r=this;return f(this,function(n){switch(n.label){case 0:return(0,C.kg)(2,"connect Wallet Connect"),[4,Promise.all([l.e(66),l.e(110)]).then(l.bind(l,4110))];case 1:return[4,n.sent().getWalletConnectProviderInstance(o)];case 2:return t=n.sent(),[2,new Promise(function(s,d){o&&t.connector.on("display_uri",function(a,i){d(new Error("Connection expired"))}),t.enable().then(function(){var a=new y.Q(t,"any");s(r.registerProvider(a,"WalletConnect"))}).catch(function(a){return d(a)})})]}})})},c.prototype.WalletConnectV2=function(o){var e,t,r,n,s,d;return h(this,void 0,void 0,function(){var a,i,u,P=this;return f(this,function(p){switch(p.label){case 0:return(0,C.kg)(2,"connect Wallet Connect V2"),[4,l.e(66).then(l.bind(l,6066))];case 1:return[4,(a=p.sent()).getWalletConnectV2ProviderInstance()];case 2:return(i=p.sent()).on("display_uri",function(g){return h(P,void 0,void 0,function(){var W=this;return f(this,function(w){switch(w.label){case 0:return console.log("EVENT","QR Code Modal open"),[4,l.e(475).then(l.t.bind(l,5475,23))];case 1:return(u=w.sent().default).open(g,function(){W.client.getUi().showError("User closed modal")}),[2]}})})}),i.on("session_delete",function(g){console.log("WC V2 EVENT","session_deleted"),P.client.disconnectWallet()}),o?[3,4]:[4,i.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:null!==(r=null===(t=null===(e=this.walletOptions)||void 0===e?void 0:e.walletConnectV2)||void 0===t?void 0:t.chains)&&void 0!==r?r:a.WC_V2_DEFAULT_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:null!==(d=null===(s=null===(n=this.walletOptions)||void 0===n?void 0:n.walletConnectV2)||void 0===s?void 0:s.rpcMap)&&void 0!==d?d:a.WC_DEFAULT_RPC_MAP}},pairingTopic:void 0})];case 3:p.sent(),u.close(),p.label=4;case 4:return[2,new Promise(function(g,W){i.enable().then(function(){var w=new y.Q(i,"any");g(P.registerProvider(w,"WalletConnectV2"))}).catch(function(w){W(w)})})]}})})},c.prototype.Torus=function(o){return h(this,void 0,void 0,function(){var t,r;return f(this,function(n){switch(n.label){case 0:return[4,l.e(795).then(l.bind(l,8795))];case 1:return[4,n.sent().getTorusProviderInstance()];case 2:return[4,(t=n.sent()).init()];case 3:return n.sent(),[4,t.login()];case 4:return n.sent(),r=new y.Q(t.provider,"any"),[2,this.registerProvider(r,"Torus")]}})})},c.prototype.Phantom=function(o){return h(this,void 0,void 0,function(){var e,t;return f(this,function(r){switch(r.label){case 0:return(0,C.kg)(2,"connect Phantom"),typeof window.solana<"u"?[4,window.solana.connect()]:[3,2];case 1:return e=r.sent(),t=e.publicKey.toBase58(),[2,this.registerNewWalletAddress(t,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("Phantom is not available. Please check the extension is supported and active.")}})})},c.prototype.SafeConnect=function(o){return h(this,void 0,void 0,function(){var e,t;return f(this,function(r){switch(r.label){case 0:return(0,C.kg)(2,"connect SafeConnect"),[4,this.getSafeConnectProvider()];case 1:return[4,(e=r.sent()).initSafeConnect()];case 2:return t=r.sent(),this.registerNewWalletAddress(t,1,"SafeConnect",e),[2,t]}})})},c.prototype.Flow=function(o){return h(this,void 0,void 0,function(){var e,t,r;return f(this,function(n){switch(n.label){case 0:return[4,l.e(235).then(l.bind(l,5235))];case 1:return e=n.sent(),[4,(t=e.getFlowProvider()).currentUser.authenticate()];case 2:return n.sent(),[4,t.currentUser.snapshot()];case 3:if(!(r=n.sent()).addr)throw new Error("Failed to connect Flow wallet");return this.registerNewWalletAddress(r.addr,1,"flow",t),[2,r.addr]}})})},c.prototype.safeConnectAvailable=function(){return void 0!==this.safeConnectOptions},c.prototype.getSafeConnectProvider=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(l.bind(l,7747))];case 1:return[2,new(0,e.sent().SafeConnectProvider)(this.client.getUi(),this.safeConnectOptions)]}})})},c.LOCAL_STORAGE_KEY="tn-wallet-connections",c}();const S=E}}]);