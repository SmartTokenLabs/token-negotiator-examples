"use strict";(self.webpackChunkAngular_bare_bones_demo=self.webpackChunkAngular_bare_bones_demo||[]).push([[724],{3724:(W,p,d)=>{d.r(p),d.d(p,{Web3WalletProvider:()=>y,default:()=>b});var w=d(4266),C=d(9267),v=d(4033),h=function(c,t,e,o){return new(e||(e=Promise))(function(n,s){function u(a){try{r(o.next(a))}catch(g){s(g)}}function l(a){try{r(o.throw(a))}catch(g){s(g)}}function r(a){a.done?n(a.value):function i(n){return n instanceof e?n:new e(function(s){s(n)})}(a.value).then(u,l)}r((o=o.apply(c,t||[])).next())})},f=function(c,t){var o,i,n,s,e={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(r){return function(a){return function l(r){if(o)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(e=0)),e;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return e.label++,{value:r[1],done:!1};case 5:e.label++,i=r[1],r=[0];continue;case 7:r=e.ops.pop(),e.trys.pop();continue;default:if(!(n=(n=e.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){e=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){e.label=r[1];break}if(6===r[0]&&e.label<n[1]){e.label=n[1],n=r;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(r);break}n[2]&&e.ops.pop(),e.trys.pop();continue}r=t.call(c,e)}catch(a){r=[6,a],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},y=function(){function c(t,e){this.connections={},this.client=t,this.safeConnectOptions=e}return c.prototype.saveConnections=function(){var t={};for(var e in this.connections){var o=this.connections[e];t[e]={address:o.address,chainId:o.chainId,providerType:o.providerType,blockchain:o.blockchain,ethers:w}}localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(t))},c.prototype.emitSavedConnection=function(t){return Object.keys(this.connections).length&&t?(this.client.eventSender("connected-wallet",{data:this.connections[t.toLocaleLowerCase()]}),this.connections[t.toLocaleLowerCase()]):null},c.prototype.emitNetworkChange=function(t){if(t)return this.client.eventSender("network-change",t),t},c.prototype.deleteConnections=function(){this.connections={},localStorage.removeItem(c.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect")},c.prototype.loadConnections=function(){return h(this,void 0,void 0,function(){var t,e,o,i,n,s,u,l,r;return f(this,function(a){switch(a.label){case 0:if(!(t=localStorage.getItem(c.LOCAL_STORAGE_KEY)))return[2];if(!(e=JSON.parse(t)))return[2];for(n in i=[],o=e)i.push(n);s=0,a.label=1;case 1:if(!(s<i.length))return[3,6];if(!((n=i[s])in o))return[3,5];l=e[u=n],a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.connectWith(l.providerType,!0)];case 3:return a.sent(),[3,5];case 4:return r=a.sent(),console.log("Wallet couldn't connect: "+r.message),delete e[u],this.saveConnections(),this.emitSavedConnection(u),[3,5];case 5:return s++,[3,1];case 6:return[2]}})})},c.prototype.connectWith=function(t,e){return void 0===e&&(e=!1),h(this,void 0,void 0,function(){var o;return f(this,function(i){switch(i.label){case 0:if(!t)throw new Error("Please provide a Wallet type to connect with.");return this[t]?[4,this[t](e)]:[3,2];case 1:return o=i.sent(),(0,v.kg)(2,"address",o),this.saveConnections(),this.emitSavedConnection(o),[2,o];case 2:throw new Error("Wallet type not found")}})})},c.prototype.signMessage=function(t,e){return h(this,void 0,void 0,function(){return f(this,function(n){switch(n.label){case 0:return[4,this.getWalletProvider(t).getSigner(t).signMessage(e)];case 1:return[2,n.sent()]}})})},c.prototype.getWalletProvider=function(t){var e;if(t=t.toLowerCase(),!(null===(e=this.connections[t])||void 0===e?void 0:e.provider))throw new Error("Wallet provider not found for address");return this.connections[t].provider},c.prototype.getConnectedWalletData=function(){return Object.values(this.connections)},c.prototype.registerNewWalletAddress=function(t,e,o,i,n){return void 0===n&&(n="evm"),this.connections[t.toLowerCase()]={address:t,chainId:e,providerType:o,provider:i,blockchain:n,ethers:w},t},c.prototype.registerProvider=function(t,e){return h(this,void 0,void 0,function(){var o,i,n,s=this;return f(this,function(u){switch(u.label){case 0:return[4,t.listAccounts()];case 1:return o=u.sent(),[4,t.detectNetwork()];case 2:if(i=u.sent().chainId,0===o.length)throw new Error("No accounts found via wallet-connect.");return this.registerNewWalletAddress(n=o[0],i,e,t),t.provider.on("accountsChanged",function(l){n!==l[0]&&(delete s.connections[n.toLowerCase()],s.registerNewWalletAddress(n=l[0],i,e,t),s.saveConnections(),s.emitSavedConnection(n),s.client.getTokenStore().clearCachedTokens(),s.client.enrichTokenLookupDataOnChainTokens())}),t.provider.on("chainChanged",function(l){s.registerNewWalletAddress(o[0],l,e,t),s.saveConnections(),s.emitNetworkChange(l)}),[2,o[0]]}})})},c.prototype.MetaMask=function(t){return h(this,void 0,void 0,function(){var e;return f(this,function(o){switch(o.label){case 0:return(0,v.kg)(2,"connect MetaMask"),typeof window.ethereum<"u"?[4,window.ethereum.enable()]:[3,2];case 1:return o.sent(),e=new C.Q(window.ethereum,"any"),[2,this.registerProvider(e,"MetaMask")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},c.prototype.WalletConnect=function(t){return h(this,void 0,void 0,function(){var o,i=this;return f(this,function(n){switch(n.label){case 0:return(0,v.kg)(2,"connect Wallet Connect"),[4,d.e(110).then(d.bind(d,4110))];case 1:return[4,n.sent().getWalletConnectProviderInstance(t)];case 2:return o=n.sent(),[2,new Promise(function(s,u){t&&o.connector.on("display_uri",function(l,r){u(new Error("Connection expired"))}),o.enable().then(function(){var l=new C.Q(o,"any");s(i.registerProvider(l,"WalletConnect"))}).catch(function(l){return u(l)})})]}})})},c.prototype.WalletConnectV2=function(t){return h(this,void 0,void 0,function(){var e,o,i,s=this;return f(this,function(u){switch(u.label){case 0:return(0,v.kg)(2,"connect Wallet Connect V2"),[4,d.e(66).then(d.bind(d,6066))];case 1:return[4,(e=u.sent()).getWalletConnectV2ProviderInstance()];case 2:return(o=u.sent()).on("display_uri",function(l){return h(s,void 0,void 0,function(){var r=this;return f(this,function(a){switch(a.label){case 0:return console.log("EVENT","QR Code Modal open"),[4,d.e(475).then(d.t.bind(d,5475,23))];case 1:return(i=a.sent().default).open(l,function(){r.client.getUi().showError("User closed modal")}),[2]}})})}),o.on("session_delete",function(l){console.log("WC V2 EVENT","session_deleted"),s.client.disconnectWallet();var g=s.client.getUi();g&&g.updateUI("wallet")}),t?[3,4]:[4,o.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:e.WC_V2_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:e.CUSTOM_RPCS_FOR_WC_V2}},pairingTopic:void 0})];case 3:u.sent(),i.close(),u.label=4;case 4:return[2,new Promise(function(l,r){o.enable().then(function(){var a=new C.Q(o,"any");l(s.registerProvider(a,"WalletConnectV2"))}).catch(function(a){r(a)})})]}})})},c.prototype.Torus=function(t){return h(this,void 0,void 0,function(){var o,i;return f(this,function(n){switch(n.label){case 0:return[4,d.e(795).then(d.bind(d,8795))];case 1:return[4,n.sent().getTorusProviderInstance()];case 2:return[4,(o=n.sent()).init()];case 3:return n.sent(),[4,o.login()];case 4:return n.sent(),i=new C.Q(o.provider,"any"),[2,this.registerProvider(i,"Torus")]}})})},c.prototype.Phantom=function(){return h(this,void 0,void 0,function(){var t,e;return f(this,function(o){switch(o.label){case 0:return(0,v.kg)(2,"connect Phantom"),typeof window.solana<"u"?[4,window.solana.connect()]:[3,2];case 1:return t=o.sent(),e=t.publicKey.toBase58(),[2,this.registerNewWalletAddress(e,"mainnet-beta","phantom",window.solana,"solana")];case 2:throw new Error("MetaMask is not available. Please check the extension is supported and active.")}})})},c.prototype.SafeConnect=function(){return h(this,void 0,void 0,function(){var t,e;return f(this,function(o){switch(o.label){case 0:return(0,v.kg)(2,"connect SafeConnect"),[4,this.getSafeConnectProvider()];case 1:return[4,(t=o.sent()).initSafeConnect()];case 2:return e=o.sent(),this.registerNewWalletAddress(e,1,"SafeConnect",t),[2,e]}})})},c.prototype.safeConnectAvailable=function(){return void 0!==this.safeConnectOptions},c.prototype.getSafeConnectProvider=function(){return h(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(d.bind(d,7747))];case 1:return[2,new(0,e.sent().SafeConnectProvider)(this.client.getUi(),this.safeConnectOptions)]}})})},c.LOCAL_STORAGE_KEY="tn-wallet-connections",c}();const b=y}}]);