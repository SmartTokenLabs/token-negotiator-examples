LavaPack.loadBundle([[30,{"../../../shared/constants/gas":6263,"../../../shared/constants/smartTransactions":6269,"../../../shared/constants/swaps":6270,"../../../shared/constants/time":6271,"../../../shared/modules/conversion.utils":6275,"../../../shared/modules/string-utils":6283,"../../../shared/modules/swaps.utils":6284,"../../../ui/helpers/utils/fetch-with-cache":6821,"../../../ui/helpers/utils/token-util":6835,"../../../ui/pages/send/send.utils":7076,"../../../ui/pages/swaps/swaps.util":7184,"./network":17,"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"@metamask/obs-store":1204,"bignumber.js":2063,ethers:2636,"human-standard-token-abi":4496,lodash:5255,loglevel:5268},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=e("ethers"),a=n(e("loglevel")),o=n(e("bignumber.js")),c=e("@metamask/obs-store"),u=e("lodash"),l=n(e("human-standard-token-abi")),h=e("../../../ui/helpers/utils/token-util"),f=e("../../../ui/pages/send/send.utils"),d=e("../../../shared/modules/conversion.utils"),p=e("../../../shared/constants/swaps"),g=e("../../../shared/constants/gas"),m=e("../../../shared/constants/smartTransactions"),w=e("../../../shared/modules/swaps.utils"),_=e("../../../ui/pages/swaps/swaps.util"),y=n(e("../../../ui/helpers/utils/fetch-with-cache")),b=e("../../../shared/constants/time"),v=e("../../../shared/modules/string-utils"),E=e("./network");function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const T=25e5,k=b.MINUTE;function A(e=25e5,t=0,r=0){const n=new o.default(e,10).minus(t,10);return!n.lt(0)&&n.lt(r,16)?`0x${n.toString(16)}`:r}const P={swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,saveFetchedQuotes:!1,swapsQuoteRefreshTime:k,swapsQuotePrefetchingRefreshTime:k,swapsStxBatchStatusRefreshTime:m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxGetTransactionsRefreshTime:m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxMaxFeeMultiplier:m.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER,swapsFeatureFlags:{}}};function I(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort(((e,t)=>{const r=new o.default(e.overallValueOfQuote,10),n=new o.default(t.overallValueOfQuote,10);return r.equals(n)?0:r.lessThan(n)?-1:1})),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return N(t.filter((t=>e===t.overallValueOfQuote)))}const r=t.length/2,n=r-1,i=t[r].overallValueOfQuote,s=t[n].overallValueOfQuote,a=t.filter((e=>i===e.overallValueOfQuote)),c=t.filter((e=>s===e.overallValueOfQuote)),u=N(a),l=N(c);return{ethFee:new o.default(u.ethFee,10).plus(l.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new o.default(u.metaMaskFeeInEth,10).plus(l.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new o.default(u.ethValueOfTokens,10).plus(l.ethValueOfTokens,10).dividedBy(2).toString(10)}}function N(e){const t=e.reduce(((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)})),{ethFee:new o.default(0,10),metaMaskFeeInEth:new o.default(0,10),ethValueOfTokens:new o.default(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}r.default=class{constructor({getBufferedGasLimit:e,networkController:t,provider:r,getProviderConfig:n,getTokenRatesState:i,fetchTradesInfo:a=_.fetchTradesInfo,getCurrentChainId:o,getEIP1559GasFeeEstimates:u}){this.store=new c.ObservableStore({swapsState:x({},P.swapsState)}),this._fetchTradesInfo=a,this._getCurrentChainId=o,this._getEIP1559GasFeeEstimates=u,this.getBufferedGasLimit=e,this.getTokenRatesState=i,this.pollCount=0,this.getProviderConfig=n,this.indexOfNewestCallInFlight=0,this.ethersProvider=new s.ethers.providers.Web3Provider(r),this._currentNetwork=t.store.getState().network,t.on(E.NETWORK_EVENTS.NETWORK_DID_CHANGE,(e=>{"loading"!==e&&e!==this._currentNetwork&&(this._currentNetwork=e,this.ethersProvider=new s.ethers.providers.Web3Provider(r))}))}async fetchSwapsNetworkConfig(e){const t=await(0,y.default)((0,_.getBaseApi)("network",e),{method:"GET"},{cacheRefreshTime:6e5}),{refreshRates:r,parameters:n={}}=t||{};if(!r||"number"!=typeof r.quotes||"number"!=typeof r.quotesPrefetching)throw new Error(`MetaMask - invalid response for refreshRates: ${t}`);return{quotes:1e3*r.quotes,quotesPrefetching:1e3*r.quotesPrefetching,stxGetTransactions:1e3*r.stxGetTransactions,stxBatchStatus:1e3*r.stxBatchStatus,stxStatusDeadline:r.stxStatusDeadline,stxMaxFeeMultiplier:n.stxMaxFeeMultiplier}}async _setSwapsNetworkConfig(){var e,t,r,n,i,s;const a=this._getCurrentChainId();let o;try{o=await this.fetchSwapsNetworkConfig(a)}catch(e){console.error("Request for Swaps network config failed: ",e)}const{swapsState:c}=this.store.getState();this.store.updateState({swapsState:x(x({},c),{},{swapsQuoteRefreshTime:(null===(e=o)||void 0===e?void 0:e.quotes)||k,swapsQuotePrefetchingRefreshTime:(null===(t=o)||void 0===t?void 0:t.quotesPrefetching)||k,swapsStxGetTransactionsRefreshTime:(null===(r=o)||void 0===r?void 0:r.stxGetTransactions)||m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxBatchStatusRefreshTime:(null===(n=o)||void 0===n?void 0:n.stxBatchStatus)||m.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxStatusDeadline:(null===(i=o)||void 0===i?void 0:i.stxStatusDeadline)||m.FALLBACK_SMART_TRANSACTIONS_DEADLINE,swapsStxMaxFeeMultiplier:(null===(s=o)||void 0===s?void 0:s.stxMaxFeeMultiplier)||m.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER})})}pollForNewQuotes(){const{swapsState:{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:r}}=this.store.getState(),n=r?e:t;this.pollingTimeout=setTimeout((()=>{var e;const{swapsState:t}=this.store.getState();this.fetchAndSetQuotes(t.fetchParams,null===(e=t.fetchParams)||void 0===e?void 0:e.metaData,!0)}),n)}stopPollingForQuotes(){this.pollingTimeout&&clearTimeout(this.pollingTimeout)}async fetchAndSetQuotes(e,t={},r){const{chainId:n}=t,{swapsState:{quotesPollingLimitEnabled:i,saveFetchedQuotes:s}}=this.store.getState();if(!e)return null;r||(this.pollCount=0),clearTimeout(this.pollingTimeout),r||this.setSwapsErrorKey("");const a=this.indexOfNewestCallInFlight+1;this.indexOfNewestCallInFlight=a,s||this.setSaveFetchedQuotes(!0);let[o]=await Promise.all([this._fetchTradesInfo(e,x({},t)),this._setSwapsNetworkConfig()]);const{swapsState:{saveFetchedQuotes:c}}=this.store.getState();if(!c)return[{},null];o=(0,u.mapValues)(o,(e=>x(x({},e),{},{sourceTokenInfo:t.sourceTokenInfo,destinationTokenInfo:t.destinationTokenInfo})));const l=Date.now();let h=!1;if(!(0,w.isSwapsDefaultTokenAddress)(e.sourceToken,n)&&Object.values(o).length){const t=await this._getERC20Allowance(e.sourceToken,e.fromAddress,n),[i]=Object.values(o);if(h=i.approvalNeeded&&t.eq(0)&&"wrappedNative"!==i.aggregator,h){if(!r){const{gasLimit:e}=await this.timedoutGasReturn(i.approvalNeeded);o=(0,u.mapValues)(o,(t=>x(x({},t),{},{approvalNeeded:x(x({},t.approvalNeeded),{},{gas:e||p.DEFAULT_ERC20_APPROVE_GAS})})))}}else o=(0,u.mapValues)(o,(e=>x(x({},e),{},{approvalNeeded:null})))}let f=null;if(h||null!=e&&e.balanceError||(o=await this.getAllQuotesWithGasEstimates(o)),0===Object.values(o).length)this.setSwapsErrorKey(p.QUOTES_NOT_AVAILABLE_ERROR);else{const[e,t]=await this._findTopQuoteAndCalculateSavings(o);f=e,o=t}if(this.indexOfNewestCallInFlight!==a)throw new Error(p.SWAPS_FETCH_ORDER_CONFLICT);const{swapsState:d}=this.store.getState();let{selectedAggId:g}=d;return o[g]||(g=null),this.store.updateState({swapsState:x(x({},d),{},{quotes:o,fetchParams:x(x({},e),{},{metaData:t}),quotesLastFetched:l,selectedAggId:g,topAggId:f})}),i&&(this.pollCount+=1),!i||this.pollCount<4?(this.pollForNewQuotes(),[o,f]):(this.resetPostFetchState(),this.setSwapsErrorKey(p.QUOTES_EXPIRED_ERROR),null)}safeRefetchQuotes(){const{swapsState:e}=this.store.getState();!this.pollingTimeout&&e.fetchParams&&this.fetchAndSetQuotes(e.fetchParams)}setSelectedQuoteAggId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{selectedAggId:e})})}setSwapsTokens(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{tokens:e})})}clearSwapsQuotes(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:x(x({},e),{},{quotes:{}})})}setSwapsErrorKey(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{errorKey:e})})}async getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map((async e=>{const{gasLimit:t,simulationFails:r}=await this.timedoutGasReturn(e.trade);return[t,r,e.aggregator]}))),r={};return t.forEach((([t,n,i])=>{if(t&&!n){const n=A(e[i].maxGas,e[i].estimatedRefund,t);r[i]=x(x({},e[i]),{},{gasEstimate:t,gasEstimateWithRefund:n})}else e[i].approvalNeeded&&(r[i]=e[i])})),r}timedoutGasReturn(e){return new Promise((t=>{let r=!1;const n=setTimeout((()=>{r=!0,t({gasLimit:null,simulationFails:!0})}),5*b.SECOND),i={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:i},1).then((({gasLimit:e,simulationFails:i})=>{r||(clearTimeout(n),t({gasLimit:e,simulationFails:i}))})).catch((e=>{a.default.error(e),r||(clearTimeout(n),t({gasLimit:null,simulationFails:!0}))}))}))}async setInitialGasEstimate(e){const{swapsState:t}=this.store.getState(),r=x({},t.quotes[e]),{gasLimit:n,simulationFails:i}=await this.timedoutGasReturn(r.trade);if(n&&!i){const e=A(r.maxGas,r.estimatedRefund,n);r.gasEstimate=n,r.gasEstimateWithRefund=e}this.store.updateState({swapsState:x(x({},t),{},{quotes:x(x({},t.quotes),{},{[e]:r})})})}setApproveTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{approveTxId:e})})}setTradeTxId(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{tradeTxId:e})})}setQuotesLastFetched(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{quotesLastFetched:e})})}setSwapsTxGasPrice(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{customGasPrice:e})})}setSwapsTxMaxFeePerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{customMaxFeePerGas:e})})}setSwapsUserFeeLevel(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{swapsUserFeeLevel:e})})}setSwapsQuotesPollingLimitEnabled(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{quotesPollingLimitEnabled:e})})}setSwapsTxMaxFeePriorityPerGas(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{customMaxPriorityFeePerGas:e})})}setSwapsTxGasLimit(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{customMaxGas:e})})}setCustomApproveTxData(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{customApproveTxData:e})})}setBackgroundSwapRouteState(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{routeState:e})})}setSaveFetchedQuotes(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{saveFetchedQuotes:e})})}setSwapsLiveness(e){const{swapsState:t}=this.store.getState(),{swapsFeatureIsLive:r}=e;this.store.updateState({swapsState:x(x({},t),{},{swapsFeatureIsLive:r})})}setSwapsFeatureFlags(e){const{swapsState:t}=this.store.getState();this.store.updateState({swapsState:x(x({},t),{},{swapsFeatureFlags:e})})}resetPostFetchState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:x(x({},P.swapsState),{},{tokens:e.tokens,fetchParams:e.fetchParams,swapsFeatureIsLive:e.swapsFeatureIsLive,swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsFeatureFlags})}),clearTimeout(this.pollingTimeout)}resetSwapsState(){const{swapsState:e}=this.store.getState();this.store.updateState({swapsState:x(x({},P.swapsState),{},{swapsQuoteRefreshTime:e.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsQuotePrefetchingRefreshTime})}),clearTimeout(this.pollingTimeout)}async _findTopQuoteAndCalculateSavings(e={}){const{contractExchangeRates:t}=this.getTokenRatesState(),{swapsState:{customGasPrice:r,customMaxPriorityFeePerGas:n}}=this.store.getState(),i=this._getCurrentChainId();if(!Object.keys(e).length)return{};const s=(0,u.cloneDeep)(e),{gasFeeEstimates:a,gasEstimateType:c}=await this._getEIP1559GasFeeEstimates();let l="0x0";if(c===g.GAS_ESTIMATE_TYPES.FEE_MARKET){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=a;l=(0,d.addCurrencies)(n||(0,d.decGWEIToHexWEI)(e),(0,d.decGWEIToHexWEI)(t),{aBase:16,bBase:16,toNumericBase:"hex",numberOfDecimals:6})}else c===g.GAS_ESTIMATE_TYPES.LEGACY?l=r||(0,d.decGWEIToHexWEI)(a.high):c===g.GAS_ESTIMATE_TYPES.ETH_GASPRICE&&(l=r||(0,d.decGWEIToHexWEI)(a.gasPrice));let p=null,m=null;Object.values(s).forEach((e=>{const{aggregator:r,approvalNeeded:n,averageGas:s,destinationAmount:a=0,destinationToken:c,destinationTokenInfo:u,gasEstimate:g,sourceAmount:_,sourceToken:y,trade:b,fee:E}=e,S=(g?new o.default(g,16):new o.default(s||T,10)).plus((null==n?void 0:n.gas)||"0x0",16).toString(16),x=(0,f.calcGasTotal)(S,l),k=new o.default(x,16).plus(b.value,16),A=(0,d.conversionUtil)(k,{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}),P=(0,w.isSwapsDefaultTokenAddress)(y,i)?(0,d.conversionUtil)(k.minus(_,10),{fromCurrency:"ETH",fromDenomination:"WEI",toDenomination:"ETH",fromNumericBase:"BN",numberOfDecimals:6}):A,I=(0,h.calcTokenAmount)(a,u.decimals),N=new o.default(100,10).minus(E,10).div(100),R=I.div(N).minus(I),O=t[Object.keys(t).find((e=>(0,v.isEqualCaseInsensitive)(e,c)))],C=O||1,D=I.times(C.toString(10),10),L=(0,w.isSwapsDefaultTokenAddress)(c,i)?1:O,B=L===undefined?D:D.minus(P,10);e.ethFee=P.toString(10),L!==undefined&&(e.ethValueOfTokens=D.toString(10),e.overallValueOfQuote=B.toString(10),e.metaMaskFeeInEth=R.times(L.toString(10)).toString(10)),(null===m||B.gt(m))&&(p=r,m=B)}));let _=null;if((0,w.isSwapsDefaultTokenAddress)(s[p].destinationToken,i)||Boolean(t[Object.keys(t).find((e=>{var t;return(0,v.isEqualCaseInsensitive)(e,null===(t=s[p])||void 0===t?void 0:t.destinationToken)}))])){const e=s[p];_={};const{ethFee:t,metaMaskFeeInEth:r,ethValueOfTokens:n}=I(Object.values(s));_.performance=new o.default(e.ethValueOfTokens,10).minus(n,10),_.fee=new o.default(t).minus(e.ethFee,10),_.metaMaskFee=e.metaMaskFeeInEth,_.total=_.performance.plus(_.fee).minus(_.metaMaskFee).toString(10),_.performance=_.performance.toString(10),_.fee=_.fee.toString(10),_.medianMetaMaskFee=r,s[p].isBestQuote=!0,s[p].savings=_}return[p,s]}async _getERC20Allowance(e,t,r){const n=new s.ethers.Contract(e,l.default,this.ethersProvider);return await n.allowance(t,p.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[r])}};const R={getMedianEthValueQuote:I,meansOfQuotesFeesAndValue:N};r.utils=R}}},{package:"$root$"}],[31,{"../../../development/mock-3box":161,"../lib/createOriginMiddleware":47,"../lib/migrator":63,"../migrations":157,"./network/createMetamaskMiddleware":16,"3box":167,"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"@metamask/obs-store":1204,_process:5500,"eth-json-rpc-middleware":2493,"json-rpc-engine":4837,loglevel:5268},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=e("@metamask/obs-store"),a=n(e("loglevel")),o=e("json-rpc-engine"),c=e("eth-json-rpc-middleware"),u=n(e("../lib/migrator")),l=n(e("../migrations")),h=n(e("../lib/createOriginMiddleware")),f=n(e("./network/createMetamaskMiddleware"));function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const g=t.env.IN_TEST?e("../../../development/mock-3box"):e("3box");r.default=class{constructor(e={}){const{preferencesController:t,keyringController:r,addressBookController:n,version:i,getKeyringControllerState:a,trackMetaMetricsEvent:o}=e;this.preferencesController=t,this.addressBookController=n,this.keyringController=r,this.provider=this._createProvider({version:i,getAccounts:async({origin:e})=>{if("3Box"!==e)return[];const{isUnlocked:t}=a(),r=await this.keyringController.getAccounts();if(t&&r[0]){return[await this.keyringController.getAppKeyAddress(r[0],"wallet://3box.metamask.io")]}return[]},processPersonalMessage:async e=>{const t=await this.keyringController.getAccounts();return r.signPersonalMessage(p(p({},e),{},{from:t[0]}),{withAppKeyOrigin:"wallet://3box.metamask.io"})}}),this._trackMetaMetricsEvent=o;const c=p(p({threeBoxSyncingAllowed:!1,showRestorePrompt:!0,threeBoxLastUpdated:0},e.initState),{},{threeBoxAddress:null,threeBoxSynced:!1,threeBoxDisabled:!1});this.store=new s.ObservableStore(c),this.registeringUpdates=!1,this.lastMigration=l.default.sort(((e,t)=>e.version-t.version)).slice(-1)[0],c.threeBoxSyncingAllowed&&this.init()}async init(){const e=await this.keyringController.getAccounts();this.address=e[0],this._trackMetaMetricsEvent({event:"3Box Initiated",category:"3Box"}),!this.address||this.box&&this.store.getState().threeBoxSynced||await this.new3Box()}async _update3Box(){try{const{threeBoxSyncingAllowed:e,threeBoxSynced:t}=this.store.getState();if(e&&t){const e={preferences:this.preferencesController.store.getState(),addressBook:this.addressBookController.state,lastUpdated:Date.now(),lastMigration:this.lastMigration};await this.space.private.set("metamaskBackup",JSON.stringify(e)),await this.setShowRestorePromptToFalse()}}catch(e){console.error(e)}}_createProvider(e){const t=(0,f.default)(e),r=new o.JsonRpcEngine;r.push((0,h.default)({origin:"3Box"})),r.push(t);return(0,c.providerFromEngine)(r)}_waitForOnSyncDone(){return new Promise((e=>{this.box.onSyncDone((()=>(a.default.debug("3Box box sync done"),e())))}))}async new3Box(){const e=await this.keyringController.getAccounts();let t;this.address=await this.keyringController.getAppKeyAddress(e[0],"wallet://3box.metamask.io");try{const e=await g.getConfig(this.address);t=e.spaces&&e.spaces.metamask}catch(e){if(!e.message.match(/^Error: Invalid response \(404\)/u))throw this._trackMetaMetricsEvent({event:"3Box Config Error",category:"3Box"}),e;this._trackMetaMetricsEvent({event:"3Box Backup does not exist",category:"3Box"}),t=!1}if(this.getThreeBoxSyncingState()||t){this.store.updateState({threeBoxSynced:!1});let e=!1;const t=setTimeout((()=>{a.default.error("3Box sync timed out after 60000 ms"),e=!0,this.store.updateState({threeBoxDisabled:!0,threeBoxSyncingAllowed:!1})}),6e4);try{this.box=await g.openBox(this.address,this.provider),await this._waitForOnSyncDone(),this.space=await this.box.openSpace("metamask",{onSyncDone:async()=>{const r={threeBoxSynced:!0,threeBoxAddress:this.address};e&&(a.default.info("3Box sync completed after timeout; no longer disabled"),r.threeBoxDisabled=!1),clearTimeout(t),this.store.updateState(r),a.default.debug("3Box space sync done"),this._trackMetaMetricsEvent({event:"3Box Synced",category:"3Box"})}})}catch(e){throw this._trackMetaMetricsEvent({event:"3Box Initiation Error",category:"3Box"}),console.error(e),e}}}async getLastUpdated(){const e=await this.space.private.get("metamaskBackup");return JSON.parse(e||"{}").lastUpdated}async migrateBackedUpState(e){const t=new u.default({migrations:l.default}),{preferences:r,addressBook:n}=JSON.parse(e),i={PreferencesController:r,AddressBookController:n},s=t.generateInitialState(i),a=await t.migrateData(s);return{preferences:a.data.PreferencesController,addressBook:a.data.AddressBookController}}async restoreFromThreeBox(){const e=await this.space.private.get("metamaskBackup"),{preferences:t,addressBook:r}=await this.migrateBackedUpState(e);this.store.updateState({threeBoxLastUpdated:e.lastUpdated}),t&&this.preferencesController.store.updateState(t),r&&this.addressBookController.update(r,!0),this.setShowRestorePromptToFalse(),this._trackMetaMetricsEvent({event:"3Box Restored Data",category:"3Box"})}turnThreeBoxSyncingOn(){this._trackMetaMetricsEvent({event:"3Box Sync Turned On",category:"3Box"}),this._registerUpdates()}turnThreeBoxSyncingOff(){this._trackMetaMetricsEvent({event:"3Box Sync Turned Off",category:"3Box"}),this.box.logout()}setShowRestorePromptToFalse(){this.store.updateState({showRestorePrompt:!1})}setThreeBoxSyncingPermission(e){this.store.getState().threeBoxDisabled||(this.store.updateState({threeBoxSyncingAllowed:e}),e&&this.box&&this.turnThreeBoxSyncingOn(),!e&&this.box&&this.turnThreeBoxSyncingOff())}getThreeBoxSyncingState(){return this.store.getState().threeBoxSyncingAllowed}_registerUpdates(){if(!this.registeringUpdates){const e=this._update3Box.bind(this);this.preferencesController.store.subscribe(e);const t=this._update3Box.bind(this);this.addressBookController.subscribe(t),this.registeringUpdates=!0}}}}).call(this)}).call(this,e("_process"))}}},{package:"$root$"}],[32,{"../../../../shared/constants/app":6262,"../../../../shared/constants/gas":6263,"../../../../shared/constants/metametrics":6266,"../../../../shared/constants/network":6267,"../../../../shared/constants/transaction":6272,"../../../../shared/modules/conversion.utils":6275,"../../../../shared/modules/swaps.utils":6284,"../../../../shared/modules/transaction.utils":6285,"../../../../ui/helpers/constants/error-keys":6800,"../../../../ui/helpers/constants/transactions":6805,"../../../../ui/helpers/utils/conversions.util":6819,"../../../../ui/pages/send/send.utils":7076,"../../../../ui/pages/swaps/swaps.util":7184,"../../lib/cleanErrorStack":43,"../../lib/util":83,"../../metamask-controller":84,"./lib/util":34,"./pending-tx-tracker":35,"./tx-gas-utils":36,"./tx-state-manager":37,"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"@ethereumjs/common":406,"@ethereumjs/tx":410,"@metamask/obs-store":1204,"bignumber.js":2063,"eth-rpc-errors":2537,"ethereumjs-util":2612,"ethjs-query":2661,lodash:5255,loglevel:5268,"nonce-tracker":5382,"safe-event-emitter":5819},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("safe-event-emitter")),a=e("@metamask/obs-store"),o=e("ethereumjs-util"),c=n(e("ethjs-query")),u=e("eth-rpc-errors"),l=n(e("@ethereumjs/common")),h=e("@ethereumjs/tx"),f=n(e("nonce-tracker")),d=n(e("loglevel")),p=n(e("bignumber.js")),g=e("lodash"),m=n(e("../../lib/cleanErrorStack")),w=e("../../lib/util"),_=e("../../../../ui/helpers/constants/error-keys"),y=e("../../../../ui/pages/send/send.utils"),b=e("../../../../ui/pages/swaps/swaps.util"),v=e("../../../../ui/helpers/utils/conversions.util"),E=e("../../../../shared/constants/transaction"),S=e("../../../../ui/helpers/constants/transactions"),x=e("../../metamask-controller"),T=e("../../../../shared/constants/gas"),k=e("../../../../shared/modules/conversion.utils"),A=e("../../../../shared/modules/swaps.utils"),P=e("../../../../shared/constants/metametrics"),I=e("../../../../shared/constants/network"),N=e("../../../../shared/modules/transaction.utils"),R=e("../../../../shared/constants/app"),O=n(e("./tx-state-manager")),C=n(e("./tx-gas-utils")),D=n(e("./pending-tx-tracker")),L=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=B(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=e[s]}n.default=e,r&&r.set(e,n);return n}(e("./lib/util"));function B(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(B=function(e){return e?r:t})(e)}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const U=[E.TRANSACTION_TYPES.SWAP,E.TRANSACTION_TYPES.SWAP_APPROVAL],G=[...U,E.TRANSACTION_TYPES.SIMPLE_SEND,E.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER,E.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM],j="failed on-chain";class z extends s.default{constructor(e){super(),this.networkStore=e.networkStore||new a.ObservableStore({}),this._getCurrentChainId=e.getCurrentChainId,this.getProviderConfig=e.getProviderConfig,this._getCurrentNetworkEIP1559Compatibility=e.getCurrentNetworkEIP1559Compatibility,this._getCurrentAccountEIP1559Compatibility=e.getCurrentAccountEIP1559Compatibility,this.preferencesStore=e.preferencesStore||new a.ObservableStore({}),this.provider=e.provider,this.getPermittedAccounts=e.getPermittedAccounts,this.blockTracker=e.blockTracker,this.signEthTx=e.signTransaction,this.inProcessOfSigning=new Set,this._trackMetaMetricsEvent=e.trackMetaMetricsEvent,this._getParticipateInMetrics=e.getParticipateInMetrics,this._getEIP1559GasFeeEstimates=e.getEIP1559GasFeeEstimates,this.createEventFragment=e.createEventFragment,this.updateEventFragment=e.updateEventFragment,this.finalizeEventFragment=e.finalizeEventFragment,this.getEventFragmentById=e.getEventFragmentById,this.getDeviceModel=e.getDeviceModel,this.getAccountType=e.getAccountType,this.getTokenStandardAndDetails=e.getTokenStandardAndDetails,this.memStore=new a.ObservableStore({}),this.query=new c.default(this.provider),this.txGasUtil=new C.default(this.provider),this._mapMethods(),this.txStateManager=new O.default({initState:e.initState,txHistoryLimit:e.txHistoryLimit,getNetwork:this.getNetwork.bind(this),getCurrentChainId:e.getCurrentChainId}),this._onBootCleanUp(),this.store=this.txStateManager.store,this.nonceTracker=new f.default({provider:this.provider,blockTracker:this.blockTracker,getPendingTransactions:(...t)=>[...this.txStateManager.getPendingTransactions(...t),...e.getExternalPendingTransactions(...t)],getConfirmedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.pendingTxTracker=new D.default({provider:this.provider,nonceTracker:this.nonceTracker,publishTransaction:e=>this.query.sendRawTransaction(e),getPendingTransactions:()=>[...this.txStateManager.getPendingTransactions(),...this.txStateManager.getApprovedTransactions()],approveTransaction:this.approveTransaction.bind(this),getCompletedTransactions:this.txStateManager.getConfirmedTransactions.bind(this.txStateManager)}),this.txStateManager.store.subscribe((()=>this.emit(x.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE))),this._setupListeners(),this._updateMemstore(),this.txStateManager.store.subscribe((()=>this._updateMemstore())),this.networkStore.subscribe((()=>{this._onBootCleanUp(),this._updateMemstore()})),this._updatePendingTxsAfterFirstBlock()}getChainId(){const e=this.networkStore.getState(),t=this._getCurrentChainId(),r=parseInt(t,16);return"loading"===e||Number.isNaN(r)?0:r}async getEIP1559Compatibility(e){const t=await this._getCurrentNetworkEIP1559Compatibility(),r=await this._getCurrentAccountEIP1559Compatibility(e);return t&&r}async getCommonConfiguration(e){const{type:t,nickname:r}=this.getProviderConfig(),n=await this.getEIP1559Compatibility(e)?I.HARDFORKS.LONDON:I.HARDFORKS.BERLIN;if(t!==I.NETWORK_TYPE_RPC)return new l.default({chain:t,hardfork:n});const i=parseInt(this._getCurrentChainId(),16),s=this.networkStore.getState(),a={name:r,chainId:i,networkId:"loading"===s?0:parseInt(s,10)};return l.default.forCustomChain(I.MAINNET,a,n)}addTransaction(e){this.txStateManager.addTransaction(e),this.emit(`${e.id}:unapproved`,e),this._trackTransactionMetricsEvent(e,E.TRANSACTION_EVENTS.ADDED)}wipeTransactions(e){this.txStateManager.wipeTransactions(e)}async newUnapprovedTransaction(e,t={}){d.default.debug(`MetaMaskController newUnapprovedTransaction ${JSON.stringify(e)}`);const r=await this.addUnapprovedTransaction(e,t.origin);return new Promise(((e,t)=>{this.txStateManager.once(`${r.id}:finished`,(r=>{switch(r.status){case E.TRANSACTION_STATUSES.SUBMITTED:return e(r.hash);case E.TRANSACTION_STATUSES.REJECTED:return t((0,m.default)(u.ethErrors.provider.userRejectedRequest("MetaMask Tx Signature: User denied transaction signature.")));case E.TRANSACTION_STATUSES.FAILED:return t((0,m.default)(u.ethErrors.rpc.internal(r.err.message)));default:return t((0,m.default)(u.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(r.txParams)}`)))}}))}))}_getTransaction(e){const{transactions:t}=this.store.getState();return t[e]}_isUnapprovedTransaction(e){return this.txStateManager.getTransaction(e).status===E.TRANSACTION_STATUSES.UNAPPROVED}_throwErrorIfNotUnapprovedTx(e,t){if(!this._isUnapprovedTransaction(e))throw new Error(`TransactionsController: Can only call ${t} on an unapproved transaction.\n         Current tx status: ${this.txStateManager.getTransaction(e).status}`)}_updateTransaction(e,t,r){const n=this.txStateManager.getTransaction(e),i=(0,g.merge)(n,t);this.txStateManager.updateTransaction(i,r)}updatePreviousGasParams(e,{maxFeePerGas:t,maxPriorityFeePerGas:r,gasLimit:n}){const i={previousGas:{maxFeePerGas:t,maxPriorityFeePerGas:r,gasLimit:n}};i.previousGas=(0,g.pickBy)(i.previousGas);const s=`Update Previous Gas for ${e}`;return this._updateTransaction(e,i,s),this._getTransaction(e)}async updateEditableParams(e,{data:t,from:r,to:n,value:i,gas:s,gasPrice:a}){this._throwErrorIfNotUnapprovedTx(e,"updateEditableParams");const o={txParams:{data:t,from:r,to:n,value:i,gas:s,gasPrice:a}};o.txParams=(0,g.pickBy)(o.txParams);const c=this._getTransaction(e),{type:u}=await(0,N.determineTransactionType)(F(F({},c.txParams),o.txParams),this.query);o.type=u;const l=`Update Editable Params for ${e}`;return this._updateTransaction(e,o,l),this._getTransaction(e)}updateTransactionGasFees(e,{gas:t,gasLimit:r,gasPrice:n,maxPriorityFeePerGas:i,maxFeePerGas:s,estimateUsed:a,estimateSuggested:o,defaultGasEstimates:c,originalGasEstimate:u,userEditedGasLimit:l,userFeeLevel:h}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionGasFees");let f={txParams:{gas:t,gasLimit:r,gasPrice:n,maxPriorityFeePerGas:i,maxFeePerGas:s},estimateUsed:a,estimateSuggested:o,defaultGasEstimates:c,originalGasEstimate:u,userEditedGasLimit:l,userFeeLevel:h};f.txParams=(0,g.pickBy)(f.txParams),f=(0,g.pickBy)(f);const d=`Update Transaction Gas Fees for ${e}`;return this._updateTransaction(e,f,d),this._getTransaction(e)}updateTransactionEstimatedBaseFee(e,{estimatedBaseFee:t,decEstimatedBaseFee:r}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionEstimatedBaseFee");let n={estimatedBaseFee:t,decEstimatedBaseFee:r};n=(0,g.pickBy)(n);const i=`Update Transaction Estimated Base Fees for ${e}`;return this._updateTransaction(e,n,i),this._getTransaction(e)}updateSwapApprovalTransaction(e,{type:t,sourceTokenSymbol:r}){this._throwErrorIfNotUnapprovedTx(e,"updateSwapApprovalTransaction");let n={type:t,sourceTokenSymbol:r};n=(0,g.pickBy)(n);const i=`Update Swap Approval Transaction for ${e}`;return this._updateTransaction(e,n,i),this._getTransaction(e)}updateSwapTransaction(e,{sourceTokenSymbol:t,destinationTokenSymbol:r,type:n,destinationTokenDecimals:i,destinationTokenAddress:s,swapMetaData:a,swapTokenValue:o,estimatedBaseFee:c,approvalTxId:u}){this._throwErrorIfNotUnapprovedTx(e,"updateSwapTransaction");let l={sourceTokenSymbol:t,destinationTokenSymbol:r,type:n,destinationTokenDecimals:i,destinationTokenAddress:s,swapMetaData:a,swapTokenValue:o,estimatedBaseFee:c,approvalTxId:u};l=(0,g.pickBy)(l);const h=`Update Swap Transaction for ${e}`;return this._updateTransaction(e,l,h),this._getTransaction(e)}updateTransactionUserSettings(e,{userEditedGasLimit:t,userFeeLevel:r}){this._throwErrorIfNotUnapprovedTx(e,"updateTransactionUserSettings");let n={userEditedGasLimit:t,userFeeLevel:r};n=(0,g.pickBy)(n);const i=`Update User Settings for ${e}`;return this._updateTransaction(e,n,i),this._getTransaction(e)}updateTransactionSendFlowHistory(e,t){var r;this._throwErrorIfNotUnapprovedTx(e,"updateTransactionSendFlowHistory");const n=this._getTransaction(e),i=`Update sendFlowHistory for ${e}`;return this.txStateManager.updateTransaction(F(F({},n),{},{sendFlowHistory:[...null!==(r=null==n?void 0:n.sendFlowHistory)&&void 0!==r?r:[],...t]}),i),this._getTransaction(e)}async addUnapprovedTransaction(e,t,r,n=[]){if(r!==undefined&&!G.includes(r))throw new Error(`TransactionController - invalid transactionType value: ${r}`);const i=L.normalizeTxParams(e),s=await this.getEIP1559Compatibility();L.validateTxParams(i,s);let a=this.txStateManager.generateTxMeta({txParams:i,origin:t,sendFlowHistory:n});if(t===R.ORIGIN_METAMASK){if(i.from!==this.getSelectedAddress())throw u.ethErrors.rpc.internal({message:"Internally initiated transaction is using invalid account.",data:{origin:t,fromAddress:i.from,selectedAddress:this.getSelectedAddress()}})}else{if(!(await this.getPermittedAccounts(t)).includes(i.from))throw u.ethErrors.provider.unauthorized({data:{origin:t}})}const{type:o,getCodeResponse:c}=await(0,N.determineTransactionType)(e,this.query);a.type=r||o,a.txParams.value=a.txParams.value?(0,w.addHexPrefix)(a.txParams.value):"0x0",this.addTransaction(a),this.emit("newUnapprovedTx",a);try{a=await this.addTxGasDefaults(a,c)}catch(e){throw d.default.warn(e),a=this.txStateManager.getTransaction(a.id),a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Failed to calculate gas defaults."),e}return a.loadingDefaults=!1,this.txStateManager.updateTransaction(a,"Added new unapproved transaction."),a}async addTxGasDefaults(e,t){const r=e.txParams.type!==E.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:n,maxFeePerGas:i,maxPriorityFeePerGas:s}=await this._getDefaultGasFees(e,r),{gasLimit:a,simulationFails:o}=await this._getDefaultGasLimit(e,t);if(e=this.txStateManager.getTransaction(e.id),o&&(e.simulationFails=o),r){const{eip1559V2Enabled:t}=this.preferencesStore.getState(),r=this.getAdvancedGasFee();t&&Boolean(r)&&!U.includes(e.type)?(e.userFeeLevel=T.CUSTOM_GAS_ESTIMATE,e.txParams.maxFeePerGas=(0,k.decGWEIToHexWEI)(r.maxBaseFee),e.txParams.maxPriorityFeePerGas=(0,k.decGWEIToHexWEI)(r.priorityFee)):!e.txParams.gasPrice||e.txParams.maxFeePerGas||e.txParams.maxPriorityFeePerGas?(i&&s&&!e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas||e.origin===R.ORIGIN_METAMASK?e.userFeeLevel=T.GAS_RECOMMENDATIONS.MEDIUM:e.userFeeLevel=t?T.PRIORITY_LEVELS.DAPP_SUGGESTED:T.CUSTOM_GAS_ESTIMATE,i&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=i),s&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=s),n&&!e.txParams.maxFeePerGas&&(e.txParams.maxFeePerGas=n),e.txParams.maxFeePerGas&&!e.txParams.maxPriorityFeePerGas&&(e.txParams.maxPriorityFeePerGas=e.txParams.maxFeePerGas)):(e.txParams.maxFeePerGas=e.txParams.gasPrice,e.txParams.maxPriorityFeePerGas=e.txParams.gasPrice,t&&e.origin!==R.ORIGIN_METAMASK?e.userFeeLevel=T.PRIORITY_LEVELS.DAPP_SUGGESTED:e.userFeeLevel=T.CUSTOM_GAS_ESTIMATE),delete e.txParams.gasPrice}else delete e.txParams.maxPriorityFeePerGas,delete e.txParams.maxFeePerGas;return!n||e.txParams.gasPrice||e.txParams.maxPriorityFeePerGas||e.txParams.maxFeePerGas||(e.txParams.gasPrice=n),a&&!e.txParams.gas&&(e.txParams.gas=a,e.originalGasEstimate=a),e.defaultGasEstimates={estimateType:e.userFeeLevel,gas:e.txParams.gas,gasPrice:e.txParams.gasPrice,maxFeePerGas:e.txParams.maxFeePerGas,maxPriorityFeePerGas:e.txParams.maxPriorityFeePerGas},e}async _getDefaultGasFees(e,t){if(!t&&e.txParams.gasPrice||t&&e.txParams.maxFeePerGas&&e.txParams.maxPriorityFeePerGas)return{};try{const{gasFeeEstimates:e,gasEstimateType:r}=await this._getEIP1559GasFeeEstimates();if(t&&r===T.GAS_ESTIMATE_TYPES.FEE_MARKET){const{medium:{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:r}={}}=e;if(t&&r)return{maxFeePerGas:(0,k.decGWEIToHexWEI)(r),maxPriorityFeePerGas:(0,k.decGWEIToHexWEI)(t)}}else{if(r===T.GAS_ESTIMATE_TYPES.LEGACY)return{gasPrice:(0,k.decGWEIToHexWEI)(e.medium)};if(r===T.GAS_ESTIMATE_TYPES.ETH_GASPRICE)return{gasPrice:(0,k.decGWEIToHexWEI)(e.gasPrice)}}}catch(e){console.error(e)}const r=await this.query.gasPrice();return{gasPrice:r&&(0,w.addHexPrefix)(r.toString(16))}}async _getDefaultGasLimit(e,t){const r=this._getCurrentChainId(),n=I.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[r],i=(0,w.getChainType)(r);if(e.txParams.gas)return{};if(e.txParams.to&&e.type===E.TRANSACTION_TYPES.SIMPLE_SEND&&"custom"!==i){if(e.txParams.data){const e=new Error("TxGasUtil - Trying to call a function on a non-contract address");throw e.errorKey=_.TRANSACTION_NO_CONTRACT_ERROR_KEY,e.getCodeResponse=t,e}return{gasLimit:T.GAS_LIMITS.SIMPLE}}const{blockGasLimit:s,estimatedGasHex:a,simulationFails:o}=await this.txGasUtil.analyzeGasUsage(e);return{gasLimit:this.txGasUtil.addGasBuffer((0,w.addHexPrefix)(a),s,n),simulationFails:o}}generateNewGasParams(e,t={},r=11){const{txParams:n}=e,i={},s={};var a;t.gasLimit&&(s.gas=null!==(a=null==t?void 0:t.gas)&&void 0!==a?a:T.GAS_LIMITS.SIMPLE);return t.estimateSuggested&&(s.estimateSuggested=t.estimateSuggested),t.estimateUsed&&(s.estimateUsed=t.estimateUsed),(0,N.isEIP1559Transaction)(e)?(i.maxFeePerGas=n.maxFeePerGas,i.maxPriorityFeePerGas=n.maxPriorityFeePerGas,s.maxFeePerGas=(null==t?void 0:t.maxFeePerGas)||(0,w.bnToHex)((0,w.BnMultiplyByFraction)((0,w.hexToBn)(n.maxFeePerGas),r,10)),s.maxPriorityFeePerGas=(null==t?void 0:t.maxPriorityFeePerGas)||(0,w.bnToHex)((0,w.BnMultiplyByFraction)((0,w.hexToBn)(n.maxPriorityFeePerGas),r,10))):(i.gasPrice=n.gasPrice,s.gasPrice=(null==t?void 0:t.gasPrice)||(0,w.bnToHex)((0,w.BnMultiplyByFraction)((0,w.hexToBn)(n.gasPrice),r,10))),{previousGasParams:i,newGasParams:s}}async createCancelTransaction(e,t,{estimatedBaseFee:r}={}){const n=this.txStateManager.getTransaction(e),{txParams:i}=n,{from:s,nonce:a}=i,{previousGasParams:o,newGasParams:c}=this.generateNewGasParams(n,F(F({},t),{},{gasLimit:t.gasLimit||T.GAS_LIMITS.SIMPLE})),u=this.txStateManager.generateTxMeta({txParams:F({from:s,to:s,nonce:a,value:"0x0"},c),previousGasParams:o,loadingDefaults:!1,status:E.TRANSACTION_STATUSES.APPROVED,type:E.TRANSACTION_TYPES.CANCEL});return r&&(u.estimatedBaseFee=r),this.addTransaction(u),await this.approveTransaction(u.id),u}async createSpeedUpTransaction(e,t,{estimatedBaseFee:r}={}){const n=this.txStateManager.getTransaction(e),{txParams:i}=n,{previousGasParams:s,newGasParams:a}=this.generateNewGasParams(n,t),o=this.txStateManager.generateTxMeta({txParams:F(F({},i),a),previousGasParams:s,loadingDefaults:!1,status:E.TRANSACTION_STATUSES.APPROVED,type:E.TRANSACTION_TYPES.RETRY});return r&&(o.estimatedBaseFee=r),this.addTransaction(o),await this.approveTransaction(o.id),o}async updateTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user updated transaction")}async updateAndApproveTransaction(e){this.txStateManager.updateTransaction(e,"confTx: user approved transaction"),await this.approveTransaction(e.id)}async approveTransaction(e){if(this.inProcessOfSigning.has(e))return;let t;this.inProcessOfSigning.add(e);try{this.txStateManager.setTxStatusApproved(e);const r=this.txStateManager.getTransaction(e),n=r.txParams.from;let{customNonceValue:i}=r;i=Number(i),t=await this.nonceTracker.getNonceLock(n);const s=r.previousGasParams?r.txParams.nonce:t.nextNonce,a=0===i?i:i||s;r.txParams.nonce=(0,w.addHexPrefix)(a.toString(16)),r.nonceDetails=t.nonceDetails,i&&(r.nonceDetails.customNonceValue=i),this.txStateManager.updateTransaction(r,"transactions#approveTransaction");const o=await this.signTransaction(e);await this.publishTransaction(e,o),this._trackTransactionMetricsEvent(r,E.TRANSACTION_EVENTS.APPROVED),t.releaseLock()}catch(r){try{this._failTransaction(e,r)}catch(e){d.default.error(e)}throw t&&t.releaseLock(),r}finally{this.inProcessOfSigning.delete(e)}}async approveTransactionsWithSameNonce(e=[]){if(0===e.length)return"";const t=e[0],r=await this.getCommonConfiguration(t.from),n=h.TransactionFactory.fromTxData(t,{common:r}),i=(0,o.bufferToHex)(n.serialize());if(this.inProcessOfSigning.has(i))return"";let s,a;this.inProcessOfSigning.add(i);try{const r=t.from;a=await this.nonceTracker.getNonceLock(r);const n=a.nextNonce;s=await Promise.all(e.map((e=>(e.nonce=(0,w.addHexPrefix)(n.toString(16)),this.signExternalTransaction(e)))))}catch(e){throw d.default.error(e),e}finally{a&&a.releaseLock(),this.inProcessOfSigning.delete(i)}return s}async signExternalTransaction(e){const t=L.normalizeTxParams(e),r=this.getChainId(),n=(0,N.isEIP1559Transaction)({txParams:t})?E.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:E.TRANSACTION_ENVELOPE_TYPES.LEGACY,i=F(F({},t),{},{type:n,gasLimit:t.gas,chainId:(0,w.addHexPrefix)((0,v.decimalToHex)(r))}),s=i.from,a=await this.getCommonConfiguration(s),c=h.TransactionFactory.fromTxData(i,{common:a}),u=await this.signEthTx(c,s);return(0,o.bufferToHex)(u.serialize())}async signTransaction(e){const t=this.txStateManager.getTransaction(e),r=this.getChainId(),n=(0,N.isEIP1559Transaction)(t)?E.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:E.TRANSACTION_ENVELOPE_TYPES.LEGACY,i=F(F({},t.txParams),{},{type:n,chainId:r,gasLimit:t.txParams.gas}),s=i.from,a=await this.getCommonConfiguration(i.from),c=h.TransactionFactory.fromTxData(i,{common:a}),u=await this.signEthTx(c,s);t.r=(0,o.bufferToHex)(u.r),t.s=(0,o.bufferToHex)(u.s),t.v=(0,o.bufferToHex)(u.v),this.txStateManager.updateTransaction(t,"transactions#signTransaction: add r, s, v values"),this.txStateManager.setTxStatusSigned(t.id);return(0,o.bufferToHex)(u.serialize())}async publishTransaction(e,t){const r=this.txStateManager.getTransaction(e);if(r.rawTx=t,r.type===E.TRANSACTION_TYPES.SWAP){const e=await this.query.getBalance(r.txParams.from);r.preTxBalance=e.toString(16)}let n;this.txStateManager.updateTransaction(r,"transactions#publishTransaction");try{n=await this.query.sendRawTransaction(t)}catch(e){if(!e.message.toLowerCase().includes("known transaction"))throw e;n=(0,o.keccak)((0,o.toBuffer)((0,w.addHexPrefix)(t),"hex")).toString("hex"),n=(0,w.addHexPrefix)(n)}this.setTxHash(e,n),this.txStateManager.setTxStatusSubmitted(e),this._trackTransactionMetricsEvent(r,E.TRANSACTION_EVENTS.SUBMITTED)}async updatePostTxBalance({txMeta:e,txId:t,numberOfAttempts:r=6}){const n=await this.query.getBalance(e.txParams.from),i=this.txStateManager.getTransaction(t),s=i.approvalTxId?this.txStateManager.getTransaction(i.approvalTxId):null;i.postTxBalance=n.toString(16);(0,A.isSwapsDefaultTokenAddress)(e.destinationTokenAddress,e.chainId)&&e.preTxBalance===i.postTxBalance&&r>0?setTimeout((()=>{this.updatePostTxBalance({txMeta:e,txId:t,numberOfAttempts:r-1})}),5e3):(this.txStateManager.updateTransaction(i,"transactions#confirmTransaction - add postTxBalance"),this._trackSwapsMetrics(i,s))}async confirmTransaction(e,t,r,n){const i=this.txStateManager.getTransaction(e);if(i)try{const s=L.normalizeTxReceiptGasUsed(t.gasUsed);i.txReceipt=F(F({},t),{},{gasUsed:s}),r&&(i.baseFeePerGas=r),n&&(i.blockTimestamp=n),this.txStateManager.setTxStatusConfirmed(e),this._markNonceDuplicatesDropped(e);const{submittedTime:a}=i,o={gas_used:s};a&&(o.completion_time=this._getTransactionCompletionTime(a)),"0x0"===t.status&&(o.status=j),this._trackTransactionMetricsEvent(i,E.TRANSACTION_EVENTS.FINALIZED,o),this.txStateManager.updateTransaction(i,"transactions#confirmTransaction - add txReceipt"),i.type===E.TRANSACTION_TYPES.SWAP&&await this.updatePostTxBalance({txMeta:i,txId:e})}catch(e){d.default.error(e)}}async confirmExternalTransaction(e,t,r){if(await this.txStateManager.addExternalTransaction(e),!e)return;const n=e.id;try{const i=L.normalizeTxReceiptGasUsed(t.gasUsed);e.txReceipt=F(F({},t),{},{gasUsed:i}),r&&(e.baseFeePerGas=r),this.txStateManager.setTxStatusConfirmed(n),this._markNonceDuplicatesDropped(n);const{submittedTime:s}=e,a={gas_used:i};s&&(a.completion_time=this._getTransactionCompletionTime(s)),"0x0"===t.status&&(a.status=j),this._trackTransactionMetricsEvent(e,E.TRANSACTION_EVENTS.FINALIZED,a),this.txStateManager.updateTransaction(e,"transactions#confirmTransaction - add txReceipt"),e.type===E.TRANSACTION_TYPES.SWAP&&await this.updatePostTxBalance({txMeta:e,txId:n})}catch(e){d.default.error(e)}}async cancelTransaction(e){const t=this.txStateManager.getTransaction(e);this.txStateManager.setTxStatusRejected(e),this._trackTransactionMetricsEvent(t,E.TRANSACTION_EVENTS.REJECTED)}setTxHash(e,t){const r=this.txStateManager.getTransaction(e);r.hash=t,this.txStateManager.updateTransaction(r,"transactions#setTxHash")}async createTransactionEventFragment(e,t){const r=this.txStateManager.getTransaction(e),{properties:n,sensitiveProperties:i}=await this._buildEventFragmentProperties(r);this._createTransactionEventFragment(r,t,n,i)}_mapMethods(){this.getState=()=>this.memStore.getState(),this.getNetwork=()=>this.networkStore.getState(),this.getSelectedAddress=()=>this.preferencesStore.getState().selectedAddress,this.getUnapprovedTxCount=()=>Object.keys(this.txStateManager.getUnapprovedTxList()).length,this.getPendingTxCount=e=>this.txStateManager.getPendingTransactions(e).length,this.getTransactions=e=>this.txStateManager.getTransactions(e),this.getAdvancedGasFee=()=>this.preferencesStore.getState().advancedGasFee}async _updatePendingTxsAfterFirstBlock(){await this.blockTracker.getLatestBlock(),await this.pendingTxTracker.updatePendingTxs()}_onBootCleanUp(){this.txStateManager.getTransactions({searchCriteria:{status:E.TRANSACTION_STATUSES.UNAPPROVED,loadingDefaults:!0}}).forEach((e=>{this.addTxGasDefaults(e).then((e=>{e.loadingDefaults=!1,this.txStateManager.updateTransaction(e,"transactions: gas estimation for tx on boot")})).catch((t=>{const r=this.txStateManager.getTransaction(e.id);r.loadingDefaults=!1,this.txStateManager.updateTransaction(r,"failed to estimate gas during boot cleanup."),this._failTransaction(r.id,t)}))})),this.txStateManager.getTransactions({searchCriteria:{status:E.TRANSACTION_STATUSES.APPROVED}}).forEach((e=>{const t=new Error('Transaction found as "approved" during boot - possibly stuck during signing');this._failTransaction(e.id,t)}))}_setupListeners(){this.txStateManager.on("tx:status-update",this.emit.bind(this,"tx:status-update")),this._setupBlockTrackerListener(),this.pendingTxTracker.on("tx:warning",(e=>{this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:warning")})),this.pendingTxTracker.on("tx:failed",((e,t)=>{this._failTransaction(e,t)})),this.pendingTxTracker.on("tx:confirmed",((e,t,r,n)=>this.confirmTransaction(e,t,r,n))),this.pendingTxTracker.on("tx:dropped",(e=>{this._dropTransaction(e)})),this.pendingTxTracker.on("tx:block-update",((e,t)=>{e.firstRetryBlockNumber||(e.firstRetryBlockNumber=t,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:block-update"))})),this.pendingTxTracker.on("tx:retry",(e=>{"retryCount"in e||(e.retryCount=0),e.retryCount+=1,this.txStateManager.updateTransaction(e,"transactions/pending-tx-tracker#event: tx:retry")}))}_markNonceDuplicatesDropped(e){const t=this.txStateManager.getTransaction(e),{nonce:r,from:n}=t.txParams,i=this.txStateManager.getTransactions({searchCriteria:{nonce:r,from:n}});i.length&&i.forEach((r=>{r.id!==e&&(r.replacedBy=t.hash,this.txStateManager.updateTransaction(t,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),r.status!==E.TRANSACTION_STATUSES.FAILED&&this._dropTransaction(r.id))}))}_setupBlockTrackerListener(){let e=!1;const t=this._onLatestBlock.bind(this),{blockTracker:r,txStateManager:n}=this;function i(){const i=n.getPendingTransactions();!e&&i.length>0?(r.on("latest",t),e=!0):e&&!i.length&&(r.removeListener("latest",t),e=!1)}n.on("tx:status-update",i),i()}async _onLatestBlock(e){try{await this.pendingTxTracker.updatePendingTxs()}catch(e){d.default.error(e)}try{await this.pendingTxTracker.resubmitPendingTxs(e)}catch(e){d.default.error(e)}}_updateMemstore(){const e=this.txStateManager.getUnapprovedTxList(),t=this.txStateManager.getTransactions({limit:100});this.memStore.updateState({unapprovedTxs:e,currentNetworkTxList:t})}_calculateTransactionsCost(e,t){let r="0x0";null!=t&&t.txReceipt&&(r=(0,y.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const n=(0,y.calcGasTotal)(e.txReceipt.gasUsed,e.txReceipt.effectiveGasPrice),i=new p.default(n,16).plus(r,16).toString(16);return{approvalGasCostInEth:Number((0,v.hexWEIToDecETH)(r)),tradeGasCostInEth:Number((0,v.hexWEIToDecETH)(n)),tradeAndApprovalGasCostInEth:Number((0,v.hexWEIToDecETH)(i))}}_trackSwapsMetrics(e,t){if(this._getParticipateInMetrics()&&e.swapMetaData)if("0x0"===e.txReceipt.status)this._trackMetaMetricsEvent({event:"Swap Failed",sensitiveProperties:F({},e.swapMetaData),category:P.EVENT.CATEGORIES.SWAPS});else{const r=(0,b.getSwapsTokensReceivedFromTxMeta)(e.destinationTokenSymbol,e,e.destinationTokenAddress,e.txParams.from,e.destinationTokenDecimals,t,e.chainId),n=r?`${new p.default(r,10).div(e.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,i=e.txReceipt.gasUsed&&e.swapMetaData.estimated_gas?`${new p.default(e.txReceipt.gasUsed,16).div(e.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,s=this._calculateTransactionsCost(e,t);this._trackMetaMetricsEvent({event:"Swap Completed",category:P.EVENT.CATEGORIES.SWAPS,sensitiveProperties:F(F({},e.swapMetaData),{},{token_to_amount_received:r,quote_vs_executionRatio:n,estimated_vs_used_gasRatio:i,approval_gas_cost_in_eth:s.approvalGasCostInEth,trade_gas_cost_in_eth:s.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:s.tradeAndApprovalGasCostInEth})})}}async _buildEventFragmentProperties(e,t){const{type:r,time:n,status:i,chainId:s,origin:a,txParams:{gasPrice:o,gas:c,maxFeePerGas:u,maxPriorityFeePerGas:l,estimateSuggested:h,estimateUsed:f},defaultGasEstimates:d,metamaskNetworkId:p}=e,g=a===R.ORIGIN_METAMASK?"user":"dapp",{assetType:m,tokenStandard:w}=await(0,N.determineTransactionAssetType)(e,this.query,this.getTokenStandardAndDetails),_={};if((0,N.isEIP1559Transaction)(e)?(_.max_fee_per_gas=u,_.max_priority_fee_per_gas=l):_.gas_price=o,d){const{estimateType:t}=d;if(t){_.default_estimate=t;let r=e.defaultGasEstimates.maxFeePerGas,n=e.defaultGasEstimates.maxPriorityFeePerGas;if([T.GAS_RECOMMENDATIONS.LOW,T.GAS_RECOMMENDATIONS.MEDIUM,T.GAS_RECOMMENDATIONS.MEDIUM.HIGH].includes(t)){var y,b;const{gasFeeEstimates:e}=await this._getEIP1559GasFeeEstimates();var v,E;if(null!=e&&null!==(y=e[t])&&void 0!==y&&y.suggestedMaxFeePerGas)r=null===(v=e[t])||void 0===v?void 0:v.suggestedMaxFeePerGas,_.default_max_fee_per_gas=r;if(null!=e&&null!==(b=e[t])&&void 0!==b&&b.suggestedMaxPriorityFeePerGas)n=null===(E=e[t])||void 0===E?void 0:E.suggestedMaxPriorityFeePerGas,_.default_max_priority_fee_per_gas=n}}e.defaultGasEstimates.gas&&(_.default_gas=e.defaultGasEstimates.gas),e.defaultGasEstimates.gasPrice&&(_.default_gas_price=e.defaultGasEstimates.gasPrice)}h&&(_.estimate_suggested=h),f&&(_.estimate_used=f),null!=t&&t.gas_used&&(_.gas_used=t.gas_used);const x=this._getGasValuesInGWEI(_);let k="0";if(e.txParams.maxFeePerGas){const{eip1559V2Enabled:e}=this.preferencesStore.getState();k=e?"2":"1"}return{properties:{chain_id:s,referrer:a,source:g,network:p,type:r,eip_1559_version:k,gas_edit_type:"none",gas_edit_attempted:"none",account_type:await this.getAccountType(this.getSelectedAddress()),device_model:await this.getDeviceModel(this.getSelectedAddress()),asset_type:m,token_standard:w},sensitiveProperties:F(F({status:i,transaction_envelope_type:(0,N.isEIP1559Transaction)(e)?S.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:S.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:n,gas_limit:c},t),x)}}_createTransactionEventFragment(e,t,r,n){const i=`transaction-${[E.TRANSACTION_EVENTS.FINALIZED,E.TRANSACTION_EVENTS.SUBMITTED].includes(t)?"submitted":"added"}-${e.id}`;if(void 0===this.getEventFragmentById(i))switch(t){case E.TRANSACTION_EVENTS.ADDED:this.createEventFragment({category:P.EVENT.CATEGORIES.TRANSACTIONS,initialEvent:E.TRANSACTION_EVENTS.ADDED,successEvent:E.TRANSACTION_EVENTS.APPROVED,failureEvent:E.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:n,persist:!0,uniqueIdentifier:i});break;case E.TRANSACTION_EVENTS.APPROVED:case E.TRANSACTION_EVENTS.REJECTED:this.createEventFragment({category:P.EVENT.CATEGORIES.TRANSACTIONS,successEvent:E.TRANSACTION_EVENTS.APPROVED,failureEvent:E.TRANSACTION_EVENTS.REJECTED,properties:r,sensitiveProperties:n,persist:!0,uniqueIdentifier:i});break;case E.TRANSACTION_EVENTS.SUBMITTED:this.createEventFragment({category:P.EVENT.CATEGORIES.TRANSACTIONS,initialEvent:E.TRANSACTION_EVENTS.SUBMITTED,successEvent:E.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:n,persist:!0,uniqueIdentifier:i});break;case E.TRANSACTION_EVENTS.FINALIZED:this.createEventFragment({category:P.EVENT.CATEGORIES.TRANSACTIONS,successEvent:E.TRANSACTION_EVENTS.FINALIZED,properties:r,sensitiveProperties:n,persist:!0,uniqueIdentifier:i})}}async _trackTransactionMetricsEvent(e,t,r={}){if(!e)return;const{properties:n,sensitiveProperties:i}=await this._buildEventFragmentProperties(e,r);let s;switch(this._createTransactionEventFragment(e,t,n,i),t){case E.TRANSACTION_EVENTS.APPROVED:s=`transaction-added-${e.id}`,this.updateEventFragment(s,{properties:n,sensitiveProperties:i}),this.finalizeEventFragment(s);break;case E.TRANSACTION_EVENTS.REJECTED:s=`transaction-added-${e.id}`,this.updateEventFragment(s,{properties:n,sensitiveProperties:i}),this.finalizeEventFragment(s,{abandoned:!0});break;case E.TRANSACTION_EVENTS.FINALIZED:s=`transaction-submitted-${e.id}`,this.updateEventFragment(s,{properties:n,sensitiveProperties:i}),this.finalizeEventFragment(`transaction-submitted-${e.id}`)}}_getTransactionCompletionTime(e){return Math.round((Date.now()-e)/1e3).toString()}_getGasValuesInGWEI(e){const t={};for(const r in e)(0,o.isHexString)(e[r])?t[r]=(0,v.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}_failTransaction(e,t){this.txStateManager.setTxStatusFailed(e,t);const r=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(r,E.TRANSACTION_EVENTS.FINALIZED,{error:t.message})}_dropTransaction(e){this.txStateManager.setTxStatusDropped(e);const t=this.txStateManager.getTransaction(e);this._trackTransactionMetricsEvent(t,E.TRANSACTION_EVENTS.FINALIZED)}}r.default=z}}},{package:"$root$"}],[33,{"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"fast-json-patch":4386,lodash:5255},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.generateHistoryEntry=c,r.migrateFromSnapshotsToDiffs=function(e){return e.map(((t,r)=>0===r?t:c(e[r-1],t)))},r.replayHistory=function(e){return(0,a.cloneDeep)(e).reduce(((e,t)=>s.default.applyPatch(e,t).newDocument))},r.snapshotFromTxMeta=function(e){const t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e);return delete t.history,(0,a.cloneDeep)(t)};var i=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("fast-json-patch")),a=e("lodash");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e,t,r){const n=s.default.compare(e,t);return n[0]&&(r&&(n[0].note=r),n[0].timestamp=Date.now()),n}}}},{package:"$root$"}],[34,{"../../../../../shared/constants/transaction":6272,"../../../../../shared/modules/hexstring-utils":6278,"../../../../../shared/modules/transaction.utils":6285,"../../../lib/util":83,"eth-rpc-errors":2537},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getFinalStates=function(){return[s.TRANSACTION_STATUSES.REJECTED,s.TRANSACTION_STATUSES.CONFIRMED,s.TRANSACTION_STATUSES.FAILED,s.TRANSACTION_STATUSES.DROPPED]},r.normalizeAndValidateTxParams=function(e,t=!0){const r=u(e,t);return d(r),r},r.normalizeTxParams=u,r.normalizeTxReceiptGasUsed=function(e){return"string"==typeof e?e:e.toString(16)},r.validateConfirmedExternalTransaction=void 0,r.validateFrom=p,r.validateRecipient=g,r.validateTxParams=d;var n=e("eth-rpc-errors"),i=e("../../../lib/util"),s=e("../../../../../shared/constants/transaction"),a=e("../../../../../shared/modules/transaction.utils"),o=e("../../../../../shared/modules/hexstring-utils");const c={from:i.addHexPrefix,to:(e,t)=>t?(0,i.addHexPrefix)(e).toLowerCase():(0,i.addHexPrefix)(e),nonce:i.addHexPrefix,value:i.addHexPrefix,data:i.addHexPrefix,gas:i.addHexPrefix,gasPrice:i.addHexPrefix,maxFeePerGas:i.addHexPrefix,maxPriorityFeePerGas:i.addHexPrefix,type:i.addHexPrefix,estimateSuggested:e=>e,estimateUsed:e=>e};function u(e,t=!0){const r={};for(const n in c)e[n]&&(r[n]=c[n](e[n],t));return r}function l(e,t,r){if(void 0!==e[r])throw n.ethErrors.rpc.invalidParams(`Invalid transaction params: specified ${t} but also included ${r}, these cannot be mixed`)}function h(e,t){if("string"!=typeof e[t])throw n.ethErrors.rpc.invalidParams(`Invalid transaction params: ${t} is not a string. got: (${e[t]})`)}function f(e,t){switch(t){case"maxFeePerGas":case"maxPriorityFeePerGas":if(e.type&&e.type!==s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET)throw n.ethErrors.rpc.invalidParams(`Invalid transaction envelope type: specified type "${e.type}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET}"`);break;default:if(e.type&&e.type===s.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET)throw n.ethErrors.rpc.invalidParams(`Invalid transaction envelope type: specified type "${e.type}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`)}}function d(e,t=!0){if(!e||"object"!=typeof e||Array.isArray(e))throw n.ethErrors.rpc.invalidParams("Invalid transaction params: must be an object.");if(!e.to&&!e.data)throw n.ethErrors.rpc.invalidParams('Invalid transaction params: must specify "data" for contract deployments, or "to" (and optionally "data") for all other types of transactions.');if((0,a.isEIP1559Transaction)({txParams:e})&&!t)throw n.ethErrors.rpc.invalidParams("Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559");Object.entries(e).forEach((([t,r])=>{switch(t){case"from":p(e);break;case"to":g(e);break;case"gasPrice":f(e,"gasPrice"),l(e,"gasPrice","maxFeePerGas"),l(e,"gasPrice","maxPriorityFeePerGas"),h(e,"gasPrice");break;case"maxFeePerGas":f(e,"maxFeePerGas"),l(e,"maxFeePerGas","gasPrice"),h(e,"maxFeePerGas");break;case"maxPriorityFeePerGas":f(e,"maxPriorityFeePerGas"),l(e,"maxPriorityFeePerGas","gasPrice"),h(e,"maxPriorityFeePerGas");break;case"value":if(h(e,"value"),r.toString().includes("-"))throw n.ethErrors.rpc.invalidParams(`Invalid transaction value "${r}": not a positive number.`);if(r.toString().includes("."))throw n.ethErrors.rpc.invalidParams(`Invalid transaction value of "${r}": number must be in wei.`);if(!r.match(/^0x[a-fA-F0-9]+$/u))throw n.ethErrors.rpc.invalidParams(`Invalid transaction value of "${r}": not a valid hex string.`);break;case"chainId":if("number"!=typeof r&&"string"!=typeof r)throw n.ethErrors.rpc.invalidParams(`Invalid transaction params: ${t} is not a Number or hex string. got: (${r})`);break;default:h(e,t)}}))}function p(e){if("string"!=typeof e.from)throw n.ethErrors.rpc.invalidParams(`Invalid "from" address "${e.from}": not a string.`);if(!(0,o.isValidHexAddress)(e.from,{allowNonPrefixed:!1}))throw n.ethErrors.rpc.invalidParams('Invalid "from" address.')}function g(e){if("0x"===e.to||null===e.to){if(!e.data)throw n.ethErrors.rpc.invalidParams('Invalid "to" address.');delete e.to}else if(e.to!==undefined&&!(0,o.isValidHexAddress)(e.to,{allowNonPrefixed:!1}))throw n.ethErrors.rpc.invalidParams('Invalid "to" address.');return e}r.validateConfirmedExternalTransaction=({txMeta:e,pendingTransactions:t,confirmedTransactions:r}={})=>{if(!e||!e.txParams)throw n.ethErrors.rpc.invalidParams('"txMeta" or "txMeta.txParams" is missing');if(e.status!==s.TRANSACTION_STATUSES.CONFIRMED)throw n.ethErrors.rpc.invalidParams('External transaction status should be "confirmed"');const i=e.txParams.nonce;if(t&&t.length>0){if(t.find((e=>{var t;return(null===(t=e.txParams)||void 0===t?void 0:t.nonce)===i})))throw n.ethErrors.rpc.invalidParams("External transaction nonce should not be in pending txs")}if(r&&r.length>0){if(r.find((e=>{var t;return(null===(t=e.txParams)||void 0===t?void 0:t.nonce)===i})))throw n.ethErrors.rpc.invalidParams("External transaction nonce should not be in confirmed txs")}}}}},{package:"$root$"}],[35,{"../../../../shared/constants/transaction":6272,"./tx-state-manager":37,"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"ethjs-query":2661,loglevel:5268,"safe-event-emitter":5819},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("safe-event-emitter")),a=n(e("loglevel")),o=n(e("ethjs-query")),c=e("../../../../shared/constants/transaction"),u=e("./tx-state-manager");class l extends s.default{constructor(e){super(),(0,i.default)(this,"DROPPED_BUFFER_COUNT",3),(0,i.default)(this,"droppedBlocksBufferByHash",new Map),this.query=e.query||new o.default(e.provider),this.nonceTracker=e.nonceTracker,this.getPendingTransactions=e.getPendingTransactions,this.getCompletedTransactions=e.getCompletedTransactions,this.publishTransaction=e.publishTransaction,this.approveTransaction=e.approveTransaction,this.confirmTransaction=e.confirmTransaction}async updatePendingTxs(){const e=await this.nonceTracker.getGlobalLock();try{const e=this.getPendingTransactions();await Promise.all(e.map((e=>this._checkPendingTx(e))))}catch(e){a.default.error("PendingTransactionTracker - Error updating pending transactions"),a.default.error(e)}e.releaseLock()}async resubmitPendingTxs(e){const t=this.getPendingTransactions();if(t.length)for(const i of t)try{await this._resubmitTx(i,e)}catch(e){var r,n;const t=(null===(r=e.value)||void 0===r||null===(n=r.message)||void 0===n?void 0:n.toLowerCase())||e.message.toLowerCase();if(t.includes("replacement transaction underpriced")||t.includes("known transaction")||t.includes("gas price too low to replace")||t.includes("transaction with the same hash was already imported")||t.includes("gateway timeout")||t.includes("nonce too low"))return;i.warning={error:t,message:u.ERROR_SUBMITTING},this.emit("tx:warning",i,e)}}async _resubmitTx(e,t){e.firstRetryBlockNumber||this.emit("tx:block-update",e,t);const r=e.firstRetryBlockNumber||t,n=Number.parseInt(t,16)-Number.parseInt(r,16),i=e.retryCount||0;if(n<Math.min(50,Math.pow(2,i)))return undefined;if(!("rawTx"in e))return this.approveTransaction(e.id);const{rawTx:s}=e,a=await this.publishTransaction(s);return this.emit("tx:retry",e),a}async _checkPendingTx(e){const t=e.hash,r=e.id;if(e.status===c.TRANSACTION_STATUSES.SUBMITTED){if(!t){const e=new Error("We had an error while submitting this transaction, please try again.");return e.name="NoTxHashError",void this.emit("tx:failed",r,e)}if(await this._checkIfNonceIsTaken(e))this.emit("tx:dropped",r);else{try{const e=await this.query.getTransactionReceipt(t);if(null!=e&&e.blockNumber){const{baseFeePerGas:t,timestamp:n}=await this.query.getBlockByHash(null==e?void 0:e.blockHash,!1);return void this.emit("tx:confirmed",r,e,t,n)}}catch(t){return e.warning={error:t.message,message:"There was a problem loading this transaction."},void this.emit("tx:warning",e,t)}await this._checkIfTxWasDropped(e)&&this.emit("tx:dropped",r)}}}async _checkIfTxWasDropped(e){const{hash:t,txParams:{nonce:r,from:n}}=e,i=await this.query.getTransactionCount(n);if(parseInt(r,16)>=i.toNumber())return!1;this.droppedBlocksBufferByHash.has(t)||this.droppedBlocksBufferByHash.set(t,0);const s=this.droppedBlocksBufferByHash.get(t);return s<this.DROPPED_BUFFER_COUNT?(this.droppedBlocksBufferByHash.set(t,s+1),!1):(this.droppedBlocksBufferByHash.delete(t),!0)}async _checkIfNonceIsTaken(e){const t=e.txParams.from;return this.getCompletedTransactions(t).some((t=>!(t.id===e.id)&&t.txParams.nonce===e.txParams.nonce))}}r.default=l}}},{package:"$root$"}],[36,{"../../lib/util":83,"@babel/runtime/helpers/interopRequireDefault":200,"ethereumjs-util":2612,"ethjs-query":2661,lodash:5255,loglevel:5268},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("ethjs-query")),s=n(e("loglevel")),a=e("ethereumjs-util"),o=e("lodash"),c=e("../../lib/util");r.default=class{constructor(e){this.query=new i.default(e)}async analyzeGasUsage(e){const t=await this.query.getBlockByNumber("latest",!1),r=(0,c.hexToBn)(t.gasLimit),n=(0,c.BnMultiplyByFraction)(r,19,20);let i,a=(0,c.bnToHex)(n);try{a=await this.estimateTxGas(e)}catch(e){s.default.warn(e),i={reason:e.message,errorKey:e.errorKey,debug:{blockNumber:t.number,blockGasLimit:t.gasLimit}}}return{blockGasLimit:t.gasLimit,estimatedGasHex:a,simulationFails:i}}async estimateTxGas(e){const t=(0,o.cloneDeep)(e.txParams);return delete t.gasPrice,delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,await this.query.estimateGas(t)}addGasBuffer(e,t,r=1.5){const n=(0,c.hexToBn)(e),i=(0,c.hexToBn)(t).muln(.9),s=n.muln(r);return n.gt(i)?(0,c.bnToHex)(n):s.lt(i)?(0,c.bnToHex)(s):(0,c.bnToHex)(i)}async getBufferedGasLimit(e,t){const{blockGasLimit:r,estimatedGasHex:n,simulationFails:i}=await this.analyzeGasUsage(e);return{gasLimit:this.addGasBuffer((0,a.addHexPrefix)(n),r,t),simulationFails:i}}}}}},{package:"$root$"}],[37,{"../../../../shared/constants/app":6262,"../../../../shared/constants/transaction":6272,"../../../../shared/modules/random-id":6281,"../../../../shared/modules/transaction.utils":6285,"../../metamask-controller":84,"./lib/tx-state-history-helpers":33,"./lib/util":34,"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"@metamask/obs-store":1204,lodash:5255,loglevel:5268,"safe-event-emitter":5819},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.ERROR_SUBMITTING=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("safe-event-emitter")),a=e("@metamask/obs-store"),o=n(e("loglevel")),c=e("lodash"),u=n(e("../../../../shared/modules/random-id")),l=e("../../../../shared/constants/transaction"),h=e("../../metamask-controller"),f=e("../../../../shared/modules/transaction.utils"),d=e("../../../../shared/constants/app"),p=e("./lib/tx-state-history-helpers"),g=e("./lib/util");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const _="There was an error when resubmitting this transaction.";r.ERROR_SUBMITTING=_;class y extends s.default{constructor({initState:e,txHistoryLimit:t,getNetwork:r,getCurrentChainId:n}){super(),this.store=new a.ObservableStore(w({transactions:{}},e)),this.txHistoryLimit=t,this.getNetwork=r,this.getCurrentChainId=n}generateTxMeta(e={}){var t;const r=this.getNetwork(),n=this.getCurrentChainId();if("loading"===r)throw new Error("MetaMask is having trouble connecting to the network");let i=null;return e.txParams&&"string"==typeof e.origin&&e.origin!==d.ORIGIN_METAMASK&&(void 0!==e.txParams.gasPrice?i={gasPrice:e.txParams.gasPrice}:void 0===e.txParams.maxFeePerGas&&void 0===e.txParams.maxPriorityFeePerGas||(i={maxPriorityFeePerGas:e.txParams.maxPriorityFeePerGas,maxFeePerGas:e.txParams.maxFeePerGas}),void 0!==e.txParams.gas&&(i=w(w({},i),{},{gas:e.txParams.gas}))),w({id:(0,u.default)(),time:(new Date).getTime(),status:l.TRANSACTION_STATUSES.UNAPPROVED,metamaskNetworkId:r,originalGasEstimate:null===(t=e.txParams)||void 0===t?void 0:t.gas,userEditedGasLimit:!1,chainId:n,loadingDefaults:!0,dappSuggestedGasFees:i,sendFlowHistory:[]},e)}getUnapprovedTxList(){const e=this.getCurrentChainId(),t=this.getNetwork();return(0,c.pickBy)(this.store.getState().transactions,(r=>r.status===l.TRANSACTION_STATUSES.UNAPPROVED&&(0,f.transactionMatchesNetwork)(r,e,t)))}getApprovedTransactions(e){const t={status:l.TRANSACTION_STATUSES.APPROVED};return e&&(t.from=e),this.getTransactions({searchCriteria:t})}getPendingTransactions(e){const t={status:l.TRANSACTION_STATUSES.SUBMITTED};return e&&(t.from=e),this.getTransactions({searchCriteria:t})}getConfirmedTransactions(e){const t={status:l.TRANSACTION_STATUSES.CONFIRMED};return e&&(t.from=e),this.getTransactions({searchCriteria:t})}addTransaction(e){e.txParams&&(e.txParams=(0,g.normalizeAndValidateTxParams)(e.txParams,!1)),this.once(`${e.id}:signed`,(()=>{this.removeAllListeners(`${e.id}:rejected`)})),this.once(`${e.id}:rejected`,(()=>{this.removeAllListeners(`${e.id}:signed`)})),e.history=[];const t=(0,p.snapshotFromTxMeta)(e);e.history.push(t);const r=this.getTransactions({filterToCurrentNetwork:!1}),{txHistoryLimit:n}=this,i=new Set,s=r.reverse().filter((e=>{const{nonce:t,from:r}=e.txParams,{chainId:s,metamaskNetworkId:a,status:o}=e,c=`${t}-${null!=s?s:a}-${r}`;return!i.has(c)&&(!(i.size<n-1||!1===(0,g.getFinalStates)().includes(o))||(i.add(c),!1))})).map((e=>e.id));return this._deleteTransactions(s),this._addTransactionsToState([e]),e}addExternalTransaction(e){var t;const r=null==e||null===(t=e.txParams)||void 0===t?void 0:t.from,n=this.getConfirmedTransactions(r),i=this.getPendingTransactions(r);return(0,g.validateConfirmedExternalTransaction)({txMeta:e,pendingTransactions:i,confirmedTransactions:n}),this._addTransactionsToState([e]),e}getTransaction(e){const{transactions:t}=this.store.getState();return t[e]}updateTransaction(e,t){if(e.txParams)try{e.txParams=(0,g.normalizeAndValidateTxParams)(e.txParams,!1)}catch(t){if(e.warning.message!==_)throw t;return void this.setTxStatusFailed(e.id,t)}this._updateTransactionHistory(e,t)}_updateTransactionHistory(e,t){const r=(0,p.snapshotFromTxMeta)(e),n=(0,p.replayHistory)(e.history),i=(0,p.generateHistoryEntry)(n,r,t);i.length&&e.history.push(i);const s=e.id;this.store.updateState({transactions:w(w({},this.store.getState().transactions),{},{[s]:e})})}getTransactions({searchCriteria:e={},initialList:t,filterToCurrentNetwork:r=!0,limit:n}={}){const i=this.getCurrentChainId(),s=this.getNetwork(),a=(0,c.mapValues)(e,(e=>"function"==typeof e?e:t=>t===e)),o=t?(0,c.keyBy)(t,"id"):this.store.getState().transactions,u=(0,c.sortBy)((0,c.pickBy)(o,(e=>{if(r&&!1===(0,f.transactionMatchesNetwork)(e,i,s))return!1;for(const[t,r]of Object.entries(a))if(t in e.txParams){if(!1===r(e.txParams[t]))return!1}else if(!1===r(e[t]))return!1;return!0})),"time");if(n!==undefined){const e=new Set,t=[];for(let r=u.length-1;r>-1;r--){const i=u[r],{nonce:s}=i.txParams;if(!e.has(s)){if(!(e.size<n))continue;e.add(s)}t.unshift(i)}return t}return u}setTxStatusRejected(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.REJECTED),this._deleteTransaction(e)}setTxStatusUnapproved(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.UNAPPROVED)}setTxStatusApproved(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.APPROVED)}setTxStatusSigned(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.SIGNED)}setTxStatusSubmitted(e){const t=this.getTransaction(e);t.submittedTime=(new Date).getTime(),this.updateTransaction(t,"txStateManager - add submitted time stamp"),this._setTransactionStatus(e,l.TRANSACTION_STATUSES.SUBMITTED)}setTxStatusConfirmed(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.CONFIRMED)}setTxStatusDropped(e){this._setTransactionStatus(e,l.TRANSACTION_STATUSES.DROPPED)}setTxStatusFailed(e,t){var r;const n=t||new Error("Internal metamask failure"),i=this.getTransaction(e);i.err={message:(null===(r=n.message)||void 0===r?void 0:r.toString())||n.toString(),rpc:n.value,stack:n.stack},this._updateTransactionHistory(i,"transactions:tx-state-manager#fail - add error"),this._setTransactionStatus(e,l.TRANSACTION_STATUSES.FAILED)}wipeTransactions(e){const{transactions:t}=this.store.getState(),r=this.getNetwork(),n=this.getCurrentChainId();this.store.updateState({transactions:(0,c.omitBy)(t,(t=>t.txParams.from===e&&(0,f.transactionMatchesNetwork)(t,n,r)))})}clearUnapprovedTxs(){this.store.updateState({transactions:(0,c.omitBy)(this.store.getState().transactions,(e=>e.status===l.TRANSACTION_STATUSES.UNAPPROVED))})}_setTransactionStatus(e,t){const r=this.getTransaction(e);if(r){r.status=t;try{this._updateTransactionHistory(r,`txStateManager: setting status to ${t}`),this.emit(`${r.id}:${t}`,e),this.emit("tx:status-update",e,t),[l.TRANSACTION_STATUSES.SUBMITTED,l.TRANSACTION_STATUSES.REJECTED,l.TRANSACTION_STATUSES.FAILED].includes(t)&&this.emit(`${r.id}:finished`,r),this.emit(h.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}catch(e){o.default.error(e)}}}_addTransactionsToState(e){this.store.updateState({transactions:e.reduce(((e,t)=>(e[t.id]=t,e)),this.store.getState().transactions)})}_deleteTransaction(e){const{transactions:t}=this.store.getState();delete t[e],this.store.updateState({transactions:t})}_deleteTransactions(e){const{transactions:t}=this.store.getState();e.forEach((e=>{delete t[e]})),this.store.updateState({transactions:t})}}r.default=y}}},{package:"$root$"}],[38,{"../../shared/constants/app":6262,"./lib/util":83,"@babel/runtime/helpers/interopRequireDefault":200,"webextension-polyfill":6237},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.onMessageReceived=r.checkForMultipleVersionsRunning=void 0;var i=n(e("webextension-polyfill")),s=e("../../shared/constants/app"),a=e("./lib/util");const o="isRunning";r.onMessageReceived=e=>{e===o&&console.warn("Warning! You have multiple instances of MetaMask running!")};r.checkForMultipleVersionsRunning=async()=>{if((0,a.getPlatform)()!==s.PLATFORM_CHROME&&(0,a.getPlatform)()!==s.PLATFORM_FIREFOX)return;const e=(0,a.getPlatform)()===s.PLATFORM_CHROME?s.CHROME_BUILD_IDS:s.FIREFOX_BUILD_IDS,t=i.default.runtime.id;for(const r of e)if(r!==t)try{await i.default.runtime.sendMessage(r,o)}catch(e){}}}}},{package:"$root$"}],[39,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={config:{},PreferencesController:{frequentRpcListDetail:[{rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}]}};r.default=n}}},{package:"$root$"}],[4,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN=r.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY=r.SINGLE_CALL_BALANCES_ADDRESS_KOVAN=r.SINGLE_CALL_BALANCES_ADDRESS=void 0;r.SINGLE_CALL_BALANCES_ADDRESS="0xb1f8e55c7f64d203c1400b9d8555d050f94adf39";r.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY="0x9f510b19f1ad66f0dcf6e45559fab0d6752c1db7";r.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN="0xb8e671734ce5c8d7dfbbea5574fa4cf39f7a54a4";r.SINGLE_CALL_BALANCES_ADDRESS_KOVAN="0xb1d3fbb2f83aecd196f474c16ca5d9cffa0d0ffc"}}},{package:"$root$"}],[40,{"@babel/runtime/helpers/defineProperty":194,"@babel/runtime/helpers/interopRequireDefault":200,"@metamask/controllers":1061,"@metamask/obs-store":1204},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=e("@metamask/obs-store"),a=e("@metamask/controllers");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class u extends s.ObservableStore{constructor({config:e,controllerMessenger:t,state:r,persist:n}){super(r),(0,i.default)(this,"config",{}),this.persist=n,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();for(const t of Object.keys(e)){if(!e[t])throw new Error(`Undefined '${t}'`);const r=e[t];r.subscribe?e[t].subscribe((e=>{this.updateState({[t]:e})})):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(r=>{let n=r;this.persist&&(n=(0,a.getPersistentState)(r,e[t].metadata)),this.updateState({[t]:n})}))}}getFlatState(){if(!this.config)return{};let e={};for(const t of Object.keys(this.config)){const r=this.config[t],n=r.getState?r.getState():r.state;e=c(c({},e),n)}return e}}r.default=u}}},{package:"$root$"}],[41,{"../../../shared/constants/network":6267,"../constants/contracts":4,"./util":83,"@babel/runtime/helpers/interopRequireDefault":200,"@metamask/obs-store":1204,"eth-query":2533,loglevel:5268,pify:5494,"single-call-balance-checker-abi":5925,web3:6185},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("eth-query")),s=e("@metamask/obs-store"),a=n(e("loglevel")),o=n(e("pify")),c=n(e("web3")),u=n(e("single-call-balance-checker-abi")),l=e("../../../shared/constants/network"),h=e("../constants/contracts"),f=e("./util");r.default=class{constructor(e={}){this.store=new s.ObservableStore({accounts:{},currentBlockGasLimit:""}),this._provider=e.provider,this._query=(0,o.default)(new i.default(this._provider)),this._blockTracker=e.blockTracker,this._currentBlockNumber=this._blockTracker.getCurrentBlock(),this._blockTracker.once("latest",(e=>{this._currentBlockNumber=e})),this._updateForBlock=this._updateForBlock.bind(this),this.getCurrentChainId=e.getCurrentChainId,this.web3=new c.default(this._provider)}start(){this._blockTracker.removeListener("latest",this._updateForBlock),this._blockTracker.addListener("latest",this._updateForBlock),this._updateAccounts()}stop(){this._blockTracker.removeListener("latest",this._updateForBlock)}syncWithAddresses(e){const{accounts:t}=this.store.getState(),r=Object.keys(t),n=[];e.forEach((e=>{r.includes(e)||n.push(e)}));const i=[];r.forEach((t=>{e.includes(t)||i.push(t)})),this.addAccounts(n),this.removeAccount(i)}addAccounts(e){const{accounts:t}=this.store.getState();e.forEach((e=>{t[e]={}})),this.store.updateState({accounts:t}),this._currentBlockNumber&&this._updateAccounts()}removeAccount(e){const{accounts:t}=this.store.getState();e.forEach((e=>{delete t[e]})),this.store.updateState({accounts:t})}clearAccounts(){this.store.updateState({accounts:{}})}async _updateForBlock(e){this._currentBlockNumber=e;const t=await this._query.getBlockByNumber(e,!1);if(!t)return;const r=t.gasLimit;this.store.updateState({currentBlockGasLimit:r});try{await this._updateAccounts()}catch(e){a.default.error(e)}}async _updateAccounts(){const{accounts:e}=this.store.getState(),t=Object.keys(e);switch(this.getCurrentChainId()){case l.MAINNET_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,h.SINGLE_CALL_BALANCES_ADDRESS);break;case l.RINKEBY_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,h.SINGLE_CALL_BALANCES_ADDRESS_RINKEBY);break;case l.ROPSTEN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,h.SINGLE_CALL_BALANCES_ADDRESS_ROPSTEN);break;case l.KOVAN_CHAIN_ID:await this._updateAccountsViaBalanceChecker(t,h.SINGLE_CALL_BALANCES_ADDRESS_KOVAN);break;default:await Promise.all(t.map(this._updateAccount.bind(this)))}}async _updateAccount(e){const t={address:e,balance:await this._query.getBalance(e)},{accounts:r}=this.store.getState();r[e]&&(r[e]=t,this.store.updateState({accounts:r}))}async _updateAccountsViaBalanceChecker(e,t){const{accounts:r}=this.store.getState();this.web3.setProvider(this._provider);this.web3.eth.contract(u.default).at(t).balances(e,["0x0"],((t,n)=>{if(t)return a.default.warn("MetaMask - Account Tracker single call balance fetch failed",t),void Promise.all(e.map(this._updateAccount.bind(this)));e.forEach(((e,t)=>{const i=n[t]?(0,f.bnToHex)(n[t]):"0x0";r[e]={address:e,balance:i}})),this.store.updateState({accounts:r})}))}}}}},{package:"$root$"}],[43,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){let{name:t}=e;t=t===undefined?"Error":String(t);let r=e.message;r=r===undefined?"":String(r),""===t?e.stack=e.message:""===r?e.stack=e.name:e.stack||(e.stack=`${e.name}: ${e.message}`);return e}}}},{package:"$root$"}],[4385,{"./helpers":4387,"fast-deep-equal":4388},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("fast-deep-equal"),i=e("./helpers");r.JsonPatchError=i.PatchError,r.deepClone=i._deepClone;var s={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=o(r,this.path);n&&(n=i._deepClone(n));var s=c(r,{op:"remove",path:this.from}).removed;return c(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=o(r,this.from);return c(r,{op:"add",path:this.path,value:i._deepClone(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:n(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},a={add:function(e,t,r){return i.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:s.move,copy:s.copy,test:s.test,_get:s._get};function o(e,t){if(""==t)return e;var r={op:"_get",path:t};return c(e,r),r.value}function c(e,t,c,u,l,f){if(void 0===c&&(c=!1),void 0===u&&(u=!0),void 0===l&&(l=!0),void 0===f&&(f=0),c&&("function"==typeof c?c(t,0,e,t.path):h(t,0)),""===t.path){var d={newDocument:e};if("add"===t.op)return d.newDocument=t.value,d;if("replace"===t.op)return d.newDocument=t.value,d.removed=e,d;if("move"===t.op||"copy"===t.op)return d.newDocument=o(e,t.from),"move"===t.op&&(d.removed=e),d;if("test"===t.op){if(d.test=n(e,t.value),!1===d.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return d.newDocument=e,d}if("remove"===t.op)return d.removed=e,d.newDocument=null,d;if("_get"===t.op)return t.value=e,d;if(c)throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,t,e);return d}u||(e=i._deepClone(e));var p=(t.path||"").split("/"),g=e,m=1,w=p.length,_=undefined,y=void 0,b=void 0;for(b="function"==typeof c?c:h;;){if(y=p[m],l&&"__proto__"==y)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(c&&_===undefined&&(g[y]===undefined?_=p.slice(0,m).join("/"):m==w-1&&(_=t.path),_!==undefined&&b(t,0,e,_)),m++,Array.isArray(g)){if("-"===y)y=g.length;else{if(c&&!i.isInteger(y))throw new r.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,t,e);i.isInteger(y)&&(y=~~y)}if(m>=w){if(c&&"add"===t.op&&y>g.length)throw new r.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,t,e);if(!1===(d=a[t.op].call(t,g,y,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return d}}else if(y&&-1!=y.indexOf("~")&&(y=i.unescapePathComponent(y)),m>=w){if(!1===(d=s[t.op].call(t,g,y,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",f,t,e);return d}g=g[y]}}function u(e,t,n,s,a){if(void 0===s&&(s=!0),void 0===a&&(a=!0),n&&!Array.isArray(t))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(e=i._deepClone(e));for(var o=new Array(t.length),u=0,l=t.length;u<l;u++)o[u]=c(e,t[u],n,!0,a,u),e=o[u].newDocument;return o.newDocument=e,o}function l(e,t,n){var i=c(e,t);if(!1===i.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function h(e,t,n,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new r.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!s[e.op])throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new r.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new r.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new r.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&e.value===undefined)throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&i.hasUndefined(e.value))throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var o=e.path.split("/").length,c=a.split("/").length;if(o!==c+1&&o!==c)throw new r.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new r.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var u=f([{op:"_get",path:e.from,value:undefined}],n);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new r.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function f(e,t,n){try{if(!Array.isArray(e))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)u(i._deepClone(t),i._deepClone(e),n||!0);else{n=n||h;for(var s=0;s<e.length;s++)n(e[s],s,t,undefined)}}catch(e){if(e instanceof r.JsonPatchError)return e;throw e}}r.getValueByPointer=o,r.applyOperation=c,r.applyPatch=u,r.applyReducer=l,r.validator=h,r.validate=f,r.default={JsonPatchError:r.JsonPatchError,deepClone:r.deepClone,getValueByPointer:o,applyOperation:c,applyPatch:u,applyReducer:l,validator:h,validate:f}}}},{package:"fast-json-patch"}],[4386,{"./core":4385,"./helpers":4387},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var i=e("./helpers"),s=e("./core"),a=e("./core");r.applyOperation=a.applyOperation,r.applyPatch=a.applyPatch,r.applyReducer=a.applyReducer,r.getValueByPointer=a.getValueByPointer,r.validate=a.validate,r.validator=a.validator;var o=e("./helpers");r.JsonPatchError=o.PatchError,r.deepClone=o._deepClone,r.escapePathComponent=o.escapePathComponent,r.unescapePathComponent=o.unescapePathComponent;var c=new WeakMap,u=function(e){this.observers=new Map,this.obj=e},l=function(e,t){this.callback=e,this.observer=t};function h(e,t){t.unobserve()}function f(e,t){var r,n=function(e){return c.get(e)}(e);if(n){var s=function(e,t){return e.observers.get(t)}(n,t);r=s&&s.observer}else n=new u(e),c.set(e,n);if(r)return r;if(r={},n.value=i._deepClone(e),t){r.callback=t,r.next=null;var a=function(){d(r)},o=function(){clearTimeout(r.next),r.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return r.patches=[],r.object=e,r.unobserve=function(){d(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(n,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},n.observers.set(t,new l(t,r)),r}function d(e,t){void 0===t&&(t=!1);var r=c.get(e.object);p(r.value,e.object,e.patches,"",t),e.patches.length&&s.applyPatch(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function p(e,t,r,n,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=i._objectKeys(t),o=i._objectKeys(e),c=!1,u=o.length-1;u>=0;u--){var l=e[f=o[u]];if(!i.hasOwnProperty(t,f)||t[f]===undefined&&l!==undefined&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(s&&r.push({op:"test",path:n+"/"+i.escapePathComponent(f),value:i._deepClone(l)}),r.push({op:"remove",path:n+"/"+i.escapePathComponent(f)}),c=!0):(s&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}),!0);else{var h=t[f];"object"==typeof l&&null!=l&&"object"==typeof h&&null!=h?p(l,h,r,n+"/"+i.escapePathComponent(f),s):l!==h&&(!0,s&&r.push({op:"test",path:n+"/"+i.escapePathComponent(f),value:i._deepClone(l)}),r.push({op:"replace",path:n+"/"+i.escapePathComponent(f),value:i._deepClone(h)}))}}if(c||a.length!=o.length)for(u=0;u<a.length;u++){var f=a[u];i.hasOwnProperty(e,f)||t[f]===undefined||r.push({op:"add",path:n+"/"+i.escapePathComponent(f),value:i._deepClone(t[f])})}}}function g(e,t,r){void 0===r&&(r=!1);var n=[];return p(e,t,n,"",r),n}r.unobserve=h,r.observe=f,r.generate=d,r.compare=g;var m=e("./core"),w=e("./helpers");r.default=n({},m,{unobserve:h,observe:f,generate:d,compare:g,JsonPatchError:w.PatchError,deepClone:i._deepClone,escapePathComponent:i.escapePathComponent,unescapePathComponent:w.unescapePathComponent})}}},{package:"fast-json-patch"}],[4387,{},function(){with(this)return function(){"use strict";return function(e,t,r){
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s=Object.prototype.hasOwnProperty;function a(e,t){return s.call(e,t)}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);t=[];for(var n in e)a(e,n)&&t.push(n);return t}function c(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e,t){var r;for(var n in e)if(a(e,n)){if(e[n]===t)return c(n)+"/";if("object"==typeof e[n]&&""!=(r=u(e[n],t)))return c(n)+"/"+r}return""}function l(e,t){var r=[e];for(var n in t){var i="object"==typeof t[n]?JSON.stringify(t[n],null,2):t[n];void 0!==i&&r.push(n+": "+i)}return r.join("\n")}Object.defineProperty(r,"hasOwnProperty",{value:a}),r._objectKeys=o,r._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},r.isInteger=function(e){for(var t,r=0,n=e.length;r<n;){if(!((t=e.charCodeAt(r))>=48&&t<=57))return!1;r++}return!0},r.escapePathComponent=c,r.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},r._getPathRecursive=u,r.getPath=function(e,t){if(e===t)return"/";var r=u(e,t);if(""===r)throw new Error("Object not found in root");return"/"+r},r.hasUndefined=function e(t){if(t===undefined)return!0;if(t)if(Array.isArray(t)){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return!0}else if("object"==typeof t){var i=o(t),s=i.length;for(r=0;r<s;r++)if(e(t[i[r]]))return!0}return!1};var h=function(e){function t(t,r,n,i,s){var a=this.constructor,o=e.call(this,l(t,{name:r,index:n,operation:i,tree:s}))||this;return o.name=r,o.index=n,o.operation=i,o.tree=s,Object.setPrototypeOf(o,a.prototype),o.message=l(t,{name:r,index:n,operation:i,tree:s}),o}return i(t,e),t}(Error);r.PatchError=h}}},{package:"fast-json-patch"}],[4388,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=Array.isArray,i=Object.keys,s=Object.prototype.hasOwnProperty;t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var a,o,c,u=n(t),l=n(r);if(u&&l){if((o=t.length)!=r.length)return!1;for(a=o;0!=a--;)if(!e(t[a],r[a]))return!1;return!0}if(u!=l)return!1;var h=t instanceof Date,f=r instanceof Date;if(h!=f)return!1;if(h&&f)return t.getTime()==r.getTime();var d=t instanceof RegExp,p=r instanceof RegExp;if(d!=p)return!1;if(d&&p)return t.toString()==r.toString();var g=i(t);if((o=g.length)!==i(r).length)return!1;for(a=o;0!=a--;)if(!s.call(r,g[a]))return!1;for(a=o;0!=a--;)if(!e(t[c=g[a]],r[c]))return!1;return!0}return t!=t&&r!=r}}}},{package:"fast-json-patch>fast-deep-equal"}],[4391,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){for(var t=n.BASE,r=0,i=e.length;r<i;r++)t^=e.charCodeAt(r),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}n.BASE=2166136261,t.exports=n}}},{package:"3box>ipfs>fnv1a"}],[4393,{constants:2245},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("constants")}}},{package:"@metamask/snap-controllers>tar-stream>fs-constants"}],[4394,{assert:1803,events:2176,fsm:4395},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events").EventEmitter,i=e("assert"),s=e("fsm");t.exports=function(e,t){"object"==typeof e&&(t=e,e="START");i.equal(typeof e,"string"),i.equal(typeof t,"object"),i.ok(t[e],"invalid starting state "+e),i.ok(s.validate(t));const r=new n;return a._graph=s.reachable(t),a._emitter=r,a._events=t,a._state=e,a.emit=a,a.on=function(e,t){r.on(e,t)},a;function a(e){const t=a._events[a._state][e];if(!function(e,t,r){if(!t)return!1;if(!e)return!0;const n=r[e];return!(!n||!n[t])&&1===n[t].length}(a._state,t,a._graph)){const t="invalid transition: "+a._state+" -> "+e;return r.emit("error",t)}const n=a._state+":leave",i=t+":enter";return a._state?void(r._events[n]?r.emit(n,s):s()):s();function s(){r._events[i]?r.emit(i,o):o()}function o(){a._state=t,r.emit(t),r.emit("done")}}}}}},{package:"3box>ipfs>fsm-event"}],[4395,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e,t){for(var r in e){t(e[r],r,e)}}function i(e){return Object.keys(e).sort()}function s(e,t){return~e.indexOf(t)}function a(e,t){return e.filter((function(e){return s(t,e)}))}r.validate=function(e){Object.keys(e);return n(e,(function(t,r){n(t,(function(t,n){if(!e[t])throw new Error("invalid transition from state:"+r+" to state:"+t+" on event:"+n)}))})),!0};var o=r.reachable=function(e){var t={},r=!1;do{r=!1,n(e,(function(e,i){var s=t[i]=t[i]||{};n(e,(function(e,t){s[e]||(s[e]=[t],r=!0)})),n(e,(function(e,i){n(t[e],(function(e,t){s[t]||(s[t]=[i].concat(e),r=!0)}))}))}))}while(r);return t};r.terminal=r.deadlock=function(e){var t=[];return n(e,(function(e,r){(function(e){for(var t in e)return!1;return!0})(e)&&t.push(r)})),t};r.livelock=function(e,t){var r=o(e),i=[];return n(r,(function(e,r){s(t,r)||n(t,(function(t){e[t]||s(i,r)||i.push(r)}))})),i.sort()};function c(e){var t=[];return n(e,(function(e,r){n(e,(function(e,r){s(t,r)||t.push(r)}))})),t.sort()}r.combine=function(e,t,r,n){var o,u,l={},h=c(e),f=c(t),d=(u=f,(o=h).filter((function(e){return!s(u,e)})).concat(u.filter((function(e){return!s(o,e)}))).sort());return function r(n,s){var o,c=n+"-"+s;l[c]||(l[c]={}),o=l[c];var u=i(e[n]),h=i(t[s]);return a(u,h).forEach((function(i){o[i]=e[n][i]+"-"+t[s][i],l[o[i]]||r(e[n][i],t[s][i])})),a(d,u).forEach((function(t){o[t]=e[n][t]+"-"+s,l[o[t]]||r(e[n][t],s)})),a(d,h).forEach((function(e){o[e]=n+"-"+t[s][e],l[o[e]]||r(n,t[s][e])})),l[c]}(r,n),l}}}},{package:"3box>ipfs>fsm-event>fsm"}],[4399,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}}}},{package:"3box>ipfs>libp2p-webrtc-star>simple-peer>get-browser-rtc"}],[44,{"@babel/runtime/helpers/interopRequireDefault":200,loglevel:5268},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,n){n((n=>{r.error&&i.default.error("Error in RPC response:\n",r),t.isMetamaskInternal||(i.default.info(`RPC (${e.origin}):`,t,"->",r),n())}))}};var i=n(e("loglevel"))}}},{package:"$root$"}],[4401,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){if(e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}}}},{package:"3box>ipfs>async-iterator-to-pull-stream>get-iterator"}],[4409,{"./types":4410,"cross-fetch/polyfill":2282},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=n[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},a=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r};Object.defineProperty(r,"__esModule",{value:!0});var o=e("./types"),c=e("./types");r.ClientError=c.ClientError,e("cross-fetch/polyfill");var u=function(){function e(e,t){this.url=e,this.options=t||{}}return e.prototype.rawRequest=function(e,t){return i(this,void 0,void 0,(function(){var r,i,c,u,l,f,d,p,g;return s(this,(function(s){switch(s.label){case 0:return r=this.options,i=r.headers,c=a(r,["headers"]),u=JSON.stringify({query:e,variables:t||undefined}),[4,fetch(this.url,n({method:"POST",headers:Object.assign({"Content-Type":"application/json"},i),body:u},c))];case 1:return[4,h(l=s.sent())];case 2:if(f=s.sent(),l.ok&&!f.errors&&f.data)return d=l.headers,p=l.status,[2,n({},f,{headers:d,status:p})];throw g="string"==typeof f?{error:f}:f,new o.ClientError(n({},g,{status:l.status,headers:l.headers}),{query:e,variables:t})}}))}))},e.prototype.request=function(e,t){return i(this,void 0,void 0,(function(){var r,i,c,u,l,f,d;return s(this,(function(s){switch(s.label){case 0:return r=this.options,i=r.headers,c=a(r,["headers"]),u=JSON.stringify({query:e,variables:t||undefined}),[4,fetch(this.url,n({method:"POST",headers:Object.assign({"Content-Type":"application/json"},i),body:u},c))];case 1:return[4,h(l=s.sent())];case 2:if(f=s.sent(),l.ok&&!f.errors&&f.data)return[2,f.data];throw d="string"==typeof f?{error:f}:f,new o.ClientError(n({},d,{status:l.status}),{query:e,variables:t})}}))}))},e.prototype.setHeaders=function(e){return this.options.headers=e,this},e.prototype.setHeader=function(e,t){var r,n=this.options.headers;return n?n[e]=t:this.options.headers=((r={})[e]=t,r),this},e}();function l(e,t,r){return i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,new u(e).request(t,r)]}))}))}function h(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(r){return(t=e.headers.get("Content-Type"))&&t.startsWith("application/json")?[2,e.json()]:[2,e.text()]}))}))}r.GraphQLClient=u,r.rawRequest=function(e,t,r){return i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,new u(e).rawRequest(t,r)]}))}))},r.request=l,r.default=l}}},{package:"3box>graphql-request"}],[4410,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var s=function(e){function t(r,n){var i=this,s=t.extractMessage(r)+": "+JSON.stringify({response:r,request:n});return(i=e.call(this,s)||this).response=r,i.request=n,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return i(t,e),t.extractMessage=function(e){try{return e.errors[0].message}catch(t){return"GraphQL Error (Code: "+e.status+")"}},t}(Error);r.ClientError=s}}},{package:"3box>graphql-request"}],[4411,{"./constants":4415,bech32:4420,bs58check:2184,buffer:2175,"hash.js/lib/hash/ripemd":4474,"hash.js/lib/hash/sha":4475},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var i=e("bech32"),s=n(e("bs58check")),a=e("hash.js/lib/hash/ripemd"),o=e("hash.js/lib/hash/sha"),c=e("./constants"),u=t.from("01","hex"),l=c.BIP_CONSTANTS.PURPOSES,h=c.BIP_CONSTANTS.COINS,f=0,d=169,p=118,g=135,m=136,w=172,_=208,y=240;function b(e,r){return t.concat([e,r])}function v(e){var r=t.alloc(4);return r.writeUInt32LE(e,0),r}function E(e){var r;return e<253?(r=t.alloc(1)).writeUInt8(e,0):e<=65535?((r=t.alloc(3)).writeUInt8(253,0),r.writeUInt16LE(e,1)):e<4294967295?((r=t.alloc(5)).writeUInt8(254,0),r.writeUInt32LE(e,1)):((r=t.alloc(9)).writeUInt8(255,0),r.writeUInt32LE(e>>>0,1),r.writeUInt32LE(e/4294967296|0,5)),r}function S(e,r,n){"number"==typeof e&&(e=e.toString(16));var i=t.alloc(8),s=e.length%2==0?e.toString(16):"0".concat(e.toString(16));return t.from(s,"hex").reverse().copy(i,0),i.copy(r,n),i}function x(e){var r,n;try{r=s.default.decode(e)[0],n=s.default.decode(e).slice(1)}catch(s){try{var a=i.bech32.decode(e);if("bc"===a.prefix)r=_;else{if("tb"!==a.prefix)throw new Error("Unsupported prefix: must be bc or tb.");r=y}if(0!==a.words[0])throw new Error("Unsupported segwit version: must be 0, got ".concat(a.words[0]));n=t.from(i.bech32.fromWords(a.words.slice(1)))}catch(t){throw new Error("Unable to decode address: ".concat(e,": ").concat(t.message))}}return{versionByte:r,pkh:n}}function T(e){if(e.length<2)throw new Error("Path must be >1 index");var t=e[0],r=e[1];if(t===l.BTC_SEGWIT&&r===h.BTC)return _;if(t===l.BTC_SEGWIT&&r===h.BTC_TESTNET)return y;if(t===l.BTC_WRAPPED_SEGWIT&&r===h.BTC)return 5;if(t===l.BTC_WRAPPED_SEGWIT&&r===h.BTC_TESTNET)return 196;if(t===l.BTC_LEGACY&&r===h.BTC)return 0;if(t===l.BTC_LEGACY&&r===h.BTC_TESTNET)return 111;throw new Error("Invalid Bitcoin path provided. Cannot determine address format.")}function k(e){switch(e.signerPath[0]){case l.BTC_LEGACY:return 1;case l.BTC_WRAPPED_SEGWIT:return 3;case l.BTC_SEGWIT:return 4;default:throw new Error("Unsupported path purpose (".concat(e.signerPath[0],"): cannot determine BTC script type."))}}r.default={buildBitcoinTxRequest:function(e){try{var r=e.prevOuts,n=e.recipient,i=e.value,s=e.changePath,a=e.fee;if(!s)throw new Error("No changePath provided.");if(5!==s.length)throw new Error("Please provide a full change path.");var o=t.alloc(59+69*r.length),u=0,l=T(s);o.writeUInt8(l,0),u++,o.writeUInt32LE(s.length,u),u+=4;for(var h=0;h<s.length;h++)o.writeUInt32LE(s[h],u),u+=4;o.writeUInt32LE(a,u),u+=4;var f=x(n);o.writeUInt8(f.versionByte,u),u++,f.pkh.copy(o,u),u+=f.pkh.length,S(i,o,u),u+=8,o.writeUInt8(r.length,u),u++;var d=0;return r.forEach((function(e){if(!e.signerPath||5!==e.signerPath.length)throw new Error("Full recipient path not specified ");o.writeUInt32LE(e.signerPath.length,u),u+=4;for(var r=0;r<e.signerPath.length;r++)o.writeUInt32LE(e.signerPath[r],u),u+=4;o.writeUInt32LE(e.index,u),u+=4,S(e.value,o,u),u+=8,d+=e.value;var n=k(e);o.writeUInt8(n,u),u++,t.isBuffer(e.txHash)||(e.txHash=t.from(e.txHash,"hex")),e.txHash.copy(o,u),u+=e.txHash.length})),{payload:o,schema:c.signingSchema.BTC_TRANSFER,origData:e,changeData:{value:d-(i+a)}}}catch(e){return{err:e}}},serializeTx:function(e){var r=e.inputs,n=e.outputs,i=e.lockTime,s=void 0===i?0:i,c=t.alloc(4),h=0,T=function(e){var t=!1;return e.forEach((function(e){e.signerPath[0]!==l.BTC_SEGWIT&&e.signerPath[0]!==l.BTC_WRAPPED_SEGWIT||(t=!0)})),t}(r);c.writeUInt32LE(2,h),h+=4,T&&(c=b(c,t.from("00","hex")),c=b(c,t.from("01","hex")));var A=E(r.length);c=b(c,A),h+=A.length,r.forEach((function(e){c=b(c,e.hash.reverse()),h+=e.hash.length;var r=v(e.index);c=b(c,r),h+=r.length;var n=k(e);if(3===n){var i=function(e){var r=t.alloc(22),n=t.from((0,o.sha256)().update(e).digest("hex"),"hex"),i=t.from((0,a.ripemd160)().update(n).digest("hex"),"hex");return r.writeUInt8(f,0),r.writeUInt8(i.length,1),i.copy(r,2),r}(e.pubkey),s=E(i.length),l=E((d=t.concat([s,i])).length);c=b(c,l),h+=l.length,c=b(c,d),h+=d.length}else if(1===n){var d=function(e,r){var n=E((e=t.concat([e,u])).length),i=E(r.length),s=t.concat([n,e,i,r]),a=E(s.length);return t.concat([a,s])}(e.sig,e.pubkey);c=b(c,d),h+=d.length}else if(4===n){var p=t.from("00","hex");c=b(c,p),h+=1}var g=v(4294967295);c=b(c,g),h+=g.length}));var P=E(n.length);if(c=b(c,P),h+=P.length,n.forEach((function(e){var r,n,i=(r=e.value,n=t.alloc(8),S(r,n,0),n);c=b(c,i),h+=i.length;var s=function(e){var r=x(e);switch(r.versionByte){case _:case y:return n=r.pkh,(i=t.alloc(2+n.length)).writeUInt8(f,0),i.writeUInt8(n.length,1),n.copy(i,2),i;case 5:case 196:return function(e){var r=t.alloc(3+e.length),n=0;return r.writeUInt8(d,n),n++,r.writeUInt8(e.length,n),n++,e.copy(r,n),n+=e.length,r.writeUInt8(g,n),n++,r}(r.pkh);case 0:case 111:return function(e){var r=t.alloc(5+e.length),n=0;return r.writeUInt8(p,n),n++,r.writeUInt8(d,n),n++,r.writeUInt8(e.length,n),n++,e.copy(r,n),n+=e.length,r.writeUInt8(m,n),n++,r.writeUInt8(w,n),n++,r}(r.pkh);default:throw new Error("Unknown version byte: ".concat(r.versionByte,". Cannot build BTC transaction."))}var n,i}(e.recipient),a=E(s.length);c=b(c,a),h+=a.length,c=b(c,s),h+=s.length})),T){for(var I=[],N=[],R=0;R<r.length;R++)I.push(r[R].sig),N.push(r[R].pubkey);var O=function(e,r){var n=t.alloc(0),i=t.alloc(1);i.writeUInt8(2,0);for(var s=0;s<e.length;s++){var a=t.concat([e[s],u]),o=E(a.length),c=r[s],l=E(c.length);n=t.concat([n,i,o,a,l,c])}return n}(I,N);c=b(c,O),h+=O.length}return t.concat([c,v(s)]).toString("hex")},getBitcoinAddress:function(e,r){var n=null,a=null;if(r===_?(n="bc",a=0):r===y&&(n="tb",a=0),null!==n&&null!==a){var o=i.bech32.toWords(e);return o.unshift(a),i.bech32.encode(n,o)}return s.default.encode(t.concat([t.from([r]),e]))},getAddressFormat:T}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4412,{buffer:2175,"js-sha3":4829,rlp:4422},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.parseCanonicalName=r.parseSolidityJSONABI=void 0;var n=e("js-sha3"),i=e("rlp");r.parseSolidityJSONABI=function(e,r){e=a(e);var n=r.find((function(t){if("function"===t.type&&s(l(t).canonicalName)===e)return t}));if(n){var o=l(n).def;return t.from((0,i.encode)(o))}return null};function s(e){return"0x".concat((0,n.keccak256)(e).slice(0,8))}function a(e){if("string"!=typeof e||10!==e.length&&8!==e.length)throw new Error("`sig` must be a hex string with 4 bytes of data.");return 8===e.length&&(e="0x".concat(e)),e}function o(e){if(p(e))return d(e);if(e.indexOf(",")>-1)return e.slice(0,e.indexOf(","));if(e.indexOf(")")>-1)return e.slice(0,e.indexOf(")"));throw new Error(g)}function c(e){if(!p(e))return[u(e)];var t={szBytes:0,typeIdx:m.indexOf("tuple"),arraySzs:[]},r=d(e,!1),n=e.slice(r.length);t.arraySzs=f(n),r=r.slice(1);for(var i=[];r.length>0;){var s=o(r);r=r.slice(s.length+1),i=i.concat(c(s))}if(!i.length)throw new Error(g);return[t,i]}function u(e){var t={szBytes:0,typeIdx:0,arraySzs:[]},r=!1;if(m.forEach((function(n,i){if(e.indexOf(n)>-1&&!r){t.typeIdx=i,t.arraySzs=f(e);var s=t.arraySzs.length>0?e.indexOf("["):e.length,a=e.slice(n.length,s);if(parseInt(a)&&(t.szBytes=parseInt(a)/8,t.szBytes>32))throw new Error(g);r=!0}})),!r)throw new Error(g);return t}function l(e,t,r,n){if(void 0===t&&(t=""),void 0===r&&(r=[]),void 0===n&&(n=!1),!n){var i=e.name||"";r.push(i),t+=i}return e.inputs&&(t+="(",e.inputs.forEach((function(e){var n=function(e){if(!e.type)throw new Error("No type in input");var t=[e.name],r=function(e){var t,r={szBytes:0,typeIdx:0,arraySzs:[]};m.forEach((function(n,i){e.indexOf(n)>-1&&!t&&(t=n,r.typeIdx=i)})),r.arraySzs=f(e);var n=r.arraySzs.length>0?e.indexOf("["):e.length;if(["uint","int","bytes"].indexOf(t)>-1){var i=parseInt(e.slice(t.length,n))||0;if(i>256)throw new Error("Invalid param size");r.szBytes=i/8}else r.szBytes=0;return r}(e.type),n=r.typeIdx,i=r.szBytes,s=r.arraySzs;return t.push(n),t.push(i),t.push(s),t}(e);if(e.type.indexOf("tuple")>-1&&e.components){var i=l({inputs:e.components},t,[],!0);t=i.canonicalName,t+="".concat(e.type.slice(5),","),n.push(i.def)}else t+=e.type,t+=",";r.push(n)})),","===t[t.length-1]&&(t=t.slice(0,t.length-1)),t+=")"),{def:r,canonicalName:t}}function h(e,t){void 0===t&&(t="");var r=[],n=0;return e.forEach((function(e,i){Array.isArray(e)?r[r.length-1].push(h(e,"".concat(i,"-"))):r.push(["#".concat(t).concat(i+1-n),e.typeIdx,e.szBytes,e.arraySzs]),e.typeIdx===m.indexOf("tuple")&&(n+=1)})),r}function f(e){if("string"!=typeof e)throw new Error("Invalid type");for(var t=[],r=e;r.length>0;){var n=r.indexOf("[");if(n<0)return t;var i=r.slice(n),s=i.indexOf("]");if(s<0)throw new Error("Bad param type");var a=i.slice(1,s);0===a.length?t.push(0):t.push(parseInt(a)),r=i.slice(s+1)}return t}function d(e,t){void 0===t&&(t=!0);for(var r=0,n=!1,i=0;i<e.length;i++){"("===e[i]?(r+=1,n=!0):")"===e[i]&&(r-=1);var s=","===e[i+1]||")"===e[i+1]||i===e.length-1;if(t||"["!==e[i+1]||(s=!0),!r&&n&&s)return e.slice(0,i+1)}throw new Error(g)}function p(e){return"("===e[0]}r.parseCanonicalName=function(e,r){if((e=a(e))!==s(r))throw new Error("Name does not match provided sig.");var n=[],u=r.indexOf("(");if(u<0)throw new Error(g);n.push(r.slice(0,u)),r=r.slice(u+1);for(var l=[];r.length>1;){var f=o(r);l=l.concat(c(f)),r=r.slice(f.length+1)}var d=h(l);return t.from((0,i.encode)(n.concat(d)))};var g="Could not parse canonical function name.",m=[null,"address","bool","uint","int","bytes","string","tuple"]}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4413,{"./evm":4412},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.CALLDATA=void 0;var n=e("./evm");r.CALLDATA={EVM:{type:1,parsers:{parseSolidityJSONABI:n.parseSolidityJSONABI,parseCanonicalName:n.parseCanonicalName}}}}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4414,{"./bitcoin":4411,"./constants":4415,"./ethereum":4416,"./genericSigning":4417,"./index":4418,"./util":4419,bitwise:2099,buffer:2175,"hash.js/lib/hash/sha":4475,superagent:5989},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.Client=void 0;var s=i(e("bitwise")),a=i(e("superagent")),o=i(e("./bitcoin")),c=e("hash.js/lib/hash/sha"),u=e("./index"),l=e("./constants"),h=i(e("./ethereum")),f=e("./genericSigning"),d=e("./util"),p=t.alloc(32),g=function(){function e(e){var t=e.baseUrl,r=e.name,n=e.privKey,i=e.stateData,s=e.timeout,a=e.retryCount,o=e.skipRetryOnWrongWallet;if(this.ephemeralPub=null,this.deviceId=null,this.isPaired=!1,this.activeWallets={internal:{uid:p,name:null,capabilities:null,external:!1},external:{uid:p,name:null,capabilities:null,external:!0}},this.skipRetryOnWrongWallet=o||!1,i)this._unpackAndApplyStateData(i);else{if(this.baseUrl=t||l.BASE_URL,r&&(r.length<5||r.length>24))throw new Error("`name` must be 5-24 characters");this.name=r||"Unknown",this.privKey=n||(0,d.randomBytes)(32),this.key=(0,d.getP256KeyPair)(this.privKey),this.retryCount=a||3,this.timeout=s||6e4}}return e.prototype.getStateData=function(){return this._packStateData()},e.prototype.getFwVersion=function(){return this.fwVersion&&this.fwVersion.length>=3?{fix:this.fwVersion[0],minor:this.fwVersion[1],major:this.fwVersion[2]}:null},e.prototype.getAppName=function(){return this.name},e.prototype.connect=function(e,t){var r=this;return new Promise((function(n,i){var s=(0,d.promisifyCb)(n,i,t);if("function"==typeof e){if(!r.deviceId)return s("No device ID has been stored. Please connect with your device ID first.");s=e}else r.deviceId=e;var a=r._buildRequest(l.deviceCodes.CONNECT,r.pubKeyBytes());r._request(a,null,(function(e,t){return e?s(e):(r.isPaired=r._handleConnect(t)||!1,!r.isPaired||r._fwVersionGTE(0,14,1)?s(e,r.isPaired):void r.fetchActiveWallet((function(e){return s(e,r.isPaired)})))}))}))},e.prototype.pair=function(e,r){var n=this;return new Promise((function(i,s){var a=(0,d.promisifyCb)(i,s,r),o=n.pubKeyBytes(),c=t.alloc(25);if(n.name.length<5||n.name.length>24)return a("Invalid length for name provided. Must be 5-24 characters.");e.length>0&&c.write(n.name);var u=(0,d.generateAppSecret)(o,c,t.from(e)),l=n.key.sign(u),h=(0,d.toPaddedDER)(l),f=t.concat([c,h]);n._request(f,"FINALIZE_PAIRING",(function(e,t){if(e)return a(e);var r=n._handlePair(t);if(r)return a(r);n.fetchActiveWallet((function(e){return e?a(e):a(null,n.hasActiveWallet())}))}))}))},e.prototype.test=function(e,r){var n=this;return new Promise((function(i,s){var a=(0,d.promisifyCb)(i,s,r);if(!e.payload)return a("First argument must contain `testID` and `payload` fields.");var o=t.alloc(506);o.writeUInt32BE(e.testID,0),o.writeUInt16BE(e.payload.length,4),e.payload.copy(o,6),n._request(o,"TEST",(function(e,t){if(e)return a(e);var r=n._handleEncResponse(t,l.decResLengths.test);return null!==r.err?a(r.err):a(null,r.data.slice(65))}))}))},e.prototype.getAddresses=function(e,r){var n=this;return new Promise((function(i,a){var o=(0,d.promisifyCb)(i,a,r),c=e.startPath,u=e.n,h=e.flag,f=void 0===h?0:h;if(c===undefined||u===undefined)return o("Please provide `startPath` and `n` options");if(c.length<2||c.length>5)return o("Path must include between 2 and 5 indices");if(!(0,d.isUInt4)(u)||!(0,d.isUInt4)(f))return o("Parameters `n` and `flag` must be integers between 0 and 15 inclusive");if(u>10)return o("You may only request ".concat(10," addresses at once."));var p=(0,l.getFwVersionConst)(n.fwVersion);if(!((p.getAddressFlags||[]).indexOf(f)>-1&&(f===l.EXTERNAL.GET_ADDR_FLAGS.ED25519_PUB||f===l.EXTERNAL.GET_ADDR_FLAGS.SECP256K1_PUB))&&!(0,d.isValidAssetPath)(c,p))return o("Parent derivation path is not supported");var g=53;if(p.varAddrPathSzAllowed)g+=1;else if(5!==c.length)return o("Your Lattice firmware only supports derivation paths with 5 indices. Please upgrade.");var m=t.alloc(g),w=0,_=n.getActiveWallet();if(null===_)return o("No active wallet.");_.uid.copy(m,w),w+=32,p.varAddrPathSzAllowed&&(m.writeUInt8(c.length,w),w+=1);for(var y=0;y<5;y++)y<=c.length&&m.writeUInt32BE(c[y],w),w+=4;var b,v=0;if(p.addrFlagsAllowed){v=p.getAddressFlags&&p.getAddressFlags.indexOf(f)>-1?f:0;var E=s.default.nibble.read(v),S=s.default.nibble.read(u);b=s.default.byte.write(E.concat(S))}else b=u;return m.writeUInt8(b,w),w++,n._request(m,"GET_ADDRESSES",(function(e,t){if(e)return o(e);var r=n._handleGetAddresses(t,v);return r.err?o(r.err):o(null,r.data)}))}))},e.prototype.sign=function(e,r,i,s){var a=this;return void 0===i&&(i=null),void 0===s&&(s=null),new Promise((function(c,u){var p=(0,d.promisifyCb)(c,u,r),g=e.data;if(!g)return p("You must provide `data`");var m,w,_,y=(0,l.getFwVersionConst)(a.fwVersion);g=n({fwConstants:y},g);var b=null;if(null!==i&&null!==s)b=i.currency,m=i,w=t.concat([s,m.extraDataPayloads.shift()]),_=l.signingSchema.EXTRA_DATA;else{b=e.currency;try{var v=y.genericSigning&&y.genericSigning.encodingTypes&&y.genericSigning.encodingTypes.EVM;if("ETH"===b&&v){var E;console.warn("Using the legacy ETH signing path. This will soon be deprecated. "+"Please switch to general signing request.");try{E=h.default.ethConvertLegacyToGenericReq(g)}catch(e){return p("Could not convert legacy request. Please switch to a general signing "+"request. See gridplus-sdk docs for more information.")}g={fwConstants:y,encodingType:l.EXTERNAL.SIGNING.ENCODINGS.EVM,curveType:l.EXTERNAL.SIGNING.CURVES.SECP256K1,hashType:l.EXTERNAL.SIGNING.HASHES.KECCAK256,signerPath:g.signerPath,payload:E},b=null}m="ETH"===b?h.default.buildEthereumTxRequest(g):"ETH_MSG"===b?h.default.buildEthereumMsgRequest(g):"BTC"===b?o.default.buildBitcoinTxRequest(g):(0,f.buildGenericSigningMsgRequest)(g)}catch(e){return p("Error building signing request: ".concat(e.message))}if(m.err!==undefined)return p(m.err);if(m.payload.length>y.reqMaxDataSz)return p("Transaction is too large");w=m.payload,_=m.schema}var S=t.alloc(2+y.reqMaxDataSz),x=0,T=m.extraDataPayloads&&Number(m.extraDataPayloads.length>0);S.writeUInt8(T,x),x+=1,S.writeUInt8(_,x),x+=1;var k=a.getActiveWallet();return null===k?p("No active wallet."):(k.uid.copy(S,x),x+=k.uid.length,w.copy(S,x),a._request(S,"SIGN_TRANSACTION",(function(t,r){if(t){if(t)return p(t)}else{if(T){var n=a._handleEncResponse(r,l.decResLengths.sign);return s=n.data.slice(65,73),i||((i=m).currency=b),a.sign(e,p,i,s)}try{var o=a._handleSign(r,b,m);return p(null,o)}catch(t){return p(t.message)}}})))}))},e.prototype.addDecoders=function(e,t){return new Promise((function(e,r){return(0,d.promisifyCb)(e,r,t)("Feature currently disabled in Lattice firmware. Please include "+"calldata decoder data in the signing request itself.")}))},e.prototype.getDecoders=function(e,t){return new Promise((function(e,r){return(0,d.promisifyCb)(e,r,t)("Feature currently disabled in Lattice firmware. Please include "+"calldata decoder data in the signing request itself.")}))},e.prototype.removeDecoders=function(e,t){return new Promise((function(e,r){return(0,d.promisifyCb)(e,r,t)("Feature currently disabled in Lattice firmware. Please include "+"calldata decoder data in the signing request itself.")}))},e.prototype.addPermissionV0=function(e,t){return new Promise((function(e,r){return(0,d.promisifyCb)(e,r,t)("This feature has been deprecated and may be replaced at a later time.")}))},e.prototype.getKvRecords=function(e,r){var n=this;return new Promise((function(i,s){var a=(0,d.promisifyCb)(i,s,r),o=e.type,c=void 0===o?0:o,u=e.n,h=void 0===u?1:u,f=e.start,p=void 0===f?0:f,g=(0,l.getFwVersionConst)(n.fwVersion);if(!g.kvActionsAllowed)return a("Unsupported. Please update firmware.");if(h<1)return a("You must request at least one record.");if(h>g.kvActionMaxNum)return a("You may only request up to ".concat(g.kvActionMaxNum," records at once."));var m=t.alloc(9);return m.writeUInt32LE(c,0),m.writeUInt8(h,4),m.writeUInt32LE(p,5),n._request(m,"GET_KV_RECORDS",(function(e,t){if(!e){var r=n._handleEncResponse(t,l.decResLengths.getKvRecords);if(r.err)return a(r.err);var i=65,s=parseInt(r.data.slice(i,i+4).toString("hex"),16);i+=4;var o=parseInt(r.data.slice(i,i+1).toString("hex"),16);if(i+=1,o>g.kvActionMaxNum)return a("Too many records fetched. Firmware error.");for(var c=[],u=0;u<o;u++){var h={};h.id=parseInt(r.data.slice(i,i+4).toString("hex"),16),i+=4,h.type=parseInt(r.data.slice(i,i+4).toString("hex"),16),i+=4,h.caseSensitive=1===parseInt(r.data.slice(i,i+1).toString("hex"),16),i+=1;var f=parseInt(r.data.slice(i,i+1).toString("hex"),16);i+=1,h.key=r.data.slice(i,i+f-1).toString(),i+=g.kvKeyMaxStrSz+1;var d=parseInt(r.data.slice(i,i+1).toString("hex"),16);i+=1,h.val=r.data.slice(i,i+d-1).toString(),i+=g.kvValMaxStrSz+1,c.push(h)}return a(null,{records:c,total:s,fetched:o})}if(e)return a(e)}))}))},e.prototype.addKvRecords=function(e,r){var n=this;return new Promise((function(i,s){var a=(0,d.promisifyCb)(i,s,r),o=e.type,c=void 0===o?0:o,u=e.records,h=void 0===u?{}:u,f=e.caseSensitive,p=void 0!==f&&f,g=(0,l.getFwVersionConst)(n.fwVersion);if(!g.kvActionsAllowed)return a("Unsupported. Please update firmware.");if("object"!=typeof h||0===Object.keys(h).length)return a("One or more key-value mapping must be provided in `records` param.");if(Object.keys(h).length>g.kvActionMaxNum)return a("Too many keys provided. Please only provide up to ".concat(g.kvActionMaxNum,"."));if(Object.keys(h).length<1)return a("You must provide at least one key to add.");var m=t.alloc(1+139*g.kvActionMaxNum);m.writeUInt8(Object.keys(h).length,0);var w=1;try{Object.keys(h).forEach((function(e){if("string"!=typeof e||String(e).length>g.kvKeyMaxStrSz)throw new Error("Key ".concat(e," too large. Must be <=").concat(g.kvKeyMaxStrSz," characters."));if("string"!=typeof h[e]||String(h[e]).length>g.kvValMaxStrSz)throw new Error("Value ".concat(h[e]," too large. Must be <=").concat(g.kvValMaxStrSz," characters."));if(0===String(e).length||0===String(h[e]).length)throw new Error("Keys and values must be >0 characters.");if(!l.ASCII_REGEX.test(e)||!l.ASCII_REGEX.test(h[e]))throw new Error("Unicode characters are not supported.");m.writeUInt32LE(0,w),w+=4,m.writeUInt32LE(c,w),w+=4,m.writeUInt8(p?1:0,w),w+=1,m.writeUInt8(String(e).length+1,w),w+=1,t.from(String(e)).copy(m,w),w+=g.kvKeyMaxStrSz+1,m.writeUInt8(String(h[e]).length+1,w),w+=1,t.from(String(h[e])).copy(m,w),w+=g.kvValMaxStrSz+1}))}catch(e){return a("Error building request: ".concat(e.message))}return n._request(m,"ADD_KV_RECORDS",(function(e,t){if(!e){var r=n._handleEncResponse(t,l.decResLengths.empty);return r.err?a(r.err):a(null)}if(e)return a(e)}))}))},e.prototype.removeKvRecords=function(e,r){var n=this;return new Promise((function(i,s){var a=(0,d.promisifyCb)(i,s,r),o=e.type,c=void 0===o?0:o,u=e.ids,h=void 0===u?[]:u,f=(0,l.getFwVersionConst)(n.fwVersion);if(!f.kvActionsAllowed)return a("Unsupported. Please update firmware.");if(!Array.isArray(h)||h.length<1)return a("You must include one or more `ids` to removed.");if(h.length>f.kvRemoveMaxNum)return a("Only up to ".concat(f.kvRemoveMaxNum," records may be removed at once."));var p=t.alloc(5+4*f.kvRemoveMaxNum);p.writeUInt32LE(c,0),p.writeUInt8(h.length,4);for(var g=0;g<h.length;g++)p.writeUInt32LE(h[g],5+4*g);return n._request(p,"REMOVE_KV_RECORDS",(function(e,t){if(!e){var r=n._handleEncResponse(t,l.decResLengths.empty);return r.err?a(r.err):a(null)}if(e)return a(e)}))}))},e.prototype.fetchActiveWallet=function(e){var r=this;return new Promise((function(n,i){var s=(0,d.promisifyCb)(n,i,e),a=t.alloc(0);return r._request(a,"GET_WALLETS",(function(e,t){return e?(r._resetActiveWallets(),s(e)):s(r._handleGetWallets(t))}))}))},e.prototype._getSharedSecret=function(){return t.from(this.key.derive(this.ephemeralPub.getPublic()).toArray("be",32))},e.prototype._getEphemId=function(){if(null===this.ephemeralPub)return null;var e=this._getSharedSecret();return t.from((0,c.sha256)().update(e).digest("hex"),"hex").slice(0,4)},e.prototype._buildEncRequest=function(e,r){var n=parseInt(this._getEphemId().toString("hex"),16),i=t.concat([t.from([e]),r]),s=(0,d.checksum)(i),a=t.alloc(i.length+4);i.copy(a,0),a.writeUInt32LE(s,i.length);var o=this._getSharedSecret(),c=(0,d.aes256_encrypt)(a,o),u=t.alloc(l.ENC_MSG_LEN+4);return u.writeUInt32LE(n,0),c.copy(u,4),this._buildRequest(l.deviceCodes.ENCRYPTED_REQUEST,u)},e.prototype._buildRequest=function(e,r){var n=r&&t.isBuffer(r)?r.length+1:1;e===l.deviceCodes.ENCRYPTED_REQUEST&&(n=1+r.length);var i=0,s=t.alloc(n+8);i=s.writeUInt8(l.VERSION_BYTE,i),i=s.writeUInt8(l.REQUEST_TYPE_BYTE,i);var a=(0,d.randomBytes)(4);i=s.writeUInt32BE(parseInt("0x".concat(a.toString("hex"))),i),i=s.writeUInt16BE(n,i),i=s.writeUInt8(e,i),n>1&&(i=r.copy(s,i));var o=(0,d.checksum)(s),c=t.alloc(s.length+4);return i=s.copy(c),c.writeUInt32BE(o,i),c},e.prototype._request=function(e,t,r,n){var i=this;if(void 0===n&&(n=this.retryCount),!this.deviceId)return r("Device ID is not set. Please set it and try again.");if(t&&l.encReqCodes[t]===undefined)return r("Unknown encrypted request code.");var s=t?this._buildEncRequest(l.encReqCodes[t],e):e,o="".concat(this.baseUrl,"/").concat(this.deviceId);a.default.post(o).timeout(this.timeout).send({data:s}).then((function(s){if(!s||!s.body)return r("Invalid response: ".concat(s));if(200!==s.body.status)return r("Error code ".concat(s.body.status,": ").concat(s.body.message));var a=(0,d.parseLattice1Response)(s.body.message),o=a.responseCode===l.responseCodes.RESP_ERR_DEV_BUSY||a.responseCode===l.responseCodes.RESP_ERR_GCE_TIMEOUT,c=a.responseCode===l.responseCodes.RESP_ERR_WRONG_WALLET,u=a.responseCode===l.responseCodes.RESP_ERR_INVALID_EPHEM_ID,h=n>0;if(h&&o)setTimeout((function(){i._request(e,t,r,n-1)}),3e3);else if(h&&u)i.connect(i.deviceId,(function(s,a){return s?r(s):a?void i._request(e,t,r,n-1):r("Not paired to device.")}));else if(h&&c&&!i.skipRetryOnWrongWallet)i._resetActiveWallets(),i.fetchActiveWallet().then((function(){if(!(e=i._replaceWalletUID(t,e)))return r("Wrong wallet. Failed to switch. Please reconnect.");i._request(e,t,r,0)})).catch((function(e){return r(e)}));else if(a.responseCode||a.err){if(a.err)return r(a.err);r(l.responseMsgs[a.responseCode]||"Unknown request failure")}else r(null,a.data,a.responseCode)})).catch((function(e){var t="ECONNABORTED"===e.code&&"ETIME"===e.errno;return r(t?"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.":"Failed to make request to device: ".concat(e.message))}))},e.prototype._handleConnect=function(e){var t=0,r=e.readUInt8(t)===l.messageConstants.PAIRED;t++;var n=e.slice(t,t+65).toString("hex");if(t+=65,this.fwVersion=e.slice(t,t+4),t+=4,this.ephemeralPub=(0,d.getP256KeyPairFromPub)(n),r&&this._fwVersionGTE(0,14,1)){var i=e.slice(t,t+160);t+=160;var s=this._getSharedSecret(),a=(0,d.aes256_decrypt)(i,s);if(0!==a[a.length-2]||0!==a[a.length-1])throw new Error("Failed to connect to Lattice.");this._parseAndAddWallets(a)}return r},e.prototype._handleEncResponse=function(e,t){var r=this._getSharedSecret(),n=e.slice(0,l.ENC_MSG_LEN),i=(0,d.aes256_decrypt)(n,r);t+=65;var s=i.slice(0,t),a=parseInt("0x".concat(i.slice(t,t+4).toString("hex"))),o=(0,d.checksum)(s);if(a!==o)return{err:"Checksum mismatch in response from Lattice (calculated ".concat(o,", wanted ").concat(a,")")};var c=i.slice(0,65).toString("hex");try{return this.ephemeralPub=(0,d.getP256KeyPairFromPub)(c),{err:null,data:i}}catch(e){return{err:"Error handling getAddresses response: ".concat(e.toString())}}},e.prototype._handlePair=function(e){var t=this._handleEncResponse(e,l.decResLengths.empty);return t.err?t.err:(this.isPaired=!0,null)},e.prototype._handleGetAddresses=function(e,t){var r=this._handleEncResponse(e,l.decResLengths.getAddresses);if(null!==r.err)return r;var n=r.data,i=65,s=[],a=u.Constants.GET_ADDR_FLAGS,o=a.ED25519_PUB,c=a.SECP256K1_PUB,h=t===o||t===c;for(h&&(i+=1);i+4<l.decResLengths.getAddresses;)if(h){var f=n.slice(i,i+65),d=f.every((function(e){return 0===e}));d||t!==o?d||s.push(f):s.push(f.slice(0,32)),i+=65}else{var p=n.slice(i,i+l.ADDR_STR_LEN);i+=l.ADDR_STR_LEN;var g=p.indexOf(0);g>0&&s.push(p.slice(0,g).toString())}return{data:s,err:null}},e.prototype._handleGetWallets=function(e){var t=this._handleEncResponse(e,l.decResLengths.getWallets);if(null!==t.err)return t;var r=t.data;return this._parseAndAddWallets(r.slice(65)),this.activeWallets.internal.uid.equals(p)&&this.activeWallets.external.uid.equals(p)?"No active wallet.":null},e.prototype._parseAndAddWallets=function(e){var t=0;this.activeWallets.internal.uid=e.slice(t,t+32),this.activeWallets.internal.capabilities=e.readUInt32BE(t+32),this.activeWallets.internal.name=e.slice(t+36,t+71),t+=71,this.activeWallets.external.uid=e.slice(t,t+32),this.activeWallets.external.capabilities=e.readUInt32BE(t+32),this.activeWallets.external.name=e.slice(t+36,t+71)},e.prototype._handleSign=function(e,r,n){void 0===n&&(n=null);var i=this._handleEncResponse(e,l.decResLengths.sign);if(null!==i.err)return{err:i.err};var s,a=65,u=i.data;if("BTC"===r){var p=o.default.getAddressFormat(n.origData.changePath),g=u.slice(a,a+20);a+=20,s=o.default.getBitcoinAddress(g,p)}if("BTC"===r){for(var m=[],w=[],_=0;a<u.length&&48===u[a];){var y=a,b=a+2+u[a+1];w.push(u.slice(y,b));var v=33*_+825,E=33*(_+1)+825;m.push(u.slice(v,E)),a+=74,_+=1}var S={inputs:[],outputs:[]};S.outputs.push({value:n.origData.value,recipient:n.origData.recipient}),n.changeData.value>0&&S.outputs.push({value:n.changeData.value,recipient:s});for(var x=0;x<w.length;x++)S.inputs.push({hash:n.origData.prevOuts[x].txHash,index:n.origData.prevOuts[x].index,sig:w[x],pubkey:m[x],signerPath:n.origData.prevOuts[x].signerPath});var T=o.default.serializeTx(S),k=T,A=t.from((0,c.sha256)().update(t.from(k,"hex")).digest("hex"),"hex");return{tx:T,txHash:(0,c.sha256)().update(A).digest("hex"),changeRecipient:s,sigs:w}}if("ETH"===r){var P=(0,d.parseDER)(u.slice(a,a+2+u[a+1]));a+=74;var I=u.slice(a,a+20),N=h.default.buildEthRawTx(n,P,I),R=N.rawTx,O=N.sigWithV;return{tx:"0x".concat(R),txHash:"0x".concat(h.default.hashTransaction(R)),sig:{v:O.v,r:O.r.toString("hex"),s:O.s.toString("hex")},signer:I}}if("ETH_MSG"===r){P=(0,d.parseDER)(u.slice(a,a+2+u[a+1]));a+=74;var C=u.slice(a,a+20),D=h.default.validateEthereumMsgResponse({signer:C,sig:P},n);return{sig:{v:D.v,r:D.r.toString("hex"),s:D.s.toString("hex")},signer:C}}return(0,f.parseGenericSigningResponse)(u,a,n.curveType,n.omitPubkey)},e.prototype._resetActiveWallets=function(){this.activeWallets.internal.uid=p,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=p,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null},e.prototype._replaceWalletUID=function(e,t){var r=this.getActiveWallet();return r?"GET_ADDRESSES"===e?(r.uid.copy(t,0),t):"SIGN_TRANSACTION"===e?(r.uid.copy(t,2),t):null:null},e.prototype._packStateData=function(){try{var e={activeWallets:{internal:{uid:this.activeWallets.internal.uid.toString("hex"),name:this.activeWallets.internal.name.toString(),capabilities:this.activeWallets.internal.capabilities},external:{uid:this.activeWallets.external.uid.toString("hex"),name:this.activeWallets.external.name.toString(),capabilities:this.activeWallets.external.capabilities}},ephemeralPub:this.ephemeralPub.getPublic().encode("hex"),fwVersion:this.fwVersion.toString("hex"),deviceId:this.deviceId,name:this.name,baseUrl:this.baseUrl,privKey:this.privKey.toString("hex"),retryCount:this.retryCount,timeout:this.timeout};return JSON.stringify(e)}catch(e){return console.warn("Could not pack state data."),null}},e.prototype._unpackAndApplyStateData=function(e){try{var r=JSON.parse(e),n={uid:t.from(r.activeWallets.internal.uid,"hex"),name:t.from(r.activeWallets.internal.name),capabilities:r.activeWallets.internal.capabilities,external:!1},i={uid:t.from(r.activeWallets.external.uid,"hex"),name:t.from(r.activeWallets.external.name),capabilities:r.activeWallets.external.capabilities,external:!0},s=t.from(r.ephemeralPub,"hex"),a=t.from(r.fwVersion,"hex"),o=t.from(r.privKey,"hex");this.activeWallets.internal=n,this.activeWallets.external=i,this.ephemeralPub=(0,d.getP256KeyPairFromPub)(s),this.fwVersion=a,this.deviceId=r.deviceId,this.name=r.name,this.baseUrl=r.baseUrl,this.privKey=o,this.key=(0,d.getP256KeyPair)(this.privKey),this.retryCount=r.retryCount,this.timeout=r.timeout}catch(e){console.warn("Could not apply state data.")}},e.prototype._fwVersionGTE=function(e,t,r){var n=this.getFwVersion(),i=n.major,s=n.minor,a=n.fix;return i>e||i>=e&&s>t||i>=e&&s>=t&&a>=r},e.prototype.getActiveWallet=function(){return p.equals(this.activeWallets.external.uid)?p.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external},e.prototype.hasActiveWallet=function(){return null!==this.getActiveWallet()},e.prototype.pubKeyBytes=function(e){void 0===e&&(e=!1);var r=this.key.getPublic().encode("hex"),n=t.from(r,"hex");if(!0===e){var i=n.slice(1,33).reverse(),s=n.slice(33,65).reverse();return t.concat([n[0],i,s])}return n},e}();r.Client=g}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4415,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.ETH_ABI_LATTICE_FW_TYPE_MAP=r.MAX_CHAIN_ID_BYTES=r.HANDLE_LARGER_CHAIN_ID=r.HARDENED_OFFSET=r.VERSION_BYTE=r.REQUEST_TYPE_BYTE=r.signingSchema=r.responseMsgs=r.responseCodes=r.messageConstants=r.ethMsgProtocol=r.encReqCodes=r.deviceCodes=r.decResLengths=r.addressSizes=r.ENC_MSG_LEN=r.BASE_URL=r.BIP_CONSTANTS=r.AES_IV=r.ADDR_STR_LEN=r.getFwVersionConst=r.ASCII_REGEX=r.EXTERNAL=void 0;r.AES_IV=[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100];r.ADDR_STR_LEN=129;var s={empty:0,getAddresses:1290,sign:1090,getWallets:142,getKvRecords:1395,getDecoders:1608,removeDecoders:4,test:1646};r.decResLengths=s;var a=0;r.ENC_MSG_LEN=a,Object.keys(s).forEach((function(e){s[e]+82>a&&(r.ENC_MSG_LEN=a=s[e]+82)}));r.deviceCodes={CONNECT:1,ENCRYPTED_REQUEST:2};r.encReqCodes={FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,ADD_PERMISSION_V0:5,ADD_DECODERS:6,GET_KV_RECORDS:7,ADD_KV_RECORDS:8,REMOVE_KV_RECORDS:9,GET_DECODERS:10,REMOVE_DECODERS:11,TEST:12};r.messageConstants={NOT_PAIRED:0,PAIRED:1};r.addressSizes={BTC:20,ETH:20};var o={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WRONG_WALLET:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140,RESP_ERR_ALREADY:141,RESP_ERR_INVALID_EPHEM_ID:142};r.responseCodes=o;var c=((n={})[o.RESP_SUCCESS]=0,n[o.RESP_ERR_INVALID_MSG]="Invalid request",n[o.RESP_ERR_UNSUPPORTED_VER]="Unsupported version",n[o.RESP_ERR_DEV_BUSY]="Device busy",n[o.RESP_ERR_USER_TIMEOUT]="Timeout waiting for user",n[o.RESP_ERR_USER_DECLINED]="Request declined by user",n[o.RESP_ERR_PAIR_FAIL]="Pairing failed",n[o.RESP_ERR_PAIR_DISABLED]="Pairing is currently disabled",n[o.RESP_ERR_PERMISSION_DISABLED]="Automated signing is currently disabled",n[o.RESP_ERR_INTERNAL]="Device error",n[o.RESP_ERR_GCE_TIMEOUT]="Timeout",n[o.RESP_ERR_WRONG_WALLET]="Active wallet does not match request",n[o.RESP_ERR_DEV_LOCKED]="Device locked",n[o.RESP_ERR_DISABLED]="Disabled",n[o.RESP_ERR_ALREADY]="Record already exists. You must first remove it on your device.",n[o.RESP_ERR_INVALID_EPHEM_ID]="Could not find requester. Please reconnect.",n);r.responseMsgs=c;r.signingSchema={BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3,EXTRA_DATA:4,GENERAL_SIGNING:5};var u=2147483648;r.HARDENED_OFFSET=u;var l={PURPOSES:{ETH:2147483692,BTC_LEGACY:2147483692,BTC_WRAPPED_SEGWIT:2147483697,BTC_SEGWIT:2147483732},COINS:{ETH:2147483708,BTC:u,BTC_TESTNET:2147483649}};r.BIP_CONSTANTS=l;r.REQUEST_TYPE_BYTE=2;r.VERSION_BYTE=1;r.HANDLE_LARGER_CHAIN_ID=255;r.MAX_CHAIN_ID_BYTES=8;r.BASE_URL="https://signing.gridpl.us";var h={address:1,bool:2,uint8:3,uint16:4,uint24:5,uint32:6,uint40:7,uint48:8,uint56:9,uint64:10,uint72:11,uint80:12,uint88:13,uint96:14,uint104:15,uint112:16,uint120:17,uint128:18,uint136:19,uint144:20,uint152:21,uint160:22,uint168:23,uint176:24,uint184:25,uint192:26,uint200:27,uint208:28,uint216:29,uint224:30,uint232:31,uint240:32,uint248:33,uint256:34,int8:35,int16:36,int24:37,int32:38,int40:39,int48:40,int56:41,int64:42,int72:43,int80:44,int88:45,int96:46,int104:47,int112:48,int120:49,int128:50,int136:51,int144:52,int152:53,int160:54,int168:55,int176:56,int184:57,int192:58,int200:59,int208:60,int216:61,int224:62,int232:63,int240:64,int248:65,int256:66,uint:67,bytes1:69,bytes2:70,bytes3:71,bytes4:72,bytes5:73,bytes6:74,bytes7:75,bytes8:76,bytes9:77,bytes10:78,bytes11:79,bytes12:80,bytes13:81,bytes14:82,bytes15:83,bytes16:84,bytes17:85,bytes18:86,bytes19:87,bytes20:88,bytes21:89,bytes22:90,bytes23:91,bytes24:92,bytes25:93,bytes26:94,bytes27:95,bytes28:96,bytes29:97,bytes30:98,bytes31:99,bytes32:100,bytes:101,string:102},f=i(i({},h),{tuple1:103,tuple2:104,tuple3:105,tuple4:106,tuple5:107,tuple6:108,tuple7:109,tuple8:110,tuple9:111,tuple10:112,tuple11:113,tuple12:114,tuple13:115,tuple14:116,tuple15:117,tuple16:118,tuple17:119});r.ETH_ABI_LATTICE_FW_TYPE_MAP=f;var d={SIGN_PERSONAL:{str:"signPersonal",enumIdx:0},TYPED_DATA:{str:"typedData",enumIdx:1,rawDataMaxLen:1629,typeCodes:h}};r.ethMsgProtocol=d,r.EXTERNAL={GET_ADDR_FLAGS:{SECP256K1_PUB:3,ED25519_PUB:4},SIGNING:{HASHES:{NONE:0,KECCAK256:1,SHA256:2},CURVES:{SECP256K1:0,ED25519:1},ENCODINGS:{NONE:1,SOLANA:2,TERRA:3,EVM:4}}},r.getFwVersionConst=function(e){var t={extraDataFrameSz:0,extraDataMaxFrames:0,genericSigning:{}};function n(e,t){return e[2]>t[0]||e[2]===t[0]&&e[1]>t[1]||e[2]===t[0]&&e[1]===t[1]&&e[0]>t[2]||e[2]===t[0]&&e[1]===t[1]&&e[0]===t[2]}var i=0===e.length;return!i&&n(e,[0,10,4])||!i&&n(e,[0,10,0])?(t.reqMaxDataSz=1678,t.ethMaxGasPrice=2e13,t.addrFlagsAllowed=!0):(t.reqMaxDataSz=1152,t.ethMaxGasPrice=5e11,t.addrFlagsAllowed=!1),t.ethMaxDataSz=t.reqMaxDataSz-128,t.ethMaxMsgSz=t.ethMaxDataSz,t.eip712MaxTypeParams=18,!i&&n(e,[0,10,4])&&(t.extraDataFrameSz=1500,t.extraDataMaxFrames=1),!i&&n(e,[0,10,5])&&(t.varAddrPathSzAllowed=!0,t.eip712Supported=!0),!i&&n(e,[0,10,8])&&(t.prehashAllowed=!0),!i&&n(e,[0,10,10])&&(t.ethMsgPreHashAllowed=!0),!i&&n(e,[0,11,0])&&(t.allowedEthTxTypes=[1,2],t.ethMaxDataSz-=10,t.ethMaxMsgSz=t.ethMaxDataSz),!i&&n(e,[0,11,2])&&(t.personalSignHeaderSz=72),!i&&n(e,[0,12,0])&&(t.kvActionsAllowed=!0,t.kvKeyMaxStrSz=63,t.kvValMaxStrSz=63,t.kvActionMaxNum=10,t.kvRemoveMaxNum=100),!i&&n(e,[0,13,0])&&(t.allowBtcLegacyAndSegwitAddrs=!0,t.contractDeployKey="0x08002e0fec8e6acf00835f43c9764f7364fa3f42"),!i&&n(e,[0,14,0])&&(t.abiCategorySz=32,t.abiMaxRmv=200,t.genericSigning.baseReqSz=1552,t.genericSigning.baseDataSz=1519,t.genericSigning.hashTypes=r.EXTERNAL.SIGNING.HASHES,t.genericSigning.curveTypes=r.EXTERNAL.SIGNING.CURVES,t.genericSigning.encodingTypes={NONE:r.EXTERNAL.SIGNING.ENCODINGS.NONE,SOLANA:r.EXTERNAL.SIGNING.ENCODINGS.SOLANA},t.getAddressFlags=[r.EXTERNAL.GET_ADDR_FLAGS.ED25519_PUB,r.EXTERNAL.GET_ADDR_FLAGS.SECP256K1_PUB],t.eip712MaxTypeParams=36),!i&&n(e,[0,14,1])&&(t.genericSigning.encodingTypes.TERRA=r.EXTERNAL.SIGNING.ENCODINGS.TERRA),!i&&n(e,[0,15,0])&&(t.genericSigning.encodingTypes.EVM=r.EXTERNAL.SIGNING.ENCODINGS.EVM,t.ethMaxDataSz=1519,t.maxDecoderBufSz=1600,t.genericSigning.calldataDecoding={reserved:2895728,maxSz:1024}),t};r.ASCII_REGEX=/^[\x00-\x7F]+$/}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4416,{"./constants":4415,"./util":4419,"@ethereumjs/common":406,"@ethereumjs/tx":410,"bignumber.js":4421,borc:2138,buffer:2175,"eth-eip712-util-browser":2458,"js-sha3":4829,rlp:4422,secp256k1:4423},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var o=s(e("@ethereumjs/common")),c=e("@ethereumjs/tx"),u=a(e("bignumber.js")),l=a(e("borc")),h=e("eth-eip712-util-browser"),f=e("js-sha3"),d=e("rlp"),p=a(e("secp256k1")),g=e("./constants"),m=e("./util");function w(e){for(var t=e[0];e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e}function _(e,r,n,i){void 0===i&&(i={});try{var s=new Uint8Array(e),a=0,o=(0,m.fixLen)(r.r,32);r.r=o;var c=(0,m.fixLen)(r.s,32);r.s=c;var u=new Uint8Array(t.concat([o,c])),l=p.default.ecdsaRecover(u,a,s,!1).slice(1);if(y(l)===n.toString("hex"))return r.v=b(a,i),r;if(a=1,y(l=p.default.ecdsaRecover(u,a,s,!1).slice(1))===n.toString("hex"))return r.v=b(a,i),r;throw new Error("Invalid Ethereum signature returned.")}catch(e){throw new Error(e)}}function y(e){return(0,f.keccak256)(e).slice(-40)}function b(e,r){void 0===r&&(r={});var n=r.chainId,i=r.useEIP155,s=r.type;if(1===s||2===s)return(0,m.ensureHexBuffer)(e,!0);if(!1===i||null===n)return t.from(new u.default(e).plus(27).toString(16),"hex");var a=E(n),o=new u.default(a.toString("hex"),16);return(0,m.ensureHexBuffer)("0x".concat(o.times(2).plus(35).plus(e).toString(16)))}var v={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5};function E(e){var r,n;if((r=!0===S(e)?(0,m.ensureHexBuffer)(e):(0,m.ensureHexBuffer)("0x".concat(new u.default(e).toString(16)))).length>8)throw new Error("ChainID provided is too large.");return r.length<=2||4===r.length||8===r.length?r:(3===r.length?(n=t.alloc(4)).writeUInt32BE(e):r.length<=8&&(n=t.alloc(8),r.copy(n,8-r.length)),n)}function S(e){if("string"!=typeof e)return!1;if("0x"!==e.slice(0,2))return!1;try{return!1===new u.default(e,16).isNaN()}catch(e){return!1}}function x(e,r){var n=r.fwConstants,i=n.ethMaxMsgSz,s=n.extraDataFrameSz,a=n.extraDataMaxFrames,o=i,c=s>0&&a>0,u=[];if(e.length>o){var l=o+a*s;if(!c)throw new Error("Your message is ".concat(e.length," bytes, but can only be a maximum of ").concat(o));if(c&&e.length>l)throw new Error("Your message is ".concat(e.length," bytes, but can only be a maximum of ").concat(l));(0,m.splitFrames)(e.slice(o),s).forEach((function(e){var r=t.alloc(4);r.writeUInt32LE(e.length,0),u.push(t.concat([r,e]))}))}return u}function T(e,t,r,n){void 0===n&&(n=!1);try{r[t].forEach((function(t){var i=t.type.indexOf("[")>-1,s=i?t.type.slice(0,t.type.indexOf("[")):t.type,a=Object.keys(r).indexOf(s)>-1;if(a&&Array.isArray(e))for(var o=0;o<e.length;o++)e[o][t.name]=T(e[o][t.name],s,r,n);else if(a)e[t.name]=T(e[t.name],s,r,n);else if(Array.isArray(e))for(o=0;o<e.length;o++)if(i)for(var c=0;c<e[o][t.name].length;c++)e[o][t.name][c]=k(e[o][t.name][c],s,n);else e[o][t.name]=k(e[o][t.name],s,n);else if(i)for(o=0;o<e[t.name].length;o++)e[t.name][o]=k(e[t.name][o],s,n);else e[t.name]=k(e[t.name],s,n)}))}catch(e){throw new Error(e.message)}return e}function k(e,r,n){if(void 0===n&&(n=!1),"bytes"===r)e=(0,m.ensureHexBuffer)(e),n&&(e="0x".concat(e.toString("hex")));else if("bytes"===r.slice(0,5)){var i=parseInt(r.slice(5));if((e=(0,m.ensureHexBuffer)(e)).length!==i)throw new Error("Expected ".concat(r," type, but got ").concat(e.length," bytes"));n&&(e="0x".concat(e.toString("hex")))}else if("address"===r){if(0===(e=(0,m.ensureHexBuffer)(e)).length&&(e=t.alloc(20)),20!==e.length)throw new Error("Address type must be 20 bytes, but got ".concat(e.length," bytes"));n&&(e="0x".concat(e.toString("hex")))}else if(g.ethMsgProtocol.TYPED_DATA.typeCodes[r]&&(r.indexOf("uint")>-1||r.indexOf("int")>-1)){var s=(0,m.ensureHexBuffer)(e);0===s.length&&(s=t.from("00","hex")),e=n?"0x".concat(s.toString("hex")):(new l.default.Encoder).semanticTypes[1][0](s.toString("hex"),16)}else"bool"===r&&(e=!0===e?1:0);return e}function A(e){return t.from("Ethereum Signed Message:\n".concat(e.toString()),"utf-8")}function P(e,r){return r?t.concat([t.from([r]),(0,d.encode)(e)]):(0,d.encode)(e)}r.default={buildEthereumMsgRequest:function(e){if(!e.payload||!e.protocol||!e.signerPath)throw new Error("You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request");if(e.signerPath.length>5||e.signerPath.length<2)throw new Error("Please provide a signer path with 2-5 indices");var r={schema:g.signingSchema.ETH_MSG,payload:null,input:e,msg:null};try{switch(e.protocol){case"signPersonal":return function(e,r){var n=r.fwConstants.ethMaxMsgSz,i=r.fwConstants.varAddrPathSzAllowed,s=24+n+4,a=0;e.payload=t.alloc(s),e.payload.writeUInt8(g.ethMsgProtocol.SIGN_PERSONAL,0),a+=1;var o=(0,m.buildSignerPathBuf)(r.signerPath,i);o.copy(e.payload,a),a+=o.length;var c=r.payload,u=!1;if("string"==typeof r.payload)if("0x"===r.payload.slice(0,2))c=(0,m.ensureHexBuffer)(r.payload),u=!1===g.ASCII_REGEX.test(t.from(r.payload.slice(2),"hex").toString());else{if(!1===(0,m.isAsciiStr)(r.payload))throw new Error("Currently, the Lattice can only display ASCII strings.");c=t.from(r.payload)}else if("boolean"==typeof r.displayHex)u=r.displayHex;else{if(!r.payload.toString)throw new Error("Unsupported input data type");u=!1===g.ASCII_REGEX.test(r.payload.toString())}var l=r.fwConstants,h=n+l.extraDataMaxFrames*l.extraDataFrameSz;l.personalSignHeaderSz&&(h-=l.personalSignHeaderSz);if(l.ethMsgPreHashAllowed&&c.length>h){e.payload.writeUInt8(u,a),a+=1,e.payload.writeUInt16LE(c.length,a),a+=2;var d=t.from((0,f.keccak256)(t.concat([A(c.length),c])),"hex");d.copy(e.payload,a),e.prehash=d}else{var p=x(c,r);e.extraDataPayloads=p,e.msg=c,e.payload.writeUInt8(u,a),a+=1,e.payload.writeUInt16LE(c.length,a),a+=2,c.copy(e.payload,a)}return e}(r,e);case"eip712":if(!e.fwConstants.eip712Supported)throw new Error("EIP712 is not supported by your Lattice firmware version. Please upgrade.");return function(e,r){try{var n=r.fwConstants,i=n.ethMaxMsgSz,s=n.varAddrPathSzAllowed,a=n.eip712MaxTypeParams,o=g.ethMsgProtocol.TYPED_DATA,c=24+i+4,u=0;e.payload=t.alloc(c),e.payload.writeUInt8(o.enumIdx,0),u+=1;var f=(0,m.buildSignerPathBuf)(r.signerPath,s);f.copy(e.payload,u),u+=f.length;var d=JSON.parse(JSON.stringify(r.payload));if(!d.primaryType||!d.types[d.primaryType])throw new Error("primaryType must be specified and the type must be included.");if(!d.message||!d.domain)throw new Error("message and domain must be specified.");if(0>Object.keys(d.types).indexOf("EIP712Domain"))throw new Error("EIP712Domain type must be defined.");r.payload.message=T(JSON.parse(JSON.stringify(d.message)),JSON.parse(JSON.stringify(d.primaryType)),JSON.parse(JSON.stringify(d.types)),!0),r.payload.domain=T(JSON.parse(JSON.stringify(d.domain)),"EIP712Domain",JSON.parse(JSON.stringify(d.types)),!0),d.domain=T(d.domain,"EIP712Domain",d.types,!1),d.message=T(d.message,d.primaryType,d.types,!1);var p=t.from(l.default.encode(d)),w=r.fwConstants,_=i+w.extraDataMaxFrames*w.extraDataFrameSz,y=p.length>_;if(Object.keys(d.types).forEach((function(e){d.types[e].length>a&&(y=!0)})),w.ethMsgPreHashAllowed&&y){e.payload.writeUInt16LE(p.length,u),u+=2;var b=h.TypedDataUtils.hash(e.input.payload);b.copy(e.payload,u),e.prehash=b}else{var v=x(p,r);e.extraDataPayloads=v,e.payload.writeUInt16LE(p.length,u),u+=2,p.copy(e.payload,u),u+=p.length,e.payload=e.payload.slice(0,u)}return e}catch(e){return{err:"Failed to build EIP712 request: ".concat(e.message)}}}(r,e);default:throw new Error("Unsupported protocol")}}catch(e){return{err:e.toString()}}},validateEthereumMsgResponse:function(e,r){var n=e.signer,i=e.sig,s=r.input,a=r.msg,o=r.prehash,c=void 0===o?null:o;if("signPersonal"===s.protocol)return _(c||t.from((0,f.keccak256)(t.concat([A(a.length),a])),"hex"),i,n,{chainId:1,useEIP155:!1});if("eip712"===s.protocol){var u=h.TypedDataUtils.hash(r.input.payload);return _(c||u,i,n,{useEIP155:!1})}throw new Error("Unsupported protocol")},buildEthereumTxRequest:function(e){try{var r=e.chainId,n=void 0===r?1:r,i=e.signerPath,s=e.eip155,a=void 0===s?null:s,o=e.fwConstants,c=e.type,u=void 0===c?null:c,l=o.contractDeployKey,h=o.extraDataFrameSz,d=o.extraDataMaxFrames,p=o.prehashAllowed,w=h>0&&d>0,_=o.ethMaxDataSz,y=o.varAddrPathSzAllowed;if("number"!=typeof n&&!1===S(n)&&(n=v[n]),!n)throw new Error("Unsupported chain ID or name");if(!i)throw new Error("`signerPath` not provided");if(null===e.to&&!l)throw new Error("Contract deployment not supported. Please update your Lattice firmware.");var b=null===e.to&&l,x=o.allowedEthTxTypes&&o.allowedEthTxTypes.indexOf(2)>-1,T=o.allowedEthTxTypes&&o.allowedEthTxTypes.indexOf(1)>-1,k=x&&(2===u||"eip1559"===u),A=T&&(1===u||"eip2930"===u);if(null!==u&&!k&&!A)throw new Error("Unsupported Ethereum transaction type");var I=function(e){switch(e){case 3:case 4:return!1;default:return!0}}(n);null!==a&&"boolean"==typeof a?I=a:(k||A)&&(I=!1),e.value||(e.value=0);var N=[],R=(0,m.ensureHexBuffer)(n),O=(0,m.ensureHexBuffer)(e.nonce),C=void 0,D=(0,m.ensureHexBuffer)(e.gasLimit),L=void 0,B=void 0;b?(L=t.alloc(0),B=(0,m.ensureHexBuffer)(l)):(L=(0,m.ensureHexBuffer)(e.to),B=(0,m.ensureHexBuffer)(e.to));var M=(0,m.ensureHexBuffer)(e.value),F=(0,m.ensureHexBuffer)(e.data);(k||A)&&N.push(R),N.push(O);var U=void 0,G=void 0;if(k){if(!e.maxPriorityFeePerGas)throw new Error("EIP1559 transactions must include `maxPriorityFeePerGas`");U=(0,m.ensureHexBuffer)(e.maxPriorityFeePerGas),N.push(U),G=(0,m.ensureHexBuffer)(e.maxFeePerGas),N.push(G),C=G}else C=(0,m.ensureHexBuffer)(e.gasPrice),N.push(C);N.push(D),N.push(L),N.push(M),N.push(F);var j=!1;if(k||A){var z=[];Array.isArray(e.accessList)&&e.accessList.forEach((function(e){var t=[];e.storageKeys.forEach((function(e){t.push((0,m.ensureHexBuffer)(e))})),z.push([(0,m.ensureHexBuffer)(e.address),t]),j=!0})),N.push(z)}else!0===I&&(N.push(R),N.push((0,m.ensureHexBuffer)(null)),N.push((0,m.ensureHexBuffer)(null)));var H=t.alloc(_+122),V=0;H.writeUInt8(Number(I),V),V++;var $=void 0,q=0;if(!0==(1!==(re=E(n)).length||255===re.readUInt8(0))){if((q=($=E(n)).length)>g.MAX_CHAIN_ID_BYTES)throw new Error("ChainID provided is too large.");H.writeUInt8(g.HANDLE_LARGER_CHAIN_ID,V),V++}else{if(1!==($=(0,m.ensureHexBuffer)(n)).length)throw new Error("Error parsing chainID");$.copy(H,V),V+=$.length}var W=(0,m.buildSignerPathBuf)(i,y);if(W.copy(H,V),V+=W.length,O.length>4)throw new Error("Nonce too large");if(O.copy(H,V+(4-O.length)),V+=4,C.length>8)throw new Error("Gas price too large");if(C.copy(H,V+(8-C.length)),V+=8,D.length>4)throw new Error("Gas limit too large");if(D.copy(H,V+(4-D.length)),V+=4,20!==B.length)throw new Error("Invalid `to` address");if(B.copy(H,V),V+=20,M.length>32)throw new Error("Value too large");M.copy(H,V+(32-M.length)),V+=32;var K=!1;if(o.allowedEthTxTypes)if(j&&(K=!0),H.writeUInt8(K?1:0,V),V+=1,k){if(H.writeUInt8(2,V),V+=1,U.length>8)throw new Error("maxPriorityFeePerGasBytes too large");U.copy(H,V+(8-U.length)),V+=8}else A?(H.writeUInt8(1,V),V+=1,V+=8):V+=9;var Z=[],Y=null,J=F.length||0,Q=q>0?q+1:0,X=t.alloc(J+Q);if(Q>0&&(X.writeUInt8(q,0),$.copy(X,1)),F.copy(X,Q),J>_){var ee=J+Q,te=_+d*h;if(p&&ee>te)Y=t.from((0,f.keccak256)(P(N,u)),"hex");else{if(!w||w&&ee>te)throw new Error("Data field too large (got ".concat(F.length,"; must be <=").concat(te-Q," bytes)"));(0,m.splitFrames)(X.slice(_),h).forEach((function(e){var r=t.alloc(4);r.writeUInt32LE(e.length,0),Z.push(t.concat([r,e]))}))}}else K&&(Y=t.from((0,f.keccak256)(P(N,u)),"hex"));return H.writeUInt16BE(F.length,V),V+=2,q>0&&(H.writeUInt8(q,V),V++,$.copy(H,V),V+=q),Y?(Y.copy(H,V),V+=_):(F.slice(0,_).copy(H,V),V+=_),{rawTx:N,type:u,payload:H.slice(0,V),extraDataPayloads:Z,schema:g.signingSchema.ETH_TRANSFER,chainId:n,useEIP155:I,signerPath:i}}catch(e){return{err:e.message}}var re},buildEthRawTx:function(e,r,n){var i=_(t.from((0,f.keccak256)(P(e.rawTx,e.type)),"hex"),r,n,e),s=e.useEIP155?e.rawTx.slice(0,-3):e.rawTx;s.push(i.v),s.push(w(i.r)),s.push(w(i.s));var a=(0,d.encode)(s);return e.type&&(a=t.concat([t.from([e.type]),a])),{rawTx:t.from(a).toString("hex"),sigWithV:i}},hashTransaction:function(e){return(0,f.keccak256)(t.from(e,"hex"))},chainIds:v,ensureHexBuffer:m.ensureHexBuffer,ethConvertLegacyToGenericReq:function(e){var r;r=e.chainId&&"01"!==(0,m.ensureHexBuffer)(e.chainId).toString("hex")?o.default.custom({chainId:e.chainId},{hardfork:o.Hardfork.London,eips:[1559,2930]}):new o.default({chain:o.Chain.Mainnet,hardfork:o.Hardfork.London});var n=c.TransactionFactory.fromTxData(e,{common:r});return e.type?n.getMessageToSign(!1):t.from((0,d.encode)(n.getMessageToSign(!1)))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4417,{"./constants":4415,"./index":4418,"./util":4419,buffer:2175,"hash.js/lib/hash/sha":4475,"js-sha3":4829},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.getEncodedPayload=r.parseGenericSigningResponse=r.buildGenericSigningMsgRequest=void 0;var n=e("hash.js/lib/hash/sha"),i=e("js-sha3"),s=e("./constants"),a=e("./index"),o=e("./util");r.buildGenericSigningMsgRequest=function(e){var a=e.signerPath,c=e.curveType,u=e.hashType,l=e.encodingType,h=void 0===l?null:l,f=e.decoder,d=void 0===f?null:f,p=e.omitPubkey,g=void 0!==p&&p,m=e.fwConstants,w=m.extraDataFrameSz,_=m.extraDataMaxFrames,y=m.prehashAllowed,b=m.genericSigning,v=m.varAddrPathSzAllowed,E=b.curveTypes,S=b.encodingTypes,x=b.hashTypes,T=b.baseDataSz,k=b.baseReqSz,A=b.calldataDecoding,P=(0,r.getEncodedPayload)(e.payload,h,S),I=P.encoding,N=P.payloadBuf,R=N.length,O=T+_*w;if(!R)throw new Error("Payload could not be handled.");if(!(b&&w&&_&&y))throw new Error("Unsupported. Please update your Lattice firmware.");if(!(0,o.existsIn)(c,E))throw new Error("Unsupported curve type.");if(!(0,o.existsIn)(u,x))throw new Error("Unsupported hash type.");var C=d&&A&&d.length<=A.maxSz,D=C&&N.length+d.length<=O;if(C&&D){var L=t.alloc(8+d.length);L.writeUInt32LE(A.reserved,0),L.writeUInt32LE(d.length,4),t.from(d).copy(L,8),N=t.concat([N,L])}if(c===E.ED25519){if(u!==x.NONE)throw new Error("Signing on ed25519 requires unhashed message");a.forEach((function(e){if(e<s.HARDENED_OFFSET)throw new Error("Signing on ed25519 requires all signer path indices be hardened.")}))}var B=t.alloc(k),M=0;B.writeUInt32LE(I,M),M+=4,B.writeUInt8(u,M),M+=1,B.writeUInt8(c,M),M+=1;var F=(0,o.buildSignerPathBuf)(a,v);F.copy(B,M),M+=F.length,B.writeUInt8(g?1:0,M),M+=1;var U=[],G=null,j=!1;if(N.length>T)if(y&&N.length>O){B.writeUInt16LE(N.length,M),M+=2,j=!0;var z=N.slice(0,R);if(u===x.NONE)throw new Error("Message too large to send and could not be prehashed (hashType=NONE).");if(u===x.KECCAK256)G=t.from((0,i.keccak256)(z),"hex");else{if(u!==x.SHA256)throw new Error("Unsupported hash type.");G=t.from((0,n.sha256)().update(z).digest("hex"),"hex")}}else{(0,o.splitFrames)(N.slice(T),w).forEach((function(e){var r=t.alloc(4);r.writeUInt32LE(e.length,0),U.push(t.concat([r,e]))}))}return j||(B.writeUInt16LE(R,M),M+=2),(G||N).copy(B,M),{payload:B,extraDataPayloads:U,schema:s.signingSchema.GENERAL_SIGNING,curveType:c,omitPubkey:g}};r.parseGenericSigningResponse=function(e,r,n,i){var s={pubkey:null,sig:null};if(n===a.Constants.SIGNING.CURVES.SECP256K1){if(i)r+=65;else{var c=e.readUInt8(r);if(r+=1,2===c||3===c)s.pubkey=t.alloc(33),s.pubkey.writeUInt8(c,0),e.slice(r,r+32).copy(s.pubkey,1);else{if(4!==c)throw new Error("Bad compression byte in signing response.");s.pubkey=t.alloc(65),s.pubkey.writeUInt8(c,0),e.slice(r).copy(s.pubkey,1)}r+=64}s.sig=(0,o.parseDER)(e.slice(r,r+2+e[r+1])),s.sig.r=(0,o.fixLen)(s.sig.r,32),s.sig.s=(0,o.fixLen)(s.sig.s,32)}else{if(n!==a.Constants.SIGNING.CURVES.ED25519)throw new Error("Unsupported curve.");i||(s.pubkey=t.alloc(32),e.slice(r,r+32).copy(s.pubkey)),r+=32,s.sig={r:e.slice(r,r+32),s:e.slice(r+32,r+64)}}return s};r.getEncodedPayload=function(e,r,n){if(r||(r=a.Constants.SIGNING.ENCODINGS.NONE),!(0,o.existsIn)(r,n))throw new Error("Encoding not supported by Lattice firmware. You may want to update.");return{payloadBuf:"string"==typeof e&&"0x"===e.slice(0,2)?t.from(e.slice(2),"hex"):t.from(e),encoding:r}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4418,{"./calldata/index":4413,"./client":4414,"./constants":4415,"./util":4419},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Utils=r.Constants=r.Client=r.Calldata=void 0;var n=e("./calldata/index");Object.defineProperty(r,"Calldata",{enumerable:!0,get:function(){return n.CALLDATA}});var i=e("./client");Object.defineProperty(r,"Client",{enumerable:!0,get:function(){return i.Client}});var s=e("./constants");Object.defineProperty(r,"Constants",{enumerable:!0,get:function(){return s.EXTERNAL}});var a=e("./util");Object.defineProperty(r,"Utils",{enumerable:!0,get:function(){return a.EXTERNAL}})}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4419,{"./constants":4415,"@ethereumjs/tx":410,"aes-js":1778,"bignumber.js":4421,"bn.js":2131,buffer:2175,"crc-32":2249,elliptic:2409,"hash.js/lib/hash/sha":4475,"lodash/inRange":5235,"lodash/isInteger":5244,secp256k1:4423},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.EXTERNAL=r.getV=r.generateAppSecret=r.isUInt4=r.randomBytes=r.promisifyCb=r.existsIn=r.isAsciiStr=r.buildSignerPathBuf=r.getP256KeyPairFromPub=r.getP256KeyPair=r.parseDER=r.aes256_decrypt=r.aes256_encrypt=r.fixLen=r.ensureHexBuffer=r.splitFrames=r.isValidAssetPath=r.toPaddedDER=r.checksum=r.parseLattice1Response=void 0;var s,a=e("@ethereumjs/tx"),o=i(e("aes-js")),c=e("bn.js"),u=i(e("bignumber.js")),l=i(e("crc-32")),h=i(e("elliptic")),f=e("hash.js/lib/hash/sha"),d=e("secp256k1"),p=e("./constants"),g=p.BIP_CONSTANTS.COINS,m=p.BIP_CONSTANTS.PURPOSES,w=h.default.ec,_=i(e("lodash/isInteger")),y=i(e("lodash/inRange"));r.parseLattice1Response=function(e){var n={err:null,data:null},i=t.from(e,"hex"),s=0,a=i.readUInt8(s);if(s++,a!==p.VERSION_BYTE)return n.err="Incorrect protocol version. Please update your SDK",n;var o=i.readUInt8(s);if(s++,0!==o)return n.err="Incorrect response from Lattice1",n;i.readUInt32BE(s),s+=4;var c=i.readUInt16BE(s);s+=2;var u=i.slice(s,s+c);s+=c;var l=u.readUInt8(0);return l!==p.responseCodes.RESP_SUCCESS?(n.err="".concat(p.responseMsgs[l]?p.responseMsgs[l]:"Unknown Error"," (Lattice)"),n.responseCode=l,n):(n.data=u.slice(1,u.length),i.readUInt32BE(s)!==(0,r.checksum)(i.slice(0,i.length-4))?(n.err="Invalid checksum from device response",n.data=null,n):n)};r.checksum=function(e){return l.default.buf(e)>>>0};r.toPaddedDER=function(e){var r=t.alloc(74);return t.from(e.toDER()).copy(r),r};r.isValidAssetPath=function(e,t){var r=[m.ETH,m.BTC_LEGACY,m.BTC_WRAPPED_SEGWIT,m.BTC_SEGWIT],n=[g.ETH,g.BTC,g.BTC_TESTNET];return!((e[1]===g.BTC||e[1]===g.BTC_TESTNET)&&e[0]!==m.BTC_WRAPPED_SEGWIT&&!t.allowBtcLegacyAndSegwitAddrs)&&(r.indexOf(e[0])>=0&&(n.indexOf(e[1])>=0||[60,61,966,700,9006,9e3,1007,553,178,137,37310,108,40,889,1987,820,6060,1620,1313114,76,246529,246785,1001,227,916,464,2221,344,73799,246].indexOf(e[1]-p.HARDENED_OFFSET)>0))};r.splitFrames=function(e,t){for(var r=[],n=Math.ceil(e.length/t),i=0,s=0;s<n;s++)r.push(e.slice(i,i+t)),i+=t;return r};r.ensureHexBuffer=function(e,r){void 0===r&&(r=!0);try{if(null===e||0===e&&!0===r)return t.alloc(0);var n="number"==typeof e||function(e){var t=new u.default(e).toString().split(".").join(""),r=new String(e);return t.slice(0,8)===r.slice(0,8)}(e);return(e=n?"".concat(new u.default(e).toString(16)):"string"==typeof e&&"0x"===e.slice(0,2)?e.slice(2):e.toString("hex")).length%2>0&&(e="0".concat(e)),"00"!==e||n?t.from(e,"hex"):t.alloc(0)}catch(t){throw new Error("Cannot convert ".concat(e.toString()," to hex buffer (").concat(t.toString(),")"))}};r.fixLen=function(e,r){var n=t.alloc(r);return e.length<r?(e.copy(n,r-e.length),n):e.slice(-r)};r.aes256_encrypt=function(e,r){var n=t.from(p.AES_IV),i=new o.default.ModeOfOperation.cbc(r,n),s=e.length%16==0?e:o.default.padding.pkcs7.pad(e);return t.from(i.encrypt(s))};r.aes256_decrypt=function(e,r){var n=t.from(p.AES_IV),i=new o.default.ModeOfOperation.cbc(r,n);return t.from(i.decrypt(e))};r.parseDER=function(e){if(48!==e[0]||2!==e[2])return null;var t=3,r={r:null,s:null},n=e[t];if(t++,r.r=e.slice(t,t+n),2!==e[t+=n])return null;var i=e[++t];return t++,r.s=e.slice(t,t+i),r};r.getP256KeyPair=function(e){return s===undefined&&(s=new w("p256")),s.keyFromPrivate(e,"hex")};r.getP256KeyPairFromPub=function(e){return s===undefined&&(s=new w("p256")),s.keyFromPublic(e,"hex")};r.buildSignerPathBuf=function(e,r){var n=t.alloc(24),i=0;if(r&&e.length>5)throw new Error("Signer path must be <=5 indices.");if(!r&&5!==e.length)throw new Error("Your Lattice firmware only supports 5-index derivation paths. Please upgrade.");n.writeUInt32LE(e.length,i),i+=4;for(var s=0;s<5;s++)s<e.length?n.writeUInt32LE(e[s],i):n.writeUInt32LE(0,i),i+=4;return n};r.isAsciiStr=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)return!1;for(var r=t?[32,10]:[],n=0;n<e.length;n++){var i=e.charCodeAt(n);if(r.indexOf(i)<0&&(i<32||i>127))return!1}return!0};r.existsIn=function(e,t){return Object.keys(t).some((function(r){return t[r]===e}))};r.promisifyCb=function(e,t,r){return function(i){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return r&&"function"==typeof r?r.apply(void 0,n([i],s,!1)):i&&"string"==typeof i?t(i):e.apply(void 0,s)}};r.randomBytes=function(e){for(var r=t.alloc(e),n=0;n<e;n++)r[n]=Math.round(255*Math.random());return r};r.isUInt4=function(e){return(0,_.default)(e)&&(0,y.default)(0,16)};r.generateAppSecret=function(e,r,n){var i=t.concat([e,r,n]);return t.from((0,f.sha256)().update(i).digest("hex"),"hex")};r.getV=function(e,r){var n,i=e.getMessageToSign(!0),s=new Uint8Array(t.concat([r.sig.r,r.sig.s])),o=new Uint8Array(r.pubkey),u=(0,d.ecdsaRecover)(s,0,i,!1),l=(0,d.ecdsaRecover)(s,1,i,!1),h=t.from(o).toString("hex"),f=t.from(u).toString("hex"),p=t.from(l).toString("hex");if(h===f)n=0;else{if(h!==p)return null;n=1}if(e._type)return new c.BN(n);var g=null;return e.common&&"function"==typeof e.common.chainIdBN?g=e.common.chainIdBN():e.chainId&&(g=new c.BN(e.chainId)),g&&e.supports(a.Capability.EIP155ReplayProtection)?g.muln(2).addn(35).addn(n):new c.BN(n).addn(27)},r.EXTERNAL={getV:r.getV,generateAppSecret:r.generateAppSecret}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"eth-lattice-keyring>gridplus-sdk"}],[4420,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.bech32m=r.bech32=void 0;const n="qpzry9x8gf2tvdw0s3jn54khce6mua7l",i={};for(let e=0;e<n.length;e++){const t=n.charAt(e);i[t]=e}function s(e){const t=e>>25;return(33554431&e)<<5^996825010&-(t>>0&1)^642813549&-(t>>1&1)^513874426&-(t>>2&1)^1027748829&-(t>>3&1)^705979059&-(t>>4&1)}function a(e){let t=1;for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+e+")";t=s(t)^n>>5}t=s(t);for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);t=s(t)^31&n}return t}function o(e,t,r,n){let i=0,s=0;const a=(1<<r)-1,o=[];for(let n=0;n<e.length;++n)for(i=i<<t|e[n],s+=t;s>=r;)s-=r,o.push(i>>s&a);if(n)s>0&&o.push(i<<r-s&a);else{if(s>=t)return"Excess padding";if(i<<r-s&a)return"Non-zero padding"}return o}function c(e){return o(e,8,5,!0)}function u(e){const t=o(e,5,8,!1);if(Array.isArray(t))return t}function l(e){const t=o(e,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}function h(e){let t;function r(e,r){if(r=r||90,e.length<8)return e+" too short";if(e.length>r)return"Exceeds length limit";const n=e.toLowerCase(),o=e.toUpperCase();if(e!==n&&e!==o)return"Mixed-case string "+e;const c=(e=n).lastIndexOf("1");if(-1===c)return"No separator character for "+e;if(0===c)return"Missing prefix for "+e;const u=e.slice(0,c),l=e.slice(c+1);if(l.length<6)return"Data too short";let h=a(u);if("string"==typeof h)return h;const f=[];for(let e=0;e<l.length;++e){const t=l.charAt(e),r=i[t];if(r===undefined)return"Unknown character "+t;h=s(h)^r,e+6>=l.length||f.push(r)}return h!==t?"Invalid checksum for "+e:{prefix:u,words:f}}return t="bech32"===e?1:734539939,{decodeUnsafe:function(e,t){const n=r(e,t);if("object"==typeof n)return n},decode:function(e,t){const n=r(e,t);if("object"==typeof n)return n;throw new Error(n)},encode:function(e,r,i){if(i=i||90,e.length+7+r.length>i)throw new TypeError("Exceeds length limit");let o=a(e=e.toLowerCase());if("string"==typeof o)throw new Error(o);let c=e+"1";for(let e=0;e<r.length;++e){const t=r[e];if(t>>5!=0)throw new Error("Non 5-bit word");o=s(o)^t,c+=n.charAt(t)}for(let e=0;e<6;++e)o=s(o);o^=t;for(let e=0;e<6;++e){c+=n.charAt(o>>5*(5-e)&31)}return c},toWords:c,fromWordsUnsafe:u,fromWords:l}}r.bech32=h("bech32"),r.bech32m=h("bech32m")}}},{package:"eth-lattice-keyring>gridplus-sdk>bech32"}],[4421,{},function(){with(this)return function(){"use strict";return function(e,t,r){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,a="[BigNumber Error] ",o=a+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,d=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function g(e){for(var t,r,n=1,i=e.length,s=e[0]+"";n<i;){for(t=e[n++]+"",r=u-t.length;r--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function m(e,t){var r,n,i=e.c,s=t.c,a=e.s,o=t.s,c=e.e,u=t.e;if(!a||!o)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-o:a;if(a!=o)return a;if(r=a<0,n=c==u,!i||!s)return n?0:!i^r?1:-1;if(!n)return c>u^r?1:-1;for(o=(c=i.length)<(u=s.length)?c:u,a=0;a<o;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return c==u?0:c>u^r?1:-1}function w(e,t,r,n){if(e<t||e>r||e!==s(e))throw Error(a+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function _(e){var t=e.c.length-1;return p(e.e/u)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function b(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,v,E,S,x,T,k,A,P,I,N=H.prototype={constructor:H,toString:null,valueOf:null},R=new H(1),O=20,C=4,D=-7,L=21,B=-1e7,M=1e7,F=!1,U=1,G=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},z="0123456789abcdefghijklmnopqrstuvwxyz";function H(e,t){var r,i,a,c,h,f,d,p,g=this;if(!(g instanceof H))return new H(e,t);if(null==t){if(e&&!0===e._isBigNumber)return g.s=e.s,void(!e.c||e.e>M?g.c=g.e=null:e.e<B?g.c=[g.e=0]:(g.e=e.e,g.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(g.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,h=e;h>=10;h/=10,c++);return void(c>M?g.c=g.e=null:(g.e=c,g.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return E(g,p,f);g.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(c=p.indexOf("."))>-1&&(p=p.replace(".","")),(h=p.search(/e/i))>0?(c<0&&(c=h),c+=+p.slice(h+1),p=p.substring(0,h)):c<0&&(c=p.length)}else{if(w(t,2,z.length,"Base"),10==t)return W(g=new H(e),O+g.e+1,C);if(p=String(e),f="number"==typeof e){if(0*e!=0)return E(g,p,f,t);if(g.s=1/e<0?(p=p.slice(1),-1):1,H.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else g.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=z.slice(0,t),c=h=0,d=p.length;h<d;h++)if(r.indexOf(i=p.charAt(h))<0){if("."==i){if(h>c){c=d;continue}}else if(!a&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){a=!0,h=-1,c=0;continue}return E(g,String(e),f,t)}f=!1,(c=(p=v(p,t,10,g.s)).indexOf("."))>-1?p=p.replace(".",""):c=p.length}for(h=0;48===p.charCodeAt(h);h++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(h,++d)){if(d-=h,f&&H.DEBUG&&d>15&&(e>l||e!==s(e)))throw Error(o+g.s*e);if((c=c-h-1)>M)g.c=g.e=null;else if(c<B)g.c=[g.e=0];else{if(g.e=c,g.c=[],h=(c+1)%u,c<0&&(h+=u),h<d){for(h&&g.c.push(+p.slice(0,h)),d-=u;h<d;)g.c.push(+p.slice(h,h+=u));h=u-(p=p.slice(h)).length}else h-=d;for(;h--;p+="0");g.c.push(+p)}}else g.c=[g.e=0]}function V(e,t,r,n){var i,s,a,o,c;if(null==r?r=C:w(r,0,8),!e.c)return e.toString();if(i=e.c[0],a=e.e,null==t)c=g(e.c),c=1==n||2==n&&(a<=D||a>=L)?y(c,a):b(c,a,"0");else if(s=(e=W(new H(e),t,r)).e,o=(c=g(e.c)).length,1==n||2==n&&(t<=s||s<=D)){for(;o<t;c+="0",o++);c=y(c,s)}else if(t-=a,c=b(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function $(e,t){for(var r,n=1,i=new H(e[0]);n<e.length;n++){if(!(r=new H(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function q(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+r*u-1)>M?e.c=e.e=null:r<B?e.c=[e.e=0]:(e.e=r,e.c=t),e}function W(e,t,r,n){var a,o,l,f,d,p,g,m=e.c,w=h;if(m){e:{for(a=1,f=m[0];f>=10;f/=10,a++);if((o=t-a)<0)o+=u,l=t,g=(d=m[p=0])/w[a-l-1]%10|0;else if((p=i((o+1)/u))>=m.length){if(!n)break e;for(;m.length<=p;m.push(0));d=g=0,a=1,l=(o%=u)-u+1}else{for(d=f=m[p],a=1;f>=10;f/=10,a++);g=(l=(o%=u)-u+a)<0?0:d/w[a-l-1]%10|0}if(n=n||t<0||null!=m[p+1]||(l<0?d:d%w[a-l-1]),n=r<4?(g||n)&&(0==r||r==(e.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(o>0?l>0?d/w[a-l]:0:m[p-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=w[(u-t%u)%u],e.e=-t||0):m[0]=e.e=0,e;if(0==o?(m.length=p,f=1,p--):(m.length=p+1,f=w[u-o],m[p]=l>0?s(d/w[a-l]%w[l])*f:0),n)for(;;){if(0==p){for(o=1,l=m[0];l>=10;l/=10,o++);for(l=m[0]+=f,f=1;l>=10;l/=10,f++);o!=f&&(e.e++,m[0]==c&&(m[0]=1));break}if(m[p]+=f,m[p]!=c)break;m[p--]=0,f=1}for(o=m.length;0===m[--o];m.pop());}e.e>M?e.c=e.e=null:e.e<B&&(e.c=[e.e=0])}return e}function K(e){var t,r=e.e;return null===r?e.toString():(t=g(e.c),t=r<=D||r>=L?y(t,r):b(t,r,"0"),e.s<0?"-"+t:t)}return H.clone=e,H.ROUND_UP=0,H.ROUND_DOWN=1,H.ROUND_CEIL=2,H.ROUND_FLOOR=3,H.ROUND_HALF_UP=4,H.ROUND_HALF_DOWN=5,H.ROUND_HALF_EVEN=6,H.ROUND_HALF_CEIL=7,H.ROUND_HALF_FLOOR=8,H.EUCLID=9,H.config=H.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(a+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(w(r=e[t],0,d,t),O=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(w(r=e[t],0,8,t),C=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(w(r[0],-d,0,t),w(r[1],0,d,t),D=r[0],L=r[1]):(w(r,-d,d,t),D=-(L=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)w(r[0],-d,-1,t),w(r[1],1,d,t),B=r[0],M=r[1];else{if(w(r,-d,d,t),!r)throw Error(a+t+" cannot be zero: "+r);B=-(M=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(a+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw F=!r,Error(a+"crypto unavailable");F=r}else F=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(w(r=e[t],0,9,t),U=r),e.hasOwnProperty(t="POW_PRECISION")&&(w(r=e[t],0,d,t),G=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(a+t+" not an object: "+r);j=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(a+t+" invalid: "+r);z=r}}return{DECIMAL_PLACES:O,ROUNDING_MODE:C,EXPONENTIAL_AT:[D,L],RANGE:[B,M],CRYPTO:F,MODULO_MODE:U,POW_PRECISION:G,FORMAT:j,ALPHABET:z}},H.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!H.DEBUG)return!0;var t,r,n=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-d&&i<=d&&i===s(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%u)<1&&(t+=u),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=c||r!==s(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(a+"Invalid BigNumber: "+e)},H.maximum=H.max=function(){return $(arguments,N.lt)},H.minimum=H.min=function(){return $(arguments,N.gt)},H.random=(S=9007199254740992,x=Math.random()*S&2097151?function(){return s(Math.random()*S)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,o,c,l=0,f=[],p=new H(R);if(null==e?e=O:w(e,0,d),o=i(e/u),F)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[l]=r[0],t[l+1]=r[1]):(f.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw F=!1,Error(a+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(f.push(c%1e14),l+=7);l=o/7}if(!F)for(;l<o;)(c=x())<9e15&&(f[l++]=c%1e14);for(o=f[--l],e%=u,o&&e&&(c=h[u-e],f[l]=s(o/c)*c);0===f[l];f.pop(),l--);if(l<0)f=[n=0];else{for(n=-1;0===f[0];f.splice(0,1),n-=u);for(l=1,c=f[0];c>=10;c/=10,l++);l<u&&(n-=u-l)}return p.e=n,p.c=f,p}),H.sum=function(){for(var e=1,t=arguments,r=new H(t[0]);e<t.length;)r=r.plus(t[e++]);return r},v=function(){var e="0123456789";function t(e,t,r,n){for(var i,s,a=[0],o=0,c=e.length;o<c;){for(s=a.length;s--;a[s]*=t);for(a[0]+=n.indexOf(e.charAt(o++)),i=0;i<a.length;i++)a[i]>r-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/r|0,a[i]%=r)}return a.reverse()}return function(n,i,s,a,o){var c,u,l,h,f,d,p,m,w=n.indexOf("."),_=O,y=C;for(w>=0&&(h=G,G=0,n=n.replace(".",""),d=(m=new H(i)).pow(n.length-w),G=h,m.c=t(b(g(d.c),d.e,"0"),10,s,e),m.e=m.c.length),l=h=(p=t(n,i,s,o?(c=z,e):(c=e,z))).length;0==p[--h];p.pop());if(!p[0])return c.charAt(0);if(w<0?--l:(d.c=p,d.e=l,d.s=a,p=(d=r(d,m,_,y,s)).c,f=d.r,l=d.e),w=p[u=l+_+1],h=s/2,f=f||u<0||null!=p[u+1],f=y<4?(null!=w||f)&&(0==y||y==(d.s<0?3:2)):w>h||w==h&&(4==y||f||6==y&&1&p[u-1]||y==(d.s<0?8:7)),u<1||!p[0])n=f?b(c.charAt(1),-_,c.charAt(0)):c.charAt(0);else{if(p.length=u,f)for(--s;++p[--u]>s;)p[u]=0,u||(++l,p=[1].concat(p));for(h=p.length;!p[--h];);for(w=0,n="";w<=h;n+=c.charAt(p[w++]));n=b(n,l,c.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,i,s,a,o=0,c=e.length,u=t%f,l=t/f|0;for(e=e.slice();c--;)o=((i=u*(s=e[c]%f)+(n=l*s+(a=e[c]/f|0)*u)%f*f+o)/r|0)+(n/f|0)+l*a,e[c]=i%r;return o&&(e=[o].concat(e)),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,a,o,l){var h,f,d,g,m,w,_,y,b,v,E,S,x,T,k,A,P,I=n.s==i.s?1:-1,N=n.c,R=i.c;if(!(N&&N[0]&&R&&R[0]))return new H(n.s&&i.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*I:I/0:NaN);for(b=(y=new H(I)).c=[],I=a+(f=n.e-i.e)+1,l||(l=c,f=p(n.e/u)-p(i.e/u),I=I/u|0),d=0;R[d]==(N[d]||0);d++);if(R[d]>(N[d]||0)&&f--,I<0)b.push(1),g=!0;else{for(T=N.length,A=R.length,d=0,I+=2,(m=s(l/(R[0]+1)))>1&&(R=e(R,m,l),N=e(N,m,l),A=R.length,T=N.length),x=A,E=(v=N.slice(0,A)).length;E<A;v[E++]=0);P=R.slice(),P=[0].concat(P),k=R[0],R[1]>=l/2&&k++;do{if(m=0,(h=t(R,v,A,E))<0){if(S=v[0],A!=E&&(S=S*l+(v[1]||0)),(m=s(S/k))>1)for(m>=l&&(m=l-1),_=(w=e(R,m,l)).length,E=v.length;1==t(w,v,_,E);)m--,r(w,A<_?P:R,_,l),_=w.length,h=1;else 0==m&&(h=m=1),_=(w=R.slice()).length;if(_<E&&(w=[0].concat(w)),r(v,w,E,l),E=v.length,-1==h)for(;t(R,v,A,E)<1;)m++,r(v,A<E?P:R,E,l),E=v.length}else 0===h&&(m++,v=[0]);b[d++]=m,v[0]?v[E++]=N[x]||0:(v=[N[x]],E=1)}while((x++<T||null!=v[0])&&I--);g=null!=v[0],b[0]||b.splice(0,1)}if(l==c){for(d=1,I=b[0];I>=10;I/=10,d++);W(y,a+(y.e=d+f*u-1)+1,o,g)}else y.e=f,y.r=+g;return y}}(),T=/^(-?)0([xbo])(?=\w[\w.]*$)/i,k=/^([^.]+)\.$/,A=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(e,t,r,n){var i,s=r?t:t.replace(I,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(T,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,s=s.replace(k,"$1").replace(A,"0.$1")),t!=s))return new H(s,i);if(H.DEBUG)throw Error(a+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new H(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return m(this,new H(e,t))},N.decimalPlaces=N.dp=function(e,t){var r,n,i,s=this;if(null!=e)return w(e,0,d),null==t?t=C:w(t,0,8),W(new H(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((i=r.length-1)-p(this.e/u))*u,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},N.dividedBy=N.div=function(e,t){return r(this,new H(e,t),O,C)},N.dividedToIntegerBy=N.idiv=function(e,t){return r(this,new H(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var r,n,o,c,l,h,f,d,p=this;if((e=new H(e)).c&&!e.isInteger())throw Error(a+"Exponent not an integer: "+K(e));if(null!=t&&(t=new H(t)),l=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return d=new H(Math.pow(+K(p),l?2-_(e):+K(e))),t?d.mod(t):d;if(h=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new H(NaN);(n=!h&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||l&&p.c[1]>=24e7:p.c[0]<8e13||l&&p.c[0]<=9999975e7)))return c=p.s<0&&_(e)?-0:0,p.e>-1&&(c=1/c),new H(h?1/c:c);G&&(c=i(G/u+2))}for(l?(r=new H(.5),h&&(e.s=1),f=_(e)):f=(o=Math.abs(+K(e)))%2,d=new H(R);;){if(f){if(!(d=d.times(p)).c)break;c?d.c.length>c&&(d.c.length=c):n&&(d=d.mod(t))}if(o){if(0===(o=s(o/2)))break;f=o%2}else if(W(e=e.times(r),e.e+1,1),e.e>14)f=_(e);else{if(0===(o=+K(e)))break;f=o%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}return n?d:(h&&(d=R.div(d)),t?d.mod(t):c?W(d,G,C,undefined):d)},N.integerValue=function(e){var t=new H(this);return null==e?e=C:w(e,0,8),W(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===m(this,new H(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return m(this,new H(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=m(this,new H(e,t)))||0===t},N.isInteger=function(){return!!this.c&&p(this.e/u)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return m(this,new H(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=m(this,new H(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var r,n,i,s,a=this,o=a.s;if(t=(e=new H(e,t)).s,!o||!t)return new H(NaN);if(o!=t)return e.s=-t,a.plus(e);var l=a.e/u,h=e.e/u,f=a.c,d=e.c;if(!l||!h){if(!f||!d)return f?(e.s=-t,e):new H(d?a:NaN);if(!f[0]||!d[0])return d[0]?(e.s=-t,e):new H(f[0]?a:3==C?-0:0)}if(l=p(l),h=p(h),f=f.slice(),o=l-h){for((s=o<0)?(o=-o,i=f):(h=l,i=d),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(n=(s=(o=f.length)<(t=d.length))?o:t,o=t=0;t<n;t++)if(f[t]!=d[t]){s=f[t]<d[t];break}if(s&&(i=f,f=d,d=i,e.s=-e.s),(t=(n=d.length)-(r=f.length))>0)for(;t--;f[r++]=0);for(t=c-1;n>o;){if(f[--n]<d[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=c}f[n]-=d[n]}for(;0==f[0];f.splice(0,1),--h);return f[0]?q(e,f,h):(e.s=3==C?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var n,i,s=this;return e=new H(e,t),!s.c||!e.s||e.c&&!e.c[0]?new H(NaN):!e.c||s.c&&!s.c[0]?new H(s):(9==U?(i=e.s,e.s=1,n=r(s,e,0,3),e.s=i,n.s*=i):n=r(s,e,0,U),(e=s.minus(n.times(e))).c[0]||1!=U||(e.s=s.s),e)},N.multipliedBy=N.times=function(e,t){var r,n,i,s,a,o,l,h,d,g,m,w,_,y,b,v=this,E=v.c,S=(e=new H(e,t)).c;if(!(E&&S&&E[0]&&S[0]))return!v.s||!e.s||E&&!E[0]&&!S||S&&!S[0]&&!E?e.c=e.e=e.s=null:(e.s*=v.s,E&&S?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=p(v.e/u)+p(e.e/u),e.s*=v.s,(l=E.length)<(g=S.length)&&(_=E,E=S,S=_,i=l,l=g,g=i),i=l+g,_=[];i--;_.push(0));for(y=c,b=f,i=g;--i>=0;){for(r=0,m=S[i]%b,w=S[i]/b|0,s=i+(a=l);s>i;)r=((h=m*(h=E[--a]%b)+(o=w*h+(d=E[a]/b|0)*m)%b*b+_[s]+r)/y|0)+(o/b|0)+w*d,_[s--]=h%y;_[s]=r}return r?++n:_.splice(0,1),q(e,_,n)},N.negated=function(){var e=new H(this);return e.s=-e.s||null,e},N.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new H(e,t)).s,!i||!t)return new H(NaN);if(i!=t)return e.s=-t,n.minus(e);var s=n.e/u,a=e.e/u,o=n.c,l=e.c;if(!s||!a){if(!o||!l)return new H(i/0);if(!o[0]||!l[0])return l[0]?e:new H(o[0]?n:0*i)}if(s=p(s),a=p(a),o=o.slice(),i=s-a){for(i>0?(a=s,r=l):(i=-i,r=o),r.reverse();i--;r.push(0));r.reverse()}for((i=o.length)-(t=l.length)<0&&(r=l,l=o,o=r,t=i),i=0;t;)i=(o[--t]=o[t]+l[t]+i)/c|0,o[t]=c===o[t]?0:o[t]%c;return i&&(o=[i].concat(o),++a),q(e,o,a)},N.precision=N.sd=function(e,t){var r,n,i,s=this;if(null!=e&&e!==!!e)return w(e,1,d),null==t?t=C:w(t,0,8),W(new H(s),e,t);if(!(r=s.c))return null;if(n=(i=r.length-1)*u+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},N.shiftedBy=function(e){return w(e,-9007199254740991,l),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,n,i,s,a=this,o=a.c,c=a.s,u=a.e,l=O+4,h=new H("0.5");if(1!==c||!o||!o[0])return new H(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+K(a)))||c==1/0?(((t=g(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=p((u+1)/2)-(u<0||u%2),n=new H(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):n=new H(c+""),n.c[0])for((c=(u=n.e)+l)<3&&(c=0);;)if(s=n,n=h.times(s.plus(r(a,s,l,1))),g(s.c).slice(0,c)===(t=g(n.c)).slice(0,c)){if(n.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(W(n,n.e+O+2,1),e=!n.times(n).eq(a));break}if(!i&&(W(s,s.e+O+2,0),s.times(s).eq(a))){n=s;break}l+=4,c+=4,i=1}return W(n,n.e+O+1,C,e)},N.toExponential=function(e,t){return null!=e&&(w(e,0,d),e++),V(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(w(e,0,d),e=e+this.e+1),V(this,e,t)},N.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=j;else if("object"!=typeof r)throw Error(a+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var s,o=n.split("."),c=+r.groupSize,u=+r.secondaryGroupSize,l=r.groupSeparator||"",h=o[0],f=o[1],d=i.s<0,p=d?h.slice(1):h,g=p.length;if(u&&(s=c,c=u,u=s,g-=s),c>0&&g>0){for(s=g%c||c,h=p.substr(0,s);s<g;s+=c)h+=l+p.substr(s,c);u>0&&(h+=l+p.slice(s)),d&&(h="-"+h)}n=f?h+(r.decimalSeparator||"")+((u=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):h}return(r.prefix||"")+n+(r.suffix||"")},N.toFraction=function(e){var t,n,i,s,o,c,l,f,d,p,m,w,_=this,y=_.c;if(null!=e&&(!(l=new H(e)).isInteger()&&(l.c||1!==l.s)||l.lt(R)))throw Error(a+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+K(l));if(!y)return new H(_);for(t=new H(R),d=n=new H(R),i=f=new H(R),w=g(y),o=t.e=w.length-_.e-1,t.c[0]=h[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:d:l,c=M,M=1/0,l=new H(w),f.c[0]=0;p=r(l,t,0,1),1!=(s=n.plus(p.times(i))).comparedTo(e);)n=i,i=s,d=f.plus(p.times(s=d)),f=s,t=l.minus(p.times(s=t)),l=s;return s=r(e.minus(n),i,0,1),f=f.plus(s.times(d)),n=n.plus(s.times(i)),f.s=d.s=_.s,m=r(d,i,o*=2,C).minus(_).abs().comparedTo(r(f,n,o,C).minus(_).abs())<1?[d,i]:[f,n],M=c,m},N.toNumber=function(){return+K(this)},N.toPrecision=function(e,t){return null!=e&&w(e,1,d),V(this,e,t,2)},N.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=D||i>=L?y(g(r.c),i):b(g(r.c),i,"0"):10===e?t=b(g((r=W(new H(r),O+i+1,C)).c),r.e,"0"):(w(e,2,z.length,"Base"),t=v(b(g(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return K(this)},N._isBigNumber=!0,null!=t&&H.set(t),H}(),r.default=r.BigNumber=r,"function"==typeof define&&define.amd?define((function(){return r})):void 0!==t&&t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(this)}}},{package:"eth-lattice-keyring>gridplus-sdk>bignumber.js"}],[4422,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++)t.push(n(e[r]));const r=d(...t);return d(a(r.length,192),r)}const t=w(e);return 1===t.length&&t[0]<128?t:d(a(t.length,128),t)}function i(e,t,r){if(r>e.length)throw new Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function s(e){if(0===e[0])throw new Error("invalid RLP: extra zeros");return h(l(e))}function a(e,t){if(e<56)return Uint8Array.from([e+t]);const r=g(e),n=g(t+55+r.length/2);return Uint8Array.from(f(n+r))}function o(e,t=!1){if(!e||0===e.length)return Uint8Array.from([]);const r=c(w(e));if(t)return r;if(0!==r.remainder.length)throw new Error("invalid RLP: remainder must be zero");return r.data}function c(e){let t,r,n,a,o;const u=[],l=e[0];if(l<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(l<=183){if(t=l-127,n=128===l?Uint8Array.from([]):i(e,1,t),2===t&&n[0]<128)throw new Error("invalid RLP encoding: invalid prefix, single byte < 0x80 are not prefixed");return{data:n,remainder:e.slice(t)}}if(l<=191){if(r=l-182,e.length-1<r)throw new Error("invalid RLP: not enough bytes for string length");if(t=s(i(e,1,r)),t<=55)throw new Error("invalid RLP: expected string length to be greater than 55");return n=i(e,r,t+r),{data:n,remainder:e.slice(t+r)}}if(l<=247){for(t=l-191,a=i(e,1,t);a.length;)o=c(a),u.push(o.data),a=o.remainder;return{data:u,remainder:e.slice(t)}}{if(r=l-246,t=s(i(e,1,r)),t<56)throw new Error("invalid RLP: encoded list too short");const n=r+t;if(n>e.length)throw new Error("invalid RLP: total length is larger than the data");for(a=i(e,r,n);a.length;)o=c(a),u.push(o.data),a=o.remainder;return{data:u,remainder:e.slice(n)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.decode=r.encode=void 0,r.encode=n,r.decode=o;const u=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function l(e){let t="";for(let r=0;r<e.length;r++)t+=u[e[r]];return t}function h(e){const t=Number.parseInt(e,16);if(Number.isNaN(t))throw new Error("Invalid byte sequence");return t}function f(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=h(e.slice(n,n+2))}return t}function d(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}function p(e){return(new TextEncoder).encode(e)}function g(e){if(e<0)throw new Error("Invalid integer as argument, must be unsigned!");const t=e.toString(16);return t.length%2?`0${t}`:t}function m(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function w(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)return m(e)?f((t="string"!=typeof(r=e)?r:m(r)?r.slice(2):r).length%2?`0${t}`:t):p(e);var t,r;if("number"==typeof e||"bigint"==typeof e)return e?f(g(e)):Uint8Array.from([]);if(null===e||e===undefined)return Uint8Array.from([]);throw new Error("toBytes: received unsupported type "+typeof e)}r.utils={bytesToHex:l,concatBytes:d,hexToBytes:f,utf8ToBytes:p};const _={encode:n,decode:o};r.default=_}}},{package:"eth-lattice-keyring>gridplus-sdk>rlp"}],[4423,{"./lib":4425,"./lib/elliptic":4424},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./lib")(e("./lib/elliptic"))}}},{package:"eth-lattice-keyring>gridplus-sdk>secp256k1"}],[4424,{elliptic:2409},function(){with(this)return function(){"use strict";return function(e,t,r){const n=new(0,e("elliptic").ec)("secp256k1"),i=n.curve,s=i.n.constructor;function a(e){const t=e[0];switch(t){case 2:case 3:return 33!==e.length?null:function(e,t){let r=new s(t);if(r.cmp(i.p)>=0)return null;r=r.toRed(i.red);let a=r.redSqr().redIMul(r).redIAdd(i.b).redSqrt();return 3===e!==a.isOdd()&&(a=a.redNeg()),n.keyPair({pub:{x:r,y:a}})}(t,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:function(e,t,r){let a=new s(t),o=new s(r);if(a.cmp(i.p)>=0||o.cmp(i.p)>=0)return null;if(a=a.toRed(i.red),o=o.toRed(i.red),(6===e||7===e)&&o.isOdd()!==(7===e))return null;const c=a.redSqr().redIMul(a);return o.redSqr().redISub(c.redIAdd(i.b)).isZero()?n.keyPair({pub:{x:a,y:o}}):null}(t,e.subarray(1,33),e.subarray(33,65));default:return null}}function o(e,t){const r=t.encode(null,33===e.length);for(let t=0;t<e.length;++t)e[t]=r[t]}t.exports={contextRandomize:()=>0,privateKeyVerify(e){const t=new s(e);return t.cmp(i.n)<0&&!t.isZero()?0:1},privateKeyNegate(e){const t=new s(e),r=i.n.sub(t).umod(i.n).toArrayLike(Uint8Array,"be",32);return e.set(r),0},privateKeyTweakAdd(e,t){const r=new s(t);if(r.cmp(i.n)>=0)return 1;if(r.iadd(new s(e)),r.cmp(i.n)>=0&&r.isub(i.n),r.isZero())return 1;const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},privateKeyTweakMul(e,t){let r=new s(t);if(r.cmp(i.n)>=0||r.isZero())return 1;r.imul(new s(e)),r.cmp(i.n)>=0&&(r=r.umod(i.n));const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},publicKeyVerify:e=>null===a(e)?1:0,publicKeyCreate(e,t){const r=new s(t);if(r.cmp(i.n)>=0||r.isZero())return 1;return o(e,n.keyFromPrivate(t).getPublic()),0},publicKeyConvert(e,t){const r=a(t);if(null===r)return 1;return o(e,r.getPublic()),0},publicKeyNegate(e,t){const r=a(t);if(null===r)return 1;const n=r.getPublic();return n.y=n.y.redNeg(),o(e,n),0},publicKeyCombine(e,t){const r=new Array(t.length);for(let e=0;e<t.length;++e)if(r[e]=a(t[e]),null===r[e])return 1;let n=r[0].getPublic();for(let e=1;e<r.length;++e)n=n.add(r[e].pub);return n.isInfinity()?2:(o(e,n),0)},publicKeyTweakAdd(e,t,r){const n=a(t);if(null===n)return 1;if((r=new s(r)).cmp(i.n)>=0)return 2;const c=n.getPublic().add(i.g.mul(r));return c.isInfinity()?2:(o(e,c),0)},publicKeyTweakMul(e,t,r){const n=a(t);if(null===n)return 1;if((r=new s(r)).cmp(i.n)>=0||r.isZero())return 2;return o(e,n.getPublic().mul(r)),0},signatureNormalize(e){const t=new s(e.subarray(0,32)),r=new s(e.subarray(32,64));return t.cmp(i.n)>=0||r.cmp(i.n)>=0?1:(1===r.cmp(n.nh)&&e.set(i.n.sub(r).toArrayLike(Uint8Array,"be",32),32),0)},signatureExport(e,t){const r=t.subarray(0,32),n=t.subarray(32,64);if(new s(r).cmp(i.n)>=0)return 1;if(new s(n).cmp(i.n)>=0)return 1;const{output:a}=e;let o=a.subarray(4,37);o[0]=0,o.set(r,1);let c=33,u=0;for(;c>1&&0===o[u]&&!(128&o[u+1]);--c,++u);if(o=o.subarray(u),128&o[0])return 1;if(c>1&&0===o[0]&&!(128&o[1]))return 1;let l=a.subarray(39,72);l[0]=0,l.set(n,1);let h=33,f=0;for(;h>1&&0===l[f]&&!(128&l[f+1]);--h,++f);return l=l.subarray(f),128&l[0]||h>1&&0===l[0]&&!(128&l[1])?1:(e.outputlen=6+c+h,a[0]=48,a[1]=e.outputlen-2,a[2]=2,a[3]=o.length,a.set(o,4),a[4+c]=2,a[5+c]=l.length,a.set(l,6+c),0)},signatureImport(e,t){if(t.length<8)return 1;if(t.length>72)return 1;if(48!==t[0])return 1;if(t[1]!==t.length-2)return 1;if(2!==t[2])return 1;const r=t[3];if(0===r)return 1;if(5+r>=t.length)return 1;if(2!==t[4+r])return 1;const n=t[5+r];if(0===n)return 1;if(6+r+n!==t.length)return 1;if(128&t[4])return 1;if(r>1&&0===t[4]&&!(128&t[5]))return 1;if(128&t[r+6])return 1;if(n>1&&0===t[r+6]&&!(128&t[r+7]))return 1;let a=t.subarray(4,4+r);if(33===a.length&&0===a[0]&&(a=a.subarray(1)),a.length>32)return 1;let o=t.subarray(6+r);if(33===o.length&&0===o[0]&&(o=o.slice(1)),o.length>32)throw new Error("S length is too long");let c=new s(a);c.cmp(i.n)>=0&&(c=new s(0));let u=new s(t.subarray(6+r));return u.cmp(i.n)>=0&&(u=new s(0)),e.set(c.toArrayLike(Uint8Array,"be",32),0),e.set(u.toArrayLike(Uint8Array,"be",32),32),0},ecdsaSign(e,t,r,a,o){if(o){const e=o;o=n=>{const i=e(t,r,null,a,n);if(!(i instanceof Uint8Array&&32===i.length))throw new Error("This is the way");return new s(i)}}const c=new s(r);if(c.cmp(i.n)>=0||c.isZero())return 1;let u;try{u=n.sign(t,r,{canonical:!0,k:o,pers:a})}catch(e){return 1}return e.signature.set(u.r.toArrayLike(Uint8Array,"be",32),0),e.signature.set(u.s.toArrayLike(Uint8Array,"be",32),32),e.recid=u.recoveryParam,0},ecdsaVerify(e,t,r){const o={r:e.subarray(0,32),s:e.subarray(32,64)},c=new s(o.r),u=new s(o.s);if(c.cmp(i.n)>=0||u.cmp(i.n)>=0)return 1;if(1===u.cmp(n.nh)||c.isZero()||u.isZero())return 3;const l=a(r);if(null===l)return 2;const h=l.getPublic();return n.verify(t,o,h)?0:3},ecdsaRecover(e,t,r,a){const c={r:t.slice(0,32),s:t.slice(32,64)},u=new s(c.r),l=new s(c.s);if(u.cmp(i.n)>=0||l.cmp(i.n)>=0)return 1;if(u.isZero()||l.isZero())return 2;let h;try{h=n.recoverPubKey(a,c,r)}catch(e){return 2}return o(e,h),0},ecdh(e,t,r,o,c,u,l){const h=a(t);if(null===h)return 1;const f=new s(r);if(f.cmp(i.n)>=0||f.isZero())return 2;const d=h.getPublic().mul(f);if(c===undefined){const t=d.encode(null,!0),r=n.hash().update(t).digest();for(let t=0;t<32;++t)e[t]=r[t]}else{u||(u=new Uint8Array(32));const t=d.getX().toArray("be",32);for(let e=0;e<32;++e)u[e]=t[e];l||(l=new Uint8Array(32));const r=d.getY().toArray("be",32);for(let e=0;e<32;++e)l[e]=r[e];const n=c(u,l,o);if(!(n instanceof Uint8Array&&n.length===e.length))return 2;e.set(n)}return 0}}}}},{package:"eth-lattice-keyring>gridplus-sdk>secp256k1"}],[4425,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="Impossible case. Please create issue.",i="The tweak was out of range or the resulted private key is invalid",s="The tweak was out of range or equal to zero",a="Unknow error on context randomization",o="Private Key is invalid",c="Public Key could not be parsed",u="Public Key serialization error",l="The sum of the public keys is not valid",h="Signature could not be parsed",f="The nonce generation function failed, or the private key was invalid",d="Public key could not be recover",p="Scalar was invalid (zero or overflow)";function g(e,t){if(!e)throw new Error(t)}function m(e,t,r){if(g(t instanceof Uint8Array,`Expected ${e} to be an Uint8Array`),r!==undefined)if(Array.isArray(r)){const n=`Expected ${e} to be an Uint8Array with length [${r.join(", ")}]`;g(r.includes(t.length),n)}else{const n=`Expected ${e} to be an Uint8Array with length ${r}`;g(t.length===r,n)}}function w(e){g("Boolean"===y(e),"Expected compressed to be a Boolean")}function _(e=(e=>new Uint8Array(e)),t){return"function"==typeof e&&(e=e(t)),m("output",e,t),e}function y(e){return Object.prototype.toString.call(e).slice(8,-1)}t.exports=e=>({contextRandomize(t){if(g(null===t||t instanceof Uint8Array,"Expected seed to be an Uint8Array or null"),null!==t&&m("seed",t,32),1===e.contextRandomize(t))throw new Error(a)},privateKeyVerify:t=>(m("private key",t,32),0===e.privateKeyVerify(t)),privateKeyNegate(t){switch(m("private key",t,32),e.privateKeyNegate(t)){case 0:return t;case 1:throw new Error(n)}},privateKeyTweakAdd(t,r){switch(m("private key",t,32),m("tweak",r,32),e.privateKeyTweakAdd(t,r)){case 0:return t;case 1:throw new Error(i)}},privateKeyTweakMul(t,r){switch(m("private key",t,32),m("tweak",r,32),e.privateKeyTweakMul(t,r)){case 0:return t;case 1:throw new Error(s)}},publicKeyVerify:t=>(m("public key",t,[33,65]),0===e.publicKeyVerify(t)),publicKeyCreate(t,r=!0,n){switch(m("private key",t,32),w(r),n=_(n,r?33:65),e.publicKeyCreate(n,t)){case 0:return n;case 1:throw new Error(o);case 2:throw new Error(u)}},publicKeyConvert(t,r=!0,n){switch(m("public key",t,[33,65]),w(r),n=_(n,r?33:65),e.publicKeyConvert(n,t)){case 0:return n;case 1:throw new Error(c);case 2:throw new Error(u)}},publicKeyNegate(t,r=!0,i){switch(m("public key",t,[33,65]),w(r),i=_(i,r?33:65),e.publicKeyNegate(i,t)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(n);case 3:throw new Error(u)}},publicKeyCombine(t,r=!0,n){g(Array.isArray(t),"Expected public keys to be an Array"),g(t.length>0,"Expected public keys array will have more than zero items");for(const e of t)m("public key",e,[33,65]);switch(w(r),n=_(n,r?33:65),e.publicKeyCombine(n,t)){case 0:return n;case 1:throw new Error(c);case 2:throw new Error(l);case 3:throw new Error(u)}},publicKeyTweakAdd(t,r,n=!0,s){switch(m("public key",t,[33,65]),m("tweak",r,32),w(n),s=_(s,n?33:65),e.publicKeyTweakAdd(s,t,r)){case 0:return s;case 1:throw new Error(c);case 2:throw new Error(i)}},publicKeyTweakMul(t,r,n=!0,i){switch(m("public key",t,[33,65]),m("tweak",r,32),w(n),i=_(i,n?33:65),e.publicKeyTweakMul(i,t,r)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(s)}},signatureNormalize(t){switch(m("signature",t,64),e.signatureNormalize(t)){case 0:return t;case 1:throw new Error(h)}},signatureExport(t,r){m("signature",t,64);const i={output:r=_(r,72),outputlen:72};switch(e.signatureExport(i,t)){case 0:return r.slice(0,i.outputlen);case 1:throw new Error(h);case 2:throw new Error(n)}},signatureImport(t,r){switch(m("signature",t),r=_(r,64),e.signatureImport(r,t)){case 0:return r;case 1:throw new Error(h);case 2:throw new Error(n)}},ecdsaSign(t,r,i={},s){m("message",t,32),m("private key",r,32),g("Object"===y(i),"Expected options to be an Object"),i.data!==undefined&&m("options.data",i.data),i.noncefn!==undefined&&g("Function"===y(i.noncefn),"Expected options.noncefn to be a Function");const a={signature:s=_(s,64),recid:null};switch(e.ecdsaSign(a,t,r,i.data,i.noncefn)){case 0:return a;case 1:throw new Error(f);case 2:throw new Error(n)}},ecdsaVerify(t,r,n){switch(m("signature",t,64),m("message",r,32),m("public key",n,[33,65]),e.ecdsaVerify(t,r,n)){case 0:return!0;case 3:return!1;case 1:throw new Error(h);case 2:throw new Error(c)}},ecdsaRecover(t,r,i,s=!0,a){switch(m("signature",t,64),g("Number"===y(r)&&r>=0&&r<=3,"Expected recovery id to be a Number within interval [0, 3]"),m("message",i,32),w(s),a=_(a,s?33:65),e.ecdsaRecover(a,t,r,i)){case 0:return a;case 1:throw new Error(h);case 2:throw new Error(d);case 3:throw new Error(n)}},ecdh(t,r,n={},i){switch(m("public key",t,[33,65]),m("private key",r,32),g("Object"===y(n),"Expected options to be an Object"),n.data!==undefined&&m("options.data",n.data),n.hashfn!==undefined?(g("Function"===y(n.hashfn),"Expected options.hashfn to be a Function"),n.xbuf!==undefined&&m("options.xbuf",n.xbuf,32),n.ybuf!==undefined&&m("options.ybuf",n.ybuf,32),m("output",i)):i=_(i,32),e.ecdh(i,t,r,n.data,n.hashfn,n.xbuf,n.ybuf)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(p)}}})}}},{package:"eth-lattice-keyring>gridplus-sdk>secp256k1"}],[4427,{"is-deflate":4801,"is-gzip":4804,"peek-stream":5486,pumpify:4443,through2:4444,zlib:4429},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("zlib"),i=e("peek-stream"),s=e("through2"),a=e("pumpify"),o=e("is-gzip"),c=e("is-deflate"),u=function(e){return e===undefined&&(e=3),i({newline:!1,maxBuffer:10},(function(t,r){if(e<0)return r(new Error("Maximum recursion reached"));switch(function(e){return o(e)?1:c(e)?2:0}(t)){case 1:r(null,a(n.createGunzip(),u(e-1)));break;case 2:r(null,a(n.createInflate(),u(e-1)));break;default:r(null,s())}}))};t.exports=u}}},{package:"@metamask/snap-controllers>gunzip-maybe"}],[4428,{_process:5500,buffer:2175,"pako/lib/zlib/constants":4433,"pako/lib/zlib/deflate.js":4435,"pako/lib/zlib/inflate.js":4437,"pako/lib/zlib/messages":4439,"pako/lib/zlib/zstream":4441},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){var i=e("pako/lib/zlib/messages"),s=e("pako/lib/zlib/zstream"),a=e("pako/lib/zlib/deflate.js"),o=e("pako/lib/zlib/inflate.js"),c=e("pako/lib/zlib/constants");for(var u in c)r[u]=c[u];function l(e){if(e<r.DEFLATE||e>r.UNZIP)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function h(e,t){for(var r=0;r<e.length;r++)this[t+r]=e[r]}r.NONE=0,r.DEFLATE=1,r.INFLATE=2,r.GZIP=3,r.GUNZIP=4,r.DEFLATERAW=5,r.INFLATERAW=6,r.UNZIP=7,l.prototype.init=function(e,t,n,i,c){switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=i,this.mode!==r.GZIP&&this.mode!==r.GUNZIP||(this.windowBits+=16),this.mode===r.UNZIP&&(this.windowBits+=32),this.mode!==r.DEFLATERAW&&this.mode!==r.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new s,this.mode){case r.DEFLATE:case r.GZIP:case r.DEFLATERAW:var u=a.deflateInit2(this.strm,this.level,r.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case r.INFLATE:case r.GUNZIP:case r.INFLATERAW:case r.UNZIP:u=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}u===r.Z_OK?(this.write_in_progress=!1,this.init_done=!0):this._error(u)},l.prototype.params=function(){throw new Error("deflateParams Not supported")},l.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===r.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},l.prototype.write=function(e,r,n,i,s,a,o){this._writeCheck(),this.write_in_progress=!0;var c=this;return t.nextTick((function(){c.write_in_progress=!1;var t=c._write(e,r,n,i,s,a,o);c.callback(t[0],t[1]),c.pending_close&&c.close()})),this},l.prototype.writeSync=function(e,t,r,n,i,s,a){return this._writeCheck(),this._write(e,t,r,n,i,s,a)},l.prototype._write=function(e,t,i,s,c,u,l){if(this.write_in_progress=!0,e!==r.Z_NO_FLUSH&&e!==r.Z_PARTIAL_FLUSH&&e!==r.Z_SYNC_FLUSH&&e!==r.Z_FULL_FLUSH&&e!==r.Z_FINISH&&e!==r.Z_BLOCK)throw new Error("Invalid flush value");null==t&&(t=new n(0),s=0,i=0),c._set?c.set=c._set:c.set=h;var f=this.strm;switch(f.avail_in=s,f.input=t,f.next_in=i,f.avail_out=l,f.output=c,f.next_out=u,this.mode){case r.DEFLATE:case r.GZIP:case r.DEFLATERAW:var d=a.deflate(f,e);break;case r.UNZIP:case r.INFLATE:case r.GUNZIP:case r.INFLATERAW:d=o.inflate(f,e);break;default:throw new Error("Unknown mode "+this.mode)}return d!==r.Z_STREAM_END&&d!==r.Z_OK&&this._error(d),this.write_in_progress=!1,[f.avail_in,f.avail_out]},l.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,this.mode===r.DEFLATE||this.mode===r.GZIP||this.mode===r.DEFLATERAW?a.deflateEnd(this.strm):o.inflateEnd(this.strm),this.mode=r.NONE)},l.prototype.reset=function(){switch(this.mode){case r.DEFLATE:case r.DEFLATERAW:var e=a.deflateReset(this.strm);break;case r.INFLATE:case r.INFLATERAW:e=o.inflateReset(this.strm)}e!==r.Z_OK&&this._error(e)},l.prototype._error=function(e){this.onerror(i[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()},r.Zlib=l}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib"}],[4429,{"./binding":4428,_process:5500,_stream_transform:5781,assert:1803,buffer:2175,util:2181},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){var i=e("_stream_transform"),s=e("./binding"),a=e("util"),o=e("assert").ok;function c(e,t,r){var i=[],s=0;function a(){for(var t;null!==(t=e.read());)i.push(t),s+=t.length;e.once("readable",a)}function o(){var t=n.concat(i,s);i=[],r(null,t),e.close()}e.on("error",(function(t){e.removeListener("end",o),e.removeListener("readable",a),r(t)})),e.on("end",o),e.end(t),a()}function u(e,t){if("string"==typeof t&&(t=new n(t)),!n.isBuffer(t))throw new TypeError("Not a string or buffer");var r=s.Z_FINISH;return e._processChunk(t,r)}function l(e){if(!(this instanceof l))return new l(e);w.call(this,e,s.DEFLATE)}function h(e){if(!(this instanceof h))return new h(e);w.call(this,e,s.INFLATE)}function f(e){if(!(this instanceof f))return new f(e);w.call(this,e,s.GZIP)}function d(e){if(!(this instanceof d))return new d(e);w.call(this,e,s.GUNZIP)}function p(e){if(!(this instanceof p))return new p(e);w.call(this,e,s.DEFLATERAW)}function g(e){if(!(this instanceof g))return new g(e);w.call(this,e,s.INFLATERAW)}function m(e){if(!(this instanceof m))return new m(e);w.call(this,e,s.UNZIP)}function w(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||r.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&e.flush!==s.Z_NO_FLUSH&&e.flush!==s.Z_PARTIAL_FLUSH&&e.flush!==s.Z_SYNC_FLUSH&&e.flush!==s.Z_FULL_FLUSH&&e.flush!==s.Z_FINISH&&e.flush!==s.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||s.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<r.Z_MIN_CHUNK||e.chunkSize>r.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<r.Z_MIN_WINDOWBITS||e.windowBits>r.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<r.Z_MIN_LEVEL||e.level>r.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<r.Z_MIN_MEMLEVEL||e.memLevel>r.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=r.Z_FILTERED&&e.strategy!=r.Z_HUFFMAN_ONLY&&e.strategy!=r.Z_RLE&&e.strategy!=r.Z_FIXED&&e.strategy!=r.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!n.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new s.Zlib(t);var a=this;this._hadError=!1,this._binding.onerror=function(e,t){a._binding=null,a._hadError=!0;var n=new Error(e);n.errno=t,n.code=r.codes[t],a.emit("error",n)};var o=r.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(o=e.level);var c=r.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(c=e.strategy),this._binding.init(e.windowBits||r.Z_DEFAULT_WINDOWBITS,o,e.memLevel||r.Z_DEFAULT_MEMLEVEL,c,e.dictionary),this._buffer=new n(this._chunkSize),this._offset=0,this._closed=!1,this._level=o,this._strategy=c,this.once("end",this.close)}s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=Infinity,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION,Object.keys(s).forEach((function(e){e.match(/^Z/)&&(r[e]=s[e])})),r.codes={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},Object.keys(r.codes).forEach((function(e){r.codes[r.codes[e]]=e})),r.Deflate=l,r.Inflate=h,r.Gzip=f,r.Gunzip=d,r.DeflateRaw=p,r.InflateRaw=g,r.Unzip=m,r.createDeflate=function(e){return new l(e)},r.createInflate=function(e){return new h(e)},r.createDeflateRaw=function(e){return new p(e)},r.createInflateRaw=function(e){return new g(e)},r.createGzip=function(e){return new f(e)},r.createGunzip=function(e){return new d(e)},r.createUnzip=function(e){return new m(e)},r.deflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new l(t),e,r)},r.deflateSync=function(e,t){return u(new l(t),e)},r.gzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new f(t),e,r)},r.gzipSync=function(e,t){return u(new f(t),e)},r.deflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new p(t),e,r)},r.deflateRawSync=function(e,t){return u(new p(t),e)},r.unzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new m(t),e,r)},r.unzipSync=function(e,t){return u(new m(t),e)},r.inflate=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new h(t),e,r)},r.inflateSync=function(e,t){return u(new h(t),e)},r.gunzip=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new d(t),e,r)},r.gunzipSync=function(e,t){return u(new d(t),e)},r.inflateRaw=function(e,t,r){return"function"==typeof t&&(r=t,t={}),c(new g(t),e,r)},r.inflateRawSync=function(e,t){return u(new g(t),e)},a.inherits(w,i),w.prototype.params=function(e,n,i){if(e<r.Z_MIN_LEVEL||e>r.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(n!=r.Z_FILTERED&&n!=r.Z_HUFFMAN_ONLY&&n!=r.Z_RLE&&n!=r.Z_FIXED&&n!=r.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==e||this._strategy!==n){var a=this;this.flush(s.Z_SYNC_FLUSH,(function(){a._binding.params(e,n),a._hadError||(a._level=e,a._strategy=n,i&&i())}))}else t.nextTick(i)},w.prototype.reset=function(){return this._binding.reset()},w.prototype._flush=function(e){this._transform(new n(0),"",e)},w.prototype.flush=function(e,r){var i=this._writableState;if(("function"==typeof e||void 0===e&&!r)&&(r=e,e=s.Z_FULL_FLUSH),i.ended)r&&t.nextTick(r);else if(i.ending)r&&this.once("end",r);else if(i.needDrain){var a=this;this.once("drain",(function(){a.flush(r)}))}else this._flushFlag=e,this.write(new n(0),"",r)},w.prototype.close=function(e){if(e&&t.nextTick(e),!this._closed){this._closed=!0,this._binding.close();var r=this;t.nextTick((function(){r.emit("close")}))}},w.prototype._transform=function(e,t,r){var i,a=this._writableState,o=(a.ending||a.ended)&&(!e||a.length===e.length);if(null===!e&&!n.isBuffer(e))return r(new Error("invalid input"));o?i=s.Z_FINISH:(i=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH));this._processChunk(e,i,r)},w.prototype._processChunk=function(e,t,r){var i=e&&e.length,s=this._chunkSize-this._offset,a=0,c=this,u="function"==typeof r;if(!u){var l,h=[],f=0;this.on("error",(function(e){l=e}));do{var d=this._binding.writeSync(t,e,a,i,this._buffer,this._offset,s)}while(!this._hadError&&m(d[0],d[1]));if(this._hadError)throw l;var p=n.concat(h,f);return this.close(),p}var g=this._binding.write(t,e,a,i,this._buffer,this._offset,s);function m(l,d){if(!c._hadError){var p=s-d;if(o(p>=0,"have should not go down"),p>0){var g=c._buffer.slice(c._offset,c._offset+p);c._offset+=p,u?c.push(g):(h.push(g),f+=g.length)}if((0===d||c._offset>=c._chunkSize)&&(s=c._chunkSize,c._offset=0,c._buffer=new n(c._chunkSize)),0===d){if(a+=i-l,i=l,!u)return!0;var w=c._binding.write(t,e,a,i,c._buffer,c._offset,c._chunkSize);return w.callback=m,void(w.buffer=e)}if(!u)return!1;r()}}g.buffer=e,g.callback=m},a.inherits(l,w),a.inherits(h,w),a.inherits(f,w),a.inherits(d,w),a.inherits(p,w),a.inherits(g,w),a.inherits(m,w)}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib"}],[4430,{_process:5500,buffer:2175,"end-of-stream":2432,inherits:4515,"readable-stream":5780,"stream-shift":5984},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r,n){(function(){var i=e("readable-stream"),s=e("end-of-stream"),a=e("inherits"),o=e("stream-shift"),c=n.from&&n.from!==Uint8Array.from?n.from([0]):new n([0]),u=function(e,t){e._corked?e.once("uncork",t):t()},l=function(e,t){return function(r){r?function(e,t){e._autoDestroy&&e.destroy(t)}(e,"premature close"===r.message?null:r):t&&!e._ended&&e.end()}},h=function(e,t,r){if(!(this instanceof h))return new h(e,t,r);i.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};a(h,i.Duplex),h.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new h(e,t,r)},h.prototype.cork=function(){1==++this._corked&&this.emit("cork")},h.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},h.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,n=s(e,{writable:!0,readable:!1},l(this,this._forwardEnd)),i=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&r.nextTick(i),this._writable=e,this._writable.on("drain",i),this._unwrite=function(){t._writable.removeListener("drain",i),n()},this.uncork()}else this.end()},h.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,r=this,n=s(e,{writable:!1,readable:!0},l(this)),a=function(){r._forward()},o=function(){r.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new i.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",a),this._readable2.on("end",o),this._unread=function(){r._readable2.removeListener("readable",a),r._readable2.removeListener("end",o),n()},this._forward()}},h.prototype._read=function(){this._drained=!0,this._forward()},h.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=o(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},h.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;r.nextTick((function(){t._destroy(e)}))}},h.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},h.prototype._write=function(e,t,r){return this.destroyed?r():this._corked?u(this,this._write.bind(this,e,t,r)):e===c?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:r()):r()},h.prototype._finish=function(e){var t=this;this.emit("preend"),u(this,(function(){var r,n;r=t._forwardEnd&&t._writable,n=function(){!1===t._writableState.prefinished&&(t._writableState.prefinished=!0),t.emit("prefinish"),u(t,e)},r?r._writableState&&r._writableState.finished?n():r._writableState?r.end(n):(r.end(),n()):n()}))},h.prototype.end=function(e,t,r){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(c),i.Writable.prototype.end.call(this,r))},t.exports=h}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>gunzip-maybe>pumpify>duplexify"}],[4431,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)s=e[t],a.set(s,i),i+=s.length;return a}},s={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4432,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{s=s+(i=i+t[n++]|0)|0}while(--a);i%=65521,s%=65521}return i|s<<16|0}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4433,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4434,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var s=n,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^s[255&(e^t[o])];return-1^e}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4435,{"../utils/common":4431,"./adler32":4432,"./crc32":4434,"./messages":4439,"./trees":4440},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=e("../utils/common"),s=e("./trees"),a=e("./adler32"),o=e("./crc32"),c=e("./messages"),u=-2,l=258,h=262,f=103,d=113,p=666;function g(e,t){return e.msg=c[t],t}function m(e){return(e<<1)-(e>4?9:0)}function w(e){for(var t=e.length;--t>=0;)e[t]=0}function _(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function y(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function b(e,t){e.pending_buf[e.pending++]=t}function v(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function E(e,t){var r,n,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,c=e.strstart>e.w_size-h?e.strstart-(e.w_size-h):0,u=e.window,f=e.w_mask,d=e.prev,p=e.strstart+l,g=u[s+a-1],m=u[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+a]===m&&u[r+a-1]===g&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<p);if(n=l-(p-s),s=p-l,n>a){if(e.match_start=t,a=n,n>=o)break;g=u[s+a-1],m=u[s+a]}}}while((t=d[t&f])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function S(e){var t,r,n,s,c,u,l,f,d,p,g=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-h)){i.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=g?n-g:0}while(--r);t=r=g;do{n=e.prev[--t],e.prev[t]=n>=g?n-g:0}while(--r);s+=g}if(0===e.strm.avail_in)break;if(u=e.strm,l=e.window,f=e.strstart+e.lookahead,d=s,p=void 0,(p=u.avail_in)>d&&(p=d),r=0===p?0:(u.avail_in-=p,i.arraySet(l,u.input,u.next_in,p,f),1===u.state.wrap?u.adler=a(u.adler,l,p,f):2===u.state.wrap&&(u.adler=o(u.adler,l,p,f)),u.next_in+=p,u.total_in+=p,p),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[c+3-1])&e.hash_mask,e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<h&&0!==e.strm.avail_in)}function x(e,t){for(var r,n;;){if(e.lookahead<h){if(S(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-h&&(e.match_length=E(e,r)),e.match_length>=3)if(n=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function T(e,t){for(var r,n,i;;){if(e.lookahead<h){if(S(e),e.lookahead<h&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-h&&(e.match_length=E(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(y(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=s._tr_tally(e,0,e.window[e.strstart-1]))&&y(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}function k(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:d,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):g(e,u)}function I(e){var t,r=P(e);return 0===r&&((t=e.state).window_size=2*t.w_size,w(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function N(e,t,r,n,s,a){if(!e)return u;var o=1;if(-1===t&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>9||8!==r||n<8||n>15||t<0||t>9||a<0||a>4)return g(e,u);8===n&&(n=9);var c=new A;return e.state=c,c.strm=e,c.wrap=o,c.gzhead=null,c.w_bits=n,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=t,c.strategy=a,c.method=r,I(e)}n=[new k(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(S(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,y(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-h&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(y(e,!1),e.strm.avail_out),1)})),new k(4,4,8,4,x),new k(4,5,16,8,x),new k(4,6,32,32,x),new k(4,4,16,16,T),new k(8,16,32,32,T),new k(8,16,128,128,T),new k(8,32,128,256,T),new k(32,128,258,1024,T),new k(32,258,258,4096,T)],r.deflateInit=function(e,t){return N(e,t,8,15,8,0)},r.deflateInit2=N,r.deflateReset=I,r.deflateResetKeep=P,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,0):u},r.deflate=function(e,t){var r,i,a,c;if(!e||!e.state||t>5||t<0)return e?g(e,u):u;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===p&&4!==t)return g(e,0===e.avail_out?-5:u);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,b(i,31),b(i,139),b(i,8),i.gzhead?(b(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),b(i,255&i.gzhead.time),b(i,i.gzhead.time>>8&255),b(i,i.gzhead.time>>16&255),b(i,i.gzhead.time>>24&255),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(b(i,255&i.gzhead.extra.length),b(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=o(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(b(i,0),b(i,0),b(i,0),b(i,0),b(i,0),b(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),b(i,3),i.status=d);else{var h=8+(i.w_bits-8<<4)<<8;h|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(h|=32),h+=31-h%31,i.status=d,v(i,h),0!==i.strstart&&(v(i,e.adler>>>16),v(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),_(e),a=i.pending,i.pending!==i.pending_buf_size));)b(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),_(e),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,b(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),_(e),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,b(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(e.adler=o(e.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=f)}else i.status=f;if(i.status===f&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&_(e),i.pending+2<=i.pending_buf_size&&(b(i,255&e.adler),b(i,e.adler>>8&255),e.adler=0,i.status=d)):i.status=d),0!==i.pending){if(_(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&m(t)<=m(r)&&4!==t)return g(e,-5);if(i.status===p&&0!==e.avail_in)return g(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&i.status!==p){var E=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(S(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=l){if(S(e),e.lookahead<=l&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=o[i=e.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){a=e.strstart+l;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<a);e.match_length=l-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(y(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==E&&4!==E||(i.status=p),1===E||3===E)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===E&&(1===t?s._tr_align(i):5!==t&&(s._tr_stored_block(i,0,0,!1),3===t&&(w(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),_(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(b(i,255&e.adler),b(i,e.adler>>8&255),b(i,e.adler>>16&255),b(i,e.adler>>24&255),b(i,255&e.total_in),b(i,e.total_in>>8&255),b(i,e.total_in>>16&255),b(i,e.total_in>>24&255)):(v(i,e.adler>>>16),v(i,65535&e.adler)),_(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},r.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==f&&t!==d&&t!==p?g(e,u):(e.state=null,t===d?g(e,-3):0):u},r.deflateSetDictionary=function(e,t){var r,n,s,o,c,l,h,f,d=t.length;if(!e||!e.state)return u;if(2===(o=(r=e.state).wrap)||1===o&&42!==r.status||r.lookahead)return u;for(1===o&&(e.adler=a(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===o&&(w(r.head),r.strstart=0,r.block_start=0,r.insert=0),f=new i.Buf8(r.w_size),i.arraySet(f,t,d-r.w_size,r.w_size,0),t=f,d=r.w_size),c=e.avail_in,l=e.next_in,h=e.input,e.avail_in=d,e.next_in=0,e.input=t,S(r);r.lookahead>=3;){n=r.strstart,s=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--s);r.strstart=n,r.lookahead=2,S(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=l,e.input=h,e.avail_in=c,r.wrap=o,0},r.deflateInfo="pako deflate (from Nodeca project)"}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4436,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){var r,n,i,s,a,o,c,u,l,h,f,d,p,g,m,w,_,y,b,v,E,S,x,T,k;r=e.state,n=e.next_in,T=e.input,i=n+(e.avail_in-5),s=e.next_out,k=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),c=r.dmax,u=r.wsize,l=r.whave,h=r.wnext,f=r.window,d=r.hold,p=r.bits,g=r.lencode,m=r.distcode,w=(1<<r.lenbits)-1,_=(1<<r.distbits)-1;e:do{p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),y=g[d&w];t:for(;;){if(d>>>=b=y>>>24,p-=b,0===(b=y>>>16&255))k[s++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=g[(65535&y)+(d&(1<<b)-1)];continue t}if(32&b){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}v=65535&y,(b&=15)&&(p<b&&(d+=T[n++]<<p,p+=8),v+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=T[n++]<<p,p+=8,d+=T[n++]<<p,p+=8),y=m[d&_];r:for(;;){if(d>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=m[(65535&y)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&y,p<(b&=15)&&(d+=T[n++]<<p,(p+=8)<b&&(d+=T[n++]<<p,p+=8)),(E+=d&(1<<b)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=b,p-=b,E>(b=s-a)){if((b=E-b)>l&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=0,x=f,0===h){if(S+=u-b,b<v){v-=b;do{k[s++]=f[S++]}while(--b);S=s-E,x=k}}else if(h<b){if(S+=u+h-b,(b-=h)<v){v-=b;do{k[s++]=f[S++]}while(--b);if(S=0,h<v){v-=b=h;do{k[s++]=f[S++]}while(--b);S=s-E,x=k}}}else if(S+=h-b,b<v){v-=b;do{k[s++]=f[S++]}while(--b);S=s-E,x=k}for(;v>2;)k[s++]=x[S++],k[s++]=x[S++],k[s++]=x[S++],v-=3;v&&(k[s++]=x[S++],v>1&&(k[s++]=x[S++]))}else{S=s-E;do{k[s++]=k[S++],k[s++]=k[S++],k[s++]=k[S++],v-=3}while(v>2);v&&(k[s++]=k[S++],v>1&&(k[s++]=k[S++]))}break}}break}}while(n<i&&s<o);n-=v=p>>3,d&=(1<<(p-=v<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<o?o-s+257:257-(s-o),r.hold=d,r.bits=p}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4437,{"../utils/common":4431,"./adler32":4432,"./crc32":4434,"./inffast":4436,"./inftrees":4438},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/common"),i=e("./adler32"),s=e("./crc32"),a=e("./inffast"),o=e("./inftrees"),c=-2,u=12,l=30;function h(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function f(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):c}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):c}function g(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?c:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,p(e))):c}function m(e,t){var r,n;return e?(n=new f,e.state=n,n.window=null,0!==(r=g(e,t))&&(e.state=null),r):c}var w,_,y=!0;function b(e){if(y){var t;for(w=new n.Buf32(512),_=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,w,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,_,0,e.work,{bits:5}),y=!1}e.lencode=w,e.lenbits=9,e.distcode=_,e.distbits=5}function v(e,t,r,i){var s,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>i&&(s=i),n.arraySet(a.window,t,r-i,s,a.wnext),(i-=s)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}r.inflateReset=p,r.inflateReset2=g,r.inflateResetKeep=d,r.inflateInit=function(e){return m(e,15)},r.inflateInit2=m,r.inflate=function(e,t){var r,f,d,p,g,m,w,_,y,E,S,x,T,k,A,P,I,N,R,O,C,D,L,B,M=0,F=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return c;(r=e.state).mode===u&&(r.mode=13),g=e.next_out,d=e.output,w=e.avail_out,p=e.next_in,f=e.input,m=e.avail_in,_=r.hold,y=r.bits,E=m,S=w,D=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;y<16;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(2&r.wrap&&35615===_){r.check=0,F[0]=255&_,F[1]=_>>>8&255,r.check=s(r.check,F,2,0),_=0,y=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",r.mode=l;break}if(8!=(15&_)){e.msg="unknown compression method",r.mode=l;break}if(y-=4,C=8+(15&(_>>>=4)),0===r.wbits)r.wbits=C;else if(C>r.wbits){e.msg="invalid window size",r.mode=l;break}r.dmax=1<<C,e.adler=r.check=1,r.mode=512&_?10:u,_=0,y=0;break;case 2:for(;y<16;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(r.flags=_,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=l;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=l;break}r.head&&(r.head.text=_>>8&1),512&r.flags&&(F[0]=255&_,F[1]=_>>>8&255,r.check=s(r.check,F,2,0)),_=0,y=0,r.mode=3;case 3:for(;y<32;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.head&&(r.head.time=_),512&r.flags&&(F[0]=255&_,F[1]=_>>>8&255,F[2]=_>>>16&255,F[3]=_>>>24&255,r.check=s(r.check,F,4,0)),_=0,y=0,r.mode=4;case 4:for(;y<16;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&r.flags&&(F[0]=255&_,F[1]=_>>>8&255,r.check=s(r.check,F,2,0)),_=0,y=0,r.mode=5;case 5:if(1024&r.flags){for(;y<16;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.length=_,r.head&&(r.head.extra_len=_),512&r.flags&&(F[0]=255&_,F[1]=_>>>8&255,r.check=s(r.check,F,2,0)),_=0,y=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((x=r.length)>m&&(x=m),x&&(r.head&&(C=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,f,p,x,C)),512&r.flags&&(r.check=s(r.check,f,x,p)),m-=x,p+=x,r.length-=x),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===m)break e;x=0;do{C=f[p+x++],r.head&&C&&r.length<65536&&(r.head.name+=String.fromCharCode(C))}while(C&&x<m);if(512&r.flags&&(r.check=s(r.check,f,x,p)),m-=x,p+=x,C)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===m)break e;x=0;do{C=f[p+x++],r.head&&C&&r.length<65536&&(r.head.comment+=String.fromCharCode(C))}while(C&&x<m);if(512&r.flags&&(r.check=s(r.check,f,x,p)),m-=x,p+=x,C)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;y<16;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(_!==(65535&r.check)){e.msg="header crc mismatch",r.mode=l;break}_=0,y=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=u;break;case 10:for(;y<32;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}e.adler=r.check=h(_),_=0,y=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,r.hold=_,r.bits=y,2;e.adler=r.check=1,r.mode=u;case u:if(5===t||6===t)break e;case 13:if(r.last){_>>>=7&y,y-=7&y,r.mode=27;break}for(;y<3;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}switch(r.last=1&_,y-=1,3&(_>>>=1)){case 0:r.mode=14;break;case 1:if(b(r),r.mode=20,6===t){_>>>=2,y-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=l}_>>>=2,y-=2;break;case 14:for(_>>>=7&y,y-=7&y;y<32;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",r.mode=l;break}if(r.length=65535&_,_=0,y=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(x=r.length){if(x>m&&(x=m),x>w&&(x=w),0===x)break e;n.arraySet(d,f,p,x,g),m-=x,p+=x,w-=x,g+=x,r.length-=x;break}r.mode=u;break;case 17:for(;y<14;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(r.nlen=257+(31&_),_>>>=5,y-=5,r.ndist=1+(31&_),_>>>=5,y-=5,r.ncode=4+(15&_),_>>>=4,y-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=l;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;y<3;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.lens[U[r.have++]]=7&_,_>>>=3,y-=3}for(;r.have<19;)r.lens[U[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,L={bits:r.lenbits},D=o(0,r.lens,0,19,r.lencode,0,r.work,L),r.lenbits=L.bits,D){e.msg="invalid code lengths set",r.mode=l;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;P=(M=r.lencode[_&(1<<r.lenbits)-1])>>>16&255,I=65535&M,!((A=M>>>24)<=y);){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(I<16)_>>>=A,y-=A,r.lens[r.have++]=I;else{if(16===I){for(B=A+2;y<B;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(_>>>=A,y-=A,0===r.have){e.msg="invalid bit length repeat",r.mode=l;break}C=r.lens[r.have-1],x=3+(3&_),_>>>=2,y-=2}else if(17===I){for(B=A+3;y<B;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}y-=A,C=0,x=3+(7&(_>>>=A)),_>>>=3,y-=3}else{for(B=A+7;y<B;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}y-=A,C=0,x=11+(127&(_>>>=A)),_>>>=7,y-=7}if(r.have+x>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=l;break}for(;x--;)r.lens[r.have++]=C}}if(r.mode===l)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=l;break}if(r.lenbits=9,L={bits:r.lenbits},D=o(1,r.lens,0,r.nlen,r.lencode,0,r.work,L),r.lenbits=L.bits,D){e.msg="invalid literal/lengths set",r.mode=l;break}if(r.distbits=6,r.distcode=r.distdyn,L={bits:r.distbits},D=o(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,L),r.distbits=L.bits,D){e.msg="invalid distances set",r.mode=l;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(m>=6&&w>=258){e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,r.hold=_,r.bits=y,a(e,S),g=e.next_out,d=e.output,w=e.avail_out,p=e.next_in,f=e.input,m=e.avail_in,_=r.hold,y=r.bits,r.mode===u&&(r.back=-1);break}for(r.back=0;P=(M=r.lencode[_&(1<<r.lenbits)-1])>>>16&255,I=65535&M,!((A=M>>>24)<=y);){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(P&&0==(240&P)){for(N=A,R=P,O=I;P=(M=r.lencode[O+((_&(1<<N+R)-1)>>N)])>>>16&255,I=65535&M,!(N+(A=M>>>24)<=y);){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}_>>>=N,y-=N,r.back+=N}if(_>>>=A,y-=A,r.back+=A,r.length=I,0===P){r.mode=26;break}if(32&P){r.back=-1,r.mode=u;break}if(64&P){e.msg="invalid literal/length code",r.mode=l;break}r.extra=15&P,r.mode=22;case 22:if(r.extra){for(B=r.extra;y<B;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,y-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;P=(M=r.distcode[_&(1<<r.distbits)-1])>>>16&255,I=65535&M,!((A=M>>>24)<=y);){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(0==(240&P)){for(N=A,R=P,O=I;P=(M=r.distcode[O+((_&(1<<N+R)-1)>>N)])>>>16&255,I=65535&M,!(N+(A=M>>>24)<=y);){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}_>>>=N,y-=N,r.back+=N}if(_>>>=A,y-=A,r.back+=A,64&P){e.msg="invalid distance code",r.mode=l;break}r.offset=I,r.extra=15&P,r.mode=24;case 24:if(r.extra){for(B=r.extra;y<B;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,y-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=l;break}r.mode=25;case 25:if(0===w)break e;if(x=S-w,r.offset>x){if((x=r.offset-x)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=l;break}x>r.wnext?(x-=r.wnext,T=r.wsize-x):T=r.wnext-x,x>r.length&&(x=r.length),k=r.window}else k=d,T=g-r.offset,x=r.length;x>w&&(x=w),w-=x,r.length-=x;do{d[g++]=k[T++]}while(--x);0===r.length&&(r.mode=21);break;case 26:if(0===w)break e;d[g++]=r.length,w--,r.mode=21;break;case 27:if(r.wrap){for(;y<32;){if(0===m)break e;m--,_|=f[p++]<<y,y+=8}if(S-=w,e.total_out+=S,r.total+=S,S&&(e.adler=r.check=r.flags?s(r.check,d,S,g-S):i(r.check,d,S,g-S)),S=w,(r.flags?_:h(_))!==r.check){e.msg="incorrect data check",r.mode=l;break}_=0,y=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;y<32;){if(0===m)break e;m--,_+=f[p++]<<y,y+=8}if(_!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=l;break}_=0,y=0}r.mode=29;case 29:D=1;break e;case l:D=-3;break e;case 31:return-4;default:return c}return e.next_out=g,e.avail_out=w,e.next_in=p,e.avail_in=m,r.hold=_,r.bits=y,(r.wsize||S!==e.avail_out&&r.mode<l&&(r.mode<27||4!==t))&&v(e,e.output,e.next_out,S-e.avail_out)?(r.mode=31,-4):(E-=e.avail_in,S-=e.avail_out,e.total_in+=E,e.total_out+=S,r.total+=S,r.wrap&&S&&(e.adler=r.check=r.flags?s(r.check,d,S,e.next_out-S):i(r.check,d,S,e.next_out-S)),e.data_type=r.bits+(r.last?64:0)+(r.mode===u?128:0)+(20===r.mode||15===r.mode?256:0),(0===E&&0===S||4===t)&&0===D&&(D=-5),D)},r.inflateEnd=function(e){if(!e||!e.state)return c;var t=e.state;return t.window&&(t.window=null),e.state=null,0},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?c:(r.head=t,t.done=!1,0):c},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?c:11===r.mode&&i(1,t,n,0)!==r.check?-3:v(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):c},r.inflateInfo="pako inflate (from Nodeca project)"}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4438,{"../utils/common":4431},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/common"),i=15,s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,u,l,h,f,d){var p,g,m,w,_,y,b,v,E,S=d.bits,x=0,T=0,k=0,A=0,P=0,I=0,N=0,R=0,O=0,C=0,D=null,L=0,B=new n.Buf16(16),M=new n.Buf16(16),F=null,U=0;for(x=0;x<=i;x++)B[x]=0;for(T=0;T<u;T++)B[t[r+T]]++;for(P=S,A=i;A>=1&&0===B[A];A--);if(P>A&&(P=A),0===A)return l[h++]=20971520,l[h++]=20971520,d.bits=1,0;for(k=1;k<A&&0===B[k];k++);for(P<k&&(P=k),R=1,x=1;x<=i;x++)if(R<<=1,(R-=B[x])<0)return-1;if(R>0&&(0===e||1!==A))return-1;for(M[1]=0,x=1;x<i;x++)M[x+1]=M[x]+B[x];for(T=0;T<u;T++)0!==t[r+T]&&(f[M[t[r+T]]++]=T);if(0===e?(D=F=f,y=19):1===e?(D=s,L-=257,F=a,U-=257,y=256):(D=o,F=c,y=-1),C=0,T=0,x=k,_=h,I=P,N=0,m=-1,w=(O=1<<P)-1,1===e&&O>852||2===e&&O>592)return 1;for(;;){b=x-N,f[T]<y?(v=0,E=f[T]):f[T]>y?(v=F[U+f[T]],E=D[L+f[T]]):(v=96,E=0),p=1<<x-N,k=g=1<<I;do{l[_+(C>>N)+(g-=p)]=b<<24|v<<16|E|0}while(0!==g);for(p=1<<x-1;C&p;)p>>=1;if(0!==p?(C&=p-1,C+=p):C=0,T++,0==--B[x]){if(x===A)break;x=t[r+f[T]]}if(x>P&&(C&w)!==m){for(0===N&&(N=P),_+=k,R=1<<(I=x-N);I+N<A&&!((R-=B[I+N])<=0);)I++,R<<=1;if(O+=1<<I,1===e&&O>852||2===e&&O>592)return 1;l[m=C&w]=P<<24|I<<16|_-h|0}}return 0!==C&&(l[_+C]=x-N<<24|64<<16|0),d.bits=P,0}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4439,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4440,{"../utils/common":4431},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/common");function i(e){for(var t=e.length;--t>=0;)e[t]=0}var s=256,a=286,o=30,c=15,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],l=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=new Array(576);i(d);var p=new Array(60);i(p);var g=new Array(512);i(g);var m=new Array(256);i(m);var w=new Array(29);i(w);var _,y,b,v=new Array(o);function E(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function S(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?g[e]:g[256+(e>>>7)]}function T(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function k(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,T(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function A(e,t,r){k(e,r[2*t],r[2*t+1])}function P(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function I(e,t,r){var n,i,s=new Array(16),a=0;for(n=1;n<=c;n++)s[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=P(s[o]++,o))}}function N(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function R(e){e.bi_valid>8?T(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function O(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function C(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&O(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!O(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function D(e,t,r){var n,i,a,o,c=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],i=e.pending_buf[e.l_buf+c],c++,0===n?A(e,i,t):(A(e,(a=m[i])+s+1,t),0!==(o=u[a])&&k(e,i-=w[a],o),A(e,a=x(--n),r),0!==(o=l[a])&&k(e,n-=v[a],o))}while(c<e.last_lit);A(e,256,t)}function L(e,t){var r,n,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==s[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=l,r=e.heap_len>>1;r>=1;r--)C(e,s,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,s[2*i]=s[2*r]+s[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,s[2*r+1]=s[2*n+1]=i,e.heap[1]=i++,C(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,s,a,o,u=t.dyn_tree,l=t.max_code,h=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(s=0;s<=c;s++)e.bl_count[s]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(s=u[2*u[2*(n=e.heap[r])+1]+1]+1)>g&&(s=g,m++),u[2*n+1]=s,n>l||(e.bl_count[s]++,a=0,n>=p&&(a=d[n-p]),o=u[2*n],e.opt_len+=o*(s+a),f&&(e.static_len+=o*(h[2*n+1]+a)));if(0!==m){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(s=g;0!==s;s--)for(n=e.bl_count[s];0!==n;)(i=e.heap[--r])>l||(u[2*i+1]!==s&&(e.opt_len+=(s-u[2*i+1])*u[2*i],u[2*i+1]=s),n--)}}(e,t),I(s,l,e.bl_count)}function B(e,t,r){var n,i,s=-1,a=t[1],o=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++o<c&&i===a||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function M(e,t,r){var n,i,s=-1,a=t[1],o=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++o<c&&i===a)){if(o<u)do{A(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==s&&(A(e,i,e.bl_tree),o--),A(e,16,e.bl_tree),k(e,o-3,2)):o<=10?(A(e,17,e.bl_tree),k(e,o-3,3)):(A(e,18,e.bl_tree),k(e,o-11,7));o=0,s=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}i(v);var F=!1;function U(e,t,r,i){k(e,0+(i?1:0),3),function(e,t,r,i){R(e),i&&(T(e,r),T(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){F||(!function(){var e,t,r,n,i,s=new Array(16);for(r=0,n=0;n<28;n++)for(w[n]=r,e=0;e<1<<u[n];e++)m[r++]=n;for(m[r-1]=n,i=0,n=0;n<16;n++)for(v[n]=i,e=0;e<1<<l[n];e++)g[i++]=n;for(i>>=7;n<o;n++)for(v[n]=i<<7,e=0;e<1<<l[n]-7;e++)g[256+i++]=n;for(t=0;t<=c;t++)s[t]=0;for(e=0;e<=143;)d[2*e+1]=8,e++,s[8]++;for(;e<=255;)d[2*e+1]=9,e++,s[9]++;for(;e<=279;)d[2*e+1]=7,e++,s[7]++;for(;e<=287;)d[2*e+1]=8,e++,s[8]++;for(I(d,287,s),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=P(e,5);_=new E(d,u,257,a,c),y=new E(p,l,0,o,c),b=new E(new Array(0),h,0,19,7)}(),F=!0),e.l_desc=new S(e.dyn_ltree,_),e.d_desc=new S(e.dyn_dtree,y),e.bl_desc=new S(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,N(e)},r._tr_stored_block=U,r._tr_flush_block=function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),L(e,e.l_desc),L(e,e.d_desc),o=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),L(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*f[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?U(e,t,r,n):4===e.strategy||a===i?(k(e,2+(n?1:0),3),D(e,d,p)):(k(e,4+(n?1:0),3),function(e,t,r,n){var i;for(k(e,t-257,5),k(e,r-1,5),k(e,n-4,4),i=0;i<n;i++)k(e,e.bl_tree[2*f[i]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),D(e,e.dyn_ltree,e.dyn_dtree)),N(e),n&&R(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(m[r]+s+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){k(e,2,3),A(e,256,d),function(e){16===e.bi_valid?(T(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4441,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}}},{package:"@metamask/snap-controllers>gunzip-maybe>browserify-zlib>pako"}],[4442,{"end-of-stream":2432,fs:2174,once:5393},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("once"),i=e("end-of-stream"),s=e("fs"),a=function(){},o=function(e){return"function"==typeof e},c=function(e,t,r,c){c=n(c);var u=!1;e.on("close",(function(){u=!0})),i(e,{readable:t,writable:r},(function(e){if(e)return c(e);u=!0,c()}));var l=!1;return function(t){if(!u&&!l)return l=!0,function(e){return!!s&&(e instanceof(s.ReadStream||a)||e instanceof(s.WriteStream||a))&&o(e.close)}(e)?e.close(a):function(e){return e.setHeader&&o(e.abort)}(e)?e.abort():o(e.destroy)?e.destroy():void c(t||new Error("stream was destroyed"))}},u=function(e){e()},l=function(e,t){return e.pipe(t)};t.exports=function(){var e,t=Array.prototype.slice.call(arguments),r=o(t[t.length-1]||a)&&t.pop()||a;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var n=t.map((function(i,s){var a=s<t.length-1;return c(i,a,s>0,(function(t){e||(e=t),t&&n.forEach(u),a||(n.forEach(u),r(e))}))}));return t.reduce(l)}}}},{package:"@metamask/snap-controllers>gunzip-maybe>pumpify>pump"}],[4443,{duplexify:4430,inherits:4515,pump:4442},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("pump"),i=e("inherits"),s=e("duplexify"),a=function(e){return e.length?Array.isArray(e[0])?e[0]:Array.prototype.slice.call(e):[]},o=function(e){var t=function(){var r=a(arguments);if(!(this instanceof t))return new t(r);s.call(this,null,null,e),r.length&&this.setPipeline(r)};return i(t,s),t.prototype.setPipeline=function(){var e=a(arguments),t=this,r=!1,i=e[0],s=e[e.length-1];s=s.readable?s:null,i=i.writable?i:null;var o=function(){e[0].emit("error",new Error("stream was destroyed"))};if(this.on("close",o),this.on("prefinish",(function(){r||t.cork()})),n(e,(function(e){if(t.removeListener("close",o),e)return t.destroy(e);r=!0,t.uncork()})),this.destroyed)return o();this.setWritable(i),this.setReadable(s)},t};t.exports=o({destroy:!1}),t.exports.obj=o({destroy:!1,objectMode:!0,highWaterMark:16})}}},{package:"@metamask/snap-controllers>gunzip-maybe>pumpify"}],[4444,{_process:5500,"readable-stream":5780,util:2181,xtend:6249},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,i=e("util").inherits,s=e("xtend");function a(e){n.call(this,e),this._destroyed=!1}function o(e,t,r){r(null,e)}function c(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=o),"function"!=typeof n&&(n=null),e(t,r,n)}}i(a,n),a.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,r){var n=new a(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=c((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=s(e,t),a.call(this,this.options)}return i(n,a),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=c((function(e,t,r){var n=new a(s({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>gunzip-maybe>through2"}],[4445,{"./consumable-hash":4447,"sparse-array":5951},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("sparse-array"),i=e("./consumable-hash"),s={bits:8};class a{constructor(e,t,r){if(this._options=Object.assign({},s,e),this._popCount=0,this._parent=t,this._posAtParent=r,!this._options.hashFn)throw new Error("please define an options.hashFn");this._options.hash||(this._options.hash=i(this._options.hashFn)),this._children=new n}static isBucket(e){return e instanceof a}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof a?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)if(t instanceof a)for(const e of t.eachLeafSeries())yield e;else yield t}serialize(e,t){return t(this._children.reduce(((r,n,i)=>(n&&(n instanceof a?r.push(n.serialize(e,t)):r.push(e(n,i))),r)),[]))}async asyncTransform(e,t){return l(this,e,t)}toJSON(){return this.serialize(c,u)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(r&&r.key===e)return r}async _findPlace(e){const t=this._options.hash(e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof a?n._findPlace(t):{bucket:this,pos:r,hash:t}}async _findNewBucketAndPos(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(r&&r.key!==e){const e=new a(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const n=await e._findPlace(r.hash);return n.bucket._putAt(n,r.key,r.value),e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)||this._popCount++,this._children.set(e,t)}_delAt(e){this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(o);if(!(e instanceof a)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function o(e){return Boolean(e)}function c(e,t){return e.key}function u(e){return e}async function l(e,t,r){const n=[];for(const i of e._children.compactArray()){if(i instanceof a)await l(i,t,r);else{const r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return r(n)}}t.exports=a}}},{package:"3box>ipfs>ipfs-mfs>hamt-sharding"}],[4446,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n=[255,254,252,248,240,224,192,128],i=[1,3,7,15,31,63,127,255];function s(e,t,r){const s=function(e,t){return n[e]&i[Math.min(t+e-1,7)]}(t,r);return(e&s)>>>t}t.exports=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+s(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}}}},{package:"3box>ipfs>ipfs-mfs>hamt-sharding"}],[4447,{"../../is-buffer/index.js":4797,"./consumable-buffer":4446},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("./consumable-buffer");t.exports=function(e){return function(t){return t instanceof i?t:new i(t,e)}};class i{constructor(e,t){if("string"!=typeof e&&!r.isBuffer(e))throw new Error("can only hash strings or buffers");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth?this._value+this._depth:this._value,t=await this._hashFn(e),r=new n(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}}).call(this)}).call(this,{isBuffer:e("../../is-buffer/index.js")})}}},{package:"3box>ipfs>ipfs-mfs>hamt-sharding"}],[4448,{"./bucket":4445},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./bucket");t.exports=function(e){return new n(e)},t.exports.isBucket=n.isBucket}}},{package:"3box>ipfs>ipfs-mfs>hamt-sharding"}],[4449,{buffer:2175,isarray:4450},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("isarray"),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(n(t)){for(var i=0,o=t.length;i<o;i++)if(e(t[i]))return!0;return!1}if("function"==typeof r&&r.isBuffer&&r.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||s&&t instanceof Blob||a&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)&&e(t[c]))return!0;return!1}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io>has-binary2"}],[4450,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io>has-binary2>isarray"}],[4451,{},function(){with(this)return function(){"use strict";return function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>engine.io-client>has-cors"}],[4483,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return r[e]!==undefined||n[e]!==undefined},remove:function(e){r[e]!==undefined&&(r[e]=undefined),n[e]!==undefined&&(n[e]=undefined)},get:function(e){var t=r[e];return t!==undefined?t:(t=n[e])!==undefined?(i(e,t),t):void 0},set:function(e,t){r[e]!==undefined?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}}}},{package:"3box>ipfs>libp2p-kad-dht>hashlru"}],[4489,{"./lib/heap":4490},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./lib/heap")}}},{package:"3box>ipfs>libp2p-kad-dht>heap"}],[4490,{},function(){with(this)return function(){"use strict";return function(e,t,r){(function(){var e,n,i,s,a,o,c,u,l,h,f,d,p,g,m,w,_;i=Math.floor,h=Math.min,n=function(e,t){return e<t?-1:e>t?1:0},l=function(e,t,r,s,a){var o;if(null==r&&(r=0),null==a&&(a=n),r<0)throw new Error("lo must be non-negative");for(null==s&&(s=e.length);r<s;)a(t,e[o=i((r+s)/2)])<0?s=o:r=o+1;return[].splice.apply(e,[r,r-r].concat(t)),t},o=function(e,t,r){return null==r&&(r=n),e.push(t),g(e,0,e.length-1,r)},a=function(e,t){var r,i;return null==t&&(t=n),r=e.pop(),e.length?(i=e[0],e[0]=r,m(e,0,t)):i=r,i},u=function(e,t,r){var i;return null==r&&(r=n),i=e[0],e[0]=t,m(e,0,r),i},c=function(e,t,r){var i;return null==r&&(r=n),e.length&&r(e[0],t)<0&&(t=(i=[e[0],t])[0],e[0]=i[1],m(e,0,r)),t},s=function(e,t){var r,s,a,o,c,u;for(null==t&&(t=n),o=function(){u=[];for(var t=0,r=i(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)u.push(t);return u}.apply(this).reverse(),c=[],s=0,a=o.length;s<a;s++)r=o[s],c.push(m(e,r,t));return c},p=function(e,t,r){var i;if(null==r&&(r=n),-1!==(i=e.indexOf(t)))return g(e,0,i,r),m(e,i,r)},f=function(e,t,r){var i,a,o,u,l;if(null==r&&(r=n),!(a=e.slice(0,t)).length)return a;for(s(a,r),o=0,u=(l=e.slice(t)).length;o<u;o++)i=l[o],c(a,i,r);return a.sort(r).reverse()},d=function(e,t,r){var i,o,c,u,f,d,p,g,m;if(null==r&&(r=n),10*t<=e.length){if(!(c=e.slice(0,t).sort(r)).length)return c;for(o=c[c.length-1],u=0,d=(p=e.slice(t)).length;u<d;u++)r(i=p[u],o)<0&&(l(c,i,0,null,r),c.pop(),o=c[c.length-1]);return c}for(s(e,r),m=[],f=0,g=h(t,e.length);0<=g?f<g:f>g;0<=g?++f:--f)m.push(a(e,r));return m},g=function(e,t,r,i){var s,a,o;for(null==i&&(i=n),s=e[r];r>t&&i(s,a=e[o=r-1>>1])<0;)e[r]=a,r=o;return e[r]=s},m=function(e,t,r){var i,s,a,o,c;for(null==r&&(r=n),s=e.length,c=t,a=e[t],i=2*t+1;i<s;)(o=i+1)<s&&!(r(e[i],e[o])<0)&&(i=o),e[t]=e[i],i=2*(t=i)+1;return e[t]=a,g(e,c,t,r)},e=function(){function e(e){this.cmp=null!=e?e:n,this.nodes=[]}return e.push=o,e.pop=a,e.replace=u,e.pushpop=c,e.heapify=s,e.updateItem=p,e.nlargest=f,e.nsmallest=d,e.prototype.push=function(e){return o(this.nodes,e,this.cmp)},e.prototype.pop=function(){return a(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return u(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return c(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return s(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return p(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),w=this,_=function(){return e},"function"==typeof define&&define.amd?define([],_):"object"==typeof r?t.exports=_():w.Heap=_()}).call(this)}}},{package:"3box>ipfs>libp2p-kad-dht>heap"}],[4491,{_process:5500},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){
/*
 * [hi-base32]{@link https://github.com/emn178/hi-base32}
 *
 * @version 0.5.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */
!function(){var r="object"==typeof window?window:{};!r.HI_BASE32_NO_NODE_JS&&"object"==typeof e&&e.versions&&e.versions.node&&(r=global);var n=!r.HI_BASE32_NO_COMMON_JS&&"object"==typeof t&&t.exports,i="function"==typeof define&&define.amd,s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),a={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},o=[0,0,0,0,0,0,0,0],c=function(e,t){t.length>10&&(t="..."+t.substr(-10));var r=new Error("Decoded data is not valid UTF-8."+" Maybe try base32.decode.asBytes()?"+" Partial data after reading "+e+" bytes: "+t+" <-");throw r.position=e,r},u=function(e){if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");for(var t,r,n,i,s,o,c,u,l=[],h=0,f=(e=e.replace(/=/g,"")).length,d=0,p=f>>3<<3;d<p;)t=a[e.charAt(d++)],r=a[e.charAt(d++)],n=a[e.charAt(d++)],i=a[e.charAt(d++)],s=a[e.charAt(d++)],o=a[e.charAt(d++)],c=a[e.charAt(d++)],u=a[e.charAt(d++)],l[h++]=255&(t<<3|r>>>2),l[h++]=255&(r<<6|n<<1|i>>>4),l[h++]=255&(i<<4|s>>>1),l[h++]=255&(s<<7|o<<2|c>>>3),l[h++]=255&(c<<5|u);var g=f-p;return 2===g?(t=a[e.charAt(d++)],r=a[e.charAt(d++)],l[h++]=255&(t<<3|r>>>2)):4===g?(t=a[e.charAt(d++)],r=a[e.charAt(d++)],n=a[e.charAt(d++)],i=a[e.charAt(d++)],l[h++]=255&(t<<3|r>>>2),l[h++]=255&(r<<6|n<<1|i>>>4)):5===g?(t=a[e.charAt(d++)],r=a[e.charAt(d++)],n=a[e.charAt(d++)],i=a[e.charAt(d++)],s=a[e.charAt(d++)],l[h++]=255&(t<<3|r>>>2),l[h++]=255&(r<<6|n<<1|i>>>4),l[h++]=255&(i<<4|s>>>1)):7===g&&(t=a[e.charAt(d++)],r=a[e.charAt(d++)],n=a[e.charAt(d++)],i=a[e.charAt(d++)],s=a[e.charAt(d++)],o=a[e.charAt(d++)],c=a[e.charAt(d++)],l[h++]=255&(t<<3|r>>>2),l[h++]=255&(r<<6|n<<1|i>>>4),l[h++]=255&(i<<4|s>>>1),l[h++]=255&(s<<7|o<<2|c>>>3)),l},l=function(e,t){if(!t)return function(e){for(var t,r,n="",i=e.length,s=0,a=0;s<i;)if((t=e[s++])<=127)n+=String.fromCharCode(t);else{t>191&&t<=223?(r=31&t,a=1):t<=239?(r=15&t,a=2):t<=247?(r=7&t,a=3):c(s,n);for(var o=0;o<a;++o)((t=e[s++])<128||t>191)&&c(s,n),r<<=6,r+=63&t;r>=55296&&r<=57343&&c(s,n),r>1114111&&c(s,n),r<=65535?n+=String.fromCharCode(r):(r-=65536,n+=String.fromCharCode(55296+(r>>10)),n+=String.fromCharCode(56320+(1023&r)))}return n}(u(e));if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");var r,n,i,s,o,l,h,f,d="",p=e.indexOf("=");-1===p&&(p=e.length);for(var g=0,m=p>>3<<3;g<m;)r=a[e.charAt(g++)],n=a[e.charAt(g++)],i=a[e.charAt(g++)],s=a[e.charAt(g++)],o=a[e.charAt(g++)],l=a[e.charAt(g++)],h=a[e.charAt(g++)],f=a[e.charAt(g++)],d+=String.fromCharCode(255&(r<<3|n>>>2))+String.fromCharCode(255&(n<<6|i<<1|s>>>4))+String.fromCharCode(255&(s<<4|o>>>1))+String.fromCharCode(255&(o<<7|l<<2|h>>>3))+String.fromCharCode(255&(h<<5|f));var w=p-m;return 2===w?(r=a[e.charAt(g++)],n=a[e.charAt(g++)],d+=String.fromCharCode(255&(r<<3|n>>>2))):4===w?(r=a[e.charAt(g++)],n=a[e.charAt(g++)],i=a[e.charAt(g++)],s=a[e.charAt(g++)],d+=String.fromCharCode(255&(r<<3|n>>>2))+String.fromCharCode(255&(n<<6|i<<1|s>>>4))):5===w?(r=a[e.charAt(g++)],n=a[e.charAt(g++)],i=a[e.charAt(g++)],s=a[e.charAt(g++)],o=a[e.charAt(g++)],d+=String.fromCharCode(255&(r<<3|n>>>2))+String.fromCharCode(255&(n<<6|i<<1|s>>>4))+String.fromCharCode(255&(s<<4|o>>>1))):7===w&&(r=a[e.charAt(g++)],n=a[e.charAt(g++)],i=a[e.charAt(g++)],s=a[e.charAt(g++)],o=a[e.charAt(g++)],l=a[e.charAt(g++)],h=a[e.charAt(g++)],d+=String.fromCharCode(255&(r<<3|n>>>2))+String.fromCharCode(255&(n<<6|i<<1|s>>>4))+String.fromCharCode(255&(s<<4|o>>>1))+String.fromCharCode(255&(o<<7|l<<2|h>>>3))),d},h={encode:function(e,t){var r="string"!=typeof e;return r&&e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),r?function(e){for(var t,r,n,i,a,o="",c=e.length,u=0,l=5*parseInt(c/5);u<l;)t=e[u++],r=e[u++],n=e[u++],i=e[u++],a=e[u++],o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[31&(i<<3|a>>>5)]+s[31&a];var h=c-l;return 1===h?(t=e[u],o+=s[t>>>3]+s[t<<2&31]+"======"):2===h?(t=e[u++],r=e[u],o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[r<<4&31]+"===="):3===h?(t=e[u++],r=e[u++],n=e[u],o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[n<<1&31]+"==="):4===h&&(t=e[u++],r=e[u++],n=e[u++],i=e[u],o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[i<<3&31]+"="),o}(e):t?function(e){for(var t,r,n,i,a,o="",c=e.length,u=0,l=5*parseInt(c/5);u<l;)t=e.charCodeAt(u++),r=e.charCodeAt(u++),n=e.charCodeAt(u++),i=e.charCodeAt(u++),a=e.charCodeAt(u++),o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[31&(i<<3|a>>>5)]+s[31&a];var h=c-l;return 1===h?(t=e.charCodeAt(u),o+=s[t>>>3]+s[t<<2&31]+"======"):2===h?(t=e.charCodeAt(u++),r=e.charCodeAt(u),o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[r<<4&31]+"===="):3===h?(t=e.charCodeAt(u++),r=e.charCodeAt(u++),n=e.charCodeAt(u),o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[n<<1&31]+"==="):4===h&&(t=e.charCodeAt(u++),r=e.charCodeAt(u++),n=e.charCodeAt(u++),i=e.charCodeAt(u),o+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[i<<3&31]+"="),o}(e):function(e){var t,r,n,i,a,c,u,l=!1,h="",f=0,d=0,p=e.length;do{for(o[0]=o[5],o[1]=o[6],o[2]=o[7],u=d;f<p&&u<5;++f)(c=e.charCodeAt(f))<128?o[u++]=c:c<2048?(o[u++]=192|c>>6,o[u++]=128|63&c):c<55296||c>=57344?(o[u++]=224|c>>12,o[u++]=128|c>>6&63,o[u++]=128|63&c):(c=65536+((1023&c)<<10|1023&e.charCodeAt(++f)),o[u++]=240|c>>18,o[u++]=128|c>>12&63,o[u++]=128|c>>6&63,o[u++]=128|63&c);d=u-5,f===p&&++f,f>p&&u<6&&(l=!0),t=o[0],u>4?(r=o[1],n=o[2],i=o[3],a=o[4],h+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[31&(i<<3|a>>>5)]+s[31&a]):1===u?h+=s[t>>>3]+s[t<<2&31]+"======":2===u?(r=o[1],h+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[r<<4&31]+"===="):3===u?(r=o[1],n=o[2],h+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[n<<1&31]+"==="):(r=o[1],n=o[2],i=o[3],h+=s[t>>>3]+s[31&(t<<2|r>>>6)]+s[r>>>1&31]+s[31&(r<<4|n>>>4)]+s[31&(n<<1|i>>>7)]+s[i>>>2&31]+s[i<<3&31]+"=")}while(!l);return h}(e)},decode:l};l.asBytes=u,n?t.exports=h:(r.base32=h,i&&define((function(){return h})))}()}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>multiaddr>hi-base32"}],[4495,{"did-resolver":2368,xmlhttprequest:2174},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(a,o)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(r,"__esModule",{value:!0});var s=e("did-resolver");function a(t){return new Promise((function(r,n){var i=new("undefined"!=typeof window?window.XMLHttpRequest:e("xmlhttprequest").XMLHttpRequest);i.open("GET",t),i.onreadystatechange=function(){i&&4===i.readyState&&(200===i.status?r(i.responseText):n(new Error(("Invalid http response status "+i.status+" "+i.responseText).trim())))},i.setRequestHeader("accept","application/json"),i.send()}))}r.default=function(){s.registerMethod("https",(function(e,t){return n(this,void 0,void 0,(function(){var r,n,s,o;return i(this,(function(i){switch(i.label){case 0:r="https://"+t.id+"/.well-known/did.json",n=null,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a(r)];case 2:return n=i.sent(),[3,4];case 3:throw s=i.sent(),new Error("DID must resolve to a valid https URL: "+s.message);case 4:o=null;try{o=JSON.parse(n)}catch(e){throw new Error("DID must resolve to a JSON document")}if(!("https://w3id.org/did/v1"===o["@context"]))throw new Error("DID document missing context");if(!(o.id===e))throw new Error("DID document id does not match requested did");if(!(Array.isArray(o.publicKey)&&o.publicKey.length>0))throw new Error("DID document has no public keys");return[2,o]}}))}))}))}}}},{package:"3box>https-did-resolver"}],[4497,{"promisify-es6":5504},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("promisify-es6"),i=/^((\d+(\.\d+)*)(ns|ms|us|µs|m|s|h))+$/,s=/((\d+(\.\d+)*)(ns|ms|us|µs|m|s|h))/g,a=/(ns|ms|us|µs|m|s|h)/g,o={ns:1e-6,us:.001,"µs":.001,ms:1,s:1e3,m:6e4,h:36e5};t.exports=n((function(e,t){return"string"!=typeof e?t(new Error("the first argument must be a string")):i.test(e)?void t(null,e.match(s).reduce(((e,t)=>e+function(e){let t=e.match(a)[0];return e=e.substring(0,e.length-t.length),parseFloat(e)*o[t]}(t)),0)):t(new Error("invalid time"))}))}}},{package:"3box>ipfs>human-to-milliseconds"}],[4499,{stream:2178,xtend:6249},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("stream"),i=e("xtend");t.exports=function(e,t,r){if("object"!=typeof e)throw new TypeError("db must be an object");if("string"!=typeof t)throw new TypeError("storeName must be a string");if(null==r&&(r={}),"object"!=typeof r)throw new TypeError("opts must be an object");var s=new n.Transform(i(r,{objectMode:!0,transform:function(e,t,r){r(null,e)}}));r=i({snapshot:!1},r);var a=null;return s._cursorsOpened=0,function n(){var i,o,c,u,l,h=r.direction||"next",f=r.range||{};i=f.lower,o=f.upper,c=!!f.lowerOpen,u=!!f.upperOpen,a&&("next"===h?(c=!0,i=a):(u=!0,o=a)),i&&o?l=IDBKeyRange.bound(i,o,c,u):i?l=IDBKeyRange.lowerBound(i,c):o&&(l=IDBKeyRange.upperBound(o,u));var d=e.transaction(t,"readonly"),p=d.objectStore(t);s._cursorsOpened++;var g=p.openCursor(l,r.direction);function m(e){try{e.continue()}catch(e){"TransactionInactiveError"!==e.name||r.snapshot?s.emit("error",e):n()}}g.onsuccess=function(){var e=g.result;if(e){a=e.key;var t=s.write({key:e.key,value:e.value});r.snapshot||t?m(e):s.once("drain",(function(){m(e)}))}else s.end()},d.onabort=function(){s.emit("error",d.error)},d.onerror=function(){s.emit("error",d.error)}}(),s}}}},{package:"3box>ipfs>ipfs-repo>datastore-level>level-js>idb-readable-stream"}],[45,{"eth-rpc-errors":2537},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors");var i=(e,t)=>async r=>{if(t._writableState.ended)return;if(!e[r.method])return void t.write({jsonrpc:"2.0",error:n.ethErrors.rpc.methodNotFound({message:`${r.method} not found`}),id:r.id});let i,s;try{i=await e[r.method](...r.params)}catch(e){s=e}t._writableState.ended?s&&console.error(s):s?t.write({jsonrpc:"2.0",error:(0,n.serializeError)(s,{shouldIncludeStack:!0}),id:r.id}):t.write({jsonrpc:"2.0",result:i,id:r.id})};r.default=i}}},{package:"$root$"}],[4505,{"./messageChannel":4506,"./mutation.js":4507,"./nextTick":4508,"./stateChange":4509,"./timeout":4510},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i,s,a=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],o=-1,c=[],u=!1;function l(){n&&i&&(n=!1,i.length?c=i.concat(c):o=-1,c.length&&h())}function h(){if(!n){u=!1,n=!0;for(var e=c.length,t=setTimeout(l);e;){for(i=c,c=[];i&&++o<e;)i[o].run();o=-1,e=c.length}i=null,o=-1,n=!1,clearTimeout(t)}}for(var f=-1,d=a.length;++f<d;)if(a[f]&&a[f].test&&a[f].test()){s=a[f].install(h);break}function p(e,t){this.fun=e,this.array=t}p.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),u||n||(u=!0,s())}}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4506,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.test=function(){return!global.setImmediate&&void 0!==global.MessageChannel},r.install=function(e){var t=new global.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4507,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=global.MutationObserver||global.WebKitMutationObserver;r.test=function(){return n},r.install=function(e){var t=0,r=new n(e),i=global.document.createTextNode("");return r.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4508,{_process:5500},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){r.test=function(){return void 0!==e&&!e.browser},r.install=function(t){return function(){e.nextTick(t)}}}).call(this)}).call(this,e("_process"))}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4509,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")},r.install=function(e){return function(){var t=global.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},global.document.documentElement.appendChild(t),e}}}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4510,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}}}},{package:"3box>orbit-db>orbit-db-cache>level-js>immediate"}],[4514,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>indexof"}],[4516,{"pull-defer/duplex":5531},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("pull-defer/duplex");t.exports=class{constructor(e,t){this.peerInfo=null,this.conn=n(),e?this.setInnerConn(e,t):t&&(this.info=t)}get source(){return this.conn.source}get sink(){return this.conn.sink}getPeerInfo(e){return this.info&&this.info.getPeerInfo?this.info.getPeerInfo(e):this.peerInfo?void e(null,this.peerInfo):e(new Error("Peer Info not set yet"))}setPeerInfo(e){if(this.info&&this.info.setPeerInfo)return this.info.setPeerInfo(e);this.peerInfo=e}getObservedAddrs(e){if(this.info&&this.info.getObservedAddrs)return this.info.getObservedAddrs(e);e(null,[])}setInnerConn(e,t){this.conn.resolve(e),this.info=t||e}}}}},{package:"3box>ipfs>pull-mplex>interface-connection"}],[4517,{"./connection":4516},function(){with(this)return function(){"use strict";return function(e,t,r){r.Connection=e("./connection")}}},{package:"3box>ipfs>pull-mplex>interface-connection"}],[4518,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}}}},{package:"3box>ipfs>interface-datastore>uuid"}],[4519,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var s=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}}}},{package:"3box>ipfs>interface-datastore>uuid"}],[4520,{"./lib/bytesToUuid":4518,"./lib/rng":4519},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}}}},{package:"3box>ipfs>interface-datastore>uuid"}],[4521,{"err-code":2449},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("err-code");t.exports.dbOpenFailedError=e=>(e=e||new Error("Cannot open database"),n(e,"ERR_DB_OPEN_FAILED")),t.exports.dbDeleteFailedError=e=>(e=e||new Error("Delete failed"),n(e,"ERR_DB_DELETE_FAILED")),t.exports.dbWriteFailedError=e=>(e=e||new Error("Write failed"),n(e,"ERR_DB_WRITE_FAILED")),t.exports.notFoundError=e=>(e=e||new Error("Not Found"),n(e,"ERR_NOT_FOUND"))}}},{package:"3box>ipfs>interface-datastore"}],[4522,{"./errors":4521,"./key":4523,"./memory":4524,"./utils":4525},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./key"),i=e("./memory"),s=e("./utils"),a=e("./errors");r.Key=n,r.MemoryDatastore=i,r.utils=s,r.Errors=a}}},{package:"3box>ipfs>interface-datastore"}],[4523,{buffer:2175,"class-is":2214,"uuid/v4":4520},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("uuid/v4"),i=e("class-is"),s="/",a=r.from(s),o=a[0];class c{constructor(e,t){if("string"==typeof e?this._buf=r.from(e):r.isBuffer(e)&&(this._buf=e),null==t&&(t=!0),t&&this.clean(),0===this._buf.length||this._buf[0]!==o)throw new Error(`Invalid key: ${this.toString()}`)}toString(e){return this._buf.toString(e||"utf8")}toBuffer(){return this._buf}get[Symbol.toStringTag](){return`[Key ${this.toString()}]`}static withNamespaces(e){return new u(e.join(s))}static random(){return new u(n().replace(/-/g,""))}clean(){for(this._buf&&0!==this._buf.length||(this._buf=r.from(s)),this._buf[0]!==o&&(this._buf=r.concat([a,this._buf]));this._buf.length>1&&this._buf[this._buf.length-1]===o;)this._buf=this._buf.slice(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return c.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(s).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new u(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(s)||(e+=s),e+=this.type(),new u(e)}parent(){const e=this.list();return 1===e.length?new u(s):new u(e.slice(0,-1).join(s))}child(e){return this.toString()===s?e:e.toString()===s?this:new u(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}}const u=i(c,{className:"Key",symbolName:"@ipfs/interface-datastore/key"});t.exports=u}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>interface-datastore"}],[4524,{"./errors":4521,"./key":4523,"./utils":4525,"async/setImmediate":1876,"pull-stream":5557},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("pull-stream"),i=e("async/setImmediate"),s=e("./utils").asyncFilter,a=e("./utils").asyncSort,o=e("./key"),c=e("./errors");t.exports=class{constructor(){this.data={}}open(e){i(e)}put(e,t,r){this.data[e.toString()]=t,i(r)}get(e,t){this.has(e,((r,n)=>r?t(r):n?void t(null,this.data[e.toString()]):t(c.notFoundError())))}has(e,t){i((()=>{t(null,this.data[e.toString()]!==undefined)}))}delete(e,t){delete this.data[e.toString()],i((()=>{t()}))}batch(){let e=[],t=[];return{put(t,r){e.push([t,r])},delete(e){t.push(e)},commit:r=>{e.forEach((e=>{this.data[e[0].toString()]=e[1]})),e=[],t.forEach((e=>{delete this.data[e.toString()]})),t=[],i(r)}}}query(e){let t=[n.keys(this.data),n.map((e=>({key:new o(e),value:this.data[e]})))],r=[];if(null!=e.prefix){const t=e.prefix;r.push(((e,r)=>r(null,e.key.toString().startsWith(t))))}if(null!=e.filters&&(r=r.concat(e.filters)),t=t.concat(r.map((e=>s(e)))),null!=e.orders&&(t=t.concat(e.orders.map((e=>a(e))))),null!=e.offset){let r=0;t.push(n.filter((()=>r++>=e.offset)))}return null!=e.limit&&t.push(n.take(e.limit)),!0===e.keysOnly&&t.push(n.map((e=>({key:e.key})))),n.apply(null,t)}close(e){i(e)}}}}},{package:"3box>ipfs>interface-datastore"}],[4525,{os:5443,path:5476,"pull-defer/source":5534,"pull-stream":5557,"uuid/v4":4520},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("pull-stream"),i=e("pull-defer/source"),s=e("path"),a=e("os"),o=e("uuid/v4");r.asyncFilter=function(e){let t,r,n=!1;return function(i){return function s(a,o){if(r)return o(r);a?(r=a,i(a,n?()=>{n?t=o:o(a)}:o)):i(null,((i,a)=>{i?o(i):r?o(r):(n=!0,e(a,((e,i)=>{n=!1,r?(o(r),t(r)):e?s(e,o):i?o(null,a):s(null,o)})))}))}}},r.asyncSort=function(e){const t=i(),r=n.collect(((r,i)=>{if(r)return t.abort(r);e(i,((e,r)=>{if(e)return t.abort(e);t.resolve(n.values(i))}))}));return function(e){return r(e),t}},r.replaceStartWith=function(e,t){const r=new RegExp("^"+t);return e.replace(r,"")},r.tmpdir=()=>s.join(a.tmpdir(),o())}}},{package:"3box>ipfs>interface-datastore"}],[4527,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}",i="[0-9a-fA-F]{1,4}",s=`\n(\n(?:${i}:){7}(?:${i}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${i}:){6}(?:${n}|:${i}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${i}:){5}(?::${n}|(:${i}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${i}:){4}(?:(:${i}){0,1}:${n}|(:${i}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${i}:){3}(?:(:${i}){0,2}:${n}|(:${i}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${i}:){2}(?:(:${i}){0,3}:${n}|(:${i}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${i}:){1}(?:(:${i}){0,4}:${n}|(:${i}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::((?::${i}){0,5}:${n}|(?::${i}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),a=t.exports=e=>e&&e.exact?new RegExp(`(?:^${n}$)|(?:^${s}$)`):new RegExp(`(?:${n})|(?:${s})`,"g");a.v4=e=>e&&e.exact?new RegExp(`^${n}$`):new RegExp(n,"g"),a.v6=e=>e&&e.exact?new RegExp(`^${s}$`):new RegExp(s,"g")}}},{package:"chromedriver>tcp-port-used>is2>ip-regex"}],[4528,{buffer:2175,os:5443},function(){with(this)return function(){"use strict";return function(e,t,r){var n=r,i=e("buffer").Buffer,s=e("os");n.toBuffer=function(e,t,r){var n;if(r=~~r,this.isV4Format(e))n=t||new i(r+4),e.split(/\./g).map((function(e){n[r++]=255&parseInt(e,10)}));else if(this.isV6Format(e)){var s,a=e.split(":",8);for(s=0;s<a.length;s++){var o;this.isV4Format(a[s])&&(o=this.toBuffer(a[s]),a[s]=o.slice(0,2).toString("hex")),o&&++s<8&&a.splice(s,0,o.slice(2,4).toString("hex"))}if(""===a[0])for(;a.length<8;)a.unshift("0");else if(""===a[a.length-1])for(;a.length<8;)a.push("0");else if(a.length<8){for(s=0;s<a.length&&""!==a[s];s++);var c=[s,1];for(s=9-a.length;s>0;s--)c.push("0");a.splice.apply(a,c)}for(n=t||new i(r+16),s=0;s<a.length;s++){var u=parseInt(a[s],16);n[r++]=u>>8&255,n[r++]=255&u}}if(!n)throw Error("Invalid ip address: "+e);return n},n.toString=function(e,t,r){t=~~t;var n=[];if(4===(r=r||e.length-t)){for(var i=0;i<r;i++)n.push(e[t+i]);n=n.join(".")}else if(16===r){for(i=0;i<r;i+=2)n.push(e.readUInt16BE(t+i).toString(16));n=(n=(n=n.join(":")).replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3")).replace(/:{3,4}/,"::")}return n};var a=/^(\d{1,3}\.){3,3}\d{1,3}$/,o=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i;function c(e){return e?e.toLowerCase():"ipv4"}n.isV4Format=function(e){return a.test(e)},n.isV6Format=function(e){return o.test(e)},n.fromPrefixLen=function(e,t){var r=4;"ipv6"===(t=e>32?"ipv6":c(t))&&(r=16);for(var s=new i(r),a=0,o=s.length;a<o;++a){var u=8;e<8&&(u=e),e-=u,s[a]=255&~(255>>u)}return n.toString(s)},n.mask=function(e,t){e=n.toBuffer(e),t=n.toBuffer(t);var r=new i(Math.max(e.length,t.length)),s=0;if(e.length===t.length)for(s=0;s<e.length;s++)r[s]=e[s]&t[s];else if(4===t.length)for(s=0;s<t.length;s++)r[s]=e[e.length-4+s]&t[s];else{for(s=0;s<r.length-6;s++)r[s]=0;for(r[10]=255,r[11]=255,s=0;s<e.length;s++)r[s+12]=e[s]&t[s+12];s+=12}for(;s<r.length;s++)r[s]=0;return n.toString(r)},n.cidr=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error("invalid CIDR subnet: "+r);var i=n.fromPrefixLen(parseInt(t[1],10));return n.mask(r,i)},n.subnet=function(e,t){for(var r=n.toLong(n.mask(e,t)),i=n.toBuffer(t),s=0,a=0;a<i.length;a++)if(255===i[a])s+=8;else for(var o=255&i[a];o;)o=o<<1&255,s++;var c=Math.pow(2,32-s);return{networkAddress:n.fromLong(r),firstAddress:c<=2?n.fromLong(r):n.fromLong(r+1),lastAddress:c<=2?n.fromLong(r+c-1):n.fromLong(r+c-2),broadcastAddress:n.fromLong(r+c-1),subnetMask:t,subnetMaskLength:s,numHosts:c<=2?c:c-2,length:c,contains:function(e){return r===n.toLong(n.mask(e,t))}}},n.cidrSubnet=function(e){var t=e.split("/"),r=t[0];if(2!==t.length)throw new Error("invalid CIDR subnet: "+r);var i=n.fromPrefixLen(parseInt(t[1],10));return n.subnet(r,i)},n.not=function(e){for(var t=n.toBuffer(e),r=0;r<t.length;r++)t[r]=255^t[r];return n.toString(t)},n.or=function(e,t){if(e=n.toBuffer(e),t=n.toBuffer(t),e.length===t.length){for(var r=0;r<e.length;++r)e[r]|=t[r];return n.toString(e)}var i=e,s=t;t.length>e.length&&(i=t,s=e);var a=i.length-s.length;for(r=a;r<i.length;++r)i[r]|=s[r-a];return n.toString(i)},n.isEqual=function(e,t){if(e=n.toBuffer(e),t=n.toBuffer(t),e.length===t.length){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if(4===t.length){var i=t;t=e,e=i}for(r=0;r<10;r++)if(0!==t[r])return!1;var s=t.readUInt16BE(10);if(0!==s&&65535!==s)return!1;for(r=0;r<4;r++)if(e[r]!==t[r+12])return!1;return!0},n.isPrivate=function(e){return/^(::f{4}:)?10\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?192\.168\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?172\.(1[6-9]|2\d|30|31)\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^(::f{4}:)?169\.254\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^f[cd][0-9a-f]{2}:/i.test(e)||/^fe80:/i.test(e)||/^::1$/.test(e)||/^::$/.test(e)},n.isPublic=function(e){return!n.isPrivate(e)},n.isLoopback=function(e){return/^(::f{4}:)?127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})/.test(e)||/^fe80::1$/.test(e)||/^::1$/.test(e)||/^::$/.test(e)},n.loopback=function(e){if("ipv4"!==(e=c(e))&&"ipv6"!==e)throw new Error("family must be ipv4 or ipv6");return"ipv4"===e?"127.0.0.1":"fe80::1"},n.address=function(e,t){var r,i=s.networkInterfaces();if(t=c(t),e&&"private"!==e&&"public"!==e){var a=i[e].filter((function(e){return e.family.toLowerCase()===t}));return 0===a.length?undefined:a[0].address}return(r=Object.keys(i).map((function(r){var s=i[r].filter((function(r){return r.family=r.family.toLowerCase(),r.family===t&&!n.isLoopback(r.address)&&(!e||("public"===e?n.isPrivate(r.address):n.isPublic(r.address)))}));return s.length?s[0].address:undefined})).filter(Boolean)).length?r[0]:n.loopback(t)},n.toLong=function(e){var t=0;return e.split(".").forEach((function(e){t<<=8,t+=parseInt(e)})),t>>>0},n.fromLong=function(e){return(e>>>24)+"."+(e>>16&255)+"."+(e>>8&255)+"."+(255&e)}}}},{package:"react-devtools>ip"}],[4529,{},function(){with(this)return function(){"use strict";return function(e,t,r){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,s=Math.ceil,a=Math.floor,o="[BigNumber Error] ",c=o+"Number primitive has more than 15 significant digits: ",u=1e14,l=14,h=9007199254740991,f=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],d=1e7,p=1e9;function g(e){var t=0|e;return e>0||e===t?t:t-1}function m(e){for(var t,r,n=1,i=e.length,s=e[0]+"";n<i;){for(t=e[n++]+"",r=l-t.length;r--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function w(e,t){var r,n,i=e.c,s=t.c,a=e.s,o=t.s,c=e.e,u=t.e;if(!a||!o)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-o:a;if(a!=o)return a;if(r=a<0,n=c==u,!i||!s)return n?0:!i^r?1:-1;if(!n)return c>u^r?1:-1;for(o=(c=i.length)<(u=s.length)?c:u,a=0;a<o;a++)if(i[a]!=s[a])return i[a]>s[a]^r?1:-1;return c==u?0:c>u^r?1:-1}function _(e,t,r,n){if(e<t||e>r||e!==a(e))throw Error(o+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function y(e){var t=e.c.length-1;return g(e.e/l)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,E,S,x,T,k,A,P,I,N,R=V.prototype={constructor:V,toString:null,valueOf:null},O=new V(1),C=20,D=4,L=-7,B=21,M=-1e7,F=1e7,U=!1,G=1,j=0,z={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},H="0123456789abcdefghijklmnopqrstuvwxyz";function V(e,t){var r,i,s,o,u,f,d,p,g=this;if(!(g instanceof V))return new V(e,t);if(null==t){if(e&&!0===e._isBigNumber)return g.s=e.s,void(!e.c||e.e>F?g.c=g.e=null:e.e<M?g.c=[g.e=0]:(g.e=e.e,g.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(g.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,u=e;u>=10;u/=10,o++);return void(o>F?g.c=g.e=null:(g.e=o,g.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return S(g,p,f);g.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(o=p.indexOf("."))>-1&&(p=p.replace(".","")),(u=p.search(/e/i))>0?(o<0&&(o=u),o+=+p.slice(u+1),p=p.substring(0,u)):o<0&&(o=p.length)}else{if(_(t,2,H.length,"Base"),10==t)return K(g=new V(e),C+g.e+1,D);if(p=String(e),f="number"==typeof e){if(0*e!=0)return S(g,p,f,t);if(g.s=1/e<0?(p=p.slice(1),-1):1,V.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(c+e)}else g.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=H.slice(0,t),o=u=0,d=p.length;u<d;u++)if(r.indexOf(i=p.charAt(u))<0){if("."==i){if(u>o){o=d;continue}}else if(!s&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){s=!0,u=-1,o=0;continue}return S(g,String(e),f,t)}f=!1,(o=(p=E(p,t,10,g.s)).indexOf("."))>-1?p=p.replace(".",""):o=p.length}for(u=0;48===p.charCodeAt(u);u++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(u,++d)){if(d-=u,f&&V.DEBUG&&d>15&&(e>h||e!==a(e)))throw Error(c+g.s*e);if((o=o-u-1)>F)g.c=g.e=null;else if(o<M)g.c=[g.e=0];else{if(g.e=o,g.c=[],u=(o+1)%l,o<0&&(u+=l),u<d){for(u&&g.c.push(+p.slice(0,u)),d-=l;u<d;)g.c.push(+p.slice(u,u+=l));u=l-(p=p.slice(u)).length}else u-=d;for(;u--;p+="0");g.c.push(+p)}}else g.c=[g.e=0]}function $(e,t,r,n){var i,s,a,o,c;if(null==r?r=D:_(r,0,8),!e.c)return e.toString();if(i=e.c[0],a=e.e,null==t)c=m(e.c),c=1==n||2==n&&(a<=L||a>=B)?b(c,a):v(c,a,"0");else if(s=(e=K(new V(e),t,r)).e,o=(c=m(e.c)).length,1==n||2==n&&(t<=s||s<=L)){for(;o<t;c+="0",o++);c=b(c,s)}else if(t-=a,c=v(c,s,"0"),s+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-o)>0)for(s+1==o&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function q(e,t){for(var r,n=1,i=new V(e[0]);n<e.length;n++){if(!(r=new V(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function W(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+r*l-1)>F?e.c=e.e=null:r<M?e.c=[e.e=0]:(e.e=r,e.c=t),e}function K(e,t,r,n){var i,o,c,h,d,p,g,m=e.c,w=f;if(m){e:{for(i=1,h=m[0];h>=10;h/=10,i++);if((o=t-i)<0)o+=l,c=t,g=(d=m[p=0])/w[i-c-1]%10|0;else if((p=s((o+1)/l))>=m.length){if(!n)break e;for(;m.length<=p;m.push(0));d=g=0,i=1,c=(o%=l)-l+1}else{for(d=h=m[p],i=1;h>=10;h/=10,i++);g=(c=(o%=l)-l+i)<0?0:d/w[i-c-1]%10|0}if(n=n||t<0||null!=m[p+1]||(c<0?d:d%w[i-c-1]),n=r<4?(g||n)&&(0==r||r==(e.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(o>0?c>0?d/w[i-c]:0:m[p-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=w[(l-t%l)%l],e.e=-t||0):m[0]=e.e=0,e;if(0==o?(m.length=p,h=1,p--):(m.length=p+1,h=w[l-o],m[p]=c>0?a(d/w[i-c]%w[c])*h:0),n)for(;;){if(0==p){for(o=1,c=m[0];c>=10;c/=10,o++);for(c=m[0]+=h,h=1;c>=10;c/=10,h++);o!=h&&(e.e++,m[0]==u&&(m[0]=1));break}if(m[p]+=h,m[p]!=u)break;m[p--]=0,h=1}for(o=m.length;0===m[--o];m.pop());}e.e>F?e.c=e.e=null:e.e<M&&(e.c=[e.e=0])}return e}function Z(e){var t,r=e.e;return null===r?e.toString():(t=m(e.c),t=r<=L||r>=B?b(t,r):v(t,r,"0"),e.s<0?"-"+t:t)}return V.clone=e,V.ROUND_UP=0,V.ROUND_DOWN=1,V.ROUND_CEIL=2,V.ROUND_FLOOR=3,V.ROUND_HALF_UP=4,V.ROUND_HALF_DOWN=5,V.ROUND_HALF_EVEN=6,V.ROUND_HALF_CEIL=7,V.ROUND_HALF_FLOOR=8,V.EUCLID=9,V.config=V.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(o+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(_(r=e[t],0,p,t),C=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(_(r=e[t],0,8,t),D=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(_(r[0],-p,0,t),_(r[1],0,p,t),L=r[0],B=r[1]):(_(r,-p,p,t),L=-(B=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)_(r[0],-p,-1,t),_(r[1],1,p,t),M=r[0],F=r[1];else{if(_(r,-p,p,t),!r)throw Error(o+t+" cannot be zero: "+r);M=-(F=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(o+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw U=!r,Error(o+"crypto unavailable");U=r}else U=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(_(r=e[t],0,9,t),G=r),e.hasOwnProperty(t="POW_PRECISION")&&(_(r=e[t],0,p,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(o+t+" not an object: "+r);z=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.$|[+-.\s]|(.).*\1/.test(r))throw Error(o+t+" invalid: "+r);H=r}}return{DECIMAL_PLACES:C,ROUNDING_MODE:D,EXPONENTIAL_AT:[L,B],RANGE:[M,F],CRYPTO:U,MODULO_MODE:G,POW_PRECISION:j,FORMAT:z,ALPHABET:H}},V.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!V.DEBUG)return!0;var t,r,n=e.c,i=e.e,s=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===s||-1===s)&&i>=-p&&i<=p&&i===a(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%l)<1&&(t+=l),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=u||r!==a(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===s||1===s||-1===s))return!0;throw Error(o+"Invalid BigNumber: "+e)},V.maximum=V.max=function(){return q(arguments,R.lt)},V.minimum=V.min=function(){return q(arguments,R.gt)},V.random=(x=9007199254740992,T=Math.random()*x&2097151?function(){return a(Math.random()*x)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,i,c,u=0,h=[],d=new V(O);if(null==e?e=C:_(e,0,p),i=s(e/l),U)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(i*=2));u<i;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[u]=r[0],t[u+1]=r[1]):(h.push(c%1e14),u+=2);u=i/2}else{if(!crypto.randomBytes)throw U=!1,Error(o+"crypto unavailable");for(t=crypto.randomBytes(i*=7);u<i;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=i/7}if(!U)for(;u<i;)(c=T())<9e15&&(h[u++]=c%1e14);for(i=h[--u],e%=l,i&&e&&(c=f[l-e],h[u]=a(i/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[n=0];else{for(n=-1;0===h[0];h.splice(0,1),n-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(n-=l-u)}return d.e=n,d.c=h,d}),V.sum=function(){for(var e=1,t=arguments,r=new V(t[0]);e<t.length;)r=r.plus(t[e++]);return r},E=function(){var e="0123456789";function t(e,t,r,n){for(var i,s,a=[0],o=0,c=e.length;o<c;){for(s=a.length;s--;a[s]*=t);for(a[0]+=n.indexOf(e.charAt(o++)),i=0;i<a.length;i++)a[i]>r-1&&(null==a[i+1]&&(a[i+1]=0),a[i+1]+=a[i]/r|0,a[i]%=r)}return a.reverse()}return function(n,i,s,a,o){var c,u,l,h,f,d,p,g,w=n.indexOf("."),_=C,y=D;for(w>=0&&(h=j,j=0,n=n.replace(".",""),d=(g=new V(i)).pow(n.length-w),j=h,g.c=t(v(m(d.c),d.e,"0"),10,s,e),g.e=g.c.length),l=h=(p=t(n,i,s,o?(c=H,e):(c=e,H))).length;0==p[--h];p.pop());if(!p[0])return c.charAt(0);if(w<0?--l:(d.c=p,d.e=l,d.s=a,p=(d=r(d,g,_,y,s)).c,f=d.r,l=d.e),w=p[u=l+_+1],h=s/2,f=f||u<0||null!=p[u+1],f=y<4?(null!=w||f)&&(0==y||y==(d.s<0?3:2)):w>h||w==h&&(4==y||f||6==y&&1&p[u-1]||y==(d.s<0?8:7)),u<1||!p[0])n=f?v(c.charAt(1),-_,c.charAt(0)):c.charAt(0);else{if(p.length=u,f)for(--s;++p[--u]>s;)p[u]=0,u||(++l,p=[1].concat(p));for(h=p.length;!p[--h];);for(w=0,n="";w<=h;n+=c.charAt(p[w++]));n=v(n,l,c.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,i,s,a,o=0,c=e.length,u=t%d,l=t/d|0;for(e=e.slice();c--;)o=((i=u*(s=e[c]%d)+(n=l*s+(a=e[c]/d|0)*u)%d*d+o)/r|0)+(n/d|0)+l*a,e[c]=i%r;return o&&(e=[o].concat(e)),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,s,o,c){var h,f,d,p,m,w,_,y,b,v,E,S,x,T,k,A,P,I=n.s==i.s?1:-1,N=n.c,R=i.c;if(!(N&&N[0]&&R&&R[0]))return new V(n.s&&i.s&&(N?!R||N[0]!=R[0]:R)?N&&0==N[0]||!R?0*I:I/0:NaN);for(b=(y=new V(I)).c=[],I=s+(f=n.e-i.e)+1,c||(c=u,f=g(n.e/l)-g(i.e/l),I=I/l|0),d=0;R[d]==(N[d]||0);d++);if(R[d]>(N[d]||0)&&f--,I<0)b.push(1),p=!0;else{for(T=N.length,A=R.length,d=0,I+=2,(m=a(c/(R[0]+1)))>1&&(R=e(R,m,c),N=e(N,m,c),A=R.length,T=N.length),x=A,E=(v=N.slice(0,A)).length;E<A;v[E++]=0);P=R.slice(),P=[0].concat(P),k=R[0],R[1]>=c/2&&k++;do{if(m=0,(h=t(R,v,A,E))<0){if(S=v[0],A!=E&&(S=S*c+(v[1]||0)),(m=a(S/k))>1)for(m>=c&&(m=c-1),_=(w=e(R,m,c)).length,E=v.length;1==t(w,v,_,E);)m--,r(w,A<_?P:R,_,c),_=w.length,h=1;else 0==m&&(h=m=1),_=(w=R.slice()).length;if(_<E&&(w=[0].concat(w)),r(v,w,E,c),E=v.length,-1==h)for(;t(R,v,A,E)<1;)m++,r(v,A<E?P:R,E,c),E=v.length}else 0===h&&(m++,v=[0]);b[d++]=m,v[0]?v[E++]=N[x]||0:(v=[N[x]],E=1)}while((x++<T||null!=v[0])&&I--);p=null!=v[0],b[0]||b.splice(0,1)}if(c==u){for(d=1,I=b[0];I>=10;I/=10,d++);K(y,s+(y.e=d+f*l-1)+1,o,p)}else y.e=f,y.r=+p;return y}}(),k=/^(-?)0([xbo])(?=\w[\w.]*$)/i,A=/^([^.]+)\.$/,P=/^\.([^.]+)$/,I=/^-?(Infinity|NaN)$/,N=/^\s*\+(?=[\w.])|^\s+|\s+$/g,S=function(e,t,r,n){var i,s=r?t:t.replace(N,"");if(I.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(k,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,s=s.replace(A,"$1").replace(P,"0.$1")),t!=s))return new V(s,i);if(V.DEBUG)throw Error(o+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},R.absoluteValue=R.abs=function(){var e=new V(this);return e.s<0&&(e.s=1),e},R.comparedTo=function(e,t){return w(this,new V(e,t))},R.decimalPlaces=R.dp=function(e,t){var r,n,i,s=this;if(null!=e)return _(e,0,p),null==t?t=D:_(t,0,8),K(new V(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((i=r.length-1)-g(this.e/l))*l,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},R.dividedBy=R.div=function(e,t){return r(this,new V(e,t),C,D)},R.dividedToIntegerBy=R.idiv=function(e,t){return r(this,new V(e,t),0,1)},R.exponentiatedBy=R.pow=function(e,t){var r,n,i,c,u,h,f,d,p=this;if((e=new V(e)).c&&!e.isInteger())throw Error(o+"Exponent not an integer: "+Z(e));if(null!=t&&(t=new V(t)),u=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return d=new V(Math.pow(+Z(p),u?2-y(e):+Z(e))),t?d.mod(t):d;if(h=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new V(NaN);(n=!h&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||u&&p.c[1]>=24e7:p.c[0]<8e13||u&&p.c[0]<=9999975e7)))return c=p.s<0&&y(e)?-0:0,p.e>-1&&(c=1/c),new V(h?1/c:c);j&&(c=s(j/l+2))}for(u?(r=new V(.5),h&&(e.s=1),f=y(e)):f=(i=Math.abs(+Z(e)))%2,d=new V(O);;){if(f){if(!(d=d.times(p)).c)break;c?d.c.length>c&&(d.c.length=c):n&&(d=d.mod(t))}if(i){if(0===(i=a(i/2)))break;f=i%2}else if(K(e=e.times(r),e.e+1,1),e.e>14)f=y(e);else{if(0===(i=+Z(e)))break;f=i%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}return n?d:(h&&(d=O.div(d)),t?d.mod(t):c?K(d,j,D,undefined):d)},R.integerValue=function(e){var t=new V(this);return null==e?e=D:_(e,0,8),K(t,t.e+1,e)},R.isEqualTo=R.eq=function(e,t){return 0===w(this,new V(e,t))},R.isFinite=function(){return!!this.c},R.isGreaterThan=R.gt=function(e,t){return w(this,new V(e,t))>0},R.isGreaterThanOrEqualTo=R.gte=function(e,t){return 1===(t=w(this,new V(e,t)))||0===t},R.isInteger=function(){return!!this.c&&g(this.e/l)>this.c.length-2},R.isLessThan=R.lt=function(e,t){return w(this,new V(e,t))<0},R.isLessThanOrEqualTo=R.lte=function(e,t){return-1===(t=w(this,new V(e,t)))||0===t},R.isNaN=function(){return!this.s},R.isNegative=function(){return this.s<0},R.isPositive=function(){return this.s>0},R.isZero=function(){return!!this.c&&0==this.c[0]},R.minus=function(e,t){var r,n,i,s,a=this,o=a.s;if(t=(e=new V(e,t)).s,!o||!t)return new V(NaN);if(o!=t)return e.s=-t,a.plus(e);var c=a.e/l,h=e.e/l,f=a.c,d=e.c;if(!c||!h){if(!f||!d)return f?(e.s=-t,e):new V(d?a:NaN);if(!f[0]||!d[0])return d[0]?(e.s=-t,e):new V(f[0]?a:3==D?-0:0)}if(c=g(c),h=g(h),f=f.slice(),o=c-h){for((s=o<0)?(o=-o,i=f):(h=c,i=d),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(n=(s=(o=f.length)<(t=d.length))?o:t,o=t=0;t<n;t++)if(f[t]!=d[t]){s=f[t]<d[t];break}if(s&&(i=f,f=d,d=i,e.s=-e.s),(t=(n=d.length)-(r=f.length))>0)for(;t--;f[r++]=0);for(t=u-1;n>o;){if(f[--n]<d[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=u}f[n]-=d[n]}for(;0==f[0];f.splice(0,1),--h);return f[0]?W(e,f,h):(e.s=3==D?-1:1,e.c=[e.e=0],e)},R.modulo=R.mod=function(e,t){var n,i,s=this;return e=new V(e,t),!s.c||!e.s||e.c&&!e.c[0]?new V(NaN):!e.c||s.c&&!s.c[0]?new V(s):(9==G?(i=e.s,e.s=1,n=r(s,e,0,3),e.s=i,n.s*=i):n=r(s,e,0,G),(e=s.minus(n.times(e))).c[0]||1!=G||(e.s=s.s),e)},R.multipliedBy=R.times=function(e,t){var r,n,i,s,a,o,c,h,f,p,m,w,_,y,b,v=this,E=v.c,S=(e=new V(e,t)).c;if(!(E&&S&&E[0]&&S[0]))return!v.s||!e.s||E&&!E[0]&&!S||S&&!S[0]&&!E?e.c=e.e=e.s=null:(e.s*=v.s,E&&S?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=g(v.e/l)+g(e.e/l),e.s*=v.s,(c=E.length)<(p=S.length)&&(_=E,E=S,S=_,i=c,c=p,p=i),i=c+p,_=[];i--;_.push(0));for(y=u,b=d,i=p;--i>=0;){for(r=0,m=S[i]%b,w=S[i]/b|0,s=i+(a=c);s>i;)r=((h=m*(h=E[--a]%b)+(o=w*h+(f=E[a]/b|0)*m)%b*b+_[s]+r)/y|0)+(o/b|0)+w*f,_[s--]=h%y;_[s]=r}return r?++n:_.splice(0,1),W(e,_,n)},R.negated=function(){var e=new V(this);return e.s=-e.s||null,e},R.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new V(e,t)).s,!i||!t)return new V(NaN);if(i!=t)return e.s=-t,n.minus(e);var s=n.e/l,a=e.e/l,o=n.c,c=e.c;if(!s||!a){if(!o||!c)return new V(i/0);if(!o[0]||!c[0])return c[0]?e:new V(o[0]?n:0*i)}if(s=g(s),a=g(a),o=o.slice(),i=s-a){for(i>0?(a=s,r=c):(i=-i,r=o),r.reverse();i--;r.push(0));r.reverse()}for((i=o.length)-(t=c.length)<0&&(r=c,c=o,o=r,t=i),i=0;t;)i=(o[--t]=o[t]+c[t]+i)/u|0,o[t]=u===o[t]?0:o[t]%u;return i&&(o=[i].concat(o),++a),W(e,o,a)},R.precision=R.sd=function(e,t){var r,n,i,s=this;if(null!=e&&e!==!!e)return _(e,1,p),null==t?t=D:_(t,0,8),K(new V(s),e,t);if(!(r=s.c))return null;if(n=(i=r.length-1)*l+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},R.shiftedBy=function(e){return _(e,-9007199254740991,h),this.times("1e"+e)},R.squareRoot=R.sqrt=function(){var e,t,n,i,s,a=this,o=a.c,c=a.s,u=a.e,l=C+4,h=new V("0.5");if(1!==c||!o||!o[0])return new V(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+Z(a)))||c==1/0?(((t=m(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=g((u+1)/2)-(u<0||u%2),n=new V(t=c==1/0?"1e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):n=new V(c+""),n.c[0])for((c=(u=n.e)+l)<3&&(c=0);;)if(s=n,n=h.times(s.plus(r(a,s,l,1))),m(s.c).slice(0,c)===(t=m(n.c)).slice(0,c)){if(n.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(K(n,n.e+C+2,1),e=!n.times(n).eq(a));break}if(!i&&(K(s,s.e+C+2,0),s.times(s).eq(a))){n=s;break}l+=4,c+=4,i=1}return K(n,n.e+C+1,D,e)},R.toExponential=function(e,t){return null!=e&&(_(e,0,p),e++),$(this,e,t,1)},R.toFixed=function(e,t){return null!=e&&(_(e,0,p),e=e+this.e+1),$(this,e,t)},R.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=z;else if("object"!=typeof r)throw Error(o+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var s,a=n.split("."),c=+r.groupSize,u=+r.secondaryGroupSize,l=r.groupSeparator||"",h=a[0],f=a[1],d=i.s<0,p=d?h.slice(1):h,g=p.length;if(u&&(s=c,c=u,u=s,g-=s),c>0&&g>0){for(s=g%c||c,h=p.substr(0,s);s<g;s+=c)h+=l+p.substr(s,c);u>0&&(h+=l+p.slice(s)),d&&(h="-"+h)}n=f?h+(r.decimalSeparator||"")+((u=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):h}return(r.prefix||"")+n+(r.suffix||"")},R.toFraction=function(e){var t,n,i,s,a,c,u,h,d,p,g,w,_=this,y=_.c;if(null!=e&&(!(u=new V(e)).isInteger()&&(u.c||1!==u.s)||u.lt(O)))throw Error(o+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Z(u));if(!y)return new V(_);for(t=new V(O),d=n=new V(O),i=h=new V(O),w=m(y),a=t.e=w.length-_.e-1,t.c[0]=f[(c=a%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?a>0?t:d:u,c=F,F=1/0,u=new V(w),h.c[0]=0;p=r(u,t,0,1),1!=(s=n.plus(p.times(i))).comparedTo(e);)n=i,i=s,d=h.plus(p.times(s=d)),h=s,t=u.minus(p.times(s=t)),u=s;return s=r(e.minus(n),i,0,1),h=h.plus(s.times(d)),n=n.plus(s.times(i)),h.s=d.s=_.s,g=r(d,i,a*=2,D).minus(_).abs().comparedTo(r(h,n,a,D).minus(_).abs())<1?[d,i]:[h,n],F=c,g},R.toNumber=function(){return+Z(this)},R.toPrecision=function(e,t){return null!=e&&_(e,1,p),$(this,e,t,2)},R.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=L||i>=B?b(m(r.c),i):v(m(r.c),i,"0"):10===e?t=v(m((r=K(new V(r),C+i+1,D)).c),r.e,"0"):(_(e,2,H.length,"Base"),t=E(v(m(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},R.valueOf=R.toJSON=function(){return Z(this)},R._isBigNumber=!0,i&&(R[Symbol.toStringTag]="BigNumber",R[Symbol.for("nodejs.util.inspect.custom")]=R.valueOf),null!=t&&V.set(t),V}(),r.default=r.BigNumber=r,"function"==typeof define&&define.amd?define((function(){return r})):void 0!==t&&t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(this)}}},{package:"3box>ipfs>ipfs-bitswap>bignumber.js"}],[4530,{"./utils":4534,blakejs:2128,buffer:2175},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("blakejs"),i=e("./utils").toCallback,s={init:n.blake2bInit,update:n.blake2bUpdate,digest:n.blake2bFinal},a={init:n.blake2sInit,update:n.blake2sUpdate,digest:n.blake2sFinal},o=(e,t)=>i((n=>{const i=t.init(e,null);return t.update(i,n),r.from(t.digest(i))}));t.exports=e=>{for(let t=0;t<64;t++)e[45569+t]=o(t+1,s);for(let t=0;t<32;t++)e[45633+t]=o(t+1,a)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-bitswap>multihashing-async"}],[4531,{buffer:2175,nodeify:5380},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("nodeify"),i=function(){if(self.crypto)return self.crypto.subtle||self.crypto.webkitSubtle;if(self.msCrypto)return self.msCrypto.subtle}();function s(e){if(!i)throw new Error("Please use a browser with webcrypto support and ensure the code has been delivered securely via HTTPS/TLS and run within a Secure Context");return(t,s)=>{const a=i.digest({name:e},t);if("function"!=typeof a.then)return a.onerror=()=>{s(new Error(`hashing data using ${e}`))},void(a.oncomplete=e=>{s(null,e.target.result)});n(a.then((e=>r.from(new Uint8Array(e)))),s)}}t.exports={sha1:function(e,t){s("SHA-1")(e,t)},sha2256:function(e,t){s("SHA-256")(e,t)},sha2512:function(e,t){s("SHA-512")(e,t)}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-bitswap>multihashing-async"}],[4532,{"./blake":4530,"./crypto-sha1-2":4531,"./utils":4534,buffer:2175,"js-sha3":4829,murmurhash3js:5340},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("js-sha3"),i=e("murmurhash3js"),s=e("./utils"),a=e("./crypto-sha1-2"),o=s.toCallback,c=s.toBuf,u=s.fromString,l=s.fromNumberTo32BitBuf;t.exports={sha1:a.sha1,sha2256:a.sha2256,sha2512:a.sha2512,sha3512:o(c(n.sha3_512)),sha3384:o(c(n.sha3_384)),sha3256:o(c(n.sha3_256)),sha3224:o(c(n.sha3_224)),shake128:o(c(n.shake_128,128)),shake256:o(c(n.shake_256,256)),keccak224:o(c(n.keccak_224)),keccak256:o(c(n.keccak_256)),keccak384:o(c(n.keccak_384)),keccak512:o(c(n.keccak_512)),murmur3128:o(c(u(i.x64.hash128))),murmur332:o(l(u(i.x86.hash32))),addBlake:e("./blake"),dblSha2256:(e,t)=>{a.sha2256(e,((e,n)=>{e&&t(e),a.sha2256(r.from(n),t)}))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-bitswap>multihashing-async"}],[4533,{"./crypto":4532,buffer:2175,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("multihashes"),i=e("./crypto");function s(e,t,r,i){if("function"==typeof r&&(i=r,r=undefined),!i)throw new Error("Missing callback");s.digest(e,t,r,((e,s)=>{if(e)return i(e);i(null,n.encode(s,t,r))}))}t.exports=s,s.Buffer=r,s.multihash=n,s.digest=function(e,t,r,n){if("function"==typeof r&&(n=r,r=undefined),!n)throw new Error("Missing callback");let i,a=n;r&&(a=(e,t)=>{if(e)return n(e);n(null,t.slice(0,r))});try{i=s.createHash(t)}catch(e){return a(e)}i(e,a)},s.createHash=function(e){if(e=n.coerceCode(e),!s.functions[e])throw new Error("multihash function "+e+" not yet supported");return s.functions[e]},s.functions={17:i.sha1,18:i.sha2256,19:i.sha2512,20:i.sha3512,21:i.sha3384,22:i.sha3256,23:i.sha3224,24:i.shake128,25:i.shake256,26:i.keccak224,27:i.keccak256,28:i.keccak384,29:i.keccak512,34:i.murmur3128,35:i.murmur332,86:i.dblSha2256},i.addBlake(s.functions)}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-bitswap>multihashing-async"}],[4534,{_process:5500,buffer:2175},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e,t){(function(){r.toCallback=t=>function(r,n){let i;try{i=t(r)}catch(t){return void e.nextTick(n,t)}e.nextTick(n,null,i)},r.toBuf=(e,r)=>n=>{let i=e(n,r);return t.from(i,"hex")},r.fromString=(e,r)=>n=>{const i=t.isBuffer(n)?n.toString():n;return e(i,r)},r.fromNumberTo32BitBuf=(e,r)=>n=>{let i=e(n,r);const s=new Array(4);for(let e=0;e<4;e++)s[e]=255&i,i>>=8;return t.from(s)}}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-bitswap>multihashing-async"}],[4535,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={maxProvidersPerRequest:3,providerRequestTimeout:1e4,hasBlockTimeout:15e3,provideTimeout:15e3,kMaxPriority:Math.pow(2,31)-1,rebroadcastDelay:1e4,maxListeners:1e3}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4536,{"../types/message":4544,"../types/wantlist":4547,"../utils":4548,"./ledger":4537,"async/each":1836,"async/eachSeries":1841,"async/map":1867,"async/nextTick":1870,"async/waterfall":1882,"just-debounce-it":4861},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("async/each"),i=e("async/eachSeries"),s=e("async/waterfall"),a=e("async/nextTick"),o=e("async/map"),c=e("just-debounce-it"),u=e("../types/message"),l=e("../types/wantlist"),h=e("./ledger"),{logger:f,groupBy:d,pullAllWith:p,uniqWith:g}=e("../utils"),m=524288;t.exports=class{constructor(e,t,r,n){this._log=f(e,"engine"),this.blockstore=t,this.network=r,this._stats=n,this.ledgerMap=new Map,this._running=!1,this._tasks=[],this._outbox=c(this._processTasks.bind(this),100)}_sendBlocks(e,t,r){if(t.reduce(((e,t)=>e+t.data.byteLength),0)<m)return this._sendSafeBlocks(e,t,r);let n=0,s=[],o=t.length;i(t,((t,r)=>{if(o--,s.push(t),n+=t.data.byteLength,n>=m||0===o){n=0;const t=s.slice();s=[],this._sendSafeBlocks(e,t,(e=>{e&&this._log("sendblock error: %s",e.message),r()}))}else a(r)}),r)}_sendSafeBlocks(e,t,r){const n=new u(!1);t.forEach((e=>n.addBlock(e))),this.network.sendMessage(e,n,r)}_processTasks(){if(!this._running||!this._tasks.length)return;const e=this._tasks;this._tasks=[];const t=e.map((e=>e.entry)).map((e=>e.cid)),r=g(((e,t)=>e.equals(t)),t),i=d((e=>e.target.toB58String()),e);s([e=>o(r,((e,t)=>{this.blockstore.get(e,t)}),e),(e,r)=>n(Object.values(i),((r,n)=>{const i=r[0].target,s=t.map((t=>e.find((e=>e.cid.equals(t)))));this._sendBlocks(i,s,(e=>{e?this._log.error("should never happen: ",e):s.forEach((e=>this.messageSent(i,e))),n()}))}),r)],(e=>{this._tasks=[],e&&this._log.error(e)}))}wantlistForPeer(e){const t=e.toB58String();return this.ledgerMap.has(t)?this.ledgerMap.get(t).wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toB58String(),r=this.ledgerMap.get(t);return r?{peer:r.partner.toPrint(),value:r.debtRatio(),sent:r.accounting.bytesSent,recv:r.accounting.bytesRecv,exchanged:r.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){e.length&&(this.ledgerMap.forEach((t=>{e.map((e=>t.wantlistContains(e))).filter(Boolean).forEach((e=>{this._tasks.push({entry:e,target:t.partner})}))})),this._outbox())}messageReceived(e,t,r){const n=this._findOrCreate(e);if(t.empty)return a(r);if(t.full&&(n.wantlist=new l),this._processBlocks(t.blocks,n),0===t.wantlist.size)return a(r);let i=[],s=[];t.wantlist.forEach((e=>{e.cancel?(n.cancelWant(e.cid),i.push(e)):(n.wants(e.cid,e.priority),s.push(e))})),this._cancelWants(n,e,i),this._addWants(n,e,s,r)}_cancelWants(e,t,r){const n=t.toB58String();this._tasks=p(((e,t)=>{const r=e.target.toB58String()===n,i=e.entry.cid.equals(t.cid);return r&&i}),this._tasks,r)}_addWants(e,t,r,i){n(r,((e,r)=>{this.blockstore.has(e.cid,((n,i)=>{n?this._log.error("failed existence check"):i&&this._tasks.push({entry:e.entry,target:t}),r()}))}),(()=>{this._outbox(),i()}))}_processBlocks(e,t,r){const n=[];e.forEach(((e,r)=>{this._log("got block (%s bytes)",e.data.length),t.receivedBytes(e.data.length),n.push(e.cid)})),this.receivedBlocks(n)}messageSent(e,t){const r=this._findOrCreate(e);r.sentBytes(t?t.data.length:0),t&&t.cid&&r.wantlist.remove(t.cid)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){}_findOrCreate(e){const t=e.toB58String();if(this.ledgerMap.has(t))return this.ledgerMap.get(t);const r=new h(e);return this.ledgerMap.set(t,r),this._stats&&this._stats.push(t,"peerCount",1),r}start(e){this._running=!0,a((()=>e()))}stop(e){this._running=!1,a((()=>e()))}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4537,{"../types/wantlist":4547},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("../types/wantlist");t.exports=class{constructor(e){this.partner=e,this.wantlist=new n,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t){this.wantlist.add(e,t)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.contains(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4538,{"./decision-engine":4536,"./network":4539,"./notifications":4540,"./stats":4541,"./utils":4548,"./want-manager":4549,"async/each":1836,"async/map":1867,"async/nextTick":1870,"async/reject":1873,"async/series":1875,"async/waterfall":1882},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("async/waterfall"),i=e("async/reject"),s=e("async/each"),a=e("async/series"),o=e("async/map"),c=e("async/nextTick"),u=e("./want-manager"),l=e("./network"),h=e("./decision-engine"),f=e("./notifications"),d=e("./utils").logger,p=e("./stats"),g={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},m=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];t.exports=class{constructor(e,t,r){this._libp2p=e,this._log=d(this.peerInfo.id),this._options=Object.assign({},g,r),this._stats=new p(m,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new l(e,this,{},this._stats),this.blockstore=t,this.engine=new h(this.peerInfo.id,t,this.network,this._stats),this.wm=new u(this.peerInfo.id,this.network,this._stats),this.notifications=new f(this.peerInfo.id)}get peerInfo(){return this._libp2p.peerInfo}_receiveMessage(e,t,r){this.engine.messageReceived(e,t,(n=>{if(n&&this._log("failed to receive message",t),0===t.blocks.size)return r();const i=Array.from(t.blocks.values()),a=i.filter((e=>this.wm.wantlist.contains(e.cid))).map((e=>e.cid));this.wm.cancelWants(a),s(i,((t,r)=>{const n=a.includes(t.cid);this._handleReceivedBlock(e,t,n,r)}),r)}))}_handleReceivedBlock(e,t,r,i){this._log("received block"),n([e=>this.blockstore.has(t.cid,e),(n,i)=>{if(this._updateReceiveCounters(e.toB58String(),t,n),n||!r)return c(i);this._putBlock(t,i)}],i)}_updateReceiveCounters(e,t,r){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",t.data.length),r&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",t.data.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}_putBlock(e,t){this.blockstore.put(e,(r=>{if(r)return t(r);this.notifications.hasBlock(e),this.network.provide(e.cid,(e=>{e&&this._log.error("Failed to provide: %s",e.message)})),this.engine.receivedBlocks([e.cid]),t()}))}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}get(e,t){this.getMany([e],((e,r)=>{if(e)return t(e);r&&r.length>0?t(null,r[0]):t()}))}getMany(e,t){let r=e.length;const i=[];let s=!1;const a=(e,t)=>{i.push(e),this.notifications.wantBlock(e,(r=>{this.wm.cancelWants([e]),t(null,r)}),(()=>{this.wm.cancelWants([e]),t(null,undefined)})),r||this.wm.wantBlocks(i)};o(e,((t,o)=>{n([e=>this.blockstore.has(t,e),(n,o)=>{if(r--,n)return r||this.wm.wantBlocks(i),this.blockstore.get(t,o);s||(s=!0,this.network.findAndConnect(e[0],(e=>{e&&this._log.error(e)}))),a(t,o)}],o)}),t)}unwant(e){Array.isArray(e)||(e=[e]),this.wm.unwantBlocks(e),e.forEach((e=>this.notifications.unwantBlock(e)))}cancelWants(e){Array.isArray(e)||(e=[e]),this.wm.cancelWants(e)}put(e,t){this._log("putting block"),n([t=>this.blockstore.has(e.cid,t),(t,r)=>{if(t)return c(r);this._putBlock(e,r)}],t)}putMany(e,t){n([t=>i(e,((e,t)=>{this.blockstore.has(e.cid,t)}),t),(e,t)=>this.blockstore.putMany(e,(r=>{if(r)return t(r);e.forEach((e=>{this.notifications.hasBlock(e),this.engine.receivedBlocks([e.cid]),this.network.provide(e.cid,(e=>{e&&this._log.error("Failed to provide: %s",e.message)}))})),t()}))],t)}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}start(e){a([e=>this.wm.start(e),e=>this.network.start(e),e=>this.engine.start(e)],e)}stop(e){this._stats.stop(),a([e=>this.wm.stop(e),e=>this.network.stop(e),e=>this.engine.stop(e)],e)}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4539,{"./constants":4535,"./types/message":4544,"./utils":4548,"async/each":1836,"async/nextTick":1870,"async/waterfall":1882,"pull-length-prefixed":5539,"pull-stream":5557},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("pull-length-prefixed"),i=e("pull-stream"),s=e("async/waterfall"),a=e("async/each"),o=e("async/nextTick"),c=e("./types/message"),u=e("./constants"),l=e("./utils").logger,h="/ipfs/bitswap/1.0.0",f="/ipfs/bitswap/1.1.0";t.exports=class{constructor(e,t,r,n){this._log=l(e.peerInfo.id,"network"),r=r||{},this.libp2p=e,this.bitswap=t,this.b100Only=r.b100Only||!1,this._stats=n,this._running=!1}start(e){this._running=!0,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this.libp2p.handle(h,this._onConnection),this.b100Only||this.libp2p.handle(f,this._onConnection),this.libp2p.on("peer:connect",this._onPeerConnect),this.libp2p.on("peer:disconnect",this._onPeerDisconnect),this.libp2p.peerBook.getAllArray().filter((e=>e.isConnected())).forEach((e=>this._onPeerConnect(e))),o((()=>e()))}stop(e){this._running=!1,this.libp2p.unhandle(h),this.b100Only||this.libp2p.unhandle(f),this.libp2p.removeListener("peer:connect",this._onPeerConnect),this.libp2p.removeListener("peer:disconnect",this._onPeerDisconnect),o((()=>e()))}_onConnection(e,t){this._running&&(this._log("incomming new bitswap connection: %s",e),i(t,n.decode(),i.asyncMap(((e,t)=>c.deserialize(e,t))),i.asyncMap(((e,r)=>{t.getPeerInfo(((t,n)=>{if(t)return r(t);this.bitswap._receiveMessage(n.id,e,r)}))})),i.onEnd((e=>{this._log("ending connection"),e&&this.bitswap._receiveError(e)}))))}_onPeerConnect(e){this._running&&this.bitswap._onPeerConnected(e.id)}_onPeerDisconnect(e){this._running&&this.bitswap._onPeerDisconnected(e.id)}findProviders(e,t,r){this.libp2p.contentRouting.findProviders(e,{maxTimeout:u.providerRequestTimeout,maxNumProviders:t},r)}findAndConnect(e,t){s([t=>this.findProviders(e,u.maxProvidersPerRequest,t),(e,t)=>{this._log("connecting to providers",e.map((e=>e.id.toB58String()))),a(e,((e,t)=>this.connectTo(e,t)))}],t)}provide(e,t){this.libp2p.contentRouting.provide(e,t)}sendMessage(e,t,r){if(!this._running)return r(new Error("network isn't running"));const s=e.toB58String()?e.toB58String():e.id.toB58String();this._log("sendMessage to %s",s,t),this._dialPeer(e,((s,a,o)=>{if(s)return r(s);let c;switch(o){case h:c=t.serializeToBitswap100();break;case f:c=t.serializeToBitswap110();break;default:return r(new Error("Unkown protocol: "+o))}!function(e,t,r){i(i.values([t]),n.encode(),e,i.onEnd(r))}(a,c,(e=>{e&&this._log.error(e)})),r(),this._updateSentStats(e,t.blocks)}))}connectTo(e,t){if(!this._running)return t(new Error("network isn't running"));this.libp2p.dial(e,t)}_dialPeer(e,t){this.libp2p.dialProtocol(e,f,((r,n)=>{r?this.libp2p.dialProtocol(e,h,((e,r)=>{if(e)return t(e);t(null,r,h)})):t(null,n,f)}))}_updateSentStats(e,t){const r=e.toB58String();this._stats&&(t.forEach((e=>this._stats.push(r,"dataSent",e.data.length))),this._stats.push(r,"blocksSent",t.size))}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4540,{"./constants":4535,"./utils":4548,events:2176},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events").EventEmitter,i=e("./constants"),s=e("./utils").logger,a=e=>`unwant:${e}`,o=e=>`block:${e}`;t.exports=class extends n{constructor(e){super(),this.setMaxListeners(i.maxListeners),this._log=s(e,"notif"),this._unwantListeners={},this._blockListeners={}}hasBlock(e){const t=`block:${e.cid.buffer.toString()}`;this._log(t),this.emit(t,e)}wantBlock(e,t,r){const n=e.buffer.toString();this._log(`wantBlock:${n}`),this._unwantListeners[n]=()=>{this._log(`manual unwant: ${n}`),this._cleanup(n),r()},this._blockListeners[n]=e=>{this._cleanup(n),t(e)},this.once(a(n),this._unwantListeners[n]),this.once(o(n),this._blockListeners[n])}unwantBlock(e){const t=`unwant:${e.buffer.toString()}`;this._log(t),this.emit(t)}_cleanup(e){this._unwantListeners[e]&&(this.removeListener(a(e),this._unwantListeners[e]),delete this._unwantListeners[e]),this._blockListeners[e]&&(this.removeListener(o(e),this._blockListeners[e]),delete this._blockListeners[e])}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4541,{"./stat":4542,events:2176},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events"),i=e("./stat"),s={movingAverageIntervals:[6e4,3e5,9e5]};t.exports=class extends n{constructor(e,t){super();const r=Object.assign({},s,t);if("number"!=typeof r.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!=typeof r.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=e,this._options=r,this._enabled=this._options.enabled,this._global=new i(e,r),this._global.on("update",(e=>this.emit("update",e))),this._peers=new Map}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){return e.toB58String&&(e=e.toB58String()),this._peers.get(e)}push(e,t,r){if(this._enabled&&(this._global.push(t,r),e)){let n=this._peers.get(e);n||(n=new i(this._initialCounters,this._options),this._peers.set(e,n)),n.push(t,r)}}disconnected(e){const t=e.toB58String(),r=this._peers.get(t);r&&(r.stop(),this._peers.delete(t))}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4542,{"bignumber.js":4529,events:2176,"moving-average":5289},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events"),i=e("bignumber.js"),s=e("moving-average");t.exports=class extends n{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=i(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{(this._movingAverages[e][t]=s(t)).push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){const t=e=this._queue.shift();this._applyOp(t)}this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach((r=>{this._updateFrequencyFor(r,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=n/t*1e3;let a=this._movingAverages[e];a||(a=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=a[e];t||(t=a[e]=s(e)),t.push(r,i)}))}_applyOp(e){const t=e[0],r=e[1];if("number"!=typeof r)throw new Error("invalid increment number:",r);let n;n=this._stats.hasOwnProperty(t)?this._stats[t]:this._stats[t]=i(0),this._stats[t]=n.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4543,{"../wantlist":4547,assert:1803,cids:2212},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("../wantlist").Entry,i=e("cids"),s=e("assert");t.exports=class{constructor(e,t,r){s(i.isCID(e),"needs valid cid"),this.entry=new n(e,t),this.cancel=Boolean(r)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toBaseEncodedString()} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.entry.equals(e.entry)}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4544,{"./entry":4543,"./message.proto":4545,assert:1803,"async/each":1836,"async/nextTick":1870,cids:2212,"ipfs-block":4552,"lodash.isequalwith":5076,"multicodec/src/name-table":5306,"multihashing-async":4533,protons:5520,"varint-decoder":6115},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("protons"),i=e("ipfs-block"),s=e("lodash.isequalwith"),a=e("assert"),o=e("async/each"),c=e("async/nextTick"),u=e("cids"),l=e("multicodec/src/name-table"),h=e("varint-decoder"),f=e("multihashing-async"),d=n(e("./message.proto")),p=e("./entry");class g{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map}get empty(){return 0===this.blocks.size&&0===this.wantlist.size}addEntry(e,t,r){a(e&&u.isCID(e),"must be a valid cid");const n=e.buffer.toString(),i=this.wantlist.get(n);i?(i.priority=t,i.cancel=Boolean(r)):this.wantlist.set(n,new p(e,t,r))}addBlock(e){a(i.isBlock(e),"must be a valid cid");const t=e.cid.buffer.toString();this.blocks.set(t,e)}cancel(e){a(u.isCID(e),"must be a valid cid");const t=e.buffer.toString();this.wantlist.delete(t),this.addEntry(e,0,!0)}serializeToBitswap100(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.buffer,priority:Number(e.priority),cancel:Boolean(e.cancel)})))},blocks:Array.from(this.blocks.values()).map((e=>e.data))};return this.full&&(e.wantlist.full=!0),d.Message.encode(e)}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.buffer,priority:Number(e.priority),cancel:Boolean(e.cancel)})))},payload:[]};return this.full&&(e.wantlist.full=!0),this.blocks.forEach((t=>{e.payload.push({prefix:t.cid.prefix,data:t.data})})),d.Message.encode(e)}equals(e){const t=(e,t)=>{if(e.equals&&"function"==typeof e.equals)return e.equals(t)};return!(this.full!==e.full||!s(this.wantlist,e.wantlist,t)||!s(this.blocks,e.blocks,t))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}g.deserialize=(e,t)=>{let r;try{r=d.Message.decode(e)}catch(e){return c((()=>t(e)))}const n=r.wantlist&&r.wantlist.full||!1,s=new g(n);return r.wantlist&&r.wantlist.entries.forEach((e=>{let r;try{r=new u(e.block)}catch(e){return t(e)}s.addEntry(r,e.priority,e.cancel)})),r.blocks.length>0?o(r.blocks,((e,r)=>{f(e,"sha2-256",((n,a)=>{if(n)return r(n);let o;try{o=new u(a)}catch(n){return t(n)}s.addBlock(new i(e,o)),r()}))}),(e=>{if(e)return t(e);t(null,s)})):r.payload.length>0?o(r.payload,((e,t)=>{if(!e.prefix||!e.data)return c(t);const r=h(e.prefix),n=r[0],a=r[1],o=r[2];f(e.data,o,((r,o)=>{if(r)return t(r);let c;try{c=new u(n,l[a.toString("16")],o)}catch(r){return t(r)}s.addBlock(new i(e.data,c)),t()}))}),(e=>{if(e)return t(e);t(null,s)})):void t(null,s)},g.Entry=p,t.exports=g}}},{package:"3box>ipfs>ipfs-bitswap"}],[4545,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports="\n  message Message {\n    message Wantlist {\n      message Entry {\n        // changed from string to bytes, it makes a difference in JavaScript\n        optional bytes block = 1;      // the block cid (cidV0 in bitswap 1.0.0, cidV1 in bitswap 1.1.0)\n        optional int32 priority = 2;    // the priority (normalized). default to 1\n        optional bool cancel = 3;       // whether this revokes an entry\n      }\n\n      repeated Entry entries = 1;       // a list of wantlist entries\n      optional bool full = 2;           // whether this is the full wantlist. default to false\n    }\n\n    message Block {\n      optional bytes prefix = 1;        // CID prefix (cid version, multicodec and multihash prefix (type + length)\n      optional bytes data = 2;\n    }\n\n    optional Wantlist wantlist = 1;\n    repeated bytes blocks = 2;          // used to send Blocks in bitswap 1.0.0\n    repeated Block payload = 3;         // used to send Blocks in bitswap 1.1.0\n  }\n"}}},{package:"3box>ipfs>ipfs-bitswap"}],[4546,{assert:1803,cids:2212},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("assert"),i=e("cids");class s{constructor(e,t){n(i.isCID(e),"must be valid CID"),this._refCounter=1,this.cid=e,this.priority=t||1}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toBaseEncodedString()}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority}}t.exports=s}}},{package:"3box>ipfs>ipfs-bitswap"}],[4547,{"../../utils":4548,"./entry":4546},function(){with(this)return function(){"use strict";return function(e,t,r){const{sortBy:n}=e("../../utils"),i=e("./entry");class s{constructor(e){this.set=new Map,this._stats=e}get length(){return this.set.size}add(e,t){const r=e.buffer.toString(),n=this.set.get(r);n?(n.inc(),n.priority=t):(this.set.set(r,new i(e,t)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){const t=e.buffer.toString(),r=this.set.get(t);r&&(r.dec(),r.hasRefs()||(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(n((e=>e[1].key),Array.from(this.set.entries())))}contains(e){const t=e.buffer.toString();return this.set.get(t)}}s.Entry=i,t.exports=s}}},{package:"3box>ipfs>ipfs-bitswap"}],[4548,{debug:2347},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("debug"),i=(e,t,r)=>{let n=0;const i=r.length;for(;n<i;){if(e(t,r[n]))return!0;n+=1}return!1};t.exports={logger:(e,t)=>{const r=["bitswap"];t&&r.push(t),e&&r.push(`${e.toB58String().slice(0,8)}`);const i=n(r.join(":"));return i.error=n(r.concat(["error"]).join(":")),i},includesWith:i,uniqWith:(e,t)=>{let r=0;const n=t.length,s=[];let a;for(;r<n;)a=t[r],i(e,a,s)||(s[s.length]=a),r+=1;return s},groupBy:(e,t)=>t.reduce(((t,r)=>{const n=e(r);return t[n]?t[n].push(r):t[n]=[r],t}),{}),pullAllWith:(e,t,r)=>t.filter((t=>!i(e,t,r))),sortBy:(e,t)=>Array.prototype.slice.call(t,0).sort(((t,r)=>{const n=e(t),i=e(r);return n<i?-1:n>i?1:0}))}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4549,{"../constants":4535,"../types/message":4544,"../types/wantlist":4547,"../utils":4548,"./msg-queue":4550,"async/nextTick":1870},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("async/nextTick"),i=e("../types/message"),s=e("../types/wantlist"),a=e("../constants"),o=e("./msg-queue"),c=e("../utils").logger;t.exports=class{constructor(e,t,r){this.peers=new Map,this.wantlist=new s(r),this.network=t,this._stats=r,this._peerId=e,this._log=c(e,"want")}_addEntries(e,t,r){const n=e.map(((e,r)=>new i.Entry(e,a.kMaxPriority-r,t)));n.forEach((e=>{e.cancel?r?this.wantlist.removeForce(e.cid):this.wantlist.remove(e.cid):(this._log("adding to wl"),this.wantlist.add(e.cid,e.priority))}));for(let e of this.peers.values())e.addEntries(n)}_startPeerHandler(e){let t=this.peers.get(e.toB58String());if(t)return void t.refcnt++;t=new o(this._peerId,e,this.network);const r=new i(!0);for(let e of this.wantlist.entries())r.addEntry(e[1].cid,e[1].priority);return t.addMessage(r),this.peers.set(e.toB58String(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toB58String());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toB58String()))}wantBlocks(e){this._addEntries(e,!1)}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(e){this.timer=setInterval((()=>{this._log("resend full-wantlist");const e=new i(!0);this.wantlist.forEach((t=>{e.addEntry(t.cid,t.priority)})),this.peers.forEach((t=>t.addMessage(e)))}),6e4),n((()=>e()))}stop(e){this.peers.forEach((e=>this.disconnected(e.peerId))),clearInterval(this.timer),n((()=>e()))}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4550,{"../types/message":4544,"../utils":4548,"just-debounce-it":4861},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("just-debounce-it"),i=e("../types/message"),s=e("../utils").logger;t.exports=class{constructor(e,t,r){this.peerId=t,this.network=r,this.refcnt=1,this._entries=[],this._log=s(e,"msgqueue",t.toB58String().slice(0,8)),this.sendEntries=n(this._sendEntries.bind(this),200)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new i(!1);this._entries.forEach((t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)})),this._entries=[],this.addMessage(e)}send(e){this.network.connectTo(this.peerId,(t=>{t?this._log.error("cant connect to peer %s: %s",this.peerId.toB58String(),t.message):(this._log("sending message"),this.network.sendMessage(this.peerId,e,(e=>{e&&this._log.error("send error: %s",e.message)})))}))}}}}},{package:"3box>ipfs>ipfs-bitswap"}],[4551,{"async/map":1867},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("async/map");t.exports=class{constructor(e){this._repo=e,this._bitswap=null}setExchange(e){this._bitswap=e}unsetExchange(){this._bitswap=null}hasExchange(){return null!=this._bitswap}put(e,t){this.hasExchange()?this._bitswap.put(e,t):this._repo.blocks.put(e,t)}putMany(e,t){this.hasExchange()?this._bitswap.putMany(e,t):this._repo.blocks.putMany(e,t)}get(e,t){this.hasExchange()?this._bitswap.get(e,t):this._repo.blocks.get(e,t)}getMany(e,t){Array.isArray(e)?this.hasExchange()?this._bitswap.getMany(e,t):n(e,((e,t)=>this._repo.blocks.get(e,t)),t):t(new Error("first arg must be an array of cids"))}delete(e,t){this._repo.blocks.delete(e,t)}}}}},{package:"3box>ipfs>ipfs-block-service"}],[4552,{"../../is-buffer/index.js":4797,cids:2212,"class-is":2214},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("cids"),i=e("class-is");t.exports=i(class{constructor(e,t){if(!e||!r.isBuffer(e))throw new Error("first argument  must be a buffer");if(!t||!n.isCID(t))throw new Error("second argument must be a CID");this._data=e,this._cid=t}get data(){return this._data}set data(e){throw new Error("Tried to change an immutable block")}get cid(){return this._cid}set cid(e){throw new Error("Tried to change an immutable block")}},{className:"Block",symbolName:"@ipfs/js-ipfs-block/block"})}).call(this)}).call(this,{isBuffer:e("../../is-buffer/index.js")})}}},{package:"3box>ipfs>ipfs-block"}],[4553,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="GENESIS";class i{constructor(e,t){this._ipfs=e,this._content={id:`did:${t}:GENESIS`}}get DID(){if(this._content.id.includes(n))throw new Error("DID is not available before commit");return this._content.id}static async load(e,t){const r=new i(e);return r._content=await i.cidToDocument(e,t),r._content.previousDocument={"/":t.toString()},r}addPublicKey(e,t,r,n,i){this._content.publicKey||(this._content.publicKey=[]);let s={id:`${this._content.id}#${e}`,type:t};s[r]=n,i&&(s.owner=i),this._content.publicKey.push(s)}removePublicKey(e){const t=this._content.publicKey.findIndex((t=>t.id.endsWith(e)));this._content.publicKey.splice(t,1),this._content.publicKey.length||delete this._content.publicKey}addAuthentication(e,t){this._content.authentication||(this._content.authentication=[]),this._content.authentication.push({type:e,publicKey:`${this._content.id}#${t}`})}removeAuthentication(e){const t=this._content.authentication.findIndex((t=>t.publicKey.endsWith(e)));this._content.authentication.splice(t,1),this._content.authentication.length||delete this._content.authentication}addService(e,t,r,n){this._content.service||(this._content.service=[]),this._content.service.push(Object.assign({id:`${this._content.id};${e}`,type:t,serviceEndpoint:r},n))}removeService(e){const t=this._content.service.findIndex((t=>t.id.endsWith(e)));this._content.service.splice(t,1),this._content.service.length||delete this._content.service}setRevocationMethod(e){this._content.revocationMethod=e}addCustomProperty(e,t){this._content[e]=t}removeCustomProperty(e){delete this._content[e]}async commit(e={}){this._content.created?e.noTimestamp||(this._content.updated=new Date(Date.now()).toISOString()):(this._content["@context"]="https://w3id.org/did/v1",e.noTimestamp||(this._content.created=new Date(Date.now()).toISOString()));const t=await this._ipfs.dag.put(this._content,{format:"dag-cbor",hashAlg:"sha2-256"});return this._content=await i.cidToDocument(this._ipfs,t),this._content.previousDocument={"/":t.toString()},t}static async cidToDocument(e,t){let r=(await e.dag.get(t)).value;if(r.id.includes(n)){const e=new RegExp(n,"gi");r.id=r.id.replace(e,t),r.publicKey&&(r.publicKey=JSON.parse(JSON.stringify(r.publicKey).replace(e,t))),r.authentication&&(r.authentication=JSON.parse(JSON.stringify(r.authentication).replace(e,t))),r.service&&(r.service=JSON.parse(JSON.stringify(r.service).replace(e,t)))}return r.previousDocument&&(r.previousDocument={"/":r.previousDocument.toString()}),r}}t.exports=i}}},{package:"3box>ipfs-did-document"}],[4554,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=(e,t,r)=>new Promise(((n,i)=>{if(r=Object.assign({concurrency:Infinity},r),"function"!=typeof t)throw new TypeError("Mapper function is required");const s=r.concurrency;if(!("number"==typeof s&&s>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${s}\` (${typeof s})`);const a=[],o=e[Symbol.iterator]();let c=!1,u=!1,l=0,h=0;const f=()=>{if(c)return;const e=o.next(),r=h;if(h++,e.done)return u=!0,void(0===l&&n(a));l++,Promise.resolve(e.value).then((e=>t(e,r))).then((e=>{a[r]=e,l--,f()}),(e=>{c=!0,i(e)}))};for(let e=0;e<s&&(f(),!u);e++);}))}}},{package:"3box>3box-orbitdb-plugins>ipfs-log>p-map"}],[4555,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=class{async canAppend(e,t){return!0}}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4556,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=class{constructor(e={}){this._cache=e}set(e,t){this._cache[e]=t}get(e){return this._cache[e]}delete(e){return delete this._cache[e]}add(e){this._cache=Object.assign(this._cache,e)}get length(){return Object.values(this._cache).length}}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4557,{"./entry":4558,"p-map":4554,"p-whilst":5452},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("p-whilst"),i=e("p-map"),s=e("./entry");class a{static async fetchParallel(e,t,{length:r=-1,exclude:n=[],concurrency:s=null,timeout:o,onProgressCallback:c}={}){const u=e=>e.hash,l=(e,t)=>{const r=e.map(u);return t.forEach((t=>{-1===r.indexOf(t.hash)&&e.push(t)})),e},h=Array.isArray(t)?t.slice():[t];s=Math.max(s||h.length,1);const f=await i(h,(t=>a.fetchAll(e,t,{length:r,exclude:n,timeout:o,onProgressCallback:c})),{concurrency:s});return f.reduce(l,[])}static async fetchAll(e,t,{length:r=-1,exclude:i=[],timeout:a=null,onProgressCallback:o}){let c=[],u={},l=Array.isArray(t)?t.slice():[t];const h=e=>l.push(e);(i=i&&Array.isArray(i)?i:[]).forEach((e=>{s.isEntry(e)&&(c.push(e),u[e.hash]=e)}));return await n((()=>l.length>0&&(c.length<r||r<0)),(()=>{const t=l.shift();return u[t]?Promise.resolve():new Promise((async(r,n)=>{const i=a?setTimeout((()=>{console.warn(`Warning: Couldn't fetch entry '${t}', request timed out (${a}ms)`),r()}),a):null;try{(e=>{s.isEntry(e)&&(e.next.forEach(h),c.push(e),u[t]=e,o&&o(t,e,c.length))})(await s.fromMultihash(e,t)),r()}catch(e){n(e)}finally{clearTimeout(i)}}))})),c}}t.exports=a}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4558,{"./lamport-clock":4560,"./utils":4567,buffer:2175,"json-stringify-deterministic":4843},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("./lamport-clock"),{isDefined:i,io:s}=e("./utils"),a=e("json-stringify-deterministic"),o=["next"],c=()=>new Error("Ipfs instance not defined"),u={0:"dag-pb",1:"dag-cbor"};class l{static async create(e,t,r,s,a=[],o){if(!i(e))throw c();if(!i(t))throw new Error("Identity is required, cannot create entry");if(!i(r))throw new Error("Entry requires an id");if(!i(s))throw new Error("Entry requires data");if(!i(a)||!Array.isArray(a))throw new Error("'next' argument is not an array");const u={hash:null,id:r,payload:s,next:a.filter(i).map((e=>e.hash?e.hash:e)),v:1,clock:o||new n(t.publicKey)},h=await t.provider.sign(t,l.toBuffer(u));return u.key=t.publicKey,u.identity=t.toJSON(),u.sig=h,u.hash=await l.toMultihash(e,u),u}static async verify(e,t){if(!e)throw new Error("Identity-provider is required, cannot verify entry");if(!l.isEntry(t))throw new Error("Invalid Log entry");if(!t.key)throw new Error("Entry doesn't have a key");if(!t.sig)throw new Error("Entry doesn't have a signature");const r={hash:null,id:t.id,payload:t.payload,next:t.next,v:t.v,clock:t.clock};return e.verify(t.sig,t.key,l.toBuffer(r),"v"+t.v)}static toBuffer(e){const t=0===e.v?JSON.stringify(e):a(e);return r.from(t)}static async toMultihash(e,t){if(!e)throw c();if(!l.isEntry(t))throw new Error("Invalid object format, cannot generate entry hash");const r={hash:null,id:t.id,payload:t.payload,next:t.next,v:t.v,clock:t.clock};return t.key&&Object.assign(r,{key:t.key}),t.identity&&Object.assign(r,{identity:t.identity}),t.sig&&Object.assign(r,{sig:t.sig}),s.write(e,u[r.v],r,{links:o})}static async fromMultihash(e,t){if(!e)throw c();if(!t)throw new Error(`Invalid hash: ${t}`);const r=await s.read(e,t,{links:o});let i={hash:t,id:r.id,payload:r.payload,next:r.next,v:r.v,clock:new n(r.clock.id,r.clock.time)};return r.key&&Object.assign(i,{key:r.key}),r.identity&&Object.assign(i,{identity:r.identity}),r.sig&&Object.assign(i,{sig:r.sig}),i}static isEntry(e){return e&&e.id!==undefined&&e.next!==undefined&&e.payload!==undefined&&e.v!==undefined&&e.hash!==undefined&&e.clock!==undefined}static compare(e,t){var r=n.compare(e.clock,t.clock);return 0===r?e.clock.id<t.clock.id?-1:1:r}static isEqual(e,t){return e.hash===t.hash}static isParent(e,t){return t.next.indexOf(e.hash)>-1}static findChildren(e,t){for(var r=[],n=t.find((t=>l.isParent(e,t))),i=e;n;)r.push(n),i=n,n=t.find((e=>l.isParent(i,e)));return r=r.sort(((e,t)=>e.clock.time>t.clock.time))}}t.exports=l}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4559,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=class{constructor(e){}append(e){}merge(e){}get(e){}has(e){}get values(){}get length(){}}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4560,{},function(){with(this)return function(){"use strict";return function(e,t,r){class n{constructor(e,t){this.id=e,this.time=t||0}tick(){return new n(this.id,++this.time)}merge(e){return this.time=Math.max(this.time,e.time),new n(this.id,this.time)}clone(){return new n(this.id,this.time)}static compare(e,t){var r=e.time-t.time;return 0===r&&e.id!==t.id?e.id<t.id?-1:1:r}}t.exports=n}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4561,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={IPFSNotDefinedError:()=>new Error("IPFS instance not defined"),LogNotDefinedError:()=>new Error("Log instance not defined"),NotALogError:()=>new Error("Given argument is not an instance of Log"),CannotJoinWithDifferentId:()=>new Error("Can't join logs with different IDs"),LtOrLteMustBeStringOrArray:()=>new Error("lt or lte must be a string or array of Entries")}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4562,{"./entry":4558,"./entry-io":4557,"./lamport-clock":4560,"./log-errors":4561,"./utils":4567},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./entry"),i=e("./entry-io"),s=e("./lamport-clock"),a=e("./log-errors"),{isDefined:o,findUniques:c,difference:u,io:l}=e("./utils"),h=["heads"];t.exports=class{static async toMultihash(e,t,{format:r}={}){if(!o(e))throw a.IPFSNotDefinedError();if(!o(t))throw a.LogNotDefinedError();if(o(r)||(r="dag-cbor"),t.values.length<1)throw new Error("Can't serialize an empty log");return l.write(e,r,t.toJSON(),{links:h})}static async fromMultihash(e,t,{length:r=-1,exclude:c,onProgressCallback:u,timeout:f}={}){if(!o(e))throw a.IPFSNotDefinedError();if(!o(t))throw new Error(`Invalid hash: ${t}`);const d=await l.read(e,t,{links:h});if(!d.heads||!d.id)throw a.NotALogError();const p=await i.fetchAll(e,d.heads,{length:r,exclude:c,onProgressCallback:u,timeout:f}),g=p.reduce(((e,t)=>t.clock.time>e.time?new s(t.clock.id,t.clock.time):e),new s(d.id)),m=p.slice().sort(n.compare),w=m.filter((e=>d.heads.includes(e.hash)));return{id:d.id,values:m,heads:w,clock:g}}static async fromEntryHash(e,t,{length:r=-1,exclude:n,onProgressCallback:s,timeout:c}){if(!o(e))throw a.IpfsNotDefinedError();if(!o(t))throw new Error("'hash' must be defined");const u=Array.isArray(t)?t:[t];r=r>-1?Math.max(r,1):r;const l=await i.fetchParallel(e,u,{length:r,exclude:n,onProgressCallback:s,timeout:c});var h,f;return{values:r>-1?(f=r,(h=l).slice(h.length-f,h.length)):l}}static async fromJSON(e,t,{length:r=-1,timeout:s,onProgressCallback:c}){if(!o(e))throw a.IPFSNotDefinedError();const u=t.heads.map((e=>e.hash)),l=(await i.fetchParallel(e,u,{length:r,exclude:[],concurrency:16,timeout:s,onProgressCallback:c})).slice().sort(n.compare);return{id:t.id,values:l,heads:t.heads}}static async fromEntry(e,t,{length:r=-1,exclude:s,onProgressCallback:l,timeout:h}){if(!o(e))throw a.IPFSNotDefinedError();if(!o(t))throw new Error("'sourceEntries' must be defined");if(!Array.isArray(t)&&!n.isEntry(t))throw new Error("'sourceEntries' argument must be an array of Entry instances or a single Entry");Array.isArray(t)||(t=[t]),r=r>-1?Math.max(r,t.length):r;const f=t.map((e=>e.hash)),d=await i.fetchParallel(e,f,{length:r,exclude:s,onProgressCallback:l,timeout:h}),p=t.concat(d),g=c(p,"hash").sort(n.compare),m=g.slice(r>-1?-r:-g.length),w=((e,t)=>{var r=e.slice(t.length,e.length);return t.concat(r)})(m,u(m,t,"hash"));return{id:w[w.length-1].id,values:w}}}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4563,{"./lamport-clock":4560},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./lamport-clock");function i(e,t,r){const i=n.compare(e.clock,t.clock);return 0===i?r(e,t):i}function s(e,t,r){return e.clock.id===t.clock.id?r(e,t):e.clock.id<t.clock.id?-1:1}r.SortByClocks=i,r.SortByClockId=s,r.LastWriteWins=function(e,t){const r=(e,t)=>e,n=(e,t)=>s(e,t,r);return((e,t)=>i(e,t,n))(e,t)},r.SortByEntryHash=function(e,t){const r=(e,t)=>e.hash<t.hash?-1:1,n=(e,t)=>s(e,t,r);return((e,t)=>i(e,t,n))(e,t)},r.NoZeroes=function(e){const t=`Your log's tiebreaker function, ${e.name}, has returned zero and therefore cannot be`;return(r,n)=>{const i=e(r,n);if(0===i)throw Error(t);return i}}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4564,{"./default-access-controller":4555,"./entry":4558,"./entry-index":4556,"./g-set":4559,"./lamport-clock":4560,"./log-errors":4561,"./log-io":4562,"./log-sorting":4563,"./utils":4567,buffer:2175,"p-each-series":5444},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("p-each-series"),i=e("./g-set"),s=e("./entry"),a=e("./log-io"),o=e("./log-errors"),c=e("./lamport-clock"),u=e("./log-sorting"),{LastWriteWins:l,NoZeroes:h}=u,f=e("./default-access-controller"),{isDefined:d,findUniques:p}=e("./utils"),g=e("./entry-index"),m=e=>e.hash,w=(e,t)=>e.concat(t),_=e=>e.next,y=(e,t)=>Math.max(e,t.clock.time),b=(e,t)=>(e[t.hash]=t,e);class v extends i{constructor(e,t,{logId:r,access:n,entries:i,heads:s,clock:a,sortFn:u}={}){if(!d(e))throw o.IPFSNotDefinedError();if(!d(t))throw new Error("Identity is required");if(d(n)||(n=new f),d(i)&&!Array.isArray(i))throw new Error("'entries' argument must be an array of Entry instances");if(d(s)&&!Array.isArray(s))throw new Error("'heads' argument must be an array");d(u)||(u=l),super(),this._sortFn=h(u),this._storage=e,this._id=r||(new Date).getTime().toString(),this._access=n,this._identity=t,i=i||[],this._entryIndex=new g(i.reduce(b,{})),s=s||v.findHeads(i),this._headsIndex=s.reduce(b,{}),this._nextsIndex={};i.forEach((e=>e.next.forEach((t=>this._nextsIndex[t]=e.hash)))),this._length=i.length;const p=Math.max(a?a.time:0,this.heads.reduce(y,0));this._clock=new c(this._identity.publicKey,p)}get id(){return this._id}get clock(){return this._clock}get length(){return this._length}get values(){return Object.values(this.traverse(this.heads)).reverse()}get heads(){return Object.values(this._headsIndex).sort(this._sortFn).reverse()}get tails(){return v.findTails(this.values)}get tailHashes(){return v.findTailHashes(this.values)}setIdentity(e){this._identity=e;const t=Math.max(this.clock.time,this.heads.reduce(y,0));this._clock=new c(this._identity.publicKey,t)}get(e){return this._entryIndex.get(e)}has(e){return this._entryIndex.get(e.hash||e)!==undefined}traverse(e,t=-1,r){var n=e.sort(this._sortFn).reverse();let i={},s={},a=0;const o=e=>this.get(e),c=e=>{e&&!i[e.hash]&&(n=[e,...n].sort(this._sortFn).reverse(),i[e.hash]=!0)};for(;n.length>0&&(-1===t||a<t);){const e=n.shift();if(a++,s[e.hash]=e,e.next.map(o).filter(d).forEach(c),e.hash===r)break}return s}async append(e,t=1){const r=Math.max(this.clock.time,this.heads.reduce(y,0))+1;this._clock=new c(this.clock.id,r);const n=this.traverse(this.heads,Math.max(t,this.heads.length)),i=this.heads.reverse().reduce(b,{}),a=Object.keys(Object.assign({},i,n)),o=await s.create(this._storage,this._identity,this.id,e,a,this.clock);if(!await this._access.canAppend(o,this._identity.provider))throw new Error(`Could not append entry, key "${this._identity.id}" is not allowed to write to the log`);return this._entryIndex.set(o.hash,o),a.forEach((e=>this._nextsIndex[e]=o.hash)),this._headsIndex={},this._headsIndex[o.hash]=o,this._length++,o}iterator({gt:e=undefined,gte:t=undefined,lt:r=undefined,lte:n=undefined,amount:i=-1}={}){if(0===i)return function*(){}();if("string"==typeof n&&(n=[this.get(n)]),"string"==typeof r&&(r=[this.get(this.get(r).next)]),n&&!Array.isArray(n))throw o.LtOrLteMustBeStringOrArray();if(r&&!Array.isArray(r))throw o.LtOrLteMustBeStringOrArray();let s=n||r||this.heads,a=t?this.get(t).hash:e?this.get(e).hash:null,c=a?-1:i||-1,u=this.traverse(s,c,a),l=Object.values(u);return e&&l.pop(),(e||t)&&i>-1&&(l=l.slice(l.length-i,l.length)),function*(){for(let e in l)yield l[e]}()}async join(e,t=-1){if(!d(e))throw o.LogNotDefinedError();if(!v.isLog(e))throw o.NotALogError();if(this.id!==e.id)return;const r=v.difference(e,this),i=this._identity.provider,a=async e=>{if(!await this._access.canAppend(e,i))throw new Error(`Could not append entry, key "${e.identity.id}" is not allowed to write to the log`)},u=Object.values(r);await n(u,(async e=>{await a(e),await(async e=>{const t=await s.verify(i,e),r=e.identity?e.identity.publicKey:e.key;if(!t)throw new Error(`Could not validate signature "${e.sig}" for entry "${e.hash}" and key "${r}"`)})(e)}));Object.values(r).forEach((e=>{this.get(e.hash)||this._length++,e.next.forEach((t=>this._nextsIndex[t]=e.hash))})),this._entryIndex.add(r);const l=Object.values(r).map(_).reduce(w,[]),h=v.findHeads(Object.values(Object.assign({},this._headsIndex,e._headsIndex))).filter((e=>!l.find((t=>t===e.hash)))).filter((e=>!this._nextsIndex[e.hash])).reduce(b,{});if(this._headsIndex=h,t>-1){let e=this.values;e=e.slice(-t),this._entryIndex=null,this._entryIndex=new g(e.reduce(b,{})),this._headsIndex=v.findHeads(e).reduce(b,{}),this._length=this._entryIndex.length}const f=Object.values(this._headsIndex).reduce(y,0);return this._clock=new c(this.clock.id,Math.max(this.clock.time,f)),this}toJSON(){return{id:this.id,heads:this.heads.sort(this._sortFn).reverse().map(m)}}toSnapshot(){return{id:this.id,heads:this.heads,values:this.values}}toBuffer(){return r.from(JSON.stringify(this.toJSON()))}toString(e){return this.values.slice().reverse().map(((t,r)=>{const n=s.findChildren(t,this.values).length;let i=new Array(Math.max(n-1,0));return i=n>1?i.fill("  "):i,i=n>0?i.concat(["└─"]):i,i.join("")+(e?e(t.payload):t.payload)})).join("\n")}static isLog(e){return e.id!==undefined&&e.heads!==undefined&&e._entryIndex!==undefined}toMultihash({format:e}={}){return a.toMultihash(this._storage,this,{format:e})}static async fromMultihash(e,t,r,{access:n,length:i=-1,exclude:s,onProgressCallback:o,sortFn:u,timeout:l,format:h}={}){const f=await a.fromMultihash(e,r,{length:i,exclude:s,onProgressCallback:o,timeout:l,format:h});return new v(e,t,{logId:f.id,access:n,entries:f.values,heads:f.heads,clock:new c(f.clock.id,f.clock.time),sortFn:u})}static async fromEntryHash(e,t,r,{logId:n,access:i,length:s=-1,exclude:o,onProgressCallback:c,sortFn:u,timeout:l}){const h=await a.fromEntryHash(e,r,{length:s,exclude:o,onProgressCallback:c,timeout:l});return new v(e,t,{logId:n,access:i,entries:h.values,sortFn:u})}static async fromJSON(e,t,r,{access:n,length:i=-1,timeout:s,onProgressCallback:o,sortFn:c}={}){const u=await a.fromJSON(e,r,{length:i,timeout:s,onProgressCallback:o});return new v(e,t,{logId:u.id,access:n,entries:u.values,sortFn:c})}static async fromEntry(e,t,r,{access:n,length:i=-1,exclude:s,onProgressCallback:o,timeout:c,sortFn:u}={}){const l=await a.fromEntry(e,r,{length:i,exclude:s,onProgressCallback:o,timeout:c});return new v(e,t,{logId:l.id,access:n,entries:l.values,sortFn:u})}static findHeads(e){var t=e.reduce(((e,t,r,n)=>(t.next.forEach((r=>e[r]=t.hash)),e)),{});return e.filter((e=>t[e.hash]===undefined)).sort(((e,t)=>e.clock.id>t.clock.id))}static findTails(e){var t={},r=[],n={},i=[];e.forEach((e=>{0===e.next.length&&r.push(e);e.next.forEach((r=>{t[r]||(t[r]=[]),t[r].push(e)})),i=i.concat(e.next),n[e.hash]=!0}));const a=i.filter((e=>n[e]===undefined)).map((e=>t[e])).reduce(((e,t,r,n)=>e.concat(p(t,"hash"))),[]).concat(r);return p(a,"hash").sort(s.compare)}static findTailHashes(e){var t={};return e.forEach((e=>t[e.hash]=!0)),e.reduce(((e,r,n,i)=>(r.next.reverse().forEach((r=>{t[r]===undefined&&e.splice(0,0,r)})),e)),[])}static difference(e,t){let r=Object.keys(e._headsIndex),n={},i={};const s=e=>{n[e]||t.get(e)||(r.push(e),n[e]=!0)};for(;r.length>0;){const a=r.shift(),o=e.get(a);o&&!t.get(a)&&o.id===t.id&&(i[o.hash]=o,n[o.hash]=!0,o.next.forEach(s))}return i}}t.exports=v,t.exports.Sorting=u,t.exports.AccessController=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4565,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n={},i={};return e.forEach((e=>i[r?e[r]:e]=!0)),t.reduce(((e,t)=>{var s=i[r?t[r]:t]!==undefined,a=n[r?t[r]:t]!==undefined;return s||a||(e.push(t),n[r?t[r]:t]=!0),e}),[])}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4566,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){let r={};return e.forEach((e=>r[t?e[t]:e]=e)),Object.keys(r).map((e=>r[e]))}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4567,{"./difference":4565,"./find-uniques":4566,"./is-defined":4568,"orbit-db-io":5422},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./difference"),i=e("./find-uniques"),s=e("./is-defined"),a=e("orbit-db-io");t.exports={difference:n,findUniques:i,isDefined:s,io:a}}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4568,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e=>e!==undefined&&null!==e}}},{package:"3box>3box-orbitdb-plugins>ipfs-log"}],[4569,{"./src/core":4572},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./src/core")}}},{package:"3box>ipfs>ipfs-mfs"}],[4570,{"./mkdir":4574,"./utils/add-link":4579,"./utils/apply-default-options":4580,"./utils/to-mfs-path":4587,"./utils/to-sources-and-destination":4589,"./utils/to-trail":4591,"./utils/update-mfs-root":4592,"./utils/update-tree":4593,debug:2347,"err-code":2449},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./mkdir"),i=e("debug")("ipfs:mfs:cp"),s=e("err-code"),a=e("./utils/update-tree"),o=e("./utils/update-mfs-root"),c=e("./utils/add-link"),u=e("./utils/apply-default-options"),l=e("./utils/to-mfs-path"),h=e("./utils/to-sources-and-destination"),f=e("./utils/to-trail"),d={parents:!1,flush:!0,format:"dag-pb",hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};t.exports=e=>async function(...t){const r=u(t,d);let{sources:a,destination:o}=await h(e,t);if(!a.length)throw s(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");if(!o)throw s(new Error("Please supply a destination"),"ERR_INVALID_PARAMS");r.parents=r.p||r.parents;const c=a.find((e=>!e.exists));if(c)throw s(new Error(`${c.path} does not exist`),"ERR_INVALID_PARAMS");const w=p(o);if(o.exists){if(i("Destination exists"),1===a.length&&!w)throw s(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(i("Destination does not exist"),a.length>1){if(!r.parents)throw s(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await n(e)(o.path,r),o=await l(e,o.path)}const _=p(o)?o.mfsPath:o.mfsDirectory,y=await f(e,_,r);if(1===a.length){const t=a.pop(),n=w?t.name:o.name;return i(`Only one source, copying to destination ${w?"directory":"file"} ${n}`),g(e,t,n,y,r)}return i("Multiple sources, wrapping in a directory"),m(e,a,o,y,r)};const p=e=>e.unixfs&&e.unixfs.type&&e.unixfs.type.includes("directory"),g=async(e,t,r,n,i)=>{let s=n.pop();s=await w(e,t,r,s,i),n.push(s);const c=await a(e,n,i);await o(e,c)},m=async(e,t,r,n,i)=>{for(let n=0;n<t.length;n++){const s=t[n];r=await w(e,s,s.name,r,i)}n[n.length-1]=r;const s=await a(e,n,i);await o(e,s)},w=async(e,t,r,n,i)=>{const s=await e.repo.blocks.get(t.cid),{node:a,cid:o}=await c(e,{parentCid:n.cid,size:s.data.length,cid:t.cid,name:r,format:i.format,hashAlg:i.hashAlg,cidVersion:i.cidVersion});return n.node=a,n.cid=o,n.size=a.size,n}}}},{package:"3box>ipfs>ipfs-mfs"}],[4571,{"./stat":4578,"./utils/apply-default-options":4580,"./utils/constants":4581},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./utils/apply-default-options"),i=e("./stat"),{FILE_SEPARATOR:s}=e("./utils/constants"),a={};t.exports=e=>async function(t=s,r=a){r=n(r,a),await i(e)(t,r)}}}},{package:"3box>ipfs>ipfs-mfs"}],[4572,{"./cp":4570,"./flush":4571,"./ls":4573,"./mkdir":4574,"./mv":4575,"./read":4576,"./rm":4577,"./stat":4578,"./utils/create-lock":4582,"./write":4595,assert:1803,"promisify-es6":5504},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("assert"),i=e("promisify-es6"),s=e("./utils/create-lock"),a={stat:e("./stat")},o={cp:e("./cp"),flush:e("./flush"),mkdir:e("./mkdir"),mv:e("./mv"),rm:e("./rm")},c={write:e("./write"),read:e("./read"),ls:e("./ls")},u=({options:e,mfs:t,operations:r,lock:n})=>{Object.keys(r).forEach((i=>{t[i]=n(r[i](e))}))},l={repoOwner:!0,ipld:null,repo:null};t.exports=e=>{const{repoOwner:t}=Object.assign({},l||{},e);n(e.ipld,"MFS requires an IPLD instance"),n(e.blocks,"MFS requires an BlockStore instance"),n(e.datastore,"MFS requires a DataStore instance"),e.repo={blocks:{get:i(e.blocks.get,{context:e.blocks})},datastore:{open:i(e.datastore.open,{context:e.datastore}),get:i(e.datastore.get,{context:e.datastore}),put:i(e.datastore.put,{context:e.datastore})}};const r=s(t),h={};return u({options:e,mfs:h,operations:a,lock:e=>r.readLock(e)}),u({options:e,mfs:h,operations:o,lock:e=>r.writeLock(e)}),Object.keys(c).forEach((t=>{h[t]=c[t](e)})),h}}}},{package:"3box>ipfs>ipfs-mfs"}],[4573,{"./utils/apply-default-options":4580,"./utils/constants":4581,"./utils/to-mfs-path":4587,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("ipfs-unixfs-exporter"),i=e("./utils/apply-default-options"),s=e("./utils/to-mfs-path"),{FILE_SEPARATOR:a,FILE_TYPES:o}=e("./utils/constants"),c={},u=e=>{let t=0,r=e.node.size||e.node.length;return e.unixfs&&(r=e.unixfs.fileSize(),t=o[e.unixfs.type]),{cid:e.cid,name:e.name,type:t,size:r}};t.exports=e=>async function*(t=a,r={}){"object"!=typeof t||t instanceof String||(r=t,t=a),r=i(r,c);const o=await s(e,t),l=await n(o.mfsPath,e.ipld);if(l.unixfs&&l.unixfs.type.includes("directory"))for await(const e of l.content(r))yield u(e);else yield u(l)}}}},{package:"3box>ipfs>ipfs-mfs"}],[4574,{"./utils/add-link":4579,"./utils/apply-default-options":4580,"./utils/constants":4581,"./utils/create-node":4583,"./utils/to-path-components":4588,"./utils/update-mfs-root":4592,"./utils/update-tree":4593,"./utils/with-mfs-root":4594,debug:2347,"err-code":2449,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("err-code"),i=e("debug")("ipfs:mfs:mkdir"),s=e("ipfs-unixfs-exporter"),a=e("./utils/create-node"),o=e("./utils/to-path-components"),c=e("./utils/update-mfs-root"),u=e("./utils/update-tree"),l=e("./utils/add-link"),h=e("./utils/with-mfs-root"),f=e("./utils/apply-default-options"),{FILE_SEPARATOR:d}=e("./utils/constants"),p={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,format:"dag-pb",flush:!0};t.exports=e=>async function(t,r){if(r=f(r,p),!t)throw new Error("no path given to Mkdir");if((t=t.trim())===d){if(r.parents)return;throw n(new Error(`cannot create directory '${d}': Already exists`),"ERR_INVALID_PATH")}if(t.substring(0,1)!==d)throw n(new Error("paths must start with a leading /"),"ERR_INVALID_PATH");i(`Creating ${t}`);const l=o(t);if("ipfs"===l[0])throw n(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");let m,w=await h(e),_=[];const y=await a(e,"directory",r);for(let t=0;t<=l.length;t++){const a=l.slice(0,t),o=`/ipfs/${w}/${a.join("/")}`;try{if(m=await s(o,e.ipld),i(`${o} existed`),i(`${o} had children ${m.node.Links.map((e=>e.Name))}`),t===l.length){if(r.parents)return;throw n(new Error("file already exists"),"ERR_ALREADY_EXISTS")}_.push({name:m.name,cid:m.cid})}catch(i){if("ERR_NOT_FOUND"!==i.code)throw i;if(t<l.length&&!r.parents)throw n(new Error(`Intermediate directory path ${o} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await g(e,a[a.length-1],y,_[_.length-1],_,r)}}const b=await u(e,_,r);await c(e,b)};const g=async(e,t,r,n,s,a)=>{i(`Adding empty dir called ${t} to ${n.cid}`);const o=await l(e,{parent:n.node,parentCid:n.cid,size:r.node.size,cid:r.cid,name:t,format:a.format,hashAlg:a.hashAlg,cidVersion:a.cidVersion});s[s.length-1].cid=o.cid,s.push({name:t,cid:r.cid})}}}},{package:"3box>ipfs>ipfs-mfs"}],[4575,{"./cp":4570,"./rm":4577,"./utils/apply-default-options":4580,"./utils/to-sources":4590},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./utils/apply-default-options"),i=e("./utils/to-sources"),s=e("./cp"),a=e("./rm"),o={parents:!1,recursive:!1,flush:!0,format:"dag-pb",hashAlg:"sha2-256",shardSplitThreshold:1e3};t.exports=e=>async function(...t){Array.isArray(t[0])&&(t=t[0].concat(t.slice(1)));const{sources:r}=await i(e,t),c=n(t,o),u=r.map((e=>e.path)).concat(c),l=r.slice(0,-1).map((e=>e.path)).concat(Object.assign(c,{recursive:!0}));await s(e).apply(null,u),await a(e).apply(null,l)}}}},{package:"3box>ipfs>ipfs-mfs"}],[4576,{"./utils/apply-default-options":4580,"./utils/to-mfs-path":4587,"err-code":2449,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("ipfs-unixfs-exporter"),i=e("./utils/apply-default-options"),s=e("./utils/to-mfs-path"),a=e("err-code"),o={offset:0,length:Infinity};t.exports=e=>function(t,r={}){return r=i(r,o),{[Symbol.asyncIterator]:async function*(){const i=await s(e,t),o=await n(i.mfsPath,e.ipld);if("file"!==o.unixfs.type)throw a(new Error(`${t} was not a file`),"ERR_NOT_FILE");if(!o.content)throw a(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(const e of o.content({offset:r.offset,length:r.length}))yield e}}}}}},{package:"3box>ipfs>ipfs-mfs"}],[4577,{"./utils/apply-default-options":4580,"./utils/constants":4581,"./utils/remove-link":4585,"./utils/to-mfs-path":4587,"./utils/to-sources":4590,"./utils/to-trail":4591,"./utils/update-mfs-root":4592,"./utils/update-tree":4593,"err-code":2449},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("err-code"),i=e("./utils/update-tree"),s=e("./utils/update-mfs-root"),a=e("./utils/to-sources"),o=e("./utils/remove-link"),c=e("./utils/to-mfs-path"),u=e("./utils/to-trail"),l=e("./utils/apply-default-options"),{FILE_SEPARATOR:h}=e("./utils/constants"),f={recursive:!1,cidVersion:0,hashAlg:"sha2-256",format:"dag-pb",flush:!0};t.exports=e=>async function(){const t=Array.from(arguments),{sources:r}=await a(e,t,f),i=l(t,f);if(!r.length)throw n(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");r.forEach((e=>{if(e.path===h)throw n(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")}));for(const t of r)await d(e,t.path,i)};const d=async(e,t,r)=>{const a=await c(e,t),l=await u(e,a.mfsPath,r),h=l.pop(),f=l[l.length-1];if(!f)throw n(new Error(`${t} does not exist`),"ERR_NOT_FOUND");if("directory"===h.type&&!r.recursive)throw n(new Error(`${t} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:d}=await o(e,{parentCid:f.cid,name:h.name,format:r.format,hashAlg:r.hashAlg,cidVersion:r.cidVersion,flush:r.flush});f.cid=d;const p=await i(e,l,r);await s(e,p)}}}},{package:"3box>ipfs>ipfs-mfs"}],[4578,{"./utils/apply-default-options":4580,"./utils/to-mfs-path":4587,debug:2347,"err-code":2449,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./utils/apply-default-options"),i=e("./utils/to-mfs-path"),s=e("ipfs-unixfs-exporter"),a=e("debug")("ipfs:mfs:stat"),o=e("err-code"),c={withLocal:!1};t.exports=e=>async function(t,r){r=n(r,c),a(`Fetching stats for ${t}`);const{type:l,cid:h,mfsPath:f}=await i(e,t);let d,p="ipfs"===l&&h?h:f;try{d=await s(p,e.ipld)}catch(e){if("ERR_NOT_FOUND"===e.code)throw o(new Error(`${t} does not exist`),"ERR_NOT_FOUND");throw e}if(!u[d.cid.codec])throw new Error(`Cannot stat codec ${d.cid.codec}`);return u[d.cid.codec](d,r)};const u={raw:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:undefined,sizeLocal:undefined,withLocality:!1}),"dag-pb":e=>{let t=e.node.Links.length,r=e.node.size,n=e.node.size,i=null;return e.unixfs&&(r=e.unixfs.fileSize(),i=e.unixfs.type,i.includes("directory")&&(r=0,n=e.node.size),"file"===i&&(t=e.unixfs.blockSizes.length)),{cid:e.cid,size:r,cumulativeSize:n,blocks:t,type:i,local:undefined,sizeLocal:undefined,withLocality:!1}},"dag-cbor":e=>({cid:e.cid,local:undefined,sizeLocal:undefined,withLocality:!1})}}}},{package:"3box>ipfs>ipfs-mfs"}],[4579,{"./hamt-utils":4584,"async-iterator-last":1810,cids:2212,debug:2347,"err-code":2449,"ipfs-unixfs":4648,"ipfs-unixfs-importer/src/dir-sharded":4641,"ipld-dag-pb":4785,multicodec:5305,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){const{DAGNode:n,DAGLink:i}=e("ipld-dag-pb"),s=e("cids"),a=e("debug")("ipfs:mfs:core:utils:add-link"),o=e("ipfs-unixfs"),c=e("ipfs-unixfs-importer/src/dir-sharded"),{updateHamtDirectory:u,recreateHamtLevel:l,createShard:h,toPrefix:f,addLinksToHamtBucket:d}=e("./hamt-utils"),p=e("err-code"),g=e("multicodec"),m=e("multihashes"),w=e("async-iterator-last"),_=async(e,t)=>{const r=await h(e,t.parent.Links.map((e=>({name:e.Name,size:e.Tsize,cid:e.Hash}))).concat({name:t.name,size:t.size,cid:t.cid}),t);return a(`Converted directory to sharded directory ${r.cid}`),r},y=async(e,t)=>{let r=await n.rmLink(t.parent,t.name);r=await n.addLink(r,new i(t.name,t.size,t.cid));const s=g[t.format.toUpperCase().replace(/-/g,"_")],a=m.names[t.hashAlg];return{node:r,cid:await e.ipld.put(r,s,{cidVersion:t.cidVersion,hashAlg:a,hashOnly:!t.flush})}},b=async(e,t)=>{const{shard:r,path:i}=await v(e,t),s=await w(r.flush("",e.ipld)),a=t.parent.Links.find((e=>e.Name.substring(0,2)===i[0].prefix)),o=s.node.Links.find((e=>e.Name.substring(0,2)===i[0].prefix));let c=t.parent;return a&&(c=await n.rmLink(t.parent,a.Name)),c=await n.addLink(c,o),u(e,c.Links,i[0].bucket,t)},v=async(e,t)=>{const r={name:t.name,cid:t.cid,size:t.size},n=await l(t.parent.Links),i=new c({root:!0,dir:!0,parent:null,parentKey:null,path:"",dirty:!0,flat:!1},t);i._bucket=n;const s=await n._findNewBucketAndPos(r.name),o=E(s);o[0].node=t.parent;let u=0;for(;u<o.length;){let t=o[u];u++;let i=t.node.Links.find((e=>e.Name.substring(0,2)===t.prefix));if(!i){a(`Link ${t.prefix}${r.name} will be added`),u=o.length;break}if(i.Name===`${t.prefix}${r.name}`){a(`Link ${t.prefix}${r.name} will be replaced`),u=o.length;break}if(i.Name.length>2){a(`Link ${i.Name} will be replaced with a subshard`),u=o.length;break}a(`Found subshard ${t.prefix}`);const s=await e.ipld.get(i.Hash);if(!o[u]){a(`Loaded new subshard ${t.prefix}`),await l(s.Links,n,t.bucket,parseInt(t.prefix,16));const e=await n._findNewBucketAndPos(r.name);o.push({bucket:e.bucket,prefix:f(e.pos),node:s});break}const c=o[u];await d(s.Links,c.bucket,n),c.node=s}return await i._bucket.put(r.name,{size:r.size,cid:r.cid}),{shard:i,path:o}},E=e=>{let t=e.bucket,r=e.pos,n=[{bucket:t,prefix:f(r)}];for(t=e.bucket._parent,r=e.bucket._posAtParent;t;)n.push({bucket:t,prefix:f(r)}),r=t._posAtParent,t=t._parent;return n.reverse(),n};t.exports=async(e,t)=>{if(!t.parentCid&&!t.parent)throw p(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(t.parentCid&&!s.isCID(t.parentCid))throw p(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(t.parent||(a(`Loading parent node ${t.parentCid}`),t.parent=await e.ipld.get(t.parentCid)),!t.cid)throw p(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!t.name)throw p(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(s.isCID(t.cid)||(t.cid=new s(t.cid)),!t.size&&0!==t.size)throw p(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");return"hamt-sharded-directory"===o.unmarshal(t.parent.Data).type?(a("Adding link to sharded directory"),b(e,t)):t.parent.Links.length>=t.shardSplitThreshold?(a("Converting directory to sharded directory"),_(e,t)):(a(`Adding ${t.name} (${t.cid}) to regular directory`),y(e,t))}}}},{package:"3box>ipfs>ipfs-mfs"}],[4580,{"err-code":2449},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("err-code");t.exports=(e={},t)=>{Array.isArray(e)&&(e=e.filter((e=>"object"==typeof e)).pop()||{});const r={};for(let n in t)null!==e[n]&&e[n]!==undefined?r[n]=e[n]:r[n]=t[n];const i=r.format||r.codec;if(i&&isNaN(i)&&(r.format=i,delete r.codec),e.count!==undefined&&(r.length=e.count),e.p!==undefined&&(r.parents=e.p),e.l!==undefined&&(r.long=e.l),r.length||0===r.length||(r.length=Infinity),r.offset<0)throw n(new Error("cannot have negative write offset"),"ERR_INVALID_PARAMS");if(r.length<0)throw n(new Error("cannot have negative byte count"),"ERR_INVALID_PARAMS");return r}}}},{package:"3box>ipfs>ipfs-mfs"}],[4581,{"interface-datastore":4522},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("interface-datastore").Key;t.exports={FILE_SEPARATOR:"/",MFS_ROOT_KEY:new n("/local/filesroot"),MAX_CHUNK_SIZE:262144,MAX_LINKS:174,FILE_TYPES:{file:0,directory:1,"hamt-sharded-directory":1}}}}},{package:"3box>ipfs>ipfs-mfs"}],[4582,{mortice:5287},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("mortice");let i;t.exports=e=>{if(i)return i;const t=n({singleProcess:e});return i={readLock:e=>(...r)=>t.readLock((()=>e.apply(null,r))),writeLock:e=>(...r)=>t.writeLock((()=>e.apply(null,r)))},i}}}},{package:"3box>ipfs>ipfs-mfs"}],[4583,{"ipfs-unixfs":4648,"ipld-dag-pb":4785,multicodec:5305,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("ipfs-unixfs"),{DAGNode:i}=e("ipld-dag-pb"),s=e("multicodec"),a=e("multihashes");t.exports=async(e,t,r)=>{const o=s[r.format.toUpperCase().replace(/-/g,"_")],c=a.names[r.hashAlg],u=i.create(new n(t).marshal());return{cid:await e.ipld.put(u,o,{cidVersion:r.cidVersion,hashAlg:c}),node:u}}}}},{package:"3box>ipfs>ipfs-mfs"}],[4584,{"async-iterator-last":1810,buffer:2175,debug:2347,"hamt-sharding/src/bucket":4445,"ipfs-unixfs":4648,"ipfs-unixfs-importer/src/dir-sharded":4641,"ipld-dag-pb":4785,multicodec:5305,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const{DAGNode:n}=e("ipld-dag-pb"),i=e("hamt-sharding/src/bucket"),s=e("ipfs-unixfs-importer/src/dir-sharded"),a=e("debug")("ipfs:mfs:core:utils:hamt-utils"),o=e("ipfs-unixfs"),c=e("multicodec"),u=e("multihashes"),l=e("async-iterator-last"),h=async(e,t,r,n)=>{const a=new i({hashFn:s.hashFn,hash:r?r._options.hash:undefined},r,n);return r&&r._putObjectAt(n,a),await f(e,a,t),a},f=async(e,t,r)=>{await Promise.all(e.map((e=>{if(2===e.Name.length){const r=parseInt(e.Name,16);return t._putObjectAt(r,new i({hashFn:s.hashFn},t,r)),Promise.resolve()}return(r||t).put(e.Name.substring(2),{size:e.TSize,cid:e.Hash})})))},d=e=>e.toString("16").toUpperCase().padStart(2,"0").substring(0,2);t.exports={generatePath:async(e,t,r)=>{const n=await h(r.Links,null,null,null),i=await n._findNewBucketAndPos(t);let s=[{bucket:i.bucket,prefix:d(i.pos)}],o=i.bucket;for(;o!==n;)s.push({bucket:o,prefix:d(o._posAtParent)}),o=o._parent;s.reverse(),s[0].node=r;for(let r=0;r<s.length;r++){const i=s[r],o=i.node.Links.filter((e=>e.Name.substring(0,2)===i.prefix)).pop();if(!o){a(`Link ${i.prefix}${t} will be added`);continue}if(o.Name===`${i.prefix}${t}`){a(`Link ${i.prefix}${t} will be replaced`);continue}a(`Found subshard ${i.prefix}`);const c=await e.ipld.get(o.Hash);if(!s[r+1]){a(`Loaded new subshard ${i.prefix}`),await h(c.Links,n,i.bucket,parseInt(i.prefix,16));const e=await n._findNewBucketAndPos(t);s.push({bucket:e.bucket,prefix:d(e.pos),node:c});continue}const u=s[r+1];await f(c.Links,u.bucket,n),u.node=c}return await n.put(t,!0),s.reverse(),{rootBucket:n,path:s}},updateHamtDirectory:async(e,t,i,a)=>{const l=r.from(i._children.bitField().reverse()),h=new o("hamt-sharded-directory",l);h.fanout=i.tableSize(),h.hashType=s.hashFn.code;const f=c[a.format.toUpperCase().replace(/-/g,"_")],d=u.names[a.hashAlg],p=n.create(h.marshal(),t);return{node:p,cid:await e.ipld.put(p,f,{cidVersion:a.cidVersion,hashAlg:d,hashOnly:!a.flush})}},recreateHamtLevel:h,addLinksToHamtBucket:f,toPrefix:d,createShard:async(e,t,r)=>{const n=new s({root:!0,dir:!0,parent:null,parentKey:null,path:"",dirty:!0,flat:!1},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});return l(n.flush("",e.ipld,null))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-mfs"}],[4585,{"./hamt-utils":4584,cids:2212,debug:2347,"err-code":2449,"ipfs-unixfs":4648,"ipld-dag-pb":4785,multicodec:5305,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){const{DAGNode:n,DAGLink:i}=e("ipld-dag-pb"),s=e("cids"),a=e("debug")("ipfs:mfs:core:utils:remove-link"),o=e("ipfs-unixfs"),{generatePath:c,updateHamtDirectory:u}=e("./hamt-utils"),l=e("err-code"),h=e("multicodec"),f=e("multihashes"),d=async(e,t)=>{const r=h[t.format.toUpperCase().replace(/-/g,"_")],i=f.names[t.hashAlg],s=await n.rmLink(t.parent,t.name),o=await e.ipld.put(s,r,{cidVersion:t.cidVersion,hashAlg:i});return a(`Updated regular directory ${o}`),{node:s,cid:o}},p=async(e,t)=>{const{rootBucket:r,path:n}=await c(e,t.name,t.parent);await r.del(t.name);const{node:i}=await g(e,n,{name:t.name,cid:t.cid,size:t.size,hashAlg:t.hashAlg,format:t.format,cidVersion:t.cidVersion,flush:t.flush},t);return u(e,i.Links,r,t)},g=async(e,t,r,i)=>{const{bucket:s,prefix:o,node:c}=t.pop(),h=c.Links.find((e=>e.Name.substring(0,2)===o));if(!h)throw l(new Error(`No link found with prefix ${o} for file ${r.name}`),"ERR_NOT_FOUND");if(h.Name===`${o}${r.name}`){a(`Removing existing link ${h.Name}`);const t=await n.rmLink(c,h.Name);return await s.del(r.name),u(e,t.Links,s,i)}a(`Descending into sub-shard ${h.Name} for ${o}${r.name}`);const f=await g(e,t,r,i);let d=o;1===f.node.Links.length&&(a(`Removing subshard for ${o}`),f.cid=f.node.Links[0].Hash,f.node=f.node.Links[0],d=`${o}${f.node.Name.substring(2)}`),a(`Updating shard ${o} with name ${d}`);const p=n.isDAGNode(f.node)?f.node.size:f.node.Tsize;return m(e,s,c,o,d,p,f.cid,i)},m=async(e,t,r,s,a,o,c,l)=>(r=await n.rmLink(r,s),r=await n.addLink(r,new i(a,o,c)),u(e,r.Links,t,l));t.exports=async(e,t)=>{if(!t.parentCid&&!t.parent)throw l(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(t.parentCid&&!s.isCID(t.parentCid))throw l(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");if(t.parent||(a(`Loading parent node ${t.parentCid}`),t.parent=await e.ipld.get(t.parentCid)),!t.name)throw l(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");return"hamt-sharded-directory"===o.unmarshal(t.parent.Data).type?(a(`Removing ${t.name} from sharded directory`),p(e,t)):(a(`Removing link ${t.name} regular directory`),d(e,t))}}}},{package:"3box>ipfs>ipfs-mfs"}],[4586,{"./constants":4581,buffer:2175,debug:2347,"err-code":2449,fs:2174},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("err-code"),i=e("fs"),s=e("debug")("ipfs:mfs:utils:to-async-iterator"),{MAX_CHUNK_SIZE:a}=e("./constants");t.exports=async e=>{if(!e)throw n(new Error("paths must start with a leading /"),"ERR_INVALID_PATH");if("string"==typeof e||e instanceof String)return s("Content was a path"),i.createReadStream(e);if(e.length)return s("Content was array-like"),{[Symbol.asyncIterator]:async function*(){yield e}};if(e[Symbol.asyncIterator])return s("Content was an async iterator"),e;if(e[Symbol.iterator])return s("Content was an iterator"),e;if(global.Blob&&e instanceof global.Blob){s("Content was an HTML5 Blob");let t=0;const n={next:async()=>t>e.size?{done:!0}:new Promise(((n,i)=>{const s=e.slice(t,a);t+=a;const o=new global.FileReader,c=e=>{if(o.removeEventListener("loadend",c,!1),e.error)return i(e.error);n({done:!1,value:r.from(o.result)})};o.addEventListener("loadend",c),o.readAsArrayBuffer(s)}))};return{[Symbol.asyncIterator]:()=>n}}throw n(new Error(`Don't know how to convert ${e} into an async iterator`),"ERR_INVALID_PARAMS")}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>ipfs-mfs"}],[4587,{"./constants":4581,"./to-path-components":4588,"./with-mfs-root":4594,"err-code":2449,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const{FILE_SEPARATOR:n}=e("./constants"),i=e("./with-mfs-root"),s=e("./to-path-components"),a=e("ipfs-unixfs-exporter"),o=e("err-code"),c="ipfs";t.exports=async(e,t)=>{let r=Array.isArray(t),u=Array.isArray(t)?t:[t];const l=await i(e);return u=u.map((e=>{if((e=(e=(e||"").trim()).replace(/(\/\/+)/g,"/")).endsWith("/")&&e.length>1&&(e=e.substring(0,e.length-1)),!e)throw o(new Error("paths must not be empty"),"ERR_NO_PATH");if(e.substring(0,1)!==n)throw o(new Error(`paths must start with a leading ${n}`),"ERR_INVALID_PATH");e.substring(e.length-n.length)===n&&(e=e.substring(0,e.length-n.length));const t=s(e);if(t[0]===c){let e;return e=2===t.length?`${n}${t.join(n)}`:`${n}${t.slice(0,t.length-1).join(n)}`,{type:"ipfs",depth:t.length-2,mfsPath:`${n}${t.join(n)}`,mfsDirectory:e,parts:t,path:`${n}${t.join(n)}`,name:t[t.length-1]}}const r=`/ipfs/${l}${t.length?"/"+t.join(n):""}`,i=`/ipfs/${l}/${t.slice(0,t.length-1).join(n)}`;return{type:"mfs",depth:t.length,mfsDirectory:i,mfsPath:r,parts:t,path:`${n}${t.join(n)}`,name:t[t.length-1]}})),await Promise.all(u.map((async t=>{const r="mfs"===t.type?t.mfsPath:t.path;try{const n=await a(r,e.ipld);t.cid=n.cid,t.mfsPath=`/ipfs/${n.path}`,t.unixfs=n.unixfs,t.content=n.content}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}t.exists=Boolean(t.cid)}))),r?u:u[0]}}}},{package:"3box>ipfs>ipfs-mfs"}],[4588,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}}},{package:"3box>ipfs>ipfs-mfs"}],[4589,{"./to-sources":4590},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./to-sources");t.exports=async function(e,t){const{sources:r,options:i}=await n(e,t);return{destination:r.pop(),sources:r,options:i}}}}},{package:"3box>ipfs>ipfs-mfs"}],[4590,{"./to-mfs-path":4587},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./to-mfs-path");t.exports=async function(e,t){Array.isArray(t[0])&&(t=t[0]);const r=t.filter((e=>"string"==typeof e)).map((e=>e.trim()));return{sources:await n(e,r)}}}}},{package:"3box>ipfs>ipfs-mfs"}],[4591,{debug:2347,"ipfs-unixfs-exporter":4619},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("ipfs-unixfs-exporter"),i=e("debug")("ipfs:mfs:utils:to-trail");t.exports=async(e,t)=>{i(`Creating trail for path ${t}`);const r=[];for await(const i of n.path(t,e.ipld))r.push({name:i.name,cid:i.cid,size:i.node.size,type:i.unixfs?i.unixfs.type:undefined});return r}}}},{package:"3box>ipfs>ipfs-mfs"}],[4592,{"./constants":4581,debug:2347},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("debug")("ipfs:mfs:utils:update-mfs-root"),{MFS_ROOT_KEY:i}=e("./constants");t.exports=async(e,t)=>(n(`New MFS root will be ${t}`),await e.repo.datastore.put(i,t.buffer),t)}}},{package:"3box>ipfs>ipfs-mfs"}],[4593,{"./add-link":4579,debug:2347},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("debug")("ipfs:mfs:utils:update-tree"),i=e("./add-link"),s={shardSplitThreshold:1e3};t.exports=async(e,t,r)=>{r=Object.assign({},s,r),n("Trail",t),t=t.slice().reverse();let a,o=0;for await(const n of e.ipld.getMany(t.map((e=>e.cid)))){const s=t[o].cid,c=t[o].name;if(o++,!a){a={cid:s,name:c,size:n.size};continue}const u=await i(e,{parent:n,name:a.name,cid:a.cid,size:a.size,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold,format:r.format,hashAlg:r.hashAlg,cidVersion:r.cidVersion});a={cid:u.cid,name:c,size:u.node.size}}return n(`Final CID ${a.cid}`),a.cid}}}},{package:"3box>ipfs>ipfs-mfs"}],[4594,{"./constants":4581,cids:2212,debug:2347,"ipfs-unixfs":4648,"ipld-dag-pb":4785,multicodec:5305,multihashes:5320},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("cids"),i=e("ipfs-unixfs"),{DAGNode:s}=e("ipld-dag-pb"),a=e("debug")("ipfs:mfs:utils:with-mfs-root"),o=e("multicodec"),c=e("multihashes"),{MFS_ROOT_KEY:u}=e("./constants");t.exports=async e=>{let t;await e.repo.datastore.open();try{const r=await e.repo.datastore.get(u);t=new n(r)}catch(r){if("ERR_NOT_FOUND"!==r.code)throw r;a("Creating new MFS root");const n=s.create(new i("directory").marshal());t=await e.ipld.put(n,o.DAG_PB,{cidVersion:0,hashAlg:c.names["sha2-256"]}),await e.repo.datastore.put(u,t.buffer)}return a(`Loaded MFS root /ipfs/${t}`),t}}}},{package:"3box>ipfs>ipfs-mfs"}]],[],{});