LavaPack.loadBundle([[5234,{crypto:1796},function(){with(this)return function(){"use strict";return function(e,t,r){!function(t){var r=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},n=function(){throw new Error("no PRNG")},s=new Uint8Array(16),o=new Uint8Array(32);o[0]=9;var i=r(),a=r([1]),c=r([56129,1]),l=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),u=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),h=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),p=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function f(e,t,r,n){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=n>>24&255,e[t+5]=n>>16&255,e[t+6]=n>>8&255,e[t+7]=255&n}function m(e,t,r,n,s){var o,i=0;for(o=0;o<s;o++)i|=e[t+o]^r[n+o];return(1&i-1>>>8)-1}function g(e,t,r,n){return m(e,t,r,n,16)}function y(e,t,r,n){return m(e,t,r,n,32)}function b(e,t,r,n){!function(e,t,r,n){for(var s,o=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,i=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,l=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,u=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,m=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,g=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,y=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,w=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,k=o,_=i,C=a,E=c,S=l,M=u,A=d,T=h,P=p,R=f,x=m,N=g,O=y,I=b,j=v,L=w,U=0;U<20;U+=2)k^=(s=(O^=(s=(P^=(s=(S^=(s=k+O|0)<<7|s>>>25)+k|0)<<9|s>>>23)+S|0)<<13|s>>>19)+P|0)<<18|s>>>14,M^=(s=(_^=(s=(I^=(s=(R^=(s=M+_|0)<<7|s>>>25)+M|0)<<9|s>>>23)+R|0)<<13|s>>>19)+I|0)<<18|s>>>14,x^=(s=(A^=(s=(C^=(s=(j^=(s=x+A|0)<<7|s>>>25)+x|0)<<9|s>>>23)+j|0)<<13|s>>>19)+C|0)<<18|s>>>14,L^=(s=(N^=(s=(T^=(s=(E^=(s=L+N|0)<<7|s>>>25)+L|0)<<9|s>>>23)+E|0)<<13|s>>>19)+T|0)<<18|s>>>14,k^=(s=(E^=(s=(C^=(s=(_^=(s=k+E|0)<<7|s>>>25)+k|0)<<9|s>>>23)+_|0)<<13|s>>>19)+C|0)<<18|s>>>14,M^=(s=(S^=(s=(T^=(s=(A^=(s=M+S|0)<<7|s>>>25)+M|0)<<9|s>>>23)+A|0)<<13|s>>>19)+T|0)<<18|s>>>14,x^=(s=(R^=(s=(P^=(s=(N^=(s=x+R|0)<<7|s>>>25)+x|0)<<9|s>>>23)+N|0)<<13|s>>>19)+P|0)<<18|s>>>14,L^=(s=(j^=(s=(I^=(s=(O^=(s=L+j|0)<<7|s>>>25)+L|0)<<9|s>>>23)+O|0)<<13|s>>>19)+I|0)<<18|s>>>14;k=k+o|0,_=_+i|0,C=C+a|0,E=E+c|0,S=S+l|0,M=M+u|0,A=A+d|0,T=T+h|0,P=P+p|0,R=R+f|0,x=x+m|0,N=N+g|0,O=O+y|0,I=I+b|0,j=j+v|0,L=L+w|0,e[0]=k>>>0&255,e[1]=k>>>8&255,e[2]=k>>>16&255,e[3]=k>>>24&255,e[4]=_>>>0&255,e[5]=_>>>8&255,e[6]=_>>>16&255,e[7]=_>>>24&255,e[8]=C>>>0&255,e[9]=C>>>8&255,e[10]=C>>>16&255,e[11]=C>>>24&255,e[12]=E>>>0&255,e[13]=E>>>8&255,e[14]=E>>>16&255,e[15]=E>>>24&255,e[16]=S>>>0&255,e[17]=S>>>8&255,e[18]=S>>>16&255,e[19]=S>>>24&255,e[20]=M>>>0&255,e[21]=M>>>8&255,e[22]=M>>>16&255,e[23]=M>>>24&255,e[24]=A>>>0&255,e[25]=A>>>8&255,e[26]=A>>>16&255,e[27]=A>>>24&255,e[28]=T>>>0&255,e[29]=T>>>8&255,e[30]=T>>>16&255,e[31]=T>>>24&255,e[32]=P>>>0&255,e[33]=P>>>8&255,e[34]=P>>>16&255,e[35]=P>>>24&255,e[36]=R>>>0&255,e[37]=R>>>8&255,e[38]=R>>>16&255,e[39]=R>>>24&255,e[40]=x>>>0&255,e[41]=x>>>8&255,e[42]=x>>>16&255,e[43]=x>>>24&255,e[44]=N>>>0&255,e[45]=N>>>8&255,e[46]=N>>>16&255,e[47]=N>>>24&255,e[48]=O>>>0&255,e[49]=O>>>8&255,e[50]=O>>>16&255,e[51]=O>>>24&255,e[52]=I>>>0&255,e[53]=I>>>8&255,e[54]=I>>>16&255,e[55]=I>>>24&255,e[56]=j>>>0&255,e[57]=j>>>8&255,e[58]=j>>>16&255,e[59]=j>>>24&255,e[60]=L>>>0&255,e[61]=L>>>8&255,e[62]=L>>>16&255,e[63]=L>>>24&255}(e,t,r,n)}function v(e,t,r,n){!function(e,t,r,n){for(var s,o=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,i=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,c=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,l=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,u=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,m=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,g=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,y=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,w=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,k=0;k<20;k+=2)o^=(s=(y^=(s=(p^=(s=(l^=(s=o+y|0)<<7|s>>>25)+o|0)<<9|s>>>23)+l|0)<<13|s>>>19)+p|0)<<18|s>>>14,u^=(s=(i^=(s=(b^=(s=(f^=(s=u+i|0)<<7|s>>>25)+u|0)<<9|s>>>23)+f|0)<<13|s>>>19)+b|0)<<18|s>>>14,m^=(s=(d^=(s=(a^=(s=(v^=(s=m+d|0)<<7|s>>>25)+m|0)<<9|s>>>23)+v|0)<<13|s>>>19)+a|0)<<18|s>>>14,w^=(s=(g^=(s=(h^=(s=(c^=(s=w+g|0)<<7|s>>>25)+w|0)<<9|s>>>23)+c|0)<<13|s>>>19)+h|0)<<18|s>>>14,o^=(s=(c^=(s=(a^=(s=(i^=(s=o+c|0)<<7|s>>>25)+o|0)<<9|s>>>23)+i|0)<<13|s>>>19)+a|0)<<18|s>>>14,u^=(s=(l^=(s=(h^=(s=(d^=(s=u+l|0)<<7|s>>>25)+u|0)<<9|s>>>23)+d|0)<<13|s>>>19)+h|0)<<18|s>>>14,m^=(s=(f^=(s=(p^=(s=(g^=(s=m+f|0)<<7|s>>>25)+m|0)<<9|s>>>23)+g|0)<<13|s>>>19)+p|0)<<18|s>>>14,w^=(s=(v^=(s=(b^=(s=(y^=(s=w+v|0)<<7|s>>>25)+w|0)<<9|s>>>23)+y|0)<<13|s>>>19)+b|0)<<18|s>>>14;e[0]=o>>>0&255,e[1]=o>>>8&255,e[2]=o>>>16&255,e[3]=o>>>24&255,e[4]=u>>>0&255,e[5]=u>>>8&255,e[6]=u>>>16&255,e[7]=u>>>24&255,e[8]=m>>>0&255,e[9]=m>>>8&255,e[10]=m>>>16&255,e[11]=m>>>24&255,e[12]=w>>>0&255,e[13]=w>>>8&255,e[14]=w>>>16&255,e[15]=w>>>24&255,e[16]=d>>>0&255,e[17]=d>>>8&255,e[18]=d>>>16&255,e[19]=d>>>24&255,e[20]=h>>>0&255,e[21]=h>>>8&255,e[22]=h>>>16&255,e[23]=h>>>24&255,e[24]=p>>>0&255,e[25]=p>>>8&255,e[26]=p>>>16&255,e[27]=p>>>24&255,e[28]=f>>>0&255,e[29]=f>>>8&255,e[30]=f>>>16&255,e[31]=f>>>24&255}(e,t,r,n)}var w=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function k(e,t,r,n,s,o,i){var a,c,l=new Uint8Array(16),u=new Uint8Array(64);for(c=0;c<16;c++)l[c]=0;for(c=0;c<8;c++)l[c]=o[c];for(;s>=64;){for(b(u,l,i,w),c=0;c<64;c++)e[t+c]=r[n+c]^u[c];for(a=1,c=8;c<16;c++)a=a+(255&l[c])|0,l[c]=255&a,a>>>=8;s-=64,t+=64,n+=64}if(s>0)for(b(u,l,i,w),c=0;c<s;c++)e[t+c]=r[n+c]^u[c];return 0}function _(e,t,r,n,s){var o,i,a=new Uint8Array(16),c=new Uint8Array(64);for(i=0;i<16;i++)a[i]=0;for(i=0;i<8;i++)a[i]=n[i];for(;r>=64;){for(b(c,a,s,w),i=0;i<64;i++)e[t+i]=c[i];for(o=1,i=8;i<16;i++)o=o+(255&a[i])|0,a[i]=255&o,o>>>=8;r-=64,t+=64}if(r>0)for(b(c,a,s,w),i=0;i<r;i++)e[t+i]=c[i];return 0}function C(e,t,r,n,s){var o=new Uint8Array(32);v(o,n,s,w);for(var i=new Uint8Array(8),a=0;a<8;a++)i[a]=n[a+16];return _(e,t,r,i,o)}function E(e,t,r,n,s,o,i){var a=new Uint8Array(32);v(a,o,i,w);for(var c=new Uint8Array(8),l=0;l<8;l++)c[l]=o[l+16];return k(e,t,r,n,s,c,a)}var S=function(e){var t,r,n,s,o,i,a,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|r<<3),n=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(r>>>10|n<<6),s=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(n>>>7|s<<9),o=255&e[8]|(255&e[9])<<8,this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,i=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(o>>>14|i<<2),a=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(i>>>11|a<<5),c=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function M(e,t,r,n,s,o){var i=new S(o);return i.update(r,n,s),i.finish(e,t),0}function A(e,t,r,n,s,o){var i=new Uint8Array(16);return M(i,0,r,n,s,o),g(e,t,i,0)}function T(e,t,r,n,s){var o;if(r<32)return-1;for(E(e,0,t,0,r,n,s),M(e,16,e,32,r-32,e),o=0;o<16;o++)e[o]=0;return 0}function P(e,t,r,n,s){var o,i=new Uint8Array(32);if(r<32)return-1;if(C(i,0,32,n,s),0!==A(t,16,t,32,r-32,i))return-1;for(E(e,0,t,0,r,n,s),o=0;o<32;o++)e[o]=0;return 0}function R(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function x(e){var t,r,n=1;for(t=0;t<16;t++)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function N(e,t,r){for(var n,s=~(r-1),o=0;o<16;o++)n=s&(e[o]^t[o]),e[o]^=n,t[o]^=n}function O(e,t){var n,s,o,i=r(),a=r();for(n=0;n<16;n++)a[n]=t[n];for(x(a),x(a),x(a),s=0;s<2;s++){for(i[0]=a[0]-65517,n=1;n<15;n++)i[n]=a[n]-65535-(i[n-1]>>16&1),i[n-1]&=65535;i[15]=a[15]-32767-(i[14]>>16&1),o=i[15]>>16&1,i[14]&=65535,N(a,i,1-o)}for(n=0;n<16;n++)e[2*n]=255&a[n],e[2*n+1]=a[n]>>8}function I(e,t){var r=new Uint8Array(32),n=new Uint8Array(32);return O(r,e),O(n,t),y(r,0,n,0)}function j(e){var t=new Uint8Array(32);return O(t,e),1&t[0]}function L(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function U(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]+r[n]}function B(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]-r[n]}function D(e,t,r){var n,s,o=0,i=0,a=0,c=0,l=0,u=0,d=0,h=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,w=0,k=0,_=0,C=0,E=0,S=0,M=0,A=0,T=0,P=0,R=0,x=0,N=0,O=0,I=0,j=0,L=r[0],U=r[1],B=r[2],D=r[3],F=r[4],q=r[5],H=r[6],K=r[7],$=r[8],G=r[9],V=r[10],z=r[11],W=r[12],Y=r[13],J=r[14],X=r[15];o+=(n=t[0])*L,i+=n*U,a+=n*B,c+=n*D,l+=n*F,u+=n*q,d+=n*H,h+=n*K,p+=n*$,f+=n*G,m+=n*V,g+=n*z,y+=n*W,b+=n*Y,v+=n*J,w+=n*X,i+=(n=t[1])*L,a+=n*U,c+=n*B,l+=n*D,u+=n*F,d+=n*q,h+=n*H,p+=n*K,f+=n*$,m+=n*G,g+=n*V,y+=n*z,b+=n*W,v+=n*Y,w+=n*J,k+=n*X,a+=(n=t[2])*L,c+=n*U,l+=n*B,u+=n*D,d+=n*F,h+=n*q,p+=n*H,f+=n*K,m+=n*$,g+=n*G,y+=n*V,b+=n*z,v+=n*W,w+=n*Y,k+=n*J,_+=n*X,c+=(n=t[3])*L,l+=n*U,u+=n*B,d+=n*D,h+=n*F,p+=n*q,f+=n*H,m+=n*K,g+=n*$,y+=n*G,b+=n*V,v+=n*z,w+=n*W,k+=n*Y,_+=n*J,C+=n*X,l+=(n=t[4])*L,u+=n*U,d+=n*B,h+=n*D,p+=n*F,f+=n*q,m+=n*H,g+=n*K,y+=n*$,b+=n*G,v+=n*V,w+=n*z,k+=n*W,_+=n*Y,C+=n*J,E+=n*X,u+=(n=t[5])*L,d+=n*U,h+=n*B,p+=n*D,f+=n*F,m+=n*q,g+=n*H,y+=n*K,b+=n*$,v+=n*G,w+=n*V,k+=n*z,_+=n*W,C+=n*Y,E+=n*J,S+=n*X,d+=(n=t[6])*L,h+=n*U,p+=n*B,f+=n*D,m+=n*F,g+=n*q,y+=n*H,b+=n*K,v+=n*$,w+=n*G,k+=n*V,_+=n*z,C+=n*W,E+=n*Y,S+=n*J,M+=n*X,h+=(n=t[7])*L,p+=n*U,f+=n*B,m+=n*D,g+=n*F,y+=n*q,b+=n*H,v+=n*K,w+=n*$,k+=n*G,_+=n*V,C+=n*z,E+=n*W,S+=n*Y,M+=n*J,A+=n*X,p+=(n=t[8])*L,f+=n*U,m+=n*B,g+=n*D,y+=n*F,b+=n*q,v+=n*H,w+=n*K,k+=n*$,_+=n*G,C+=n*V,E+=n*z,S+=n*W,M+=n*Y,A+=n*J,T+=n*X,f+=(n=t[9])*L,m+=n*U,g+=n*B,y+=n*D,b+=n*F,v+=n*q,w+=n*H,k+=n*K,_+=n*$,C+=n*G,E+=n*V,S+=n*z,M+=n*W,A+=n*Y,T+=n*J,P+=n*X,m+=(n=t[10])*L,g+=n*U,y+=n*B,b+=n*D,v+=n*F,w+=n*q,k+=n*H,_+=n*K,C+=n*$,E+=n*G,S+=n*V,M+=n*z,A+=n*W,T+=n*Y,P+=n*J,R+=n*X,g+=(n=t[11])*L,y+=n*U,b+=n*B,v+=n*D,w+=n*F,k+=n*q,_+=n*H,C+=n*K,E+=n*$,S+=n*G,M+=n*V,A+=n*z,T+=n*W,P+=n*Y,R+=n*J,x+=n*X,y+=(n=t[12])*L,b+=n*U,v+=n*B,w+=n*D,k+=n*F,_+=n*q,C+=n*H,E+=n*K,S+=n*$,M+=n*G,A+=n*V,T+=n*z,P+=n*W,R+=n*Y,x+=n*J,N+=n*X,b+=(n=t[13])*L,v+=n*U,w+=n*B,k+=n*D,_+=n*F,C+=n*q,E+=n*H,S+=n*K,M+=n*$,A+=n*G,T+=n*V,P+=n*z,R+=n*W,x+=n*Y,N+=n*J,O+=n*X,v+=(n=t[14])*L,w+=n*U,k+=n*B,_+=n*D,C+=n*F,E+=n*q,S+=n*H,M+=n*K,A+=n*$,T+=n*G,P+=n*V,R+=n*z,x+=n*W,N+=n*Y,O+=n*J,I+=n*X,w+=(n=t[15])*L,i+=38*(_+=n*B),a+=38*(C+=n*D),c+=38*(E+=n*F),l+=38*(S+=n*q),u+=38*(M+=n*H),d+=38*(A+=n*K),h+=38*(T+=n*$),p+=38*(P+=n*G),f+=38*(R+=n*V),m+=38*(x+=n*z),g+=38*(N+=n*W),y+=38*(O+=n*Y),b+=38*(I+=n*J),v+=38*(j+=n*X),o=(n=(o+=38*(k+=n*U))+(s=1)+65535)-65536*(s=Math.floor(n/65536)),i=(n=i+s+65535)-65536*(s=Math.floor(n/65536)),a=(n=a+s+65535)-65536*(s=Math.floor(n/65536)),c=(n=c+s+65535)-65536*(s=Math.floor(n/65536)),l=(n=l+s+65535)-65536*(s=Math.floor(n/65536)),u=(n=u+s+65535)-65536*(s=Math.floor(n/65536)),d=(n=d+s+65535)-65536*(s=Math.floor(n/65536)),h=(n=h+s+65535)-65536*(s=Math.floor(n/65536)),p=(n=p+s+65535)-65536*(s=Math.floor(n/65536)),f=(n=f+s+65535)-65536*(s=Math.floor(n/65536)),m=(n=m+s+65535)-65536*(s=Math.floor(n/65536)),g=(n=g+s+65535)-65536*(s=Math.floor(n/65536)),y=(n=y+s+65535)-65536*(s=Math.floor(n/65536)),b=(n=b+s+65535)-65536*(s=Math.floor(n/65536)),v=(n=v+s+65535)-65536*(s=Math.floor(n/65536)),w=(n=w+s+65535)-65536*(s=Math.floor(n/65536)),o=(n=(o+=s-1+37*(s-1))+(s=1)+65535)-65536*(s=Math.floor(n/65536)),i=(n=i+s+65535)-65536*(s=Math.floor(n/65536)),a=(n=a+s+65535)-65536*(s=Math.floor(n/65536)),c=(n=c+s+65535)-65536*(s=Math.floor(n/65536)),l=(n=l+s+65535)-65536*(s=Math.floor(n/65536)),u=(n=u+s+65535)-65536*(s=Math.floor(n/65536)),d=(n=d+s+65535)-65536*(s=Math.floor(n/65536)),h=(n=h+s+65535)-65536*(s=Math.floor(n/65536)),p=(n=p+s+65535)-65536*(s=Math.floor(n/65536)),f=(n=f+s+65535)-65536*(s=Math.floor(n/65536)),m=(n=m+s+65535)-65536*(s=Math.floor(n/65536)),g=(n=g+s+65535)-65536*(s=Math.floor(n/65536)),y=(n=y+s+65535)-65536*(s=Math.floor(n/65536)),b=(n=b+s+65535)-65536*(s=Math.floor(n/65536)),v=(n=v+s+65535)-65536*(s=Math.floor(n/65536)),w=(n=w+s+65535)-65536*(s=Math.floor(n/65536)),o+=s-1+37*(s-1),e[0]=o,e[1]=i,e[2]=a,e[3]=c,e[4]=l,e[5]=u,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=y,e[13]=b,e[14]=v,e[15]=w}function F(e,t){D(e,t,t)}function q(e,t){var n,s=r();for(n=0;n<16;n++)s[n]=t[n];for(n=253;n>=0;n--)F(s,s),2!==n&&4!==n&&D(s,s,t);for(n=0;n<16;n++)e[n]=s[n]}function H(e,t){var n,s=r();for(n=0;n<16;n++)s[n]=t[n];for(n=250;n>=0;n--)F(s,s),1!==n&&D(s,s,t);for(n=0;n<16;n++)e[n]=s[n]}function K(e,t,n){var s,o,i=new Uint8Array(32),a=new Float64Array(80),l=r(),u=r(),d=r(),h=r(),p=r(),f=r();for(o=0;o<31;o++)i[o]=t[o];for(i[31]=127&t[31]|64,i[0]&=248,L(a,n),o=0;o<16;o++)u[o]=a[o],h[o]=l[o]=d[o]=0;for(l[0]=h[0]=1,o=254;o>=0;--o)N(l,u,s=i[o>>>3]>>>(7&o)&1),N(d,h,s),U(p,l,d),B(l,l,d),U(d,u,h),B(u,u,h),F(h,p),F(f,l),D(l,d,l),D(d,u,p),U(p,l,d),B(l,l,d),F(u,l),B(d,h,f),D(l,d,c),U(l,l,h),D(d,d,l),D(l,h,f),D(h,u,a),F(u,p),N(l,u,s),N(d,h,s);for(o=0;o<16;o++)a[o+16]=l[o],a[o+32]=d[o],a[o+48]=u[o],a[o+64]=h[o];var m=a.subarray(32),g=a.subarray(16);return q(m,m),D(g,g,m),O(e,g),0}function $(e,t){return K(e,t,o)}function G(e,t){return n(t,32),$(e,t)}function V(e,t,r){var n=new Uint8Array(32);return K(n,r,t),v(e,s,n,w)}S.prototype.blocks=function(e,t,r){for(var n,s,o,i,a,c,l,u,d,h,p,f,m,g,y,b,v,w,k,_=this.fin?0:2048,C=this.h[0],E=this.h[1],S=this.h[2],M=this.h[3],A=this.h[4],T=this.h[5],P=this.h[6],R=this.h[7],x=this.h[8],N=this.h[9],O=this.r[0],I=this.r[1],j=this.r[2],L=this.r[3],U=this.r[4],B=this.r[5],D=this.r[6],F=this.r[7],q=this.r[8],H=this.r[9];r>=16;)h=d=0,h+=(C+=8191&(n=255&e[t+0]|(255&e[t+1])<<8))*O,h+=(E+=8191&(n>>>13|(s=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*H),h+=(S+=8191&(s>>>10|(o=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*q),h+=(M+=8191&(o>>>7|(i=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*F),d=(h+=(A+=8191&(i>>>4|(a=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*D))>>>13,h&=8191,h+=(T+=a>>>1&8191)*(5*B),h+=(P+=8191&(a>>>14|(c=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*U),h+=(R+=8191&(c>>>11|(l=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*L),h+=(x+=8191&(l>>>8|(u=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*j),p=d+=(h+=(N+=u>>>5|_)*(5*I))>>>13,p+=C*I,p+=E*O,p+=S*(5*H),p+=M*(5*q),d=(p+=A*(5*F))>>>13,p&=8191,p+=T*(5*D),p+=P*(5*B),p+=R*(5*U),p+=x*(5*L),d+=(p+=N*(5*j))>>>13,p&=8191,f=d,f+=C*j,f+=E*I,f+=S*O,f+=M*(5*H),d=(f+=A*(5*q))>>>13,f&=8191,f+=T*(5*F),f+=P*(5*D),f+=R*(5*B),f+=x*(5*U),m=d+=(f+=N*(5*L))>>>13,m+=C*L,m+=E*j,m+=S*I,m+=M*O,d=(m+=A*(5*H))>>>13,m&=8191,m+=T*(5*q),m+=P*(5*F),m+=R*(5*D),m+=x*(5*B),g=d+=(m+=N*(5*U))>>>13,g+=C*U,g+=E*L,g+=S*j,g+=M*I,d=(g+=A*O)>>>13,g&=8191,g+=T*(5*H),g+=P*(5*q),g+=R*(5*F),g+=x*(5*D),y=d+=(g+=N*(5*B))>>>13,y+=C*B,y+=E*U,y+=S*L,y+=M*j,d=(y+=A*I)>>>13,y&=8191,y+=T*O,y+=P*(5*H),y+=R*(5*q),y+=x*(5*F),b=d+=(y+=N*(5*D))>>>13,b+=C*D,b+=E*B,b+=S*U,b+=M*L,d=(b+=A*j)>>>13,b&=8191,b+=T*I,b+=P*O,b+=R*(5*H),b+=x*(5*q),v=d+=(b+=N*(5*F))>>>13,v+=C*F,v+=E*D,v+=S*B,v+=M*U,d=(v+=A*L)>>>13,v&=8191,v+=T*j,v+=P*I,v+=R*O,v+=x*(5*H),w=d+=(v+=N*(5*q))>>>13,w+=C*q,w+=E*F,w+=S*D,w+=M*B,d=(w+=A*U)>>>13,w&=8191,w+=T*L,w+=P*j,w+=R*I,w+=x*O,k=d+=(w+=N*(5*H))>>>13,k+=C*H,k+=E*q,k+=S*F,k+=M*D,d=(k+=A*B)>>>13,k&=8191,k+=T*U,k+=P*L,k+=R*j,k+=x*I,C=h=8191&(d=(d=((d+=(k+=N*O)>>>13)<<2)+d|0)+(h&=8191)|0),E=p+=d>>>=13,S=f&=8191,M=m&=8191,A=g&=8191,T=y&=8191,P=b&=8191,R=v&=8191,x=w&=8191,N=k&=8191,t+=16,r-=16;this.h[0]=C,this.h[1]=E,this.h[2]=S,this.h[3]=M,this.h[4]=A,this.h[5]=T,this.h[6]=P,this.h[7]=R,this.h[8]=x,this.h[9]=N},S.prototype.finish=function(e,t){var r,n,s,o,i=new Uint16Array(10);if(this.leftover){for(o=this.leftover,this.buffer[o++]=1;o<16;o++)this.buffer[o]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,o=2;o<10;o++)this.h[o]+=r,r=this.h[o]>>>13,this.h[o]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,i[0]=this.h[0]+5,r=i[0]>>>13,i[0]&=8191,o=1;o<10;o++)i[o]=this.h[o]+r,r=i[o]>>>13,i[o]&=8191;for(i[9]-=8192,n=(1^r)-1,o=0;o<10;o++)i[o]&=n;for(n=~n,o=0;o<10;o++)this.h[o]=this.h[o]&n|i[o];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),s=this.h[0]+this.pad[0],this.h[0]=65535&s,o=1;o<8;o++)s=(this.h[o]+this.pad[o]|0)+(s>>>16)|0,this.h[o]=65535&s;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},S.prototype.update=function(e,t,r){var n,s;if(this.leftover){for((s=16-this.leftover)>r&&(s=r),n=0;n<s;n++)this.buffer[this.leftover+n]=e[t+n];if(r-=s,t+=s,this.leftover+=s,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(s=r-r%16,this.blocks(e,t,s),t+=s,r-=s),r){for(n=0;n<r;n++)this.buffer[this.leftover+n]=e[t+n];this.leftover+=r}};var z=T,W=P;var Y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function J(e,t,r,n){for(var s,o,i,a,c,l,u,d,h,p,f,m,g,y,b,v,w,k,_,C,E,S,M,A,T,P,R=new Int32Array(16),x=new Int32Array(16),N=e[0],O=e[1],I=e[2],j=e[3],L=e[4],U=e[5],B=e[6],D=e[7],F=t[0],q=t[1],H=t[2],K=t[3],$=t[4],G=t[5],V=t[6],z=t[7],W=0;n>=128;){for(_=0;_<16;_++)C=8*_+W,R[_]=r[C+0]<<24|r[C+1]<<16|r[C+2]<<8|r[C+3],x[_]=r[C+4]<<24|r[C+5]<<16|r[C+6]<<8|r[C+7];for(_=0;_<80;_++)if(s=N,o=O,i=I,a=j,c=L,l=U,u=B,D,h=F,p=q,f=H,m=K,g=$,y=G,b=V,z,M=65535&(S=z),A=S>>>16,T=65535&(E=D),P=E>>>16,M+=65535&(S=($>>>14|L<<18)^($>>>18|L<<14)^(L>>>9|$<<23)),A+=S>>>16,T+=65535&(E=(L>>>14|$<<18)^(L>>>18|$<<14)^($>>>9|L<<23)),P+=E>>>16,M+=65535&(S=$&G^~$&V),A+=S>>>16,T+=65535&(E=L&U^~L&B),P+=E>>>16,M+=65535&(S=Y[2*_+1]),A+=S>>>16,T+=65535&(E=Y[2*_]),P+=E>>>16,E=R[_%16],A+=(S=x[_%16])>>>16,T+=65535&E,P+=E>>>16,T+=(A+=(M+=65535&S)>>>16)>>>16,M=65535&(S=k=65535&M|A<<16),A=S>>>16,T=65535&(E=w=65535&T|(P+=T>>>16)<<16),P=E>>>16,M+=65535&(S=(F>>>28|N<<4)^(N>>>2|F<<30)^(N>>>7|F<<25)),A+=S>>>16,T+=65535&(E=(N>>>28|F<<4)^(F>>>2|N<<30)^(F>>>7|N<<25)),P+=E>>>16,A+=(S=F&q^F&H^q&H)>>>16,T+=65535&(E=N&O^N&I^O&I),P+=E>>>16,d=65535&(T+=(A+=(M+=65535&S)>>>16)>>>16)|(P+=T>>>16)<<16,v=65535&M|A<<16,M=65535&(S=m),A=S>>>16,T=65535&(E=a),P=E>>>16,A+=(S=k)>>>16,T+=65535&(E=w),P+=E>>>16,O=s,I=o,j=i,L=a=65535&(T+=(A+=(M+=65535&S)>>>16)>>>16)|(P+=T>>>16)<<16,U=c,B=l,D=u,N=d,q=h,H=p,K=f,$=m=65535&M|A<<16,G=g,V=y,z=b,F=v,_%16==15)for(C=0;C<16;C++)E=R[C],M=65535&(S=x[C]),A=S>>>16,T=65535&E,P=E>>>16,E=R[(C+9)%16],M+=65535&(S=x[(C+9)%16]),A+=S>>>16,T+=65535&E,P+=E>>>16,w=R[(C+1)%16],M+=65535&(S=((k=x[(C+1)%16])>>>1|w<<31)^(k>>>8|w<<24)^(k>>>7|w<<25)),A+=S>>>16,T+=65535&(E=(w>>>1|k<<31)^(w>>>8|k<<24)^w>>>7),P+=E>>>16,w=R[(C+14)%16],A+=(S=((k=x[(C+14)%16])>>>19|w<<13)^(w>>>29|k<<3)^(k>>>6|w<<26))>>>16,T+=65535&(E=(w>>>19|k<<13)^(k>>>29|w<<3)^w>>>6),P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,R[C]=65535&T|P<<16,x[C]=65535&M|A<<16;M=65535&(S=F),A=S>>>16,T=65535&(E=N),P=E>>>16,E=e[0],A+=(S=t[0])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[0]=N=65535&T|P<<16,t[0]=F=65535&M|A<<16,M=65535&(S=q),A=S>>>16,T=65535&(E=O),P=E>>>16,E=e[1],A+=(S=t[1])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[1]=O=65535&T|P<<16,t[1]=q=65535&M|A<<16,M=65535&(S=H),A=S>>>16,T=65535&(E=I),P=E>>>16,E=e[2],A+=(S=t[2])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[2]=I=65535&T|P<<16,t[2]=H=65535&M|A<<16,M=65535&(S=K),A=S>>>16,T=65535&(E=j),P=E>>>16,E=e[3],A+=(S=t[3])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[3]=j=65535&T|P<<16,t[3]=K=65535&M|A<<16,M=65535&(S=$),A=S>>>16,T=65535&(E=L),P=E>>>16,E=e[4],A+=(S=t[4])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[4]=L=65535&T|P<<16,t[4]=$=65535&M|A<<16,M=65535&(S=G),A=S>>>16,T=65535&(E=U),P=E>>>16,E=e[5],A+=(S=t[5])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[5]=U=65535&T|P<<16,t[5]=G=65535&M|A<<16,M=65535&(S=V),A=S>>>16,T=65535&(E=B),P=E>>>16,E=e[6],A+=(S=t[6])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[6]=B=65535&T|P<<16,t[6]=V=65535&M|A<<16,M=65535&(S=z),A=S>>>16,T=65535&(E=D),P=E>>>16,E=e[7],A+=(S=t[7])>>>16,T+=65535&E,P+=E>>>16,P+=(T+=(A+=(M+=65535&S)>>>16)>>>16)>>>16,e[7]=D=65535&T|P<<16,t[7]=z=65535&M|A<<16,W+=128,n-=128}return n}function X(e,t,r){var n,s=new Int32Array(8),o=new Int32Array(8),i=new Uint8Array(256),a=r;for(s[0]=1779033703,s[1]=3144134277,s[2]=1013904242,s[3]=2773480762,s[4]=1359893119,s[5]=2600822924,s[6]=528734635,s[7]=1541459225,o[0]=4089235720,o[1]=2227873595,o[2]=4271175723,o[3]=1595750129,o[4]=2917565137,o[5]=725511199,o[6]=4215389547,o[7]=327033209,J(s,o,t,r),r%=128,n=0;n<r;n++)i[n]=t[a-r+n];for(i[r]=128,i[(r=256-128*(r<112?1:0))-9]=0,f(i,r-8,a/536870912|0,a<<3),J(s,o,i,r),n=0;n<8;n++)f(e,8*n,s[n],o[n]);return 0}function Z(e,t){var n=r(),s=r(),o=r(),i=r(),a=r(),c=r(),l=r(),d=r(),h=r();B(n,e[1],e[0]),B(h,t[1],t[0]),D(n,n,h),U(s,e[0],e[1]),U(h,t[0],t[1]),D(s,s,h),D(o,e[3],t[3]),D(o,o,u),D(i,e[2],t[2]),U(i,i,i),B(a,s,n),B(c,i,o),U(l,i,o),U(d,s,n),D(e[0],a,c),D(e[1],d,l),D(e[2],l,c),D(e[3],a,d)}function Q(e,t,r){var n;for(n=0;n<4;n++)N(e[n],t[n],r)}function ee(e,t){var n=r(),s=r(),o=r();q(o,t[2]),D(n,t[0],o),D(s,t[1],o),O(e,s),e[31]^=j(n)<<7}function te(e,t,r){var n,s;for(R(e[0],i),R(e[1],a),R(e[2],a),R(e[3],i),s=255;s>=0;--s)Q(e,t,n=r[s/8|0]>>(7&s)&1),Z(t,e),Z(e,e),Q(e,t,n)}function re(e,t){var n=[r(),r(),r(),r()];R(n[0],d),R(n[1],h),R(n[2],a),D(n[3],d,h),te(e,n,t)}function ne(e,t,s){var o,i=new Uint8Array(64),a=[r(),r(),r(),r()];for(s||n(t,32),X(i,t,32),i[0]&=248,i[31]&=127,i[31]|=64,re(a,i),ee(e,a),o=0;o<32;o++)t[o+32]=e[o];return 0}var se=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function oe(e,t){var r,n,s,o;for(n=63;n>=32;--n){for(r=0,s=n-32,o=n-12;s<o;++s)t[s]+=r-16*t[n]*se[s-(n-32)],r=Math.floor((t[s]+128)/256),t[s]-=256*r;t[s]+=r,t[n]=0}for(r=0,s=0;s<32;s++)t[s]+=r-(t[31]>>4)*se[s],r=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=r*se[s];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function ie(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;oe(e,r)}function ae(e,t,n,s){var o,i,a=new Uint8Array(64),c=new Uint8Array(64),l=new Uint8Array(64),u=new Float64Array(64),d=[r(),r(),r(),r()];X(a,s,32),a[0]&=248,a[31]&=127,a[31]|=64;var h=n+64;for(o=0;o<n;o++)e[64+o]=t[o];for(o=0;o<32;o++)e[32+o]=a[32+o];for(X(l,e.subarray(32),n+32),ie(l),re(d,l),ee(e,d),o=32;o<64;o++)e[o]=s[o];for(X(c,e,n+64),ie(c),o=0;o<64;o++)u[o]=0;for(o=0;o<32;o++)u[o]=l[o];for(o=0;o<32;o++)for(i=0;i<32;i++)u[o+i]+=c[o]*a[i];return oe(e.subarray(32),u),h}function ce(e,t,n,s){var o,c=new Uint8Array(32),u=new Uint8Array(64),d=[r(),r(),r(),r()],h=[r(),r(),r(),r()];if(n<64)return-1;if(function(e,t){var n=r(),s=r(),o=r(),c=r(),u=r(),d=r(),h=r();return R(e[2],a),L(e[1],t),F(o,e[1]),D(c,o,l),B(o,o,e[2]),U(c,e[2],c),F(u,c),F(d,u),D(h,d,u),D(n,h,o),D(n,n,c),H(n,n),D(n,n,o),D(n,n,c),D(n,n,c),D(e[0],n,c),F(s,e[0]),D(s,s,c),I(s,o)&&D(e[0],e[0],p),F(s,e[0]),D(s,s,c),I(s,o)?-1:(j(e[0])===t[31]>>7&&B(e[0],i,e[0]),D(e[3],e[0],e[1]),0)}(h,s))return-1;for(o=0;o<n;o++)e[o]=t[o];for(o=0;o<32;o++)e[o+32]=s[o];if(X(u,e,n),ie(u),te(d,h,u),re(h,t.subarray(32)),Z(d,h),ee(c,d),n-=64,y(t,0,c,0)){for(o=0;o<n;o++)e[o]=0;return-1}for(o=0;o<n;o++)e[o]=t[o+64];return n}var le=16,ue=64,de=32,he=64;function pe(e,t){if(32!==e.length)throw new Error("bad key size");if(24!==t.length)throw new Error("bad nonce size")}function fe(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function me(e){for(var t=0;t<e.length;t++)e[t]=0}t.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:E,crypto_stream:C,crypto_stream_salsa20_xor:k,crypto_stream_salsa20:_,crypto_onetimeauth:M,crypto_onetimeauth_verify:A,crypto_verify_16:g,crypto_verify_32:y,crypto_secretbox:T,crypto_secretbox_open:P,crypto_scalarmult:K,crypto_scalarmult_base:$,crypto_box_beforenm:V,crypto_box_afternm:z,crypto_box:function(e,t,r,n,s,o){var i=new Uint8Array(32);return V(i,s,o),z(e,t,r,n,i)},crypto_box_open:function(e,t,r,n,s,o){var i=new Uint8Array(32);return V(i,s,o),W(e,t,r,n,i)},crypto_box_keypair:G,crypto_hash:X,crypto_sign:ae,crypto_sign_keypair:ne,crypto_sign_open:ce,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:le,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:ue,crypto_sign_PUBLICKEYBYTES:de,crypto_sign_SECRETKEYBYTES:he,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:r,D:l,L:se,pack25519:O,unpack25519:L,M:D,A:U,S:F,Z:B,pow2523:H,add:Z,set25519:R,modL:oe,scalarmult:te,scalarbase:re},t.randomBytes=function(e){var t=new Uint8Array(e);return n(t,e),t},t.secretbox=function(e,t,r){fe(e,t,r),pe(r,t);for(var n=new Uint8Array(32+e.length),s=new Uint8Array(n.length),o=0;o<e.length;o++)n[o+32]=e[o];return T(s,n,n.length,t,r),s.subarray(le)},t.secretbox.open=function(e,t,r){fe(e,t,r),pe(r,t);for(var n=new Uint8Array(le+e.length),s=new Uint8Array(n.length),o=0;o<e.length;o++)n[o+le]=e[o];return n.length<32||0!==P(s,n,n.length,t,r)?null:s.subarray(32)},t.secretbox.keyLength=32,t.secretbox.nonceLength=24,t.secretbox.overheadLength=le,t.scalarMult=function(e,t){if(fe(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var r=new Uint8Array(32);return K(r,e,t),r},t.scalarMult.base=function(e){if(fe(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return $(t,e),t},t.scalarMult.scalarLength=32,t.scalarMult.groupElementLength=32,t.box=function(e,r,n,s){var o=t.box.before(n,s);return t.secretbox(e,r,o)},t.box.before=function(e,t){fe(e,t),function(e,t){if(32!==e.length)throw new Error("bad public key size");if(32!==t.length)throw new Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return V(r,e,t),r},t.box.after=t.secretbox,t.box.open=function(e,r,n,s){var o=t.box.before(n,s);return t.secretbox.open(e,r,o)},t.box.open.after=t.secretbox.open,t.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return G(e,t),{publicKey:e,secretKey:t}},t.box.keyPair.fromSecretKey=function(e){if(fe(e),32!==e.length)throw new Error("bad secret key size");var t=new Uint8Array(32);return $(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},t.box.publicKeyLength=32,t.box.secretKeyLength=32,t.box.sharedKeyLength=32,t.box.nonceLength=24,t.box.overheadLength=t.secretbox.overheadLength,t.sign=function(e,t){if(fe(e,t),t.length!==he)throw new Error("bad secret key size");var r=new Uint8Array(ue+e.length);return ae(r,e,e.length,t),r},t.sign.open=function(e,t){if(fe(e,t),t.length!==de)throw new Error("bad public key size");var r=new Uint8Array(e.length),n=ce(r,e,e.length,t);if(n<0)return null;for(var s=new Uint8Array(n),o=0;o<s.length;o++)s[o]=r[o];return s},t.sign.detached=function(e,r){for(var n=t.sign(e,r),s=new Uint8Array(ue),o=0;o<s.length;o++)s[o]=n[o];return s},t.sign.detached.verify=function(e,t,r){if(fe(e,t,r),t.length!==ue)throw new Error("bad signature size");if(r.length!==de)throw new Error("bad public key size");var n,s=new Uint8Array(ue+e.length),o=new Uint8Array(ue+e.length);for(n=0;n<ue;n++)s[n]=t[n];for(n=0;n<e.length;n++)s[n+ue]=e[n];return ce(o,s,s.length,r)>=0},t.sign.keyPair=function(){var e=new Uint8Array(de),t=new Uint8Array(he);return ne(e,t),{publicKey:e,secretKey:t}},t.sign.keyPair.fromSecretKey=function(e){if(fe(e),e.length!==he)throw new Error("bad secret key size");for(var t=new Uint8Array(de),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},t.sign.keyPair.fromSeed=function(e){if(fe(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(de),r=new Uint8Array(he),n=0;n<32;n++)r[n]=e[n];return ne(t,r,!0),{publicKey:t,secretKey:r}},t.sign.publicKeyLength=de,t.sign.secretKeyLength=he,t.sign.seedLength=32,t.sign.signatureLength=ue,t.hash=function(e){fe(e);var t=new Uint8Array(64);return X(t,e,e.length),t},t.hash.hashLength=64,t.verify=function(e,t){return fe(e,t),0!==e.length&&0!==t.length&&(e.length===t.length&&0===m(e,0,t,0,e.length))},t.setPRNG=function(e){n=e},function(){var r="undefined"!=typeof self?self.crypto||self.msCrypto:null;if(r&&r.getRandomValues){t.setPRNG((function(e,t){var n,s=new Uint8Array(t);for(n=0;n<t;n+=65536)r.getRandomValues(s.subarray(n,n+Math.min(t-n,65536)));for(n=0;n<t;n++)e[n]=s[n];me(s)}))}else void 0!==e&&(r=e("crypto"))&&r.randomBytes&&t.setPRNG((function(e,t){var n,s=r.randomBytes(t);for(n=0;n<t;n++)e[n]=s[n];me(s)}))}()}(void 0!==t&&t.exports?t.exports:self.nacl=self.nacl||{})}}},{package:"eth-sig-util>tweetnacl"}],[5235,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}}}},{package:"@ensdomains/content-hash>cids>uint8arrays"}],[5236,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}}}},{package:"@ensdomains/content-hash>cids>uint8arrays"}],[5237,{multibase:4790},function(){with(this)return function(){"use strict";return function(e,t,r){const{encoding:n}=e("multibase"),s=new TextEncoder;t.exports=function(e,t="utf8"){return"utf8"===t||"utf-8"===t?s.encode(e):"ascii"===t?function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e):n(t).decode(e)}}}},{package:"@ensdomains/content-hash>cids>uint8arrays"}],[5238,{multibase:4790},function(){with(this)return function(){"use strict";return function(e,t,r){const{encoding:n}=e("multibase"),s=new TextDecoder("utf8");t.exports=function(e,t="utf8"){return"utf8"===t||"utf-8"===t?s.decode(e):"ascii"===t?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):n(t).encode(e)}}}},{package:"@ensdomains/content-hash>cids>uint8arrays"}],[5266,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r){var n,s=0,o=0,i=r=r||0,a=t.length;do{if(i>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[i++],s+=o<28?(127&n)<<o:(127&n)*Math.pow(2,o),o+=7}while(n>=128);return e.bytes=i-r,s}}}},{package:"@ensdomains/content-hash>multihashes>varint"}],[5267,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r,s){r=r||[];var o=s=s||0;for(;t>=n;)r[s++]=255&t|128,t/=128;for(;-128&t;)r[s++]=255&t|128,t>>>=7;return r[s]=0|t,e.bytes=s-o+1,r};var n=Math.pow(2,31)}}},{package:"@ensdomains/content-hash>multihashes>varint"}],[5268,{"./decode.js":5266,"./encode.js":5267,"./length.js":5269},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={encode:e("./encode.js"),decode:e("./decode.js"),encodingLength:e("./length.js")}}}},{package:"@ensdomains/content-hash>multihashes>varint"}],[5269,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=Math.pow(2,7),s=Math.pow(2,14),o=Math.pow(2,21),i=Math.pow(2,28),a=Math.pow(2,35),c=Math.pow(2,42),l=Math.pow(2,49),u=Math.pow(2,56),d=Math.pow(2,63);t.exports=function(e){return e<n?1:e<s?2:e<o?3:e<i?4:e<a?5:e<c?6:e<l?7:e<u?8:e<d?9:10}}}},{package:"@ensdomains/content-hash>multihashes>varint"}],[5272,{util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){r.TextEncoder="undefined"!=typeof TextEncoder?TextEncoder:e("util").TextEncoder,r.TextDecoder="undefined"!=typeof TextDecoder?TextDecoder:e("util").TextDecoder}}},{package:"@ensdomains/content-hash>multihashes>web-encoding"}],[5273,{"./util/create-payload.js":5310,"./util/rpc-cache-utils.js":5313,"./util/stoplight.js":5314,"async/eachSeries":1545,"async/map":1561,"eth-block-tracker":5275,"ethereumjs-util":5287,events:1798,util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events").EventEmitter,s=e("util").inherits,o=e("ethereumjs-util"),i=e("eth-block-tracker"),a=e("async/map"),c=e("async/eachSeries"),l=e("./util/stoplight.js"),u=(e("./util/rpc-cache-utils.js"),e("./util/create-payload.js")),d=function(){};function h(e){const t=this;n.call(t),t.setMaxListeners(30),e=e||{};const r={sendAsync:t._handleAsync.bind(t)},s=e.blockTrackerProvider||r;t._blockTracker=e.blockTracker||new i({provider:s,pollingInterval:e.pollingInterval||4e3,setSkipCacheFlag:!0}),t._ready=new l,t.currentBlock=null,t._providers=[]}t.exports=h,s(h,n),h.prototype.start=function(e=d){const t=this;t._ready.go(),t._blockTracker.on("latest",(e=>{t._getBlockByNumberWithRetry(e,((e,r)=>{if(e)return void this.emit("error",e);if(!r)return console.log(r),void this.emit("error",new Error("Could not find block"));const n=(s=r,{number:o.toBuffer(s.number),hash:o.toBuffer(s.hash),parentHash:o.toBuffer(s.parentHash),nonce:o.toBuffer(s.nonce),mixHash:o.toBuffer(s.mixHash),sha3Uncles:o.toBuffer(s.sha3Uncles),logsBloom:o.toBuffer(s.logsBloom),transactionsRoot:o.toBuffer(s.transactionsRoot),stateRoot:o.toBuffer(s.stateRoot),receiptsRoot:o.toBuffer(s.receiptRoot||s.receiptsRoot),miner:o.toBuffer(s.miner),difficulty:o.toBuffer(s.difficulty),totalDifficulty:o.toBuffer(s.totalDifficulty),size:o.toBuffer(s.size),extraData:o.toBuffer(s.extraData),gasLimit:o.toBuffer(s.gasLimit),gasUsed:o.toBuffer(s.gasUsed),timestamp:o.toBuffer(s.timestamp),transactions:s.transactions});var s;t._setCurrentBlock(n),t.emit("rawBlock",r),t.emit("latest",r)}))})),t._blockTracker.on("sync",t.emit.bind(t,"sync")),t._blockTracker.on("error",t.emit.bind(t,"error")),t._running=!0,t.emit("start")},h.prototype.stop=function(){const e=this;e._blockTracker.removeAllListeners(),e._running=!1,e.emit("stop")},h.prototype.isRunning=function(){return this._running},h.prototype.addProvider=function(e,t){const r=this;"number"==typeof t?r._providers.splice(t,0,e):r._providers.push(e),e.setEngine(this)},h.prototype.removeProvider=function(e){const t=this._providers.indexOf(e);if(t<0)throw new Error("Provider not found.");this._providers.splice(t,1)},h.prototype.send=function(e){throw new Error("Web3ProviderEngine does not support synchronous requests.")},h.prototype.sendAsync=function(e,t){const r=this;r._ready.await((function(){Array.isArray(e)?a(e,r._handleAsync.bind(r),t):r._handleAsync(e,t)}))},h.prototype._getBlockByNumberWithRetry=function(e,t){const r=this;let n=5;return void s();function s(){r._getBlockByNumber(e,o)}function o(e,r){return e?t(e):r?void t(null,r):n>0?(n--,void setTimeout((function(){s()}),1e3)):void t(null,null)}},h.prototype._getBlockByNumber=function(e,t){const r=u({method:"eth_getBlockByNumber",params:[e,!1],skipCache:!0});this._handleAsync(r,((e,r)=>e?t(e):t(null,r.result)))},h.prototype._handleAsync=function(e,t){var r=this,n=-1,s=null,o=null,i=[];function a(r,n){o=r,s=n,c(i,(function(e,t){e?e(o,s,t):t()}),(function(){var r={id:e.id,jsonrpc:e.jsonrpc,result:s};null!=o?(r.error={message:o.stack||o.message||o,code:-32e3},t(o,r)):t(null,r)}))}!function t(s){if(n+=1,i.unshift(s),n>=r._providers.length)a(new Error('Request for method "'+e.method+'" not handled by any subprovider. Please check your subprovider configuration to ensure this method is handled.'));else try{r._providers[n].handleRequest(e,t,a)}catch(e){a(e)}}()},h.prototype._setCurrentBlock=function(e){this.currentBlock=e,this.emit("block",e)}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5274,{"eth-query":2099,pify:5293,"safe-event-emitter":5082},function(){with(this)return function(){"use strict";return function(e,t,r){e("eth-query"),e("pify");const n=e("safe-event-emitter"),s=(e,t)=>e+t,o=["sync","latest"];function i(e){return Number.parseInt(e,16)}t.exports=class extends n{constructor(e={}){super(),this._blockResetDuration=e.blockResetDuration||2e4,this._blockResetTimeout,this._currentBlock=null,this._isRunning=!1,this._onNewListener=this._onNewListener.bind(this),this._onRemoveListener=this._onRemoveListener.bind(this),this._resetCurrentBlock=this._resetCurrentBlock.bind(this),this._setupInternalEvents()}isRunning(){return this._isRunning}getCurrentBlock(){return this._currentBlock}async getLatestBlock(){if(this._currentBlock)return this._currentBlock;return await new Promise((e=>this.once("latest",e)))}removeAllListeners(e){e?super.removeAllListeners(e):super.removeAllListeners(),this._setupInternalEvents(),this._onRemoveListener()}_start(){}_end(){}_setupInternalEvents(){this.removeListener("newListener",this._onNewListener),this.removeListener("removeListener",this._onRemoveListener),this.on("newListener",this._onNewListener),this.on("removeListener",this._onRemoveListener)}_onNewListener(e,t){o.includes(e)&&this._maybeStart()}_onRemoveListener(e,t){this._getBlockTrackerEventCount()>0||this._maybeEnd()}_maybeStart(){this._isRunning||(this._isRunning=!0,this._cancelBlockResetTimeout(),this._start())}_maybeEnd(){this._isRunning&&(this._isRunning=!1,this._setupBlockResetTimeout(),this._end())}_getBlockTrackerEventCount(){return o.map((e=>this.listenerCount(e))).reduce(s)}_newPotentialLatest(e){const t=this._currentBlock;t&&i(e)<=i(t)||this._setCurrentBlock(e)}_setCurrentBlock(e){const t=this._currentBlock;this._currentBlock=e,this.emit("latest",e),this.emit("sync",{oldBlock:t,newBlock:e})}_setupBlockResetTimeout(){this._cancelBlockResetTimeout(),this._blockResetTimeout=setTimeout(this._resetCurrentBlock,this._blockResetDuration),this._blockResetTimeout.unref&&this._blockResetTimeout.unref()}_cancelBlockResetTimeout(){clearTimeout(this._blockResetTimeout)}_resetCurrentBlock(){this._currentBlock=null}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-block-tracker"}],[5275,{"./base":5274,pify:5293},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("pify"),s=e("./base");function o(e,t){return new Promise((r=>{const n=setTimeout(r,e);n.unref&&t&&n.unref()}))}t.exports=class extends s{constructor(e={}){if(!e.provider)throw new Error("PollingBlockTracker - no provider specified.");const t=e.pollingInterval||2e4,r=e.retryTimeout||t/10,n=e.keepEventLoopActive===undefined||e.keepEventLoopActive,s=e.setSkipCacheFlag||!1;super(Object.assign({blockResetDuration:t},e)),this._provider=e.provider,this._pollingInterval=t,this._retryTimeout=r,this._keepEventLoopActive=n,this._setSkipCacheFlag=s}async checkForLatestBlock(){return await this._updateLatestBlock(),await this.getLatestBlock()}_start(){this._performSync().catch((e=>this.emit("error",e)))}async _performSync(){for(;this._isRunning;)try{await this._updateLatestBlock(),await o(this._pollingInterval,!this._keepEventLoopActive)}catch(e){const t=new Error(`PollingBlockTracker - encountered an error while attempting to update latest block:\n${e.stack}`);try{this.emit("error",t)}catch(e){console.error(t)}await o(this._retryTimeout,!this._keepEventLoopActive)}}async _updateLatestBlock(){const e=await this._fetchLatestBlock();this._newPotentialLatest(e)}async _fetchLatestBlock(){const e={jsonrpc:"2.0",id:1,method:"eth_blockNumber",params:[]};this._setSkipCacheFlag&&(e.skipCache=!0);const t=await n((t=>this._provider.sendAsync(e,t)))();if(t.error)throw new Error(`PollingBlockTracker - encountered error fetching block:\n${t.error}`);return t.result}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-block-tracker"}],[5276,{"./cache-utils.js":5277,"json-rpc-engine/src/createAsyncMiddleware":5292},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./cache-utils.js"),s=e("json-rpc-engine/src/createAsyncMiddleware"),o=[undefined,null,"<nil>"];t.exports=function(e={}){const{blockTracker:t}=e;if(!t)throw new Error("createBlockCacheMiddleware - No BlockTracker specified");const r=new i,o={perma:r,block:r,fork:r};return s((async(e,s,i)=>{if(e.skipCache)return i();const a=n.cacheTypeForPayload(e),c=o[a];if(!c)return i();if(!c.canCacheRequest(e))return i();let l,u=n.blockTagForPayload(e);if(u||(u="latest"),"earliest"===u)l="0x00";else if("latest"===u){const e=await t.getLatestBlock();r.clearBefore(e),l=e}else l=u;const d=await c.get(e,l);d===undefined?(await i(),await c.set(e,l,s.result)):s.result=d}))};class i{constructor(){this.cache={}}getBlockCacheForPayload(e,t){const r=Number.parseInt(t,16);let n=this.cache[r];if(!n){const e={};this.cache[r]=e,n=e}return n}async get(e,t){const r=this.getBlockCacheForPayload(e,t);if(!r)return;return r[n.cacheIdentifierForPayload(e,!0)]}async set(e,t,r){if(!this.canCacheResult(e,r))return;this.getBlockCacheForPayload(e,t)[n.cacheIdentifierForPayload(e,!0)]=r}canCacheRequest(e){if(!n.canCache(e))return!1;return"pending"!==n.blockTagForPayload(e)}canCacheResult(e,t){if(!o.includes(t))return!!(!["eth_getTransactionByHash","eth_getTransactionReceipt"].includes(e.method)||t&&t.blockHash&&"0x0000000000000000000000000000000000000000000000000000000000000000"!==t.blockHash)}clearBefore(e){const t=this,r=Number.parseInt(e,16);Object.keys(t.cache).map(Number).filter((e=>e<r)).forEach((e=>delete t.cache[e]))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-json-rpc-middleware"}],[5277,{"json-stable-stringify":4565},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("json-stable-stringify");function s(e){return"never"!==a(e)}function o(e){const t=i(e);return t>=e.params.length?e.params:"eth_getBlockByNumber"===e.method?e.params.slice(1):e.params.slice(0,t)}function i(e){switch(e.method){case"eth_getStorageAt":return 2;case"eth_getBalance":case"eth_getCode":case"eth_getTransactionCount":case"eth_call":return 1;case"eth_getBlockByNumber":return 0;default:return undefined}}function a(e){switch(e.method){case"web3_clientVersion":case"web3_sha3":case"eth_protocolVersion":case"eth_getBlockTransactionCountByHash":case"eth_getUncleCountByBlockHash":case"eth_getCode":case"eth_getBlockByHash":case"eth_getTransactionByHash":case"eth_getTransactionByBlockHashAndIndex":case"eth_getTransactionReceipt":case"eth_getUncleByBlockHashAndIndex":case"eth_getCompilers":case"eth_compileLLL":case"eth_compileSolidity":case"eth_compileSerpent":case"shh_version":case"test_permaCache":return"perma";case"eth_getBlockByNumber":case"eth_getBlockTransactionCountByNumber":case"eth_getUncleCountByBlockNumber":case"eth_getTransactionByBlockNumberAndIndex":case"eth_getUncleByBlockNumberAndIndex":case"test_forkCache":return"fork";case"eth_gasPrice":case"eth_blockNumber":case"eth_getBalance":case"eth_getStorageAt":case"eth_getTransactionCount":case"eth_call":case"eth_estimateGas":case"eth_getFilterLogs":case"eth_getLogs":case"test_blockCache":return"block";case"net_version":case"net_peerCount":case"net_listening":case"eth_syncing":case"eth_sign":case"eth_coinbase":case"eth_mining":case"eth_hashrate":case"eth_accounts":case"eth_sendTransaction":case"eth_sendRawTransaction":case"eth_newFilter":case"eth_newBlockFilter":case"eth_newPendingTransactionFilter":case"eth_uninstallFilter":case"eth_getFilterChanges":case"eth_getWork":case"eth_submitWork":case"eth_submitHashrate":case"db_putString":case"db_getString":case"db_putHex":case"db_getHex":case"shh_post":case"shh_newIdentity":case"shh_hasIdentity":case"shh_newGroup":case"shh_addToGroup":case"shh_newFilter":case"shh_uninstallFilter":case"shh_getFilterChanges":case"shh_getMessages":case"test_neverCache":return"never"}}t.exports={cacheIdentifierForPayload:function(e,t){const r=t?o(e):e.params;return s(e)?e.method+":"+n(r):null},canCache:s,blockTagForPayload:function(e){let t=i(e);if(t>=e.params.length)return null;return e.params[t]},paramsWithoutBlockTag:o,blockTagParamIndex:i,cacheTypeForPayload:a}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-json-rpc-middleware"}],[5278,{btoa:1807,"eth-rpc-errors":5280,"json-rpc-engine/src/createAsyncMiddleware":5292,"node-fetch":4832,url:5243},function(){with(this)return function(){"use strict";return function(e,t,r){const n=global.fetch||e("node-fetch"),s=e("url"),{ethErrors:o}=e("eth-rpc-errors"),i=e("btoa"),a=e("json-rpc-engine/src/createAsyncMiddleware");t.exports=function({rpcUrl:e,originHttpHeaderKey:t}){return a((async(r,s,o)=>{const{fetchUrl:i,fetchParams:a}=d({req:r,rpcUrl:e,originHttpHeaderKey:t});for(let e=0;e<5;e++){try{const e=await n(i,a);l(e);const t=await e.text();let r;try{r=JSON.parse(t)}catch(e){throw new Error(`FetchMiddleware - failed to parse response body: "${t}"`)}const o=u(e,r);return void(s.result=o)}catch(e){const t=e.toString();if(!c.some((e=>t.includes(e))))throw e}await h(1e3)}}))},t.exports.createFetchConfigFromReq=d;const c=["Gateway timeout","ETIMEDOUT","failed to parse response body","Failed to fetch"];function l(e){switch(e.status){case 405:throw o.rpc.methodNotFound();case 418:throw o.rpc.internal({message:"Request is being rate limited."});case 503:case 504:throw function(){let e="Gateway timeout. The request took too long to process. ";return e+="This can happen when querying logs over too wide a block range.",o.rpc.internal({message:e})}()}}function u(e,t){if(200!==e.status)throw o.rpc.internal({message:`Non-200 status code: '${e.status}'`,data:t});if(t.error)throw o.rpc.internal({data:t.error});return t.result}function d({req:e,rpcUrl:t,originHttpHeaderKey:r}){const n=s.parse(t),o=function(e){let t="";t+=e.protocol,e.slashes&&(t+="//");t+=e.hostname,e.port&&(t+=`:${e.port}`);return t+=`${e.path}`,t}(n),a={id:e.id,jsonrpc:e.jsonrpc,method:e.method,params:e.params},c=e.origin,l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)};if(n.auth){const e=i(n.auth);l.headers.Authorization=`Basic ${e}`}return r&&c&&(l.headers[r]=c),{fetchUrl:o,fetchParams:l}}function h(e){return new Promise((t=>setTimeout(t,e)))}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-json-rpc-middleware"}],[5279,{"./cache-utils":5277,clone:1845,"json-rpc-engine/src/createAsyncMiddleware":5292},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("clone"),s=e("json-rpc-engine/src/createAsyncMiddleware"),o=e("./cache-utils").cacheIdentifierForPayload;t.exports=function(){const e={};return s((async(t,r,s)=>{if(t.skipCache)return s();const i=o(t);if(!i)return s();let a=e[i];a?await function(e,t){const{resolve:r,promise:s}=function(){let e;const t=new Promise((t=>{e=t}));return{resolve:e,promise:t}}();return t.push((t=>{e.result=n(t.result),e.error=n(t.error),r()})),s}(r,a):(a=[],e[i]=a,await s(),delete e[i],function(e,t){setTimeout((()=>{t.forEach((t=>{try{t(e)}catch(e){console.error(e)}}))}))}(r,a))}))}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-json-rpc-middleware"}],[5280,{"./src/classes":5281,"./src/errorCodes.json":5282,"./src/errors":5284,"./src/utils":5285},function(){with(this)return function(){"use strict";return function(e,t,r){const{EthereumRpcError:n,EthereumProviderError:s}=e("./src/classes"),{serializeError:o,getMessageFromCode:i}=e("./src/utils"),a=e("./src/errors"),c=e("./src/errorCodes.json");t.exports={ethErrors:a,EthereumRpcError:n,EthereumProviderError:s,serializeError:o,getMessageFromCode:i,ERROR_CODES:c}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5281,{"fast-safe-stringify":4341},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("fast-safe-stringify");class s extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a nonempty string.');super(t),this.code=e,r!==undefined&&(this.data=r)}serialize(){const e={code:this.code,message:this.message};return this.data!==undefined&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return n(this.serialize(),o,2)}}function o(e,t){return"[Circular]"===t?undefined:t}t.exports={EthereumRpcError:s,EthereumProviderError:class extends s{constructor(e,t,r){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5282,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5283,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP 1474",message:"Invalid input."},"-32001":{standard:"EIP 1474",message:"Resource not found."},"-32002":{standard:"EIP 1474",message:"Resource unavailable."},"-32003":{standard:"EIP 1474",message:"Transaction rejected."},"-32004":{standard:"EIP 1474",message:"Method not supported."},"-32005":{standard:"EIP 1474",message:"Request limit exceeded."},4001:{standard:"EIP 1193",message:"User rejected the request."},4100:{standard:"EIP 1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP 1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP 1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP 1193",message:"The provider is disconnected from the specified chain."}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5284,{"./classes":5281,"./errorCodes.json":5282,"./utils":5285},function(){with(this)return function(){"use strict";return function(e,t,r){const{EthereumRpcError:n,EthereumProviderError:s}=e("./classes"),{getMessageFromCode:o}=e("./utils"),i=e("./errorCodes.json");function a(e,t){const[r,s]=l(t);return new n(e,r||o(e),s)}function c(e,t){const[r,n]=l(t);return new s(e,r||o(e),n)}function l(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:r}=e;return[t,r]}}return[]}t.exports={rpc:{parse:e=>a(i.rpc.parse,e),invalidRequest:e=>a(i.rpc.invalidRequest,e),invalidParams:e=>a(i.rpc.invalidParams,e),methodNotFound:e=>a(i.rpc.methodNotFound,e),internal:e=>a(i.rpc.internal,e),server:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return a(t,e)},invalidInput:e=>a(i.rpc.invalidInput,e),resourceNotFound:e=>a(i.rpc.resourceNotFound,e),resourceUnavailable:e=>a(i.rpc.resourceUnavailable,e),transactionRejected:e=>a(i.rpc.transactionRejected,e),methodNotSupported:e=>a(i.rpc.methodNotSupported,e),limitExceeded:e=>a(i.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>c(i.provider.userRejectedRequest,e),unauthorized:e=>c(i.provider.unauthorized,e),unsupportedMethod:e=>c(i.provider.unsupportedMethod,e),disconnected:e=>c(i.provider.disconnected,e),chainDisconnected:e=>c(i.provider.chainDisconnected,e),custom:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:r,data:n}=e;if(!r||"string"!=typeof r)throw new Error('"message" must be a nonempty string');return new s(t,r,n)}}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5285,{"./classes":5281,"./errorCodes.json":5282,"./errorValues.json":5283},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./errorValues.json"),s=e("./errorCodes.json").rpc.internal,{EthereumRpcError:o}=e("./classes"),i="Unspecified server error.",a={code:s,message:c(s)};function c(e,t="Unspecified error message. This is a bug, please report it."){if(Number.isInteger(e)){const t=e.toString();if(n[t])return n[t].message;if(u(e))return i}return t}function l(e){if(!Number.isInteger(e))return!1;const t=e.toString();return!!n[t]||!!u(e)}function u(e){return e>=-32099&&e<=-32e3}function d(e){return e&&"object"==typeof e&&!Array.isArray(e)?{...e}:e}t.exports={getMessageFromCode:c,isValidCode:l,serializeError:function(e,{fallbackError:t=a,shouldIncludeStack:r=!1}={}){if(!t||!Number.isInteger(t.code)||"string"!=typeof t.message)throw new Error("Must provide fallback error with integer number code and string message.");if(e instanceof o)return e.serialize();const n={};return e&&l(e.code)?(n.code=e.code,e.message&&"string"==typeof e.message?(n.message=e.message,"data"in e&&(n.data=e.data)):(n.message=c(n.code),n.data={originalError:d(e)})):(n.code=t.code,n.message=e&&e.message?e.message:t.message,n.data={originalError:d(e)}),r&&e&&"string"==typeof e.stack&&(n.stack=e.stack),n},JSON_RPC_SERVER_ERROR_MESSAGE:i}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-rpc-errors"}],[5286,{"ethereumjs-abi":2158,"ethereumjs-util":5287},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("ethereumjs-util"),s=e("ethereumjs-abi");function o(e){const t=new Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;const r=e.map((function(e){return"bytes"===e.type?n.toBuffer(e.value):e.value})),o=e.map((function(e){return e.type})),i=e.map((function(e){if(!e.name)throw t;return e.type+" "+e.name}));return s.soliditySHA3(["bytes32","bytes32"],[s.soliditySHA3(new Array(e.length).fill("string"),i),s.soliditySHA3(o,r)])}function i(e,t){const r=n.toBuffer(t),s=n.fromRpcSig(r);return n.ecrecover(e,s.v,s.r,s.s)}function a(e){const t=n.toBuffer(e.data);return i(n.hashPersonalMessage(t),e.sig)}function c(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}t.exports={concatSig:function(e,t,r){const s=n.fromSigned(t),o=n.fromSigned(r),i=n.bufferToInt(e),a=c(n.toUnsigned(s).toString("hex"),64),l=c(n.toUnsigned(o).toString("hex"),64),u=n.stripHexPrefix(n.intToHex(i));return n.addHexPrefix(a.concat(l,u)).toString("hex")},normalize:function(e){if(e){if("number"==typeof e){const t=n.toBuffer(e);e=n.bufferToHex(t)}if("string"!=typeof e){var t="eth-sig-util.normalize() requires hex string or integer input.";throw new Error(t+=" received "+typeof e+": "+e)}return n.addHexPrefix(e.toLowerCase())}},personalSign:function(e,t){var r=n.toBuffer(t.data),s=n.hashPersonalMessage(r),o=n.ecsign(s,e);return n.bufferToHex(this.concatSig(o.v,o.r,o.s))},recoverPersonalSignature:function(e){const t=a(e),r=n.publicToAddress(t);return n.bufferToHex(r)},extractPublicKey:function(e){return"0x"+a(e).toString("hex")},typedSignatureHash:function(e){const t=o(e);return n.bufferToHex(t)},signTypedData:function(e,t){const r=o(t.data),s=n.ecsign(r,e);return n.bufferToHex(this.concatSig(s.v,s.r,s.s))},recoverTypedSignature:function(e){const t=i(o(e.data),e.sig),r=n.publicToAddress(t);return n.bufferToHex(r)}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-sig-util"}],[5287,{"./secp256k1-adapter":5288,assert:1533,"bn.js":1753,"create-hash":1901,"ethereum-cryptography/keccak":2123,"ethjs-util":5291,rlp:5079,"safe-buffer":5081},function(){with(this)return function(){"use strict";return function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("ethereum-cryptography/keccak"),o=s.keccak224,i=s.keccak384,a=s.keccak256,c=s.keccak512,l=e("./secp256k1-adapter"),u=e("assert"),d=e("rlp"),h=e("bn.js"),p=e("create-hash"),f=e("safe-buffer").Buffer;Object.assign(r,e("ethjs-util")),r.MAX_INTEGER=new h("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16),r.TWO_POW256=new h("10000000000000000000000000000000000000000000000000000000000000000",16),r.KECCAK256_NULL_S="c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",r.SHA3_NULL_S=r.KECCAK256_NULL_S,r.KECCAK256_NULL=f.from(r.KECCAK256_NULL_S,"hex"),r.SHA3_NULL=r.KECCAK256_NULL,r.KECCAK256_RLP_ARRAY_S="1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",r.SHA3_RLP_ARRAY_S=r.KECCAK256_RLP_ARRAY_S,r.KECCAK256_RLP_ARRAY=f.from(r.KECCAK256_RLP_ARRAY_S,"hex"),r.SHA3_RLP_ARRAY=r.KECCAK256_RLP_ARRAY,r.KECCAK256_RLP_S="56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",r.SHA3_RLP_S=r.KECCAK256_RLP_S,r.KECCAK256_RLP=f.from(r.KECCAK256_RLP_S,"hex"),r.SHA3_RLP=r.KECCAK256_RLP,r.BN=h,r.rlp=d,r.secp256k1=l,r.zeros=function(e){return f.allocUnsafe(e).fill(0)},r.zeroAddress=function(){var e=r.zeros(20);return r.bufferToHex(e)},r.setLengthLeft=r.setLength=function(e,t,n){var s=r.zeros(t);return e=r.toBuffer(e),n?e.length<t?(e.copy(s),s):e.slice(0,t):e.length<t?(e.copy(s,t-e.length),s):e.slice(-t)},r.setLengthRight=function(e,t){return r.setLength(e,t,!0)},r.unpad=r.stripZeros=function(e){for(var t=(e=r.stripHexPrefix(e))[0];e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e},r.toBuffer=function(e){if(!f.isBuffer(e))if(Array.isArray(e))e=f.from(e);else if("string"==typeof e)e=r.isHexString(e)?f.from(r.padToEven(r.stripHexPrefix(e)),"hex"):f.from(e);else if("number"==typeof e)e=r.intToBuffer(e);else if(null===e||e===undefined)e=f.allocUnsafe(0);else if(h.isBN(e))e=e.toArrayLike(f);else{if(!e.toArray)throw new Error("invalid type");e=f.from(e.toArray())}return e},r.bufferToInt=function(e){return new h(r.toBuffer(e)).toNumber()},r.bufferToHex=function(e){return"0x"+(e=r.toBuffer(e)).toString("hex")},r.fromSigned=function(e){return new h(e).fromTwos(256)},r.toUnsigned=function(e){return f.from(e.toTwos(256).toArray())},r.keccak=function(e,t){switch(e=r.toBuffer(e),t||(t=256),t){case 224:return o(e);case 256:return a(e);case 384:return i(e);case 512:return c(e);default:throw new Error("Invald algorithm: keccak"+t)}},r.keccak256=function(e){return r.keccak(e)},r.sha3=r.keccak,r.sha256=function(e){return e=r.toBuffer(e),p("sha256").update(e).digest()},r.ripemd160=function(e,t){e=r.toBuffer(e);var n=p("rmd160").update(e).digest();return!0===t?r.setLength(n,32):n},r.rlphash=function(e){return r.keccak(d.encode(e))},r.isValidPrivate=function(e){return l.privateKeyVerify(e)},r.isValidPublic=function(e,t){return 64===e.length?l.publicKeyVerify(f.concat([f.from([4]),e])):!!t&&l.publicKeyVerify(e)},r.pubToAddress=r.publicToAddress=function(e,t){return e=r.toBuffer(e),t&&64!==e.length&&(e=l.publicKeyConvert(e,!1).slice(1)),u(64===e.length),r.keccak(e).slice(-20)};var m=r.privateToPublic=function(e){return e=r.toBuffer(e),l.publicKeyCreate(e,!1).slice(1)};r.importPublic=function(e){return 64!==(e=r.toBuffer(e)).length&&(e=l.publicKeyConvert(e,!1).slice(1)),e},r.ecsign=function(e,t){var r=l.sign(e,t),n={};return n.r=r.signature.slice(0,32),n.s=r.signature.slice(32,64),n.v=r.recovery+27,n},r.hashPersonalMessage=function(e){var t=r.toBuffer("Ethereum Signed Message:\n"+e.length.toString());return r.keccak(f.concat([t,e]))},r.ecrecover=function(e,t,n,s){var o=f.concat([r.setLength(n,32),r.setLength(s,32)],64),i=t-27;if(0!==i&&1!==i)throw new Error("Invalid signature v value");var a=l.recover(e,o,i);return l.publicKeyConvert(a,!1).slice(1)},r.toRpcSig=function(e,t,n){if(27!==e&&28!==e)throw new Error("Invalid recovery id");return r.bufferToHex(f.concat([r.setLengthLeft(t,32),r.setLengthLeft(n,32),r.toBuffer(e-27)]))},r.fromRpcSig=function(e){if(65!==(e=r.toBuffer(e)).length)throw new Error("Invalid signature length");var t=e[64];return t<27&&(t+=27),{v:t,r:e.slice(0,32),s:e.slice(32,64)}},r.privateToAddress=function(e){return r.publicToAddress(m(e))},r.isValidAddress=function(e){return/^0x[0-9a-fA-F]{40}$/.test(e)},r.isZeroAddress=function(e){return r.zeroAddress()===r.addHexPrefix(e)},r.toChecksumAddress=function(e){e=r.stripHexPrefix(e).toLowerCase();for(var t=r.keccak(e).toString("hex"),n="0x",s=0;s<e.length;s++)parseInt(t[s],16)>=8?n+=e[s].toUpperCase():n+=e[s];return n},r.isValidChecksumAddress=function(e){return r.isValidAddress(e)&&r.toChecksumAddress(e)===e},r.generateAddress=function(e,t){return e=r.toBuffer(e),t=(t=new h(t)).isZero()?null:f.from(t.toArray()),r.rlphash([e,t]).slice(-20)},r.isPrecompiled=function(e){var t=r.unpad(e);return 1===t.length&&t[0]>=1&&t[0]<=8},r.addHexPrefix=function(e){return"string"!=typeof e||r.isHexPrefixed(e)?e:"0x"+e},r.isValidSignature=function(e,t,r,n){var s=new h("7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0",16),o=new h("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",16);return 32===t.length&&32===r.length&&((27===e||28===e)&&(t=new h(t),r=new h(r),!(t.isZero()||t.gt(o)||r.isZero()||r.gt(o))&&(!1!==n||1!==new h(r).cmp(s))))},r.baToJSON=function(e){if(f.isBuffer(e))return"0x"+e.toString("hex");if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(r.baToJSON(e[n]));return t}},r.defineProperties=function(e,t,s){if(e.raw=[],e._fields=[],e.toJSON=function(t){if(t){var n={};return e._fields.forEach((function(t){n[t]="0x"+e[t].toString("hex")})),n}return r.baToJSON(this.raw)},e.serialize=function(){return d.encode(e.raw)},t.forEach((function(t,n){function s(){return e.raw[n]}function o(s){"00"!==(s=r.toBuffer(s)).toString("hex")||t.allowZero||(s=f.allocUnsafe(0)),t.allowLess&&t.length?(s=r.stripZeros(s),u(t.length>=s.length,"The field "+t.name+" must not have more "+t.length+" bytes")):t.allowZero&&0===s.length||!t.length||u(t.length===s.length,"The field "+t.name+" must have byte length of "+t.length),e.raw[n]=s}e._fields.push(t.name),Object.defineProperty(e,t.name,{enumerable:!0,configurable:!0,get:s,set:o}),t.default&&(e[t.name]=t.default),t.alias&&Object.defineProperty(e,t.alias,{enumerable:!1,configurable:!0,set:o,get:s})})),s)if("string"==typeof s&&(s=f.from(r.stripHexPrefix(s),"hex")),f.isBuffer(s)&&(s=d.decode(s)),Array.isArray(s)){if(s.length>e._fields.length)throw new Error("wrong number of fields in data");s.forEach((function(t,n){e[e._fields[n]]=r.toBuffer(t)}))}else{if("object"!==(void 0===s?"undefined":n(s)))throw new Error("invalid data");var o=Object.keys(s);t.forEach((function(t){-1!==o.indexOf(t.name)&&(e[t.name]=s[t.name]),-1!==o.indexOf(t.alias)&&(e[t.alias]=s[t.alias])}))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>ethereumjs-util"}],[5288,{"./secp256k1-lib/der":5289,"./secp256k1-lib/index":5290,buffer:1797,"ethereum-cryptography/secp256k1":2155},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("ethereum-cryptography/secp256k1"),s=e("./secp256k1-lib/index"),o=e("./secp256k1-lib/der"),i=function(e){return 32===e.length&&n.privateKeyVerify(Uint8Array.from(e))};t.exports={privateKeyVerify:i,privateKeyExport:function(e,t){if(32!==e.length)throw new RangeError("private key length is invalid");var r=s.privateKeyExport(e,t);return o.privateKeyExport(e,r,t)},privateKeyImport:function(e){if(null!==(e=o.privateKeyImport(e))&&32===e.length&&i(e))return e;throw new Error("couldn't import from DER format")},privateKeyNegate:function(e){return r.from(n.privateKeyNegate(Uint8Array.from(e)))},privateKeyModInverse:function(e){if(32!==e.length)throw new Error("private key length is invalid");return r.from(s.privateKeyModInverse(Uint8Array.from(e)))},privateKeyTweakAdd:function(e,t){return r.from(n.privateKeyTweakAdd(Uint8Array.from(e),t))},privateKeyTweakMul:function(e,t){return r.from(n.privateKeyTweakMul(Uint8Array.from(e),Uint8Array.from(t)))},publicKeyCreate:function(e,t){return r.from(n.publicKeyCreate(Uint8Array.from(e),t))},publicKeyConvert:function(e,t){return r.from(n.publicKeyConvert(Uint8Array.from(e),t))},publicKeyVerify:function(e){return(33===e.length||65===e.length)&&n.publicKeyVerify(Uint8Array.from(e))},publicKeyTweakAdd:function(e,t,s){return r.from(n.publicKeyTweakAdd(Uint8Array.from(e),Uint8Array.from(t),s))},publicKeyTweakMul:function(e,t,s){return r.from(n.publicKeyTweakMul(Uint8Array.from(e),Uint8Array.from(t),s))},publicKeyCombine:function(e,t){var s=[];return e.forEach((function(e){s.push(Uint8Array.from(e))})),r.from(n.publicKeyCombine(s,t))},signatureNormalize:function(e){return r.from(n.signatureNormalize(Uint8Array.from(e)))},signatureExport:function(e){return r.from(n.signatureExport(Uint8Array.from(e)))},signatureImport:function(e){return r.from(n.signatureImport(Uint8Array.from(e)))},signatureImportLax:function(e){if(0===e.length)throw new RangeError("signature length is invalid");var t=o.signatureImportLax(e);if(null===t)throw new Error("couldn't parse DER signature");return s.signatureImport(t)},sign:function(e,t,s){if(null===s)throw new TypeError("options should be an Object");var o=void 0;if(s){if(o={},null===s.data)throw new TypeError("options.data should be a Buffer");if(s.data){if(32!==s.data.length)throw new RangeError("options.data length is invalid");o.data=new Uint8Array(s.data)}if(null===s.noncefn)throw new TypeError("options.noncefn should be a Function");s.noncefn&&(o.noncefn=function(e,t,n,o,i){var a=null!=n?r.from(n):null,c=null!=o?r.from(o):null,l=r.from("");return s.noncefn&&(l=s.noncefn(r.from(e),r.from(t),a,c,i)),Uint8Array.from(l)})}var i=n.ecdsaSign(Uint8Array.from(e),Uint8Array.from(t),o);return{signature:r.from(i.signature),recovery:i.recid}},verify:function(e,t,r){return n.ecdsaVerify(Uint8Array.from(t),Uint8Array.from(e),r)},recover:function(e,t,s,o){return r.from(n.ecdsaRecover(Uint8Array.from(t),s,Uint8Array.from(e),o))},ecdh:function(e,t){return r.from(n.ecdh(Uint8Array.from(e),Uint8Array.from(t),{}))},ecdhUnsafe:function(e,t,n){if(33!==e.length&&65!==e.length)throw new RangeError("public key length is invalid");if(32!==t.length)throw new RangeError("private key length is invalid");return r.from(s.ecdhUnsafe(Uint8Array.from(e),Uint8Array.from(t),n))}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>ethereumjs-util"}],[5289,{buffer:1797},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){var t=e.from([48,129,211,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,133,48,129,130,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,33,2,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,36,3,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=e.from([48,130,1,19,2,1,1,4,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,129,165,48,129,162,2,1,1,48,44,6,7,42,134,72,206,61,1,1,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,252,47,48,6,4,1,0,4,1,7,4,65,4,121,190,102,126,249,220,187,172,85,160,98,149,206,135,11,7,2,155,252,219,45,206,40,217,89,242,129,91,22,248,23,152,72,58,218,119,38,163,196,101,93,164,251,252,14,17,8,168,253,23,180,72,166,133,84,25,156,71,208,143,251,16,212,184,2,33,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65,2,1,1,161,68,3,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);r.privateKeyExport=function(r,s,o){var i=e.from(o?t:n);return r.copy(i,o?8:9),s.copy(i,o?181:214),i},r.privateKeyImport=function(e){var t=e.length,r=0;if(t<r+1||48!==e[r])return null;if(t<(r+=1)+1||!(128&e[r]))return null;var n=127&e[r];if(n<1||n>2)return null;if(t<(r+=1)+n)return null;var s=e[r+n-1]|(n>1?e[r+n-2]<<8:0);return t<(r+=n)+s||t<r+3||2!==e[r]||1!==e[r+1]||1!==e[r+2]||t<(r+=3)+2||4!==e[r]||e[r+1]>32||t<r+2+e[r+1]?null:e.slice(r+2,r+2+e[r+1])},r.signatureImportLax=function(t){var r=e.alloc(32,0),n=e.alloc(32,0),s=t.length,o=0;if(48!==t[o++])return null;var i=t[o++];if(128&i&&(o+=i-128)>s)return null;if(2!==t[o++])return null;var a=t[o++];if(128&a){if(o+(i=a-128)>s)return null;for(;i>0&&0===t[o];o+=1,i-=1);for(a=0;i>0;o+=1,i-=1)a=(a<<8)+t[o]}if(a>s-o)return null;var c=o;if(o+=a,2!==t[o++])return null;var l=t[o++];if(128&l){if(o+(i=l-128)>s)return null;for(;i>0&&0===t[o];o+=1,i-=1);for(l=0;i>0;o+=1,i-=1)l=(l<<8)+t[o]}if(l>s-o)return null;var u=o;for(o+=l;a>0&&0===t[c];a-=1,c+=1);if(a>32)return null;var d=t.slice(c,c+a);for(d.copy(r,32-d.length);l>0&&0===t[u];l-=1,u+=1);if(l>32)return null;var h=t.slice(u,u+l);return h.copy(n,32-h.length),{r:r,s:n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>ethereumjs-util"}],[529,{"./metamask-airgapped-keyring.cjs.development.js":530,"./metamask-airgapped-keyring.cjs.production.min.js":531},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./metamask-airgapped-keyring.cjs.production.min.js")}}},{package:"@keystonehq/metamask-airgapped-keyring"}],[5290,{"bn.js":1753,buffer:1797,elliptic:1996},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("bn.js"),s=new(0,e("elliptic").ec)("secp256k1"),o=s.curve;r.privateKeyExport=function(e,t){var r=new n(e);if(r.ucmp(o.n)>=0)throw new Error("couldn't export to DER format");var a=s.g.mul(r);return i(a.getX(),a.getY(),t)},r.privateKeyModInverse=function(e){var r=new n(e);if(r.ucmp(o.n)>=0||r.isZero())throw new Error("private key range is invalid");return r.invm(o.n).toArrayLike(t,"be",32)},r.signatureImport=function(e){var r=new n(e.r);r.ucmp(o.n)>=0&&(r=new n(0));var s=new n(e.s);return s.ucmp(o.n)>=0&&(s=new n(0)),t.concat([r.toArrayLike(t,"be",32),s.toArrayLike(t,"be",32)])},r.ecdhUnsafe=function(e,t,r){var a=s.keyFromPublic(e),c=new n(t);if(c.ucmp(o.n)>=0||c.isZero())throw new Error("scalar was invalid (zero or overflow)");var l=a.pub.mul(c);return i(l.getX(),l.getY(),r)};var i=function(e,r,n){var s=void 0;return n?((s=t.alloc(33))[0]=r.isOdd()?3:2,e.toArrayLike(t,"be",32).copy(s,1)):((s=t.alloc(65))[0]=4,e.toArrayLike(t,"be",32).copy(s,1),r.toArrayLike(t,"be",32).copy(s,33)),s}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>ethereumjs-util"}],[5291,{buffer:1797,"is-hex-prefixed":4538,"strip-hex-prefix":5173},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("is-hex-prefixed"),s=e("strip-hex-prefix");function o(e){var t=e;if("string"!=typeof t)throw new Error("[ethjs-util] while padding to even, value must be string, is currently "+typeof t+", while padToEven.");return t.length%2&&(t="0"+t),t}function i(e){return"0x"+e.toString(16)}t.exports={arrayContainsArray:function(e,t,r){if(!0!==Array.isArray(e))throw new Error("[ethjs-util] method arrayContainsArray requires input 'superset' to be an array got type '"+typeof e+"'");if(!0!==Array.isArray(t))throw new Error("[ethjs-util] method arrayContainsArray requires input 'subset' to be an array got type '"+typeof t+"'");return t[Boolean(r)?"some":"every"]((function(t){return e.indexOf(t)>=0}))},intToBuffer:function(e){var t=i(e);return new r(o(t.slice(2)),"hex")},getBinarySize:function(e){if("string"!=typeof e)throw new Error("[ethjs-util] while getting binary size, method getBinarySize requires input 'str' to be type String, got '"+typeof e+"'.");return r.byteLength(e,"utf8")},isHexPrefixed:n,stripHexPrefix:s,padToEven:o,intToHex:i,fromAscii:function(e){for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r).toString(16);t+=n.length<2?"0"+n:n}return"0x"+t},fromUtf8:function(e){return"0x"+o(new r(e,"utf8").toString("hex")).replace(/^0+|0+$/g,"")},toAscii:function(e){var t="",r=0,n=e.length;for("0x"===e.substring(0,2)&&(r=2);r<n;r+=2){var s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t},toUtf8:function(e){return new r(o(s(e).replace(/^0+|0+$/g,"")),"hex").toString("utf8")},getKeys:function(e,t,r){if(!Array.isArray(e))throw new Error("[ethjs-util] method getKeys expecting type Array as 'params' input, got '"+typeof e+"'");if("string"!=typeof t)throw new Error("[ethjs-util] method getKeys expecting type String for input 'key' got '"+typeof t+"'.");for(var n=[],s=0;s<e.length;s++){var o=e[s][t];if(r&&!o)o="";else if("string"!=typeof o)throw new Error("invalid abi");n.push(o)}return n},isHexString:function(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>ethereumjs-util>ethjs-util"}],[5292,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return(t,r,n,s)=>{let o;const i=new Promise((e=>{o=e}));let a,c;e(t,r,(async()=>{c=!0,n((e=>{a=e,o()})),await i})).then((async()=>{c?(await i,a(null)):s(null)})).catch((e=>{a?a(e):s(e)}))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-json-rpc-middleware>json-rpc-engine"}],[5293,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n=(e,t)=>function(){const r=t.promiseModule,n=new Array(arguments.length);for(let e=0;e<arguments.length;e++)n[e]=arguments[e];return new r(((r,s)=>{t.errorFirst?n.push((function(e,n){if(t.multiArgs){const t=new Array(arguments.length-1);for(let e=1;e<arguments.length;e++)t[e-1]=arguments[e];e?(t.unshift(e),s(t)):r(t)}else e?s(e):r(n)})):n.push((function(e){if(t.multiArgs){const e=new Array(arguments.length-1);for(let t=0;t<arguments.length;t++)e[t]=arguments[t];r(e)}else r(e)})),e.apply(this,n)}))};t.exports=(e,t)=>{t=Object.assign({exclude:[/.+(Sync|Stream)$/],errorFirst:!0,promiseModule:Promise},t);const r=e=>{const r=t=>"string"==typeof t?e===t:t.test(e);return t.include?t.include.some(r):!t.exclude.some(r)};let s;s="function"==typeof e?function(){return t.excludeMain?e.apply(this,arguments):n(e,t).apply(this,arguments)}:Object.create(Object.getPrototypeOf(e));for(const o in e){const i=e[o];s[o]="function"==typeof i&&r(o)?n(i,t):i}return s}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine>eth-block-tracker>pify"}],[5294,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={name:"web3-provider-engine",version:"16.0.3",description:"A JavaScript library for composing Ethereum provider objects using middleware modules",repository:"https://github.com/MetaMask/web3-provider-engine",main:"index.js",engines:{node:">=12.0.0"},scripts:{test:"node test/index.js && yarn lint",prepublishOnly:"yarn build && yarn bundle",build:"babel zero.js index.js -d dist/es5 && babel subproviders -d dist/es5/subproviders && babel util -d dist/es5/util",bundle:"mkdir -p ./dist && yarn bundle-engine && yarn bundle-zero","bundle-zero":"browserify -s ZeroClientProvider -e zero.js -t [ babelify --presets [ @babel/preset-env ] ] > dist/ZeroClientProvider.js","bundle-engine":"browserify -s ProviderEngine -e index.js -t [ babelify --presets [ @babel/preset-env ] ] > dist/ProviderEngine.js",lint:"eslint --quiet --ignore-path .gitignore ."},files:["*.js","dist","subproviders","util"],license:"MIT",resolutions:{"ganache-core/**/elliptic":"^6.5.2"},dependencies:{"@ethereumjs/tx":"^3.3.0",async:"^2.5.0",backoff:"^2.5.0",clone:"^2.0.0","cross-fetch":"^2.1.0","eth-block-tracker":"^4.4.2","eth-json-rpc-filters":"^4.2.1","eth-json-rpc-infura":"^5.1.0","eth-json-rpc-middleware":"^6.0.0","eth-rpc-errors":"^3.0.0","eth-sig-util":"^1.4.2","ethereumjs-block":"^1.2.2","ethereumjs-util":"^5.1.5","ethereumjs-vm":"^2.3.4","json-stable-stringify":"^1.0.1","promise-to-callback":"^1.0.0","readable-stream":"^2.2.9",request:"^2.85.0",semaphore:"^1.0.3",ws:"^5.1.1",xhr:"^2.2.0",xtend:"^4.0.1"},devDependencies:{"@babel/cli":"^7.5.5","@babel/core":"^7.5.5","@babel/preset-env":"^7.5.5",babelify:"^10.0.0",browserify:"^16.5.0",eslint:"^6.2.0",ethjs:"^0.3.6","ganache-core":"^2.7.0",tape:"^4.4.0"},browser:{request:!1,ws:!1}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5295,{"./json-rpc-engine-middleware":5303,"eth-json-rpc-middleware/block-cache":5276},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./json-rpc-engine-middleware"),s=e("eth-json-rpc-middleware/block-cache");t.exports=class extends n{constructor(e){super((({blockTracker:t})=>s(Object.assign({blockTracker:t},e))))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5296,{"../package.json":5294,"./fixture.js":5299,util:1803,xtend:5385},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("util").inherits,s=e("xtend"),o=e("./fixture.js"),i=e("../package.json").version;function a(e){var t=s({web3_clientVersion:"ProviderEngine/v"+i+"/javascript",net_listening:!0,eth_hashrate:"0x00",eth_mining:!1},e=e||{});o.call(this,t)}t.exports=a,n(a,o)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5297,{"./json-rpc-engine-middleware":5303,"eth-json-rpc-middleware/fetch":5278},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./json-rpc-engine-middleware"),s=e("eth-json-rpc-middleware/fetch");t.exports=class extends n{constructor(e){super((({blockTracker:t,provider:r,engine:n})=>s(e)))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5298,{"./json-rpc-engine-middleware":5303,"eth-json-rpc-filters":2032},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./json-rpc-engine-middleware"),s=e("eth-json-rpc-filters");t.exports=class extends n{constructor(){super((({blockTracker:e,provider:t,engine:r})=>s({blockTracker:e,provider:t})))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5299,{"./subprovider.js":5307,util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("util").inherits,s=e("./subprovider.js");function o(e){e=e||{},this.staticResponses=e}t.exports=o,n(o,s),o.prototype.handleRequest=function(e,t,r){var n=this.staticResponses[e.method];"function"==typeof n?n(e,t,r):n!==undefined?setTimeout((()=>r(null,n))):t()}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[53,{"../../../shared/constants/app":5397,"../../../shared/constants/metametrics":5402,"../../../shared/modules/hexstring-utils":5425,"../../../shared/modules/random-id":5429,"../metamask-controller":88,"./util":87,"@metamask/obs-store":1217,buffer:1797,"eth-rpc-errors":2103,"ethereumjs-util":2178,events:1798,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("events")),s=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),a=f(e("loglevel")),c=e("../../../shared/constants/app"),l=e("../../../shared/constants/metametrics"),u=e("../metamask-controller"),d=f(e("../../../shared/modules/random-id")),h=e("../../../shared/modules/hexstring-utils"),p=e("./util");function f(e){return e&&e.__esModule?e:{default:e}}const m=/^[0-9A-Fa-f]+$/gu;class g extends n.default{constructor(e){super(),this.memStore=new s.ObservableStore({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0}),this.resetState=()=>{this.memStore.updateState({unapprovedDecryptMsgs:{},unapprovedDecryptMsgCount:0})},this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedDecryptMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,n)=>{if(!e.from)return void n(new Error("MetaMask Decryption: from field is required."));const s=this.addUnapprovedMessage(e,t);this.once(`${s}:finished`,(t=>{switch(t.status){case"decrypted":return void r(t.rawData);case"rejected":return void n(i.ethErrors.provider.userRejectedRequest("MetaMask Decryption: User denied message decryption."));case"errored":return void n(new Error("This message cannot be decrypted"));default:n(new Error(`MetaMask Decryption: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){a.default.debug(`DecryptMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),n=(0,d.default)(),s={id:n,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_DECRYPT};return this.addMsg(s),this.emit("update"),n}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForDecryption(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusDecrypted(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"decrypted")}prepMsgForDecryption(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:l.EVENT.CATEGORIES.MESSAGES,properties:{action:"Decrypt Message Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`DecryptMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"decrypted"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedDecryptMsgs:e,unapprovedDecryptMsgCount:t}),this.emit(u.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,h.stripHexPrefix)(e);if(t.match(m))return(0,p.addHexPrefix)(t)}catch(e){a.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=g}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[530,{"@ethereumjs/tx":331,"@keystonehq/base-eth-keyring":494,"@keystonehq/bc-ur-registry-eth":502,"@metamask/obs-store":536,buffer:1797,events:1798,rlp:5079,uuid:5247},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0});var n,s=e("@keystonehq/base-eth-keyring"),o=e("events"),i=e("@metamask/obs-store"),a=e("@keystonehq/bc-ur-registry-eth"),c=e("uuid"),l=e("@ethereumjs/tx"),u=(n=e("rlp"))&&"object"==typeof n&&"default"in n?n.default:n;class d extends o.EventEmitter{constructor(){if(super(),this.cleanSyncListeners=()=>{this.removeAllListeners("keystone-sync_success-hdkey"),this.removeAllListeners("keystone-sync_success-account"),this.removeAllListeners("keystone-sync_cancel")},this.cleanSignListeners=e=>{this.removeAllListeners(`${e}-signed`),this.removeAllListeners(`${e}-canceled`)},this.readCryptoHDKeyOrCryptoAccount=()=>new Promise(((e,r)=>{this.memStore.updateState({sync:{reading:!0}}),this.on("keystone-sync_success-hdkey",(r=>{const n=a.CryptoHDKey.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_success-account",(r=>{const n=a.CryptoAccount.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_cancel",(()=>{this.resetState(),r(new Error("KeystoneError#sync_cancel. Sync process canceled, please retry"))}))})),this.submitCryptoHDKey=e=>{this.emit("keystone-sync_success-hdkey",e)},this.submitCryptoAccount=e=>{this.emit("keystone-sync_success-account",e)},this.cancelSync=()=>{this.emit("keystone-sync_cancel")},this.requestSignature=(e,r,n)=>new Promise(((s,o)=>{const i=e.toUR(),l=e.getRequestId(),u=c.stringify(l),d={requestId:u,payload:{type:i.type,cbor:i.cbor.toString("hex")},title:r,description:n};this.memStore.updateState({sign:{request:d}}),this.once(`${u}-signed`,(e=>{const r=a.ETHSignature.fromCBOR(t.from(e,"hex"));this.resetState(),s(r)})),this.once(`${u}-canceled`,(()=>{this.resetState(),o(new Error("KeystoneError#Tx_canceled. Signing canceled, please retry"))}))})),this.submitSignature=(e,t)=>{this.emit(`${e}-signed`,t)},this.cancelRequestSignature=()=>{const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.memStore.updateState({sign:{}}),this.emit(`${t}-canceled`)}},this.reset=()=>{this.cleanSyncListeners();const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.cleanSignListeners(t)}this.resetState()},this.resetState=()=>{this.memStore.updateState({sync:{reading:!1},sign:{}})},d.instance)return d.instance;this.memStore=new i.ObservableStore({sync:{reading:!1},sign:{},_version:1}),d.instance=this}}class h extends s.BaseKeyring{constructor(e){if(super(e),this.getInteraction=()=>new d,this.resetStore=()=>{this.getInteraction().reset()},this.getMemStore=()=>this.getInteraction().memStore,this.removeAccount=e=>{if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))},this.forgetDevice=()=>{this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.name="QR Hardware",this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.indexes={},this.hdk=undefined,this.paths={}},this.submitCryptoHDKey=this.getInteraction().submitCryptoHDKey,this.submitCryptoAccount=this.getInteraction().submitCryptoAccount,this.submitSignature=this.getInteraction().submitSignature,this.cancelSync=this.getInteraction().cancelSync,this.cancelSignRequest=this.getInteraction().cancelRequestSignature,h.instance)return h.instance.deserialize(e),h.instance;h.instance=this}async signTransaction(e,t){const r=0===t.type?a.DataType.transaction:a.DataType.typedTransaction;let n;n=0===t.type?u.encode(t.getMessageToSign(!1)):t.getMessageToSign(!1);const s=await this._pathFromAddress(e),o=t.common.chainId(),i=c.v4(),d=a.EthSignRequest.constructETHRequest(n,r,s,this.xfp,i,o,e),{r:h,s:p,v:f}=await this.requestSignature(i,d,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature'),m=t.toJSON();m.v=f,m.s=p,m.r=h,m.type=t.type;return l.TransactionFactory.fromTxData(m,{common:t.common})}}h.type=s.BaseKeyring.type,r.MetaMaskKeyring=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring"}],[5300,{"../util/estimate-gas.js":5311,"./subprovider.js":5307,"async/parallel":1562,"async/waterfall":1563,"eth-sig-util":5286,"ethereumjs-util":5287,semaphore:5094,util:1803,xtend:5385},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("async/waterfall"),s=e("async/parallel"),o=e("util").inherits,i=e("ethereumjs-util"),a=e("eth-sig-util"),c=e("xtend"),l=e("semaphore"),u=e("./subprovider.js"),d=e("../util/estimate-gas.js"),h=/^[0-9A-Fa-f]+$/g;function p(e){const t=this;t.nonceLock=l(1),e.getAccounts&&(t.getAccounts=e.getAccounts),e.processTransaction&&(t.processTransaction=e.processTransaction),e.processMessage&&(t.processMessage=e.processMessage),e.processPersonalMessage&&(t.processPersonalMessage=e.processPersonalMessage),e.processTypedMessage&&(t.processTypedMessage=e.processTypedMessage),t.approveTransaction=e.approveTransaction||t.autoApprove,t.approveMessage=e.approveMessage||t.autoApprove,t.approvePersonalMessage=e.approvePersonalMessage||t.autoApprove,t.approveDecryptMessage=e.approveDecryptMessage||t.autoApprove,t.approveEncryptionPublicKey=e.approveEncryptionPublicKey||t.autoApprove,t.approveTypedMessage=e.approveTypedMessage||t.autoApprove,e.signTransaction&&(t.signTransaction=e.signTransaction||b("signTransaction")),e.signMessage&&(t.signMessage=e.signMessage||b("signMessage")),e.signPersonalMessage&&(t.signPersonalMessage=e.signPersonalMessage||b("signPersonalMessage")),e.decryptMessage&&(t.decryptMessage=e.decryptMessage||b("decryptMessage")),e.encryptionPublicKey&&(t.encryptionPublicKey=e.encryptionPublicKey||b("encryptionPublicKey")),e.signTypedMessage&&(t.signTypedMessage=e.signTypedMessage||b("signTypedMessage")),e.recoverPersonalSignature&&(t.recoverPersonalSignature=e.recoverPersonalSignature),e.publishTransaction&&(t.publishTransaction=e.publishTransaction),t.estimateGas=e.estimateGas||t.estimateGas,t.getGasPrice=e.getGasPrice||t.getGasPrice}function f(e){return e.toLowerCase()}function m(e){const t=i.addHexPrefix(e);return i.isValidAddress(t)}function g(e){const t=i.addHexPrefix(e);return!i.isValidAddress(t)&&y(e)}function y(e){if(!("string"==typeof e))return!1;if(!("0x"===e.slice(0,2)))return!1;return e.slice(2).match(h)}function b(e){return function(t,r){r(new Error('ProviderEngine - HookedWalletSubprovider - Must provide "'+e+'" fn in constructor options'))}}t.exports=p,o(p,u),p.prototype.handleRequest=function(e,t,r){const s=this;let o,i,a,l,u;switch(s._parityRequests={},s._parityRequestCount=0,e.method){case"eth_coinbase":return void s.getAccounts((function(e,t){if(e)return r(e);let n=t[0]||null;r(null,n)}));case"eth_accounts":return void s.getAccounts((function(e,t){if(e)return r(e);r(null,t)}));case"eth_sendTransaction":return o=e.params[0],void n([e=>s.validateTransaction(o,e),e=>s.processTransaction(o,e)],r);case"eth_signTransaction":return o=e.params[0],void n([e=>s.validateTransaction(o,e),e=>s.processSignTransaction(o,e)],r);case"eth_sign":return u=e.params[0],l=e.params[1],a=e.params[2]||{},i=c(a,{from:u,data:l}),void n([e=>s.validateMessage(i,e),e=>s.processMessage(i,e)],r);case"personal_sign":return function(){const t=e.params[0];if(g(e.params[1])&&m(t)){let t="The eth_personalSign method requires params ordered ";t+="[message, address]. This was previously handled incorrectly, ",t+="and has been corrected automatically. ",t+="Please switch this param order for smooth behavior in the future.",console.warn(t),u=e.params[0],l=e.params[1]}else l=e.params[0],u=e.params[1];a=e.params[2]||{},i=c(a,{from:u,data:l}),n([e=>s.validatePersonalMessage(i,e),e=>s.processPersonalMessage(i,e)],r)}();case"eth_decryptMessage":return function(){const t=e.params[0];if(g(e.params[1])&&m(t)){let t="The eth_decryptMessage method requires params ordered ";t+="[message, address]. This was previously handled incorrectly, ",t+="and has been corrected automatically. ",t+="Please switch this param order for smooth behavior in the future.",console.warn(t),u=e.params[0],l=e.params[1]}else l=e.params[0],u=e.params[1];a=e.params[2]||{},i=c(a,{from:u,data:l}),n([e=>s.validateDecryptMessage(i,e),e=>s.processDecryptMessage(i,e)],r)}();case"encryption_public_key":return function(){const t=e.params[0];n([e=>s.validateEncryptionPublicKey(t,e),e=>s.processEncryptionPublicKey(t,e)],r)}();case"personal_ecRecover":return function(){l=e.params[0];let t=e.params[1];a=e.params[2]||{},i=c(a,{sig:t,data:l}),s.recoverPersonalSignature(i,r)}();case"eth_signTypedData":case"eth_signTypedData_v3":case"eth_signTypedData_v4":return function(){const t=e.params[0],o=e.params[1];m(t)?(u=t,l=o):(l=t,u=o),a=e.params[2]||{},i=c(a,{from:u,data:l}),n([e=>s.validateTypedMessage(i,e),e=>s.processTypedMessage(i,e)],r)}();case"parity_postTransaction":return o=e.params[0],void s.parityPostTransaction(o,r);case"parity_postSign":return u=e.params[0],l=e.params[1],void s.parityPostSign(u,l,r);case"parity_checkRequest":return function(){const t=e.params[0];s.parityCheckRequest(t,r)}();case"parity_defaultAccount":return void s.getAccounts((function(e,t){if(e)return r(e);const n=t[0]||null;r(null,n)}));default:return void t()}},p.prototype.getAccounts=function(e){e(null,[])},p.prototype.processTransaction=function(e,t){const r=this;n([t=>r.approveTransaction(e,t),(e,t)=>r.checkApproval("transaction",e,t),t=>r.finalizeAndSubmitTx(e,t)],t)},p.prototype.processSignTransaction=function(e,t){const r=this;n([t=>r.approveTransaction(e,t),(e,t)=>r.checkApproval("transaction",e,t),t=>r.finalizeTx(e,t)],t)},p.prototype.processMessage=function(e,t){const r=this;n([t=>r.approveMessage(e,t),(e,t)=>r.checkApproval("message",e,t),t=>r.signMessage(e,t)],t)},p.prototype.processPersonalMessage=function(e,t){const r=this;n([t=>r.approvePersonalMessage(e,t),(e,t)=>r.checkApproval("message",e,t),t=>r.signPersonalMessage(e,t)],t)},p.prototype.processDecryptMessage=function(e,t){const r=this;n([t=>r.approveDecryptMessage(e,t),(e,t)=>r.checkApproval("decryptMessage",e,t),t=>r.decryptMessage(e,t)],t)},p.prototype.processEncryptionPublicKey=function(e,t){const r=this;n([t=>r.approveEncryptionPublicKey(e,t),(e,t)=>r.checkApproval("encryptionPublicKey",e,t),t=>r.encryptionPublicKey(e,t)],t)},p.prototype.processTypedMessage=function(e,t){const r=this;n([t=>r.approveTypedMessage(e,t),(e,t)=>r.checkApproval("message",e,t),t=>r.signTypedMessage(e,t)],t)},p.prototype.autoApprove=function(e,t){t(null,!0)},p.prototype.checkApproval=function(e,t,r){r(t?null:new Error("User denied "+e+" signature."))},p.prototype.parityPostTransaction=function(e,t){const r=this,n=`0x${r._parityRequestCount.toString(16)}`;r._parityRequestCount++,r.emitPayload({method:"eth_sendTransaction",params:[e]},(function(e,t){if(e)return void(r._parityRequests[n]={error:e});const s=t.result;r._parityRequests[n]=s})),t(null,n)},p.prototype.parityPostSign=function(e,t,r){const n=this,s=`0x${n._parityRequestCount.toString(16)}`;n._parityRequestCount++,n.emitPayload({method:"eth_sign",params:[e,t]},(function(e,t){if(e)return void(n._parityRequests[s]={error:e});const r=t.result;n._parityRequests[s]=r})),r(null,s)},p.prototype.parityCheckRequest=function(e,t){const r=this._parityRequests[e]||null;return r?r.error?t(r.error):void t(null,r):t(null,null)},p.prototype.recoverPersonalSignature=function(e,t){let r;try{r=a.recoverPersonalSignature(e)}catch(e){return t(e)}t(null,r)},p.prototype.validateTransaction=function(e,t){if(e.from===undefined)return t(new Error("Undefined address - from address required to sign transaction."));this.validateSender(e.from,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to sign transaction for this address: "${e.from}"`))}))},p.prototype.validateMessage=function(e,t){if(e.from===undefined)return t(new Error("Undefined address - from address required to sign message."));this.validateSender(e.from,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to sign message for this address: "${e.from}"`))}))},p.prototype.validatePersonalMessage=function(e,t){return e.from===undefined?t(new Error("Undefined address - from address required to sign personal message.")):e.data===undefined?t(new Error("Undefined message - message required to sign personal message.")):y(e.data)?void this.validateSender(e.from,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to sign message for this address: "${e.from}"`))})):t(new Error("HookedWalletSubprovider - validateMessage - message was not encoded as hex."))},p.prototype.validateDecryptMessage=function(e,t){return e.from===undefined?t(new Error("Undefined address - from address required to decrypt message.")):e.data===undefined?t(new Error("Undefined message - message required to decrypt message.")):y(e.data)?void this.validateSender(e.from,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to decrypt message for this address: "${e.from}"`))})):t(new Error("HookedWalletSubprovider - validateDecryptMessage - message was not encoded as hex."))},p.prototype.validateEncryptionPublicKey=function(e,t){this.validateSender(e,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to obtain encryption public key for this address: "${e}"`))}))},p.prototype.validateTypedMessage=function(e,t){return e.from===undefined?t(new Error("Undefined address - from address required to sign typed data.")):e.data===undefined?t(new Error("Undefined data - message required to sign typed data.")):void this.validateSender(e.from,(function(r,n){return r?t(r):n?void t():t(new Error(`Unknown address - unable to sign message for this address: "${e.from}"`))}))},p.prototype.validateSender=function(e,t){if(!e)return t(null,!1);this.getAccounts((function(r,n){if(r)return t(r);const s=-1!==n.map(f).indexOf(e.toLowerCase());t(null,s)}))},p.prototype.finalizeAndSubmitTx=function(e,t){const r=this;r.nonceLock.take((function(){n([r.fillInTxExtras.bind(r,e),r.signTransaction.bind(r),r.publishTransaction.bind(r)],(function(e,n){if(r.nonceLock.leave(),e)return t(e);t(null,n)}))}))},p.prototype.finalizeTx=function(e,t){const r=this;r.nonceLock.take((function(){n([r.fillInTxExtras.bind(r,e),r.signTransaction.bind(r)],(function(n,s){if(r.nonceLock.leave(),n)return t(n);t(null,{raw:s,tx:e})}))}))},p.prototype.publishTransaction=function(e,t){this.emitPayload({method:"eth_sendRawTransaction",params:[e]},(function(e,r){if(e)return t(e);t(null,r.result)}))},p.prototype.estimateGas=function(e,t){d(this.engine,e,t)},p.prototype.getGasPrice=function(e){this.emitPayload({method:"eth_gasPrice",params:[]},(function(t,r){if(t)return e(t);e(null,r.result)}))},p.prototype.fillInTxExtras=function(e,t){const r=this,n=e.from,o={};e.gasPrice===undefined&&(o.gasPrice=r.getGasPrice.bind(r)),e.nonce===undefined&&(o.nonce=r.emitPayload.bind(r,{method:"eth_getTransactionCount",params:[n,"pending"]})),e.gas===undefined&&(o.gas=r.estimateGas.bind(r,function(e){return{from:e.from,to:e.to,value:e.value,data:e.data,gas:e.gas,gasPrice:e.gasPrice,nonce:e.nonce}}(e))),s(o,(function(r,n){if(r)return t(r);const s={};n.gasPrice&&(s.gasPrice=n.gasPrice),n.nonce&&(s.nonce=n.nonce.result),n.gas&&(s.gas=n.gas),t(null,c(e,s))}))}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5301,{"./json-rpc-engine-middleware":5303,"eth-json-rpc-middleware/inflight-cache":5279},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./json-rpc-engine-middleware"),s=e("eth-json-rpc-middleware/inflight-cache");t.exports=class extends n{constructor(e){super((()=>s(e)))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5302,{"./provider.js":5305,"eth-json-rpc-infura/src/createProvider":2049},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("eth-json-rpc-infura/src/createProvider"),s=e("./provider.js");t.exports=class extends s{constructor(e={}){super(n(e))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5303,{"./subprovider.js":5307},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./subprovider.js");t.exports=class extends n{constructor(e){if(super(),!e)throw new Error("JsonRpcEngineMiddlewareSubprovider - no constructorFn specified");this._constructorFn=e}setEngine(e){if(this.middleware)throw new Error("JsonRpcEngineMiddlewareSubprovider - subprovider added to engine twice");const t=e._blockTracker,r=this._constructorFn({engine:e,provider:e,blockTracker:t});if(!r)throw new Error("JsonRpcEngineMiddlewareSubprovider - _constructorFn did not return middleware");if("function"!=typeof r)throw new Error("JsonRpcEngineMiddlewareSubprovider - specified middleware is not a function");this.middleware=r}handleRequest(e,t,r){const n={id:e.id};this.middleware(e,n,(function(e){t(((t,r,s)=>{t?(delete n.result,n.error={message:t.message||t}):n.result=r,e?e(s):s()}))}),(function(e){if(e)return r(e);r(null,n.result)}))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5304,{"../util/rpc-cache-utils":5313,"./subprovider.js":5307,"@ethereumjs/tx":331,buffer:1797,"ethereumjs-util":5287,util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("util").inherits,{TransactionFactory:s}=e("@ethereumjs/tx"),o=e("ethereumjs-util"),i=e("./subprovider.js"),a=e("../util/rpc-cache-utils").blockTagForPayload;function c(){this.nonceCache={}}t.exports=c,n(c,i),c.prototype.handleRequest=function(e,t,n){const i=this;switch(e.method){case"eth_getTransactionCount":var c=a(e),l=e.params[0].toLowerCase(),u=i.nonceCache[l];return void("pending"===c?u?n(null,u):t((function(e,t,r){if(e)return r();i.nonceCache[l]===undefined&&(i.nonceCache[l]=t),r()})):t());case"eth_sendRawTransaction":return void t((function(t,n,a){if(t)return a();var c=e.params[0],l=r.from(o.stripHexPrefix(c),"hex");const u=s.fromSerializedData(l);var d=u.getSenderAddress().toString("hex").toLowerCase(),h=o.bufferToInt(u.nonce),p=(++h).toString(16);p.length%2&&(p="0"+p),p="0x"+p,i.nonceCache[d]=p,a()}));case"evm_revert":return i.nonceCache={},void t();default:return void t()}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5305,{"./subprovider.js":5307,util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("util").inherits,s=e("./subprovider.js");function o(e){if(!e)throw new Error("ProviderSubprovider - no provider specified");if(!e.sendAsync)throw new Error("ProviderSubprovider - specified provider does not have a sendAsync method");this.provider=e}t.exports=o,n(o,s),o.prototype.handleRequest=function(e,t,r){this.provider.sendAsync(e,(function(e,t){return e?r(e):t.error?r(new Error(t.error.message)):void r(null,t.result)}))}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5306,{"./subprovider.js":5307,"ethereumjs-util":5287,util:1803,xtend:5385},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("util").inherits,s=e("./subprovider.js"),o=(e("xtend"),e("ethereumjs-util"));function i(e){}t.exports=i,n(i,s),i.prototype.handleRequest=function(e,t,r){var n=e.params[0];if("object"==typeof n&&!Array.isArray(n)){var s=function(e){return a.reduce((function(t,r){return r in e&&(Array.isArray(e[r])?t[r]=e[r].map((function(e){return c(e)})):t[r]=c(e[r])),t}),{})}(n);e.params[0]=s}t()};var a=["from","to","value","data","gas","gasPrice","nonce","fromBlock","toBlock","address","topics"];function c(e){switch(e){case"latest":case"pending":case"earliest":return e;default:return"string"==typeof e?o.addHexPrefix(e.toLowerCase()):e}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5307,{"../util/create-payload.js":5310},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("../util/create-payload.js");function s(){}t.exports=s,s.prototype.setEngine=function(e){const t=this;t.engine||(t.engine=e,e.on("block",(function(e){t.currentBlock=e})),e.on("start",(function(){t.start()})),e.on("stop",(function(){t.stop()})))},s.prototype.handleRequest=function(e,t,r){throw new Error("Subproviders should override `handleRequest`.")},s.prototype.emitPayload=function(e,t){this.engine.sendAsync(n(e),t)},s.prototype.stop=function(){},s.prototype.start=function(){}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5308,{"./json-rpc-engine-middleware":5303,"eth-json-rpc-filters/subscriptionManager":2038},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./json-rpc-engine-middleware"),s=e("eth-json-rpc-filters/subscriptionManager");t.exports=class extends n{constructor(){super((({blockTracker:e,provider:t,engine:r})=>{const{events:n,middleware:o}=s({blockTracker:e,provider:t});return n.on("notification",(e=>r.emit("data",null,e))),o}))}}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5309,{"../util/create-payload":5310,"./subprovider":5307,backoff:1695,events:1798,util:1803,ws:1796},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("backoff"),s=e("events"),o=(e("util").inherits,global.WebSocket||e("ws")),i=e("./subprovider"),a=e("../util/create-payload");class c extends i{constructor({rpcUrl:e,debug:t,origin:r}){super(),s.call(this),Object.defineProperties(this,{_backoff:{value:n.exponential({randomisationFactor:.2,maxDelay:5e3})},_connectTime:{value:null,writable:!0},_log:{value:t?(...e)=>console.info.apply(console,["[WSProvider]",...e]):()=>{}},_origin:{value:r},_pendingRequests:{value:new Map},_socket:{value:null,writable:!0},_unhandledRequests:{value:[]},_url:{value:e}}),this._handleSocketClose=this._handleSocketClose.bind(this),this._handleSocketMessage=this._handleSocketMessage.bind(this),this._handleSocketOpen=this._handleSocketOpen.bind(this),this._backoff.on("ready",(()=>{this._openSocket()})),this._openSocket()}handleRequest(e,t,r){if(!this._socket||this._socket.readyState!==o.OPEN)return this._unhandledRequests.push(Array.from(arguments)),void this._log("Socket not open. Request queued.");this._pendingRequests.set(e.id,[e,r]);const n=a(e);delete n.origin,this._socket.send(JSON.stringify(n)),this._log(`Sent: ${n.method} #${n.id}`)}_handleSocketClose({reason:e,code:t}){this._log(`Socket closed, code ${t} (${e||"no reason"})`),this._connectTime&&Date.now()-this._connectTime>5e3&&this._backoff.reset(),this._socket.removeEventListener("close",this._handleSocketClose),this._socket.removeEventListener("message",this._handleSocketMessage),this._socket.removeEventListener("open",this._handleSocketOpen),this._socket=null,this._backoff.backoff()}_handleSocketMessage(e){let t;try{t=JSON.parse(e.data)}catch(e){return void this._log("Received a message that is not valid JSON:",t)}if(t.id===undefined)return this.engine.emit("data",null,t);if(!this._pendingRequests.has(t.id))return;const[r,n]=this._pendingRequests.get(t.id);if(this._pendingRequests.delete(t.id),this._log(`Received: ${r.method} #${t.id}`),t.error)return n(new Error(t.error.message));n(null,t.result)}_handleSocketOpen(){this._log("Socket open."),this._connectTime=Date.now(),this._pendingRequests.forEach((([e,t])=>{this._unhandledRequests.push([e,null,t])})),this._pendingRequests.clear();this._unhandledRequests.splice(0,this._unhandledRequests.length).forEach((e=>{this.handleRequest.apply(this,e)}))}_openSocket(){this._log("Opening socket..."),this._socket=new o(this._url,[],this._origin?{headers:{origin:this._origin}}:{}),this._socket.addEventListener("close",this._handleSocketClose),this._socket.addEventListener("message",this._handleSocketMessage),this._socket.addEventListener("open",this._handleSocketOpen)}}Object.assign(c.prototype,s.prototype),t.exports=c}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[531,{"@ethereumjs/tx":331,"@keystonehq/base-eth-keyring":494,"@keystonehq/bc-ur-registry-eth":502,"@metamask/obs-store":536,buffer:1797,events:1798,rlp:5079,uuid:5247},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0});var n,s=e("@keystonehq/base-eth-keyring"),o=e("events"),i=e("@metamask/obs-store"),a=e("@keystonehq/bc-ur-registry-eth"),c=e("uuid"),l=e("@ethereumjs/tx"),u=(n=e("rlp"))&&"object"==typeof n&&"default"in n?n.default:n;class d extends o.EventEmitter{constructor(){if(super(),this.cleanSyncListeners=()=>{this.removeAllListeners("keystone-sync_success-hdkey"),this.removeAllListeners("keystone-sync_success-account"),this.removeAllListeners("keystone-sync_cancel")},this.cleanSignListeners=e=>{this.removeAllListeners(e+"-signed"),this.removeAllListeners(e+"-canceled")},this.readCryptoHDKeyOrCryptoAccount=()=>new Promise(((e,r)=>{this.memStore.updateState({sync:{reading:!0}}),this.on("keystone-sync_success-hdkey",(r=>{const n=a.CryptoHDKey.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_success-account",(r=>{const n=a.CryptoAccount.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_cancel",(()=>{this.resetState(),r(new Error("KeystoneError#sync_cancel. Sync process canceled, please retry"))}))})),this.submitCryptoHDKey=e=>{this.emit("keystone-sync_success-hdkey",e)},this.submitCryptoAccount=e=>{this.emit("keystone-sync_success-account",e)},this.cancelSync=()=>{this.emit("keystone-sync_cancel")},this.requestSignature=(e,r,n)=>new Promise(((s,o)=>{const i=e.toUR(),l=e.getRequestId(),u=c.stringify(l),d={requestId:u,payload:{type:i.type,cbor:i.cbor.toString("hex")},title:r,description:n};this.memStore.updateState({sign:{request:d}}),this.once(u+"-signed",(e=>{const r=a.ETHSignature.fromCBOR(t.from(e,"hex"));this.resetState(),s(r)})),this.once(u+"-canceled",(()=>{this.resetState(),o(new Error("KeystoneError#Tx_canceled. Signing canceled, please retry"))}))})),this.submitSignature=(e,t)=>{this.emit(e+"-signed",t)},this.cancelRequestSignature=()=>{const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.memStore.updateState({sign:{}}),this.emit(t+"-canceled")}},this.reset=()=>{this.cleanSyncListeners();const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.cleanSignListeners(t)}this.resetState()},this.resetState=()=>{this.memStore.updateState({sync:{reading:!1},sign:{}})},d.instance)return d.instance;this.memStore=new i.ObservableStore({sync:{reading:!1},sign:{},_version:1}),d.instance=this}}class h extends s.BaseKeyring{constructor(e){if(super(e),this.getInteraction=()=>new d,this.resetStore=()=>{this.getInteraction().reset()},this.getMemStore=()=>this.getInteraction().memStore,this.removeAccount=e=>{if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))},this.forgetDevice=()=>{this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.name="QR Hardware",this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.indexes={},this.hdk=void 0,this.paths={}},this.submitCryptoHDKey=this.getInteraction().submitCryptoHDKey,this.submitCryptoAccount=this.getInteraction().submitCryptoAccount,this.submitSignature=this.getInteraction().submitSignature,this.cancelSync=this.getInteraction().cancelSync,this.cancelSignRequest=this.getInteraction().cancelRequestSignature,h.instance)return h.instance.deserialize(e),h.instance;h.instance=this}async signTransaction(e,t){const r=0===t.type?a.DataType.transaction:a.DataType.typedTransaction;let n;n=0===t.type?u.encode(t.getMessageToSign(!1)):t.getMessageToSign(!1);const s=await this._pathFromAddress(e),o=t.common.chainId(),i=c.v4(),d=a.EthSignRequest.constructETHRequest(n,r,s,this.xfp,i,o,e),{r:h,s:p,v:f}=await this.requestSignature(i,d,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature'),m=t.toJSON();return m.v=f,m.s=p,m.r=h,m.type=t.type,l.TransactionFactory.fromTxData(m,{common:t.common})}}h.type=s.BaseKeyring.type,r.MetaMaskKeyring=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring"}],[5310,{"./random-id.js":5312,xtend:5385},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./random-id.js"),s=e("xtend");t.exports=function(e){return s({id:n(),jsonrpc:"2.0",params:[]},e)}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5311,{"./create-payload.js":5310},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./create-payload.js");t.exports=function(e,t,r){e.sendAsync(n({method:"eth_estimateGas",params:[t]}),(function(e,t){if(e)return"no contract code at given address"===e.message?r(null,"0xcf08"):r(e);r(null,t.result)}))}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5312,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){return Math.floor(Number.MAX_SAFE_INTEGER*Math.random())}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5313,{"json-stable-stringify":4565},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("json-stable-stringify");function s(e){return"never"!==a(e)}function o(e){var t=i(e);return t>=e.params.length?e.params:"eth_getBlockByNumber"===e.method?e.params.slice(1):e.params.slice(0,t)}function i(e){switch(e.method){case"eth_getStorageAt":return 2;case"eth_getBalance":case"eth_getCode":case"eth_getTransactionCount":case"eth_call":case"eth_estimateGas":return 1;case"eth_getBlockByNumber":return 0;default:return undefined}}function a(e){switch(e.method){case"web3_clientVersion":case"web3_sha3":case"eth_protocolVersion":case"eth_getBlockTransactionCountByHash":case"eth_getUncleCountByBlockHash":case"eth_getCode":case"eth_getBlockByHash":case"eth_getTransactionByHash":case"eth_getTransactionByBlockHashAndIndex":case"eth_getTransactionReceipt":case"eth_getUncleByBlockHashAndIndex":case"eth_getCompilers":case"eth_compileLLL":case"eth_compileSolidity":case"eth_compileSerpent":case"shh_version":return"perma";case"eth_getBlockByNumber":case"eth_getBlockTransactionCountByNumber":case"eth_getUncleCountByBlockNumber":case"eth_getTransactionByBlockNumberAndIndex":case"eth_getUncleByBlockNumberAndIndex":return"fork";case"eth_gasPrice":case"eth_getBalance":case"eth_getStorageAt":case"eth_getTransactionCount":case"eth_call":case"eth_estimateGas":case"eth_getFilterLogs":case"eth_getLogs":case"eth_blockNumber":return"block";case"net_version":case"net_peerCount":case"net_listening":case"eth_syncing":case"eth_sign":case"eth_coinbase":case"eth_mining":case"eth_hashrate":case"eth_accounts":case"eth_sendTransaction":case"eth_sendRawTransaction":case"eth_newFilter":case"eth_newBlockFilter":case"eth_newPendingTransactionFilter":case"eth_uninstallFilter":case"eth_getFilterChanges":case"eth_getWork":case"eth_submitWork":case"eth_submitHashrate":case"db_putString":case"db_getString":case"db_putHex":case"db_getHex":case"shh_post":case"shh_newIdentity":case"shh_hasIdentity":case"shh_newGroup":case"shh_addToGroup":case"shh_newFilter":case"shh_uninstallFilter":case"shh_getFilterChanges":case"shh_getMessages":return"never"}}t.exports={cacheIdentifierForPayload:function(e,t={}){if(!s(e))return null;const{includeBlockRef:r}=t,i=r?e.params:o(e);return e.method+":"+n(i)},canCache:s,blockTagForPayload:function(e){var t=i(e);if(t>=e.params.length)return null;return e.params[t]},paramsWithoutBlockTag:o,blockTagParamIndex:i,cacheTypeForPayload:a}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5314,{events:1798,util:1803},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("events").EventEmitter,s=e("util").inherits;function o(){n.call(this),this.isLocked=!0}t.exports=o,s(o,n),o.prototype.go=function(){this.isLocked=!1,this.emit("unlock")},o.prototype.stop=function(){this.isLocked=!0,this.emit("lock")},o.prototype.await=function(e){const t=this;t.isLocked?t.once("unlock",e):setTimeout(e)}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[5315,{"./index.js":5273,"./subproviders/cache.js":5295,"./subproviders/default-fixture.js":5296,"./subproviders/fetch.js":5297,"./subproviders/filters":5298,"./subproviders/hooked-wallet.js":5300,"./subproviders/inflight-cache":5301,"./subproviders/infura.js":5302,"./subproviders/nonce-tracker.js":5304,"./subproviders/sanitizer.js":5306,"./subproviders/subscriptions":5308,"./subproviders/websocket.js":5309},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./index.js"),s=e("./subproviders/default-fixture.js"),o=e("./subproviders/nonce-tracker.js"),i=e("./subproviders/cache.js"),a=e("./subproviders/filters"),c=e("./subproviders/subscriptions"),l=e("./subproviders/inflight-cache"),u=e("./subproviders/hooked-wallet.js"),d=e("./subproviders/sanitizer.js"),h=e("./subproviders/infura.js"),p=e("./subproviders/fetch.js"),f=e("./subproviders/websocket.js");t.exports=function(e={}){const t=function({rpcUrl:e}){if(!e)return undefined;switch(e.split(":")[0].toLowerCase()){case"http":case"https":return"http";case"ws":case"wss":return"ws";default:throw new Error(`ProviderEngine - unrecognized protocol in "${e}"`)}}(e),r=new n(e.engineParams),m=new s(e.static);r.addProvider(m),r.addProvider(new o);const g=new d;r.addProvider(g);const y=new i;r.addProvider(y),"ws"!==t&&(r.addProvider(new c),r.addProvider(new a));const b=new l;r.addProvider(b);const v=new u({getAccounts:e.getAccounts,processTransaction:e.processTransaction,approveTransaction:e.approveTransaction,signTransaction:e.signTransaction,publishTransaction:e.publishTransaction,processMessage:e.processMessage,approveMessage:e.approveMessage,signMessage:e.signMessage,processPersonalMessage:e.processPersonalMessage,processTypedMessage:e.processTypedMessage,approvePersonalMessage:e.approvePersonalMessage,approveTypedMessage:e.approveTypedMessage,signPersonalMessage:e.signPersonalMessage,signTypedMessage:e.signTypedMessage,personalRecoverSigner:e.personalRecoverSigner});r.addProvider(v);const w=e.dataSubprovider||function(e,t){const{rpcUrl:r,debug:n}=t;if(!e)return new h;if("http"===e)return new p({rpcUrl:r,debug:n});if("ws"===e)return new f({rpcUrl:r,debug:n});throw new Error(`ProviderEngine - unrecognized connectionType "${e}"`)}(t,e);r.addProvider(w),e.stopped||r.start();return r}}}},{package:"@metamask/gas-fee-controller>@metamask/network-controller>web3-provider-engine"}],[532,{"./ObservableStore":534},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const n=e("./ObservableStore");class s extends n.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=s}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5323,{"./lib/web3":5345},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./lib/web3");"undefined"!=typeof window&&void 0===window.Web3&&(window.Web3=n),t.exports=n}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5324,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"name",outputs:[{name:"o_name",type:"bytes32"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"reserve",outputs:[],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"subRegistrar",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_newOwner",type:"address"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_registrar",type:"address"}],name:"setSubRegistrar",outputs:[],type:"function"},{constant:!1,inputs:[],name:"Registrar",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_a",type:"address"},{name:"_primary",type:"bool"}],name:"setAddress",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_content",type:"bytes32"}],name:"setContent",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"disown",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"_name",type:"bytes32"},{indexed:!1,name:"_winner",type:"address"}],name:"AuctionEnded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"_name",type:"bytes32"},{indexed:!1,name:"_bidder",type:"address"},{indexed:!1,name:"_value",type:"uint256"}],name:"NewBid",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"}],name:"Changed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"},{indexed:!0,name:"addr",type:"address"}],name:"PrimaryChanged",type:"event"}]}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5325,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=[{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_refund",type:"address"}],name:"disown",outputs:[],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"reserve",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_newOwner",type:"address"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_a",type:"address"}],name:"setAddr",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"}],name:"Changed",type:"event"}]}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5326,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=[{constant:!1,inputs:[{name:"from",type:"bytes32"},{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"from",type:"bytes32"},{name:"to",type:"address"},{name:"indirectId",type:"bytes32"},{name:"value",type:"uint256"}],name:"icapTransfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"to",type:"bytes32"}],name:"deposit",outputs:[],payable:!0,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"AnonymousDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"bytes32"},{indexed:!1,name:"value",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"bytes32"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"bytes32"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"indirectId",type:"bytes32"},{indexed:!1,name:"value",type:"uint256"}],name:"IcapTransfer",type:"event"}]}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5327,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputInt,this._outputFormatter=n.formatOutputAddress};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/address(\[([0-9]*)\])?/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5328,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputBool,this._outputFormatter=n.formatOutputBool};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^bool(\[([0-9]*)\])*$/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5329,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputBytes,this._outputFormatter=n.formatOutputBytes};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^bytes([0-9]{1,})(\[([0-9]*)\])*$/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[533,{"./ObservableStore":534},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const n=e("./ObservableStore");class s extends n.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=s}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5330,{"./address":5327,"./bool":5328,"./bytes":5329,"./dynamicbytes":5331,"./formatters":5332,"./int":5333,"./real":5335,"./string":5336,"./uint":5338,"./ureal":5339},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./address"),o=e("./bool"),i=e("./int"),a=e("./uint"),c=e("./dynamicbytes"),l=e("./string"),u=e("./real"),d=e("./ureal"),h=e("./bytes"),p=function(e,t){return e.isDynamicType(t)||e.isDynamicArray(t)},f=function(e){this._types=e};f.prototype._requireType=function(e){var t=this._types.filter((function(t){return t.isType(e)}))[0];if(!t)throw Error("invalid solidity type!: "+e);return t},f.prototype.encodeParam=function(e,t){return this.encodeParams([e],[t])},f.prototype.encodeParams=function(e,t){var r=this.getSolidityTypes(e),n=r.map((function(r,n){return r.encode(t[n],e[n])})),s=r.reduce((function(t,n,s){var o=n.staticPartLength(e[s]),i=32*Math.floor((o+31)/32);return t+(p(r[s],e[s])?32:i)}),0);return this.encodeMultiWithOffset(e,r,n,s)},f.prototype.encodeMultiWithOffset=function(e,t,r,s){var o="",i=this;return e.forEach((function(a,c){if(p(t[c],e[c])){o+=n.formatInputInt(s).encode();var l=i.encodeWithOffset(e[c],t[c],r[c],s);s+=l.length/2}else o+=i.encodeWithOffset(e[c],t[c],r[c],s)})),e.forEach((function(n,a){if(p(t[a],e[a])){var c=i.encodeWithOffset(e[a],t[a],r[a],s);s+=c.length/2,o+=c}})),o},f.prototype.encodeWithOffset=function(e,t,r,s){var o=1,i=2,a=3,c=t.isDynamicArray(e)?o:t.isStaticArray(e)?i:a;if(c!==a){var l=t.nestedName(e),u=t.staticPartLength(l),d=c===o?r[0]:"";if(t.isDynamicArray(l))for(var h=c===o?2:0,p=0;p<r.length;p++)c===o?h+=+r[p-1][0]||0:c===i&&(h+=+(r[p-1]||[])[0]||0),d+=n.formatInputInt(s+p*u+32*h).encode();for(var f=c===o?r.length-1:r.length,m=0;m<f;m++){var g=d/2;c===o?d+=this.encodeWithOffset(l,t,r[m+1],s+g):c===i&&(d+=this.encodeWithOffset(l,t,r[m],s+g))}return d}return r},f.prototype.decodeParam=function(e,t){return this.decodeParams([e],t)[0]},f.prototype.decodeParams=function(e,t){var r=this.getSolidityTypes(e),n=this.getOffsets(e,r);return r.map((function(r,s){return r.decode(t,n[s],e[s],s)}))},f.prototype.getOffsets=function(e,t){for(var r=t.map((function(t,r){return t.staticPartLength(e[r])})),n=1;n<r.length;n++)r[n]+=r[n-1];return r.map((function(r,n){return r-t[n].staticPartLength(e[n])}))},f.prototype.getSolidityTypes=function(e){var t=this;return e.map((function(e){return t._requireType(e)}))};var m=new f([new s,new o,new i,new a,new c,new h,new l,new u,new d]);t.exports=m}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5331,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputDynamicBytes,this._outputFormatter=n.formatOutputDynamicBytes};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^bytes(\[([0-9]*)\])*$/)},o.prototype.isDynamicType=function(){return!0},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5332,{"../utils/config":5341,"../utils/utils":5343,"./param":5334,"bignumber.js":5373},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("bignumber.js"),s=e("../utils/utils"),o=e("../utils/config"),i=e("./param"),a=function(e){n.config(o.ETH_BIGNUMBER_ROUNDING_MODE);var t=s.padLeft(s.toTwosComplement(e).toString(16),64);return new i(t)},c=function(e){var t=e.staticPart()||"0";return function(e){return"1"===new n(e.substr(0,1),16).toString(2).substr(0,1)}(t)?new n(t,16).minus(new n("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16)).minus(1):new n(t,16)},l=function(e){var t=e.staticPart()||"0";return new n(t,16)};t.exports={formatInputInt:a,formatInputBytes:function(e){var t=s.toHex(e).substr(2),r=Math.floor((t.length+63)/64);return t=s.padRight(t,64*r),new i(t)},formatInputDynamicBytes:function(e){var t=s.toHex(e).substr(2),r=t.length/2,n=Math.floor((t.length+63)/64);return t=s.padRight(t,64*n),new i(a(r).value+t)},formatInputString:function(e){var t=s.fromUtf8(e).substr(2),r=t.length/2,n=Math.floor((t.length+63)/64);return t=s.padRight(t,64*n),new i(a(r).value+t)},formatInputBool:function(e){return new i("000000000000000000000000000000000000000000000000000000000000000"+(e?"1":"0"))},formatInputReal:function(e){return a(new n(e).times(new n(2).pow(128)))},formatOutputInt:c,formatOutputUInt:l,formatOutputReal:function(e){return c(e).dividedBy(new n(2).pow(128))},formatOutputUReal:function(e){return l(e).dividedBy(new n(2).pow(128))},formatOutputBool:function(e){return"0000000000000000000000000000000000000000000000000000000000000001"===e.staticPart()},formatOutputBytes:function(e,t){var r=t.match(/^bytes([0-9]*)/),n=parseInt(r[1]);return"0x"+e.staticPart().slice(0,2*n)},formatOutputDynamicBytes:function(e){var t=2*new n(e.dynamicPart().slice(0,64),16).toNumber();return"0x"+e.dynamicPart().substr(64,t)},formatOutputString:function(e){var t=2*new n(e.dynamicPart().slice(0,64),16).toNumber();return s.toUtf8(e.dynamicPart().substr(64,t))},formatOutputAddress:function(e){var t=e.staticPart();return"0x"+t.slice(t.length-40,t.length)}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5333,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputInt,this._outputFormatter=n.formatOutputInt};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^int([0-9]*)?(\[([0-9]*)\])*$/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5334,{"../utils/utils":5343},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=function(e,t){this.value=e||"",this.offset=t};s.prototype.dynamicPartLength=function(){return this.dynamicPart().length/2},s.prototype.withOffset=function(e){return new s(this.value,e)},s.prototype.combine=function(e){return new s(this.value+e.value)},s.prototype.isDynamic=function(){return this.offset!==undefined},s.prototype.offsetAsBytes=function(){return this.isDynamic()?n.padLeft(n.toTwosComplement(this.offset).toString(16),64):""},s.prototype.staticPart=function(){return this.isDynamic()?this.offsetAsBytes():this.value},s.prototype.dynamicPart=function(){return this.isDynamic()?this.value:""},s.prototype.encode=function(){return this.staticPart()+this.dynamicPart()},s.encodeList=function(e){var t=32*e.length,r=e.map((function(e){if(!e.isDynamic())return e;var r=t;return t+=e.dynamicPartLength(),e.withOffset(r)}));return r.reduce((function(e,t){return e+t.dynamicPart()}),r.reduce((function(e,t){return e+t.staticPart()}),""))},t.exports=s}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5335,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputReal,this._outputFormatter=n.formatOutputReal};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/real([0-9]*)?(\[([0-9]*)\])?/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5336,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputString,this._outputFormatter=n.formatOutputString};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^string(\[([0-9]*)\])*$/)},o.prototype.isDynamicType=function(){return!0},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5337,{"./formatters":5332,"./param":5334},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./param"),o=function(e){this._inputFormatter=e.inputFormatter,this._outputFormatter=e.outputFormatter};o.prototype.isType=function(e){throw"this method should be overrwritten for type "+e},o.prototype.staticPartLength=function(e){return(this.nestedTypes(e)||["[1]"]).map((function(e){return parseInt(e.slice(1,-1),10)||1})).reduce((function(e,t){return e*t}),32)},o.prototype.isDynamicArray=function(e){var t=this.nestedTypes(e);return!!t&&!t[t.length-1].match(/[0-9]{1,}/g)},o.prototype.isStaticArray=function(e){var t=this.nestedTypes(e);return!!t&&!!t[t.length-1].match(/[0-9]{1,}/g)},o.prototype.staticArrayLength=function(e){var t=this.nestedTypes(e);return t?parseInt(t[t.length-1].match(/[0-9]{1,}/g)||1):1},o.prototype.nestedName=function(e){var t=this.nestedTypes(e);return t?e.substr(0,e.length-t[t.length-1].length):e},o.prototype.isDynamicType=function(){return!1},o.prototype.nestedTypes=function(e){return e.match(/(\[[0-9]*\])/g)},o.prototype.encode=function(e,t){var r,s,o,i=this;return this.isDynamicArray(t)?(r=e.length,s=i.nestedName(t),(o=[]).push(n.formatInputInt(r).encode()),e.forEach((function(e){o.push(i.encode(e,s))})),o):this.isStaticArray(t)?function(){for(var r=i.staticArrayLength(t),n=i.nestedName(t),s=[],o=0;o<r;o++)s.push(i.encode(e[o],n));return s}():this._inputFormatter(e,t).encode()},o.prototype.decode=function(e,t,r){var n=this;if(this.isDynamicArray(r))return function(){for(var s=parseInt("0x"+e.substr(2*t,64)),o=parseInt("0x"+e.substr(2*s,64)),i=s+32,a=n.nestedName(r),c=n.staticPartLength(a),l=32*Math.floor((c+31)/32),u=[],d=0;d<o*l;d+=l)u.push(n.decode(e,i+d,a));return u}();if(this.isStaticArray(r))return function(){for(var s=n.staticArrayLength(r),o=t,i=n.nestedName(r),a=n.staticPartLength(i),c=32*Math.floor((a+31)/32),l=[],u=0;u<s*c;u+=c)l.push(n.decode(e,o+u,i));return l}();if(this.isDynamicType(r))return function(){var o=parseInt("0x"+e.substr(2*t,64)),i=parseInt("0x"+e.substr(2*o,64)),a=Math.floor((i+31)/32),c=new s(e.substr(2*o,64*(1+a)),0);return n._outputFormatter(c,r)}();var o=this.staticPartLength(r),i=new s(e.substr(2*t,2*o));return this._outputFormatter(i,r)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5338,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputInt,this._outputFormatter=n.formatOutputUInt};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^uint([0-9]*)?(\[([0-9]*)\])*$/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5339,{"./formatters":5332,"./type":5337},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./type"),o=function(){this._inputFormatter=n.formatInputReal,this._outputFormatter=n.formatOutputUReal};(o.prototype=new s({})).constructor=o,o.prototype.isType=function(e){return!!e.match(/^ureal([0-9]*)?(\[([0-9]*)\])*$/)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[534,{"@metamask/safe-event-emitter":1243},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const s=n(e("@metamask/safe-event-emitter"));class o extends s.default{constructor(e){super(),this._state=e||{}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=o}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5340,{},function(){with(this)return function(){"use strict";return function(e,t,r){"undefined"==typeof XMLHttpRequest?r.XMLHttpRequest={}:r.XMLHttpRequest=XMLHttpRequest}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5341,{"bignumber.js":5373},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("bignumber.js");t.exports={ETH_PADDING:32,ETH_SIGNATURE_LENGTH:4,ETH_UNITS:["wei","kwei","Mwei","Gwei","szabo","finney","femtoether","picoether","nanoether","microether","milliether","nano","micro","milli","ether","grand","Mether","Gether","Tether","Pether","Eether","Zether","Yether","Nether","Dether","Vether","Uether"],ETH_BIGNUMBER_ROUNDING_MODE:{ROUNDING_MODE:n.ROUND_DOWN},ETH_POLLING_TIMEOUT:500,defaultBlock:"latest",defaultAccount:undefined}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5342,{"crypto-js":1915,"crypto-js/sha3":1936},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("crypto-js"),s=e("crypto-js/sha3");t.exports=function(e,t){return t&&"hex"===t.encoding&&(e.length>2&&"0x"===e.substr(0,2)&&(e=e.substr(2)),e=n.enc.Hex.parse(e)),s(e,{outputLength:256}).toString()}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5343,{"./sha3.js":5342,"bignumber.js":5373,utf8:5374},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("bignumber.js"),s=e("./sha3.js"),o=e("utf8"),i={noether:"0",wei:"1",kwei:"1000",Kwei:"1000",babbage:"1000",femtoether:"1000",mwei:"1000000",Mwei:"1000000",lovelace:"1000000",picoether:"1000000",gwei:"1000000000",Gwei:"1000000000",shannon:"1000000000",nanoether:"1000000000",nano:"1000000000",szabo:"1000000000000",microether:"1000000000000",micro:"1000000000000",finney:"1000000000000000",milliether:"1000000000000000",milli:"1000000000000000",ether:"1000000000000000000",kether:"1000000000000000000000",grand:"1000000000000000000000",mether:"1000000000000000000000000",gether:"1000000000000000000000000000",tether:"1000000000000000000000000000000"},a=function(e,t,r){return new Array(t-e.length+1).join(r||"0")+e},c=function(e,t){e=o.encode(e);for(var r="",n=0;n<e.length;n++){var s=e.charCodeAt(n);if(0===s){if(!t)break;r+="00"}else{var i=s.toString(16);r+=i.length<2?"0"+i:i}}return"0x"+r},l=function(e){var t=h(e),r=t.toString(16);return t.lessThan(0)?"-0x"+r.substr(1):"0x"+r},u=function(e){if(y(e))return l(+e);if(m(e))return l(e);if("object"==typeof e)return c(JSON.stringify(e));if(g(e)){if(0===e.indexOf("-0x"))return l(e);if(0===e.indexOf("0x"))return e;if(!isFinite(e))return c(e,1)}return l(e)},d=function(e){e=e?e.toLowerCase():"ether";var t=i[e];if(t===undefined)throw new Error("This unit doesn't exists, please use the one of the following units"+JSON.stringify(i,null,2));return new n(t,10)},h=function(e){return m(e=e||0)?e:!g(e)||0!==e.indexOf("0x")&&0!==e.indexOf("-0x")?new n(e.toString(10),10):new n(e.replace("0x",""),16)},p=function(e){return/^0x[0-9a-f]{40}$/i.test(e)},f=function(e){e=e.replace("0x","");for(var t=s(e.toLowerCase()),r=0;r<40;r++)if(parseInt(t[r],16)>7&&e[r].toUpperCase()!==e[r]||parseInt(t[r],16)<=7&&e[r].toLowerCase()!==e[r])return!1;return!0},m=function(e){return e instanceof n||e&&e.constructor&&"BigNumber"===e.constructor.name},g=function(e){return"string"==typeof e||e&&e.constructor&&"String"===e.constructor.name},y=function(e){return"boolean"==typeof e};t.exports={padLeft:a,padRight:function(e,t,r){return e+new Array(t-e.length+1).join(r||"0")},toHex:u,toDecimal:function(e){return h(e).toNumber()},fromDecimal:l,toUtf8:function(e){var t="",r=0,n=e.length;for("0x"===e.substring(0,2)&&(r=2);r<n;r+=2){var s=parseInt(e.substr(r,2),16);if(0===s)break;t+=String.fromCharCode(s)}return o.decode(t)},toAscii:function(e){var t="",r=0,n=e.length;for("0x"===e.substring(0,2)&&(r=2);r<n;r+=2){var s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t},fromUtf8:c,fromAscii:function(e,t){for(var r="",n=0;n<e.length;n++){var s=e.charCodeAt(n).toString(16);r+=s.length<2?"0"+s:s}return"0x"+r.padEnd(t,"0")},transformToFullName:function(e){if(-1!==e.name.indexOf("("))return e.name;var t=e.inputs.map((function(e){return e.type})).join();return e.name+"("+t+")"},extractDisplayName:function(e){var t=e.indexOf("("),r=e.indexOf(")");return-1!==t&&-1!==r?e.substr(0,t):e},extractTypeName:function(e){var t=e.indexOf("("),r=e.indexOf(")");return-1!==t&&-1!==r?e.substr(t+1,r-t-1).replace(" ",""):""},toWei:function(e,t){var r=h(e).times(d(t));return m(e)?r:r.toString(10)},fromWei:function(e,t){var r=h(e).dividedBy(d(t));return m(e)?r:r.toString(10)},toBigNumber:h,toTwosComplement:function(e){var t=h(e).round();return t.lessThan(0)?new n("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",16).plus(t).plus(1):t},toAddress:function(e){return p(e)?e:/^[0-9a-f]{40}$/.test(e)?"0x"+e:"0x"+a(u(e).substr(2),40)},isBigNumber:m,isStrictAddress:p,isAddress:function(e){return!!/^(0x)?[0-9a-f]{40}$/i.test(e)&&(!(!/^(0x)?[0-9a-f]{40}$/.test(e)&&!/^(0x)?[0-9A-F]{40}$/.test(e))||f(e))},isChecksumAddress:f,toChecksumAddress:function(e){if(void 0===e)return"";e=e.toLowerCase().replace("0x","");for(var t=s(e),r="0x",n=0;n<e.length;n++)parseInt(t[n],16)>7?r+=e[n].toUpperCase():r+=e[n];return r},isFunction:function(e){return"function"==typeof e},isString:g,isObject:function(e){return null!==e&&!Array.isArray(e)&&"object"==typeof e},isBoolean:y,isArray:function(e){return Array.isArray(e)},isJson:function(e){try{return!!JSON.parse(e)}catch(e){return!1}},isBloom:function(e){return!!/^(0x)?[0-9a-f]{512}$/i.test(e)&&!(!/^(0x)?[0-9a-f]{512}$/.test(e)&&!/^(0x)?[0-9A-F]{512}$/.test(e))},isTopic:function(e){return!!/^(0x)?[0-9a-f]{64}$/i.test(e)&&!(!/^(0x)?[0-9a-f]{64}$/.test(e)&&!/^(0x)?[0-9A-F]{64}$/.test(e))}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5344,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={version:"0.20.7"}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5345,{"./utils/sha3":5342,"./utils/utils":5343,"./version.json":5344,"./web3/batch":5347,"./web3/extend":5351,"./web3/httpprovider":5355,"./web3/iban":5356,"./web3/ipcprovider":5357,"./web3/methods/db":5360,"./web3/methods/eth":5361,"./web3/methods/net":5362,"./web3/methods/personal":5363,"./web3/methods/shh":5364,"./web3/methods/swarm":5365,"./web3/property":5368,"./web3/requestmanager":5369,"./web3/settings":5370,"bignumber.js":5373},function(){with(this)return function(){"use strict";return function(e,t,r){
/*!
 * web3.js - Ethereum JavaScript API
 *
 * @license lgpl-3.0
 * @see https://github.com/ethereum/web3.js
*/
var n=e("./web3/requestmanager"),s=e("./web3/iban"),o=e("./web3/methods/eth"),i=e("./web3/methods/db"),a=e("./web3/methods/shh"),c=e("./web3/methods/net"),l=e("./web3/methods/personal"),u=e("./web3/methods/swarm"),d=e("./web3/settings"),h=e("./version.json"),p=e("./utils/utils"),f=e("./utils/sha3"),m=e("./web3/extend"),g=e("./web3/batch"),y=e("./web3/property"),b=e("./web3/httpprovider"),v=e("./web3/ipcprovider"),w=e("bignumber.js");function k(e){this._requestManager=new n(e),this.currentProvider=e,this.eth=new o(this),this.db=new i(this),this.shh=new a(this),this.net=new c(this),this.personal=new l(this),this.bzz=new u(this),this.settings=new d,this.version={api:h.version},this.providers={HttpProvider:b,IpcProvider:v},this._extend=m(this),this._extend({properties:_()})}k.providers={HttpProvider:b,IpcProvider:v},k.prototype.setProvider=function(e){this._requestManager.setProvider(e),this.currentProvider=e},k.prototype.reset=function(e){this._requestManager.reset(e),this.settings=new d},k.prototype.BigNumber=w,k.prototype.toHex=p.toHex,k.prototype.toAscii=p.toAscii,k.prototype.toUtf8=p.toUtf8,k.prototype.fromAscii=p.fromAscii,k.prototype.fromUtf8=p.fromUtf8,k.prototype.toDecimal=p.toDecimal,k.prototype.fromDecimal=p.fromDecimal,k.prototype.toBigNumber=p.toBigNumber,k.prototype.toWei=p.toWei,k.prototype.fromWei=p.fromWei,k.prototype.isAddress=p.isAddress,k.prototype.isChecksumAddress=p.isChecksumAddress,k.prototype.toChecksumAddress=p.toChecksumAddress,k.prototype.isIBAN=p.isIBAN,k.prototype.padLeft=p.padLeft,k.prototype.padRight=p.padRight,k.prototype.sha3=function(e,t){return"0x"+f(e,t)},k.prototype.fromICAP=function(e){return new s(e).address()};var _=function(){return[new y({name:"version.node",getter:"web3_clientVersion"}),new y({name:"version.network",getter:"net_version",inputFormatter:p.toDecimal}),new y({name:"version.ethereum",getter:"eth_protocolVersion",inputFormatter:p.toDecimal}),new y({name:"version.whisper",getter:"shh_version",inputFormatter:p.toDecimal})]};k.prototype.isConnected=function(){return this.currentProvider&&this.currentProvider.isConnected()},k.prototype.createBatch=function(){return new g(this)},t.exports=k}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5346,{"../utils/sha3":5342,"../utils/utils":5343,"./event":5350,"./filter":5352,"./formatters":5353,"./methods/watches":5366},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/sha3"),s=e("./event"),o=e("./formatters"),i=e("../utils/utils"),a=e("./filter"),c=e("./methods/watches"),l=function(e,t,r){this._requestManager=e,this._json=t,this._address=r};l.prototype.encode=function(e){e=e||{};var t={};return["fromBlock","toBlock"].filter((function(t){return e[t]!==undefined})).forEach((function(r){t[r]=o.inputBlockNumberFormatter(e[r])})),t.address=this._address,t},l.prototype.decode=function(e){e.data=e.data||"";var t=i.isArray(e.topics)&&i.isString(e.topics[0])?e.topics[0].slice(2):"",r=this._json.filter((function(e){return t===n(i.transformToFullName(e))}))[0];return r?new s(this._requestManager,r,this._address).decode(e):o.outputLogFormatter(e)},l.prototype.execute=function(e,t){i.isFunction(arguments[arguments.length-1])&&(t=arguments[arguments.length-1],1===arguments.length&&(e=null));var r=this.encode(e),n=this.decode.bind(this);return new a(r,"eth",this._requestManager,c.eth(),n,t)},l.prototype.attachToContract=function(e){var t=this.execute.bind(this);e.allEvents=t},t.exports=l}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5347,{"./errors":5349,"./jsonrpc":5358},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./jsonrpc"),s=e("./errors"),o=function(e){this.requestManager=e._requestManager,this.requests=[]};o.prototype.add=function(e){this.requests.push(e)},o.prototype.execute=function(){var e=this.requests;this.requestManager.sendBatch(e,(function(t,r){r=r||[],e.map((function(e,t){return r[t]||{}})).forEach((function(t,r){if(e[r].callback){if(!n.isValidResponse(t))return e[r].callback(s.InvalidResponse(t));e[r].callback(null,e[r].format?e[r].format(t.result):t.result)}}))}))},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5348,{"../solidity/coder":5330,"../utils/utils":5343,"./allevents":5346,"./event":5350,"./function":5354},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=e("../solidity/coder"),o=e("./event"),i=e("./function"),a=e("./allevents"),c=function(e,t){return e.filter((function(e){return"constructor"===e.type&&e.inputs.length===t.length})).map((function(e){return e.inputs.map((function(e){return e.type}))})).map((function(e){return s.encodeParams(e,t)}))[0]||""},l=function(e){e.abi.filter((function(e){return"function"===e.type})).map((function(t){return new i(e._eth,t,e.address)})).forEach((function(t){t.attachToContract(e)}))},u=function(e){var t=e.abi.filter((function(e){return"event"===e.type}));new a(e._eth._requestManager,t,e.address).attachToContract(e),t.map((function(t){return new o(e._eth._requestManager,t,e.address)})).forEach((function(t){t.attachToContract(e)}))},d=function(e,t){var r=0,n=!1,s=e._eth.filter("latest",(function(o){if(!o&&!n)if(++r>50){if(s.stopWatching((function(){})),n=!0,!t)throw new Error("Contract transaction couldn't be found after 50 blocks");t(new Error("Contract transaction couldn't be found after 50 blocks"))}else e._eth.getTransactionReceipt(e.transactionHash,(function(r,o){o&&o.blockHash&&!n&&e._eth.getCode(o.contractAddress,(function(r,i){if(!n&&i)if(s.stopWatching((function(){})),n=!0,i.length>3)e.address=o.contractAddress,l(e),u(e),t&&t(null,e);else{if(!t)throw new Error("The contract code couldn't be stored, please check your gas amount.");t(new Error("The contract code couldn't be stored, please check your gas amount."))}}))}))}))},h=function(e,t){this.eth=e,this.abi=t,this.new=function(){var e,r=new p(this.eth,this.abi),s={},o=Array.prototype.slice.call(arguments);n.isFunction(o[o.length-1])&&(e=o.pop());var i=o[o.length-1];if(n.isObject(i)&&!n.isArray(i)&&(s=o.pop()),s.value>0){var a=t.filter((function(e){return"constructor"===e.type&&e.inputs.length===o.length}))[0]||{};if(!a.payable)throw new Error("Cannot send value to non-payable constructor")}var l=c(this.abi,o);if(s.data+=l,e)this.eth.sendTransaction(s,(function(t,n){t?e(t):(r.transactionHash=n,e(null,r),d(r,e))}));else{var u=this.eth.sendTransaction(s);r.transactionHash=u,d(r)}return r},this.new.getData=this.getData.bind(this)};h.prototype.at=function(e,t){var r=new p(this.eth,this.abi,e);return l(r),u(r),t&&t(null,r),r},h.prototype.getData=function(){var e={},t=Array.prototype.slice.call(arguments),r=t[t.length-1];n.isObject(r)&&!n.isArray(r)&&(e=t.pop());var s=c(this.abi,t);return e.data+=s,e.data};var p=function(e,t,r){this._eth=e,this.transactionHash=null,this.address=r,this.abi=t};t.exports=h}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5349,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={InvalidNumberOfSolidityArgs:function(){return new Error("Invalid number of arguments to Solidity function")},InvalidNumberOfRPCParams:function(){return new Error("Invalid number of input parameters to RPC method")},InvalidConnection:function(e){return new Error("CONNECTION ERROR: Couldn't connect to node "+e+".")},InvalidProvider:function(){return new Error("Provider not set or invalid")},InvalidResponse:function(e){var t=e&&e.error&&e.error.message?e.error.message:"Invalid JSON RPC response: "+JSON.stringify(e);return new Error(t)},ConnectionTimeout:function(e){return new Error("CONNECTION TIMEOUT: timeout of "+e+" ms achived")}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[535,{stream:1800},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const n=e("stream");class s extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new s(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5350,{"../solidity/coder":5330,"../utils/sha3":5342,"../utils/utils":5343,"./filter":5352,"./formatters":5353,"./methods/watches":5366},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=e("../solidity/coder"),o=e("./formatters"),i=e("../utils/sha3"),a=e("./filter"),c=e("./methods/watches"),l=function(e,t,r){this._requestManager=e,this._params=t.inputs,this._name=n.transformToFullName(t),this._address=r,this._anonymous=t.anonymous};l.prototype.types=function(e){return this._params.filter((function(t){return t.indexed===e})).map((function(e){return e.type}))},l.prototype.displayName=function(){return n.extractDisplayName(this._name)},l.prototype.typeName=function(){return n.extractTypeName(this._name)},l.prototype.signature=function(){return i(this._name)},l.prototype.encode=function(e,t){e=e||{},t=t||{};var r={};["fromBlock","toBlock"].filter((function(e){return t[e]!==undefined})).forEach((function(e){r[e]=o.inputBlockNumberFormatter(t[e])})),r.topics=[],r.address=this._address,this._anonymous||r.topics.push("0x"+this.signature());var i=this._params.filter((function(e){return!0===e.indexed})).map((function(t){var r=e[t.name];return r===undefined||null===r?null:n.isArray(r)?r.map((function(e){return"0x"+s.encodeParam(t.type,e)})):"0x"+s.encodeParam(t.type,r)}));return r.topics=r.topics.concat(i),r},l.prototype.decode=function(e){e.data=e.data||"",e.topics=e.topics||[];var t=(this._anonymous?e.topics:e.topics.slice(1)).map((function(e){return e.slice(2)})).join(""),r=s.decodeParams(this.types(!0),t),n=e.data.slice(2),i=s.decodeParams(this.types(!1),n),a=o.outputLogFormatter(e);return a.event=this.displayName(),a.address=e.address,a.args=this._params.reduce((function(e,t){return e[t.name]=t.indexed?r.shift():i.shift(),e}),{}),delete a.data,delete a.topics,a},l.prototype.execute=function(e,t,r){n.isFunction(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],2===arguments.length&&(t=null),1===arguments.length&&(t=null,e={}));var s=this.encode(e,t),o=this.decode.bind(this);return new a(s,"eth",this._requestManager,c.eth(),o,r)},l.prototype.attachToContract=function(e){var t=this.execute.bind(this),r=this.displayName();e[r]||(e[r]=t),e[r][this.typeName()]=this.execute.bind(this,e)},t.exports=l}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5351,{"./../utils/utils":5343,"./formatters":5353,"./method":5359,"./property":5368},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("./../utils/utils"),o=e("./method"),i=e("./property");t.exports=function(e){var t=function(t){var r;t.property?(e[t.property]||(e[t.property]={}),r=e[t.property]):r=e,t.methods&&t.methods.forEach((function(t){t.attachToObject(r),t.setRequestManager(e._requestManager)})),t.properties&&t.properties.forEach((function(t){t.attachToObject(r),t.setRequestManager(e._requestManager)}))};return t.formatters=n,t.utils=s,t.Method=o,t.Property=i,t}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5352,{"../utils/utils":5343,"./formatters":5353},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("../utils/utils"),o=function(e){return null==e?null:0===(e=String(e)).indexOf("0x")?e:s.fromUtf8(e)},i=function(e,t){s.isString(e.options)||e.get((function(e,r){e&&t(e),s.isArray(r)&&r.forEach((function(e){t(null,e)}))}))},a=function(e){e.requestManager.startPolling({method:e.implementation.poll.call,params:[e.filterId]},e.filterId,(function(t,r){if(t)return e.callbacks.forEach((function(e){e(t)}));s.isArray(r)&&r.forEach((function(t){t=e.formatter?e.formatter(t):t,e.callbacks.forEach((function(e){e(null,t)}))}))}),e.stopWatching.bind(e))},c=function(e,t,r,c,l,u,d){var h=this,p={};return c.forEach((function(e){e.setRequestManager(r),e.attachToObject(p)})),this.requestManager=r,this.options=function(e,t){if(s.isString(e))return e;switch(e=e||{},t){case"eth":return e.topics=e.topics||[],e.topics=e.topics.map((function(e){return s.isArray(e)?e.map(o):o(e)})),{topics:e.topics,from:e.from,to:e.to,address:e.address,fromBlock:n.inputBlockNumberFormatter(e.fromBlock),toBlock:n.inputBlockNumberFormatter(e.toBlock)};case"shh":return e}}(e,t),this.implementation=p,this.filterId=null,this.callbacks=[],this.getLogsCallbacks=[],this.pollFilters=[],this.formatter=l,this.implementation.newFilter(this.options,(function(e,t){if(e)h.callbacks.forEach((function(t){t(e)})),"function"==typeof d&&d(e);else if(h.filterId=t,h.getLogsCallbacks.forEach((function(e){h.get(e)})),h.getLogsCallbacks=[],h.callbacks.forEach((function(e){i(h,e)})),h.callbacks.length>0&&a(h),"function"==typeof u)return h.watch(u)})),this};c.prototype.watch=function(e){return this.callbacks.push(e),this.filterId&&(i(this,e),a(this)),this},c.prototype.stopWatching=function(e){if(this.requestManager.stopPolling(this.filterId),this.callbacks=[],!e)return this.implementation.uninstallFilter(this.filterId);this.implementation.uninstallFilter(this.filterId,e)},c.prototype.get=function(e){var t=this;if(!s.isFunction(e)){if(null===this.filterId)throw new Error("Filter ID Error: filter().get() can't be chained synchronous, please provide a callback for the get() method.");return this.implementation.getLogs(this.filterId).map((function(e){return t.formatter?t.formatter(e):e}))}return null===this.filterId?this.getLogsCallbacks.push(e):this.implementation.getLogs(this.filterId,(function(r,n){r?e(r):e(null,n.map((function(e){return t.formatter?t.formatter(e):e})))})),this},t.exports=c}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5353,{"../utils/config":5341,"../utils/utils":5343,"./iban":5356},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=e("../utils/config"),o=e("./iban"),i=function(e){return e===undefined?undefined:function(e){return"latest"===e||"pending"===e||"earliest"===e}(e)?e:n.toHex(e)},a=function(e){return null!==e.blockNumber&&(e.blockNumber=n.toDecimal(e.blockNumber)),null!==e.transactionIndex&&(e.transactionIndex=n.toDecimal(e.transactionIndex)),e.nonce=n.toDecimal(e.nonce),e.gas=n.toDecimal(e.gas),e.gasPrice=n.toBigNumber(e.gasPrice),e.value=n.toBigNumber(e.value),e},c=function(e){return e.blockNumber&&(e.blockNumber=n.toDecimal(e.blockNumber)),e.transactionIndex&&(e.transactionIndex=n.toDecimal(e.transactionIndex)),e.logIndex&&(e.logIndex=n.toDecimal(e.logIndex)),e},l=function(e){var t=new o(e);if(t.isValid()&&t.isDirect())return"0x"+t.address();if(n.isStrictAddress(e))return e;if(n.isAddress(e))return"0x"+e;throw new Error("invalid address")};t.exports={inputDefaultBlockNumberFormatter:function(e){return e===undefined?s.defaultBlock:i(e)},inputBlockNumberFormatter:i,inputCallFormatter:function(e){return e.from=e.from||s.defaultAccount,e.from&&(e.from=l(e.from)),e.to&&(e.to=l(e.to)),["gasPrice","gas","value","nonce"].filter((function(t){return e[t]!==undefined})).forEach((function(t){e[t]=n.fromDecimal(e[t])})),e},inputTransactionFormatter:function(e){return e.from=e.from||s.defaultAccount,e.from=l(e.from),e.to&&(e.to=l(e.to)),["gasPrice","gas","value","nonce"].filter((function(t){return e[t]!==undefined})).forEach((function(t){e[t]=n.fromDecimal(e[t])})),e},inputAddressFormatter:l,inputPostFormatter:function(e){return e.ttl=n.fromDecimal(e.ttl),e.workToProve=n.fromDecimal(e.workToProve),e.priority=n.fromDecimal(e.priority),n.isArray(e.topics)||(e.topics=e.topics?[e.topics]:[]),e.topics=e.topics.map((function(e){return 0===e.indexOf("0x")?e:n.fromUtf8(e)})),e},outputBigNumberFormatter:function(e){return n.toBigNumber(e)},outputTransactionFormatter:a,outputTransactionReceiptFormatter:function(e){return null!==e.blockNumber&&(e.blockNumber=n.toDecimal(e.blockNumber)),null!==e.transactionIndex&&(e.transactionIndex=n.toDecimal(e.transactionIndex)),e.cumulativeGasUsed=n.toDecimal(e.cumulativeGasUsed),e.gasUsed=n.toDecimal(e.gasUsed),n.isArray(e.logs)&&(e.logs=e.logs.map((function(e){return c(e)}))),e},outputBlockFormatter:function(e){return e.gasLimit=n.toDecimal(e.gasLimit),e.gasUsed=n.toDecimal(e.gasUsed),e.size=n.toDecimal(e.size),e.timestamp=n.toDecimal(e.timestamp),null!==e.number&&(e.number=n.toDecimal(e.number)),e.difficulty=n.toBigNumber(e.difficulty),e.totalDifficulty=n.toBigNumber(e.totalDifficulty),n.isArray(e.transactions)&&e.transactions.forEach((function(e){if(!n.isString(e))return a(e)})),e},outputLogFormatter:c,outputPostFormatter:function(e){return e.expiry=n.toDecimal(e.expiry),e.sent=n.toDecimal(e.sent),e.ttl=n.toDecimal(e.ttl),e.workProved=n.toDecimal(e.workProved),e.topics||(e.topics=[]),e.topics=e.topics.map((function(e){return n.toAscii(e)})),e},outputSyncingFormatter:function(e){return e?(e.startingBlock=n.toDecimal(e.startingBlock),e.currentBlock=n.toDecimal(e.currentBlock),e.highestBlock=n.toDecimal(e.highestBlock),e.knownStates&&(e.knownStates=n.toDecimal(e.knownStates),e.pulledStates=n.toDecimal(e.pulledStates)),e):e}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5354,{"../solidity/coder":5330,"../utils/sha3":5342,"../utils/utils":5343,"./errors":5349,"./formatters":5353},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../solidity/coder"),s=e("../utils/utils"),o=e("./errors"),i=e("./formatters"),a=e("../utils/sha3"),c=function(e,t,r){this._eth=e,this._inputTypes=t.inputs.map((function(e){return e.type})),this._outputTypes=t.outputs.map((function(e){return e.type})),this._constant="view"===t.stateMutability||"pure"===t.stateMutability||t.constant,this._payable="payable"===t.stateMutability||t.payable,this._name=s.transformToFullName(t),this._address=r};c.prototype.extractCallback=function(e){if(s.isFunction(e[e.length-1]))return e.pop()},c.prototype.extractDefaultBlock=function(e){if(e.length>this._inputTypes.length&&!s.isObject(e[e.length-1]))return i.inputDefaultBlockNumberFormatter(e.pop())},c.prototype.validateArgs=function(e){if(e.filter((function(e){return!(!0===s.isObject(e)&&!1===s.isArray(e)&&!1===s.isBigNumber(e))})).length!==this._inputTypes.length)throw o.InvalidNumberOfSolidityArgs()},c.prototype.toPayload=function(e){var t={};return e.length>this._inputTypes.length&&s.isObject(e[e.length-1])&&(t=e[e.length-1]),this.validateArgs(e),t.to=this._address,t.data="0x"+this.signature()+n.encodeParams(this._inputTypes,e),t},c.prototype.signature=function(){return a(this._name).slice(0,8)},c.prototype.unpackOutput=function(e){if(e){e=e.length>=2?e.slice(2):e;var t=n.decodeParams(this._outputTypes,e);return 1===t.length?t[0]:t}},c.prototype.call=function(){var e=Array.prototype.slice.call(arguments).filter((function(e){return e!==undefined})),t=this.extractCallback(e),r=this.extractDefaultBlock(e),n=this.toPayload(e);if(!t){var s=this._eth.call(n,r);return this.unpackOutput(s)}var o=this;this._eth.call(n,r,(function(e,r){if(e)return t(e,null);var n=null;try{n=o.unpackOutput(r)}catch(t){e=t}t(e,n)}))},c.prototype.sendTransaction=function(){var e=Array.prototype.slice.call(arguments).filter((function(e){return e!==undefined})),t=this.extractCallback(e),r=this.toPayload(e);if(r.value>0&&!this._payable)throw new Error("Cannot send value to non-payable function");if(!t)return this._eth.sendTransaction(r);this._eth.sendTransaction(r,t)},c.prototype.estimateGas=function(){var e=Array.prototype.slice.call(arguments),t=this.extractCallback(e),r=this.toPayload(e);if(!t)return this._eth.estimateGas(r);this._eth.estimateGas(r,t)},c.prototype.getData=function(){var e=Array.prototype.slice.call(arguments),t=this.toPayload(e);return t.data},c.prototype.displayName=function(){return s.extractDisplayName(this._name)},c.prototype.typeName=function(){return s.extractTypeName(this._name)},c.prototype.request=function(){var e=Array.prototype.slice.call(arguments),t=this.extractCallback(e),r=this.toPayload(e),n=this.unpackOutput.bind(this);return{method:this._constant?"eth_call":"eth_sendTransaction",callback:t,params:[r],format:n}},c.prototype.execute=function(){var e=!this._constant;return e?this.sendTransaction.apply(this,Array.prototype.slice.call(arguments)):this.call.apply(this,Array.prototype.slice.call(arguments))},c.prototype.attachToContract=function(e){var t=this.execute.bind(this);t.request=this.request.bind(this),Reflect.defineProperty(t,"call",this.call.bind(this)),t.sendTransaction=this.sendTransaction.bind(this),t.estimateGas=this.estimateGas.bind(this),t.getData=this.getData.bind(this);var r=this.displayName();e[r]||(e[r]=t),e[r][this.typeName()]=t},t.exports=c}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5355,{"./errors":5349,buffer:1797,"xhr2-cookies":5379,xmlhttprequest:5340},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("./errors");"undefined"!=typeof window&&window.XMLHttpRequest?XMLHttpRequest=window.XMLHttpRequest:XMLHttpRequest=e("xmlhttprequest").XMLHttpRequest;var s=e("xhr2-cookies").XMLHttpRequest,o=function(e,t,r,n,s){this.host=e||"http://localhost:8545",this.timeout=t||0,this.user=r,this.password=n,this.headers=s};o.prototype.prepareRequest=function(e){var t;if(e?(t=new s).timeout=this.timeout:t=new XMLHttpRequest,t.withCredentials=!0,t.open("POST",this.host,e),this.user&&this.password){var n="Basic "+new r(this.user+":"+this.password).toString("base64");t.setRequestHeader("Authorization",n)}return t.setRequestHeader("Content-Type","application/json"),this.headers&&this.headers.forEach((function(e){t.setRequestHeader(e.name,e.value)})),t},o.prototype.send=function(e){var t=this.prepareRequest(!1);try{t.send(JSON.stringify(e))}catch(e){throw n.InvalidConnection(this.host)}var r=t.responseText;try{r=JSON.parse(r)}catch(e){throw n.InvalidResponse(t.responseText)}return r},o.prototype.sendAsync=function(e,t){var r=this.prepareRequest(!0);r.onreadystatechange=function(){if(4===r.readyState&&1!==r.timeout){var e=r.responseText,s=null;try{e=JSON.parse(e)}catch(e){s=n.InvalidResponse(r.responseText)}t(s,e)}},r.ontimeout=function(){t(n.ConnectionTimeout(this.timeout))};try{r.send(JSON.stringify(e))}catch(e){t(n.InvalidConnection(this.host))}},o.prototype.isConnected=function(){try{return this.send({id:9999999999,jsonrpc:"2.0",method:"net_listening",params:[]}),!0}catch(e){return!1}},t.exports=o}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5356,{"bignumber.js":5373},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("bignumber.js"),s=function(e,t){for(var r=e;r.length<2*t;)r="0"+r;return r},o=function(e){var t="A".charCodeAt(0),r="Z".charCodeAt(0);return(e=(e=e.toUpperCase()).substr(4)+e.substr(0,4)).split("").map((function(e){var n=e.charCodeAt(0);return n>=t&&n<=r?n-t+10:e})).join("")},i=function(e){for(var t,r=e;r.length>2;)t=r.slice(0,9),r=parseInt(t,10)%97+r.slice(t.length);return parseInt(r,10)%97},a=function(e){this._iban=e};a.fromAddress=function(e){var t=new n(e,16).toString(36),r=s(t,15);return a.fromBban(r.toUpperCase())},a.fromBban=function(e){var t=("0"+(98-i(o("XE"+"00"+e)))).slice(-2);return new a("XE"+t+e)},a.createIndirect=function(e){return a.fromBban("ETH"+e.institution+e.identifier)},a.isValid=function(e){return new a(e).isValid()},a.prototype.isValid=function(){return/^XE[0-9]{2}(ETH[0-9A-Z]{13}|[0-9A-Z]{30,31})$/.test(this._iban)&&1===i(o(this._iban))},a.prototype.isDirect=function(){return 34===this._iban.length||35===this._iban.length},a.prototype.isIndirect=function(){return 20===this._iban.length},a.prototype.checksum=function(){return this._iban.substr(2,2)},a.prototype.institution=function(){return this.isIndirect()?this._iban.substr(7,4):""},a.prototype.client=function(){return this.isIndirect()?this._iban.substr(11):""},a.prototype.address=function(){if(this.isDirect()){var e=this._iban.substr(4),t=new n(e,36);return s(t.toString(16),20)}return""},a.prototype.toString=function(){return this._iban},t.exports=a}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5357,{"../utils/utils":5343,"./errors":5349},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=e("./errors"),o=function(e,t){var r=this;this.responseCallbacks={},this.path=e,this.connection=t.connect({path:this.path}),this.connection.on("error",(function(e){console.error("IPC Connection Error",e),r._timeout()})),this.connection.on("end",(function(){r._timeout()})),this.connection.on("data",(function(e){r._parseResponse(e.toString()).forEach((function(e){var t=null;n.isArray(e)?e.forEach((function(e){r.responseCallbacks[e.id]&&(t=e.id)})):t=e.id,r.responseCallbacks[t]&&(r.responseCallbacks[t](null,e),delete r.responseCallbacks[t])}))}))};o.prototype._parseResponse=function(e){var t=this,r=[];return e.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach((function(e){t.lastChunk&&(e=t.lastChunk+e);var n=null;try{n=JSON.parse(e)}catch(r){return t.lastChunk=e,clearTimeout(t.lastChunkTimeout),void(t.lastChunkTimeout=setTimeout((function(){throw t._timeout(),s.InvalidResponse(e)}),15e3))}clearTimeout(t.lastChunkTimeout),t.lastChunk=null,n&&r.push(n)})),r},o.prototype._addResponseCallback=function(e,t){var r=e.id||e[0].id,n=e.method||e[0].method;this.responseCallbacks[r]=t,this.responseCallbacks[r].method=n},o.prototype._timeout=function(){for(var e in this.responseCallbacks)this.responseCallbacks.hasOwnProperty(e)&&(this.responseCallbacks[e](s.InvalidConnection("on IPC")),delete this.responseCallbacks[e])},o.prototype.isConnected=function(){var e=this;return e.connection.writable||e.connection.connect({path:e.path}),!!this.connection.writable},o.prototype.send=function(e){if(this.connection.writeSync){var t;this.connection.writable||this.connection.connect({path:this.path});var r=this.connection.writeSync(JSON.stringify(e));try{t=JSON.parse(r)}catch(e){throw s.InvalidResponse(r)}return t}throw new Error('You tried to send "'+e.method+'" synchronously. Synchronous requests are not supported by the IPC provider.')},o.prototype.sendAsync=function(e,t){this.connection.writable||this.connection.connect({path:this.path}),this.connection.write(JSON.stringify(e)),this._addResponseCallback(e,t)},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5358,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n={messageId:0,toPayload:function(e,t){return e||console.error("jsonrpc method should be specified!"),n.messageId++,{jsonrpc:"2.0",id:n.messageId,method:e,params:t||[]}},isValidResponse:function(e){return Array.isArray(e)?e.every(t):t(e);function t(e){return!!e&&!e.error&&"2.0"===e.jsonrpc&&"number"==typeof e.id&&e.result!==undefined}},toBatchPayload:function(e){return e.map((function(e){return n.toPayload(e.method,e.params)}))}};t.exports=n}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5359,{"../utils/utils":5343,"./errors":5349},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=e("./errors"),o=function(e){this.name=e.name,this.call=e.call,this.params=e.params||0,this.inputFormatter=e.inputFormatter,this.outputFormatter=e.outputFormatter,this.requestManager=null};o.prototype.setRequestManager=function(e){this.requestManager=e},o.prototype.getCall=function(e){return n.isFunction(this.call)?this.call(e):this.call},o.prototype.extractCallback=function(e){if(n.isFunction(e[e.length-1]))return e.pop()},o.prototype.validateArgs=function(e){if(e.length!==this.params)throw s.InvalidNumberOfRPCParams()},o.prototype.formatInput=function(e){return this.inputFormatter?this.inputFormatter.map((function(t,r){return t?t(e[r]):e[r]})):e},o.prototype.formatOutput=function(e){return this.outputFormatter&&e?this.outputFormatter(e):e},o.prototype.toPayload=function(e){var t=this.getCall(e),r=this.extractCallback(e),n=this.formatInput(e);return this.validateArgs(n),{method:t,params:n,callback:r}},o.prototype.attachToObject=function(e){var t=this.buildCall();Reflect.defineProperty(t,"call",{value:this.call});var r=this.name.split(".");r.length>1?(e[r[0]]=e[r[0]]||{},e[r[0]][r[1]]=t):e[r[0]]=t},o.prototype.buildCall=function(){var e=this,t=function(){var t=e.toPayload(Array.prototype.slice.call(arguments));return t.callback?e.requestManager.sendAsync(t,(function(r,n){t.callback(r,e.formatOutput(n))})):e.formatOutput(e.requestManager.send(t))};return t.request=this.request.bind(this),t},o.prototype.request=function(){var e=this.toPayload(Array.prototype.slice.call(arguments));return e.format=this.formatOutput.bind(this),e},t.exports=o}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[536,{"./ComposedStore":532,"./MergedStore":533,"./ObservableStore":534,"./asStream":535,"./transform":537},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./asStream"),r),s(e("./ComposedStore"),r),s(e("./MergedStore"),r),s(e("./ObservableStore"),r),s(e("./transform"),r)}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5360,{"../method":5359},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../method"),s=function(){return[new n({name:"putString",call:"db_putString",params:3}),new n({name:"getString",call:"db_getString",params:2}),new n({name:"putHex",call:"db_putHex",params:3}),new n({name:"getHex",call:"db_getHex",params:2})]};t.exports=function(e){this._requestManager=e._requestManager;var t=this;s().forEach((function(r){r.attachToObject(t),r.setRequestManager(e._requestManager)}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5361,{"../../utils/config":5341,"../../utils/utils":5343,"../contract":5348,"../filter":5352,"../formatters":5353,"../iban":5356,"../method":5359,"../namereg":5367,"../property":5368,"../syncing":5371,"../transfer":5372,"./watches":5366},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../formatters"),s=e("../../utils/utils"),o=e("../method"),i=e("../property"),a=e("../../utils/config"),c=e("../contract"),l=e("./watches"),u=e("../filter"),d=e("../syncing"),h=e("../namereg"),p=e("../iban"),f=e("../transfer"),m=function(e){return s.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockByHash":"eth_getBlockByNumber"},g=function(e){return s.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getTransactionByBlockHashAndIndex":"eth_getTransactionByBlockNumberAndIndex"},y=function(e){return s.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleByBlockHashAndIndex":"eth_getUncleByBlockNumberAndIndex"},b=function(e){return s.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getBlockTransactionCountByHash":"eth_getBlockTransactionCountByNumber"},v=function(e){return s.isString(e[0])&&0===e[0].indexOf("0x")?"eth_getUncleCountByBlockHash":"eth_getUncleCountByBlockNumber"};function w(e){this._requestManager=e._requestManager;var t=this;k().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)})),_().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)})),this.iban=p,this.sendIBANTransaction=f.bind(null,this)}Object.defineProperty(w.prototype,"defaultBlock",{get:function(){return a.defaultBlock},set:function(e){return a.defaultBlock=e,e}}),Object.defineProperty(w.prototype,"defaultAccount",{get:function(){return a.defaultAccount},set:function(e){return a.defaultAccount=e,e}});var k=function(){var e=new o({name:"getBalance",call:"eth_getBalance",params:2,inputFormatter:[n.inputAddressFormatter,n.inputDefaultBlockNumberFormatter],outputFormatter:n.outputBigNumberFormatter}),t=new o({name:"getStorageAt",call:"eth_getStorageAt",params:3,inputFormatter:[null,s.toHex,n.inputDefaultBlockNumberFormatter]}),r=new o({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[n.inputAddressFormatter,n.inputDefaultBlockNumberFormatter]}),i=new o({name:"getBlock",call:m,params:2,inputFormatter:[n.inputBlockNumberFormatter,function(e){return!!e}],outputFormatter:n.outputBlockFormatter}),a=new o({name:"getUncle",call:y,params:2,inputFormatter:[n.inputBlockNumberFormatter,s.toHex],outputFormatter:n.outputBlockFormatter}),c=new o({name:"getCompilers",call:"eth_getCompilers",params:0}),l=new o({name:"getBlockTransactionCount",call:b,params:1,inputFormatter:[n.inputBlockNumberFormatter],outputFormatter:s.toDecimal}),u=new o({name:"getBlockUncleCount",call:v,params:1,inputFormatter:[n.inputBlockNumberFormatter],outputFormatter:s.toDecimal}),d=new o({name:"getTransaction",call:"eth_getTransactionByHash",params:1,outputFormatter:n.outputTransactionFormatter}),h=new o({name:"getTransactionFromBlock",call:g,params:2,inputFormatter:[n.inputBlockNumberFormatter,s.toHex],outputFormatter:n.outputTransactionFormatter}),p=new o({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,outputFormatter:n.outputTransactionReceiptFormatter}),f=new o({name:"getTransactionCount",call:"eth_getTransactionCount",params:2,inputFormatter:[null,n.inputDefaultBlockNumberFormatter],outputFormatter:s.toDecimal}),w=new o({name:"sendRawTransaction",call:"eth_sendRawTransaction",params:1,inputFormatter:[null]}),k=new o({name:"sendTransaction",call:"eth_sendTransaction",params:1,inputFormatter:[n.inputTransactionFormatter]}),_=new o({name:"signTransaction",call:"eth_signTransaction",params:1,inputFormatter:[n.inputTransactionFormatter]}),C=new o({name:"sign",call:"eth_sign",params:2,inputFormatter:[n.inputAddressFormatter,null]});return[e,t,r,i,a,c,l,u,d,h,p,f,new o({name:"call",call:"eth_call",params:2,inputFormatter:[n.inputCallFormatter,n.inputDefaultBlockNumberFormatter]}),new o({name:"estimateGas",call:"eth_estimateGas",params:1,inputFormatter:[n.inputCallFormatter],outputFormatter:s.toDecimal}),w,_,k,C,new o({name:"compile.solidity",call:"eth_compileSolidity",params:1}),new o({name:"compile.lll",call:"eth_compileLLL",params:1}),new o({name:"compile.serpent",call:"eth_compileSerpent",params:1}),new o({name:"submitWork",call:"eth_submitWork",params:3}),new o({name:"getWork",call:"eth_getWork",params:0})]},_=function(){return[new i({name:"coinbase",getter:"eth_coinbase"}),new i({name:"mining",getter:"eth_mining"}),new i({name:"hashrate",getter:"eth_hashrate",outputFormatter:s.toDecimal}),new i({name:"syncing",getter:"eth_syncing",outputFormatter:n.outputSyncingFormatter}),new i({name:"gasPrice",getter:"eth_gasPrice",outputFormatter:n.outputBigNumberFormatter}),new i({name:"accounts",getter:"eth_accounts"}),new i({name:"blockNumber",getter:"eth_blockNumber",outputFormatter:s.toDecimal}),new i({name:"protocolVersion",getter:"eth_protocolVersion"})]};w.prototype.contract=function(e){return new c(this,e)},w.prototype.filter=function(e,t,r){return new u(e,"eth",this._requestManager,l.eth(),n.outputLogFormatter,t,r)},w.prototype.namereg=function(){return this.contract(h.global.abi).at(h.global.address)},w.prototype.icapNamereg=function(){return this.contract(h.icap.abi).at(h.icap.address)},w.prototype.isSyncing=function(e){return new d(this._requestManager,e)},t.exports=w}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5362,{"../../utils/utils":5343,"../property":5368},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../utils/utils"),s=e("../property"),o=function(){return[new s({name:"listening",getter:"net_listening"}),new s({name:"peerCount",getter:"net_peerCount",outputFormatter:n.toDecimal})]};t.exports=function(e){this._requestManager=e._requestManager;var t=this;o().forEach((function(r){r.attachToObject(t),r.setRequestManager(e._requestManager)}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5363,{"../formatters":5353,"../method":5359,"../property":5368},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../method"),s=e("../property"),o=e("../formatters");var i=function(){var e=new n({name:"newAccount",call:"personal_newAccount",params:1,inputFormatter:[null]}),t=new n({name:"importRawKey",call:"personal_importRawKey",params:2}),r=new n({name:"sign",call:"personal_sign",params:3,inputFormatter:[null,o.inputAddressFormatter,null]}),s=new n({name:"ecRecover",call:"personal_ecRecover",params:2});return[e,t,new n({name:"unlockAccount",call:"personal_unlockAccount",params:3,inputFormatter:[o.inputAddressFormatter,null,null]}),s,r,new n({name:"sendTransaction",call:"personal_sendTransaction",params:2,inputFormatter:[o.inputTransactionFormatter,null]}),new n({name:"lockAccount",call:"personal_lockAccount",params:1,inputFormatter:[o.inputAddressFormatter]})]},a=function(){return[new s({name:"listAccounts",getter:"personal_listAccounts"})]};t.exports=function(e){this._requestManager=e._requestManager;var t=this;i().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)})),a().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5364,{"../filter":5352,"../method":5359,"./watches":5366},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../method"),s=e("../filter"),o=e("./watches"),i=function(e){this._requestManager=e._requestManager;var t=this;a().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)}))};i.prototype.newMessageFilter=function(e,t,r){return new s(e,"shh",this._requestManager,o.shh(),null,t,r)};var a=function(){return[new n({name:"version",call:"shh_version",params:0}),new n({name:"info",call:"shh_info",params:0}),new n({name:"setMaxMessageSize",call:"shh_setMaxMessageSize",params:1}),new n({name:"setMinPoW",call:"shh_setMinPoW",params:1}),new n({name:"markTrustedPeer",call:"shh_markTrustedPeer",params:1}),new n({name:"newKeyPair",call:"shh_newKeyPair",params:0}),new n({name:"addPrivateKey",call:"shh_addPrivateKey",params:1}),new n({name:"deleteKeyPair",call:"shh_deleteKeyPair",params:1}),new n({name:"hasKeyPair",call:"shh_hasKeyPair",params:1}),new n({name:"getPublicKey",call:"shh_getPublicKey",params:1}),new n({name:"getPrivateKey",call:"shh_getPrivateKey",params:1}),new n({name:"newSymKey",call:"shh_newSymKey",params:0}),new n({name:"addSymKey",call:"shh_addSymKey",params:1}),new n({name:"generateSymKeyFromPassword",call:"shh_generateSymKeyFromPassword",params:1}),new n({name:"hasSymKey",call:"shh_hasSymKey",params:1}),new n({name:"getSymKey",call:"shh_getSymKey",params:1}),new n({name:"deleteSymKey",call:"shh_deleteSymKey",params:1}),new n({name:"post",call:"shh_post",params:1,inputFormatter:[null]})]};t.exports=i}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5365,{"../method":5359,"../property":5368},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../method"),s=e("../property");var o=function(){return[new n({name:"blockNetworkRead",call:"bzz_blockNetworkRead",params:1,inputFormatter:[null]}),new n({name:"syncEnabled",call:"bzz_syncEnabled",params:1,inputFormatter:[null]}),new n({name:"swapEnabled",call:"bzz_swapEnabled",params:1,inputFormatter:[null]}),new n({name:"download",call:"bzz_download",params:2,inputFormatter:[null,null]}),new n({name:"upload",call:"bzz_upload",params:2,inputFormatter:[null,null]}),new n({name:"retrieve",call:"bzz_retrieve",params:1,inputFormatter:[null]}),new n({name:"store",call:"bzz_store",params:2,inputFormatter:[null,null]}),new n({name:"get",call:"bzz_get",params:1,inputFormatter:[null]}),new n({name:"put",call:"bzz_put",params:2,inputFormatter:[null,null]}),new n({name:"modify",call:"bzz_modify",params:4,inputFormatter:[null,null,null,null]})]},i=function(){return[new s({name:"hive",getter:"bzz_hive"}),new s({name:"info",getter:"bzz_info"})]};t.exports=function(e){this._requestManager=e._requestManager;var t=this;o().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)})),i().forEach((function(e){e.attachToObject(t),e.setRequestManager(t._requestManager)}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5366,{"../method":5359},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../method");t.exports={eth:function(){return[new n({name:"newFilter",call:function(e){switch(e[0]){case"latest":return e.shift(),this.params=0,"eth_newBlockFilter";case"pending":return e.shift(),this.params=0,"eth_newPendingTransactionFilter";default:return"eth_newFilter"}},params:1}),new n({name:"uninstallFilter",call:"eth_uninstallFilter",params:1}),new n({name:"getLogs",call:"eth_getFilterLogs",params:1}),new n({name:"poll",call:"eth_getFilterChanges",params:1})]},shh:function(){return[new n({name:"newFilter",call:"shh_newMessageFilter",params:1}),new n({name:"uninstallFilter",call:"shh_deleteMessageFilter",params:1}),new n({name:"getLogs",call:"shh_getFilterMessages",params:1}),new n({name:"poll",call:"shh_getFilterMessages",params:1})]}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5367,{"../contracts/GlobalRegistrar.json":5324,"../contracts/ICAPRegistrar.json":5325},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../contracts/GlobalRegistrar.json"),s=e("../contracts/ICAPRegistrar.json");t.exports={global:{abi:n,address:"0xc6d9d2cd449a754c494264e1809c50e34d64562b"},icap:{abi:s,address:"0xa1a111bc074c9cfa781f0c38e63bd51c91b8af00"}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5368,{"../utils/utils":5343},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils/utils"),s=function(e){this.name=e.name,this.getter=e.getter,this.setter=e.setter,this.outputFormatter=e.outputFormatter,this.inputFormatter=e.inputFormatter,this.requestManager=null};s.prototype.setRequestManager=function(e){this.requestManager=e},s.prototype.formatInput=function(e){return this.inputFormatter?this.inputFormatter(e):e},s.prototype.formatOutput=function(e){return this.outputFormatter&&null!==e&&e!==undefined?this.outputFormatter(e):e},s.prototype.extractCallback=function(e){if(n.isFunction(e[e.length-1]))return e.pop()},s.prototype.attachToObject=function(e){var t={get:this.buildGet(),enumerable:!0},r=this.name.split("."),n=r[0];r.length>1&&(e[r[0]]=e[r[0]]||{},e=e[r[0]],n=r[1]),Object.defineProperty(e,n,t),e[o(n)]=this.buildAsyncGet()};var o=function(e){return"get"+e.charAt(0).toUpperCase()+e.slice(1)};s.prototype.buildGet=function(){var e=this;return function(){return e.formatOutput(e.requestManager.send({method:e.getter}))}},s.prototype.buildAsyncGet=function(){var e=this,t=function(t){e.requestManager.sendAsync({method:e.getter},(function(r,n){t(r,e.formatOutput(n))}))};return t.request=this.request.bind(this),t},s.prototype.request=function(){var e={method:this.getter,params:[],callback:this.extractCallback(Array.prototype.slice.call(arguments))};return e.format=this.formatOutput.bind(this),e},t.exports=s}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5369,{"../utils/config":5341,"../utils/utils":5343,"./errors":5349,"./jsonrpc":5358},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./jsonrpc"),s=e("../utils/utils"),o=e("../utils/config"),i=e("./errors"),a=function(e){this.provider=e,this.polls={},this.timeout=null};a.prototype.send=function(e){if(!this.provider)return console.error(i.InvalidProvider()),null;var t=n.toPayload(e.method,e.params),r=this.provider.send(t);if(!n.isValidResponse(r))throw i.InvalidResponse(r);return r.result},a.prototype.sendAsync=function(e,t){if(!this.provider)return t(i.InvalidProvider());var r=n.toPayload(e.method,e.params);this.provider.sendAsync(r,(function(e,r){return e?t(e):n.isValidResponse(r)?void t(null,r.result):t(i.InvalidResponse(r))}))},a.prototype.sendBatch=function(e,t){if(!this.provider)return t(i.InvalidProvider());var r=n.toBatchPayload(e);this.provider.sendAsync(r,(function(e,r){return e?t(e):s.isArray(r)?void t(e,r):t(i.InvalidResponse(r))}))},a.prototype.setProvider=function(e){this.provider=e},a.prototype.startPolling=function(e,t,r,n){this.polls[t]={data:e,id:t,callback:r,uninstall:n},this.timeout||this.poll()},a.prototype.stopPolling=function(e){delete this.polls[e],0===Object.keys(this.polls).length&&this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},a.prototype.reset=function(e){for(var t in this.polls)e&&-1!==t.indexOf("syncPoll_")||(this.polls[t].uninstall(),delete this.polls[t]);0===Object.keys(this.polls).length&&this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},a.prototype.poll=function(){if(this.timeout=setTimeout(this.poll.bind(this),o.ETH_POLLING_TIMEOUT),0!==Object.keys(this.polls).length)if(this.provider){var e=[],t=[];for(var r in this.polls)e.push(this.polls[r].data),t.push(r);if(0!==e.length){var a=n.toBatchPayload(e),c={};a.forEach((function(e,r){c[e.id]=t[r]}));var l=this;this.provider.sendAsync(a,(function(e,t){if(!e){if(!s.isArray(t))throw i.InvalidResponse(t);t.map((function(e){var t=c[e.id];return!!l.polls[t]&&(e.callback=l.polls[t].callback,e)})).filter((function(e){return!!e})).filter((function(e){var t=n.isValidResponse(e);return t||e.callback(i.InvalidResponse(e)),t})).forEach((function(e){e.callback(null,e.result)}))}}))}}else console.error(i.InvalidProvider())},t.exports=a}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[537,{through2:538},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const n=e("through2");r.storeTransformStream=function(e){return n.obj(((t,r,n)=>{try{return n(null,e(t)),undefined}catch(e){return n(e),undefined}}))}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5370,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){this.defaultBlock="latest",this.defaultAccount=undefined}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5371,{"../utils/utils":5343,"./formatters":5353},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./formatters"),s=e("../utils/utils"),o=1,i=function(e,t){return this.requestManager=e,this.pollId="syncPoll_"+o++,this.callbacks=[],this.addCallback(t),this.lastSyncState=!1,function(e){e.requestManager.startPolling({method:"eth_syncing",params:[]},e.pollId,(function(t,r){if(t)return e.callbacks.forEach((function(e){e(t)}));s.isObject(r)&&r.startingBlock&&(r=n.outputSyncingFormatter(r)),e.callbacks.forEach((function(t){e.lastSyncState!==r&&(!e.lastSyncState&&s.isObject(r)&&t(null,!0),setTimeout((function(){t(null,r)}),0),e.lastSyncState=r)}))}),e.stopWatching.bind(e))}(this),this};i.prototype.addCallback=function(e){return e&&this.callbacks.push(e),this},i.prototype.stopWatching=function(){this.requestManager.stopPolling(this.pollId),this.callbacks=[]},t.exports=i}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5372,{"../contracts/SmartExchange.json":5326,"./iban":5356},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./iban"),s=e("../contracts/SmartExchange.json"),o=function(e,t,r,n,s){return e.sendTransaction({address:r,from:t,value:n},s)},i=function(e,t,r,n,o,i){var a=s;return e.contract(a).at(r).deposit(o,{from:t,value:n},i)};t.exports=function(e,t,r,s,a){var c=new n(r);if(!c.isValid())throw new Error("invalid iban address");if(c.isDirect())return o(e,t,c.address(),s,a);if(!a){var l=e.icapNamereg().addr(c.institution());return i(e,t,l,s,c.client())}e.icapNamereg().addr(c.institution(),(function(r,n){return i(e,t,n,s,c.client(),a)}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3"}],[5373,{crypto:1906},function(){with(this)return function(){"use strict";return function(e,t,r){!function(r){var n,s,o,i=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,a=Math.ceil,c=Math.floor,l=" not a boolean or binary digit",u="rounding mode",d="number type has more than 15 significant digits",h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",p=1e14,f=14,m=9007199254740991,g=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],y=1e7,b=1e9;function v(e){var t=0|e;return e>0||e===t?t:t-1}function w(e){for(var t,r,n=1,s=e.length,o=e[0]+"";n<s;){for(t=e[n++]+"",r=f-t.length;r--;t="0"+t);o+=t}for(s=o.length;48===o.charCodeAt(--s););return o.slice(0,s+1||1)}function k(e,t){var r,n,s=e.c,o=t.c,i=e.s,a=t.s,c=e.e,l=t.e;if(!i||!a)return null;if(r=s&&!s[0],n=o&&!o[0],r||n)return r?n?0:-a:i;if(i!=a)return i;if(r=i<0,n=c==l,!s||!o)return n?0:!s^r?1:-1;if(!n)return c>l^r?1:-1;for(a=(c=s.length)<(l=o.length)?c:l,i=0;i<a;i++)if(s[i]!=o[i])return s[i]>o[i]^r?1:-1;return c==l?0:c>l^r?1:-1}function _(e,t,r){return(e=A(e))>=t&&e<=r}function C(e){return"[object Array]"==Object.prototype.toString.call(e)}function E(e,t,r){for(var n,s,o=[0],i=0,a=e.length;i<a;){for(s=o.length;s--;o[s]*=t);for(o[n=0]+=h.indexOf(e.charAt(i++));n<o.length;n++)o[n]>r-1&&(null==o[n+1]&&(o[n+1]=0),o[n+1]+=o[n]/r|0,o[n]%=r)}return o.reverse()}function S(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function M(e,t){var r,n;if(t<0){for(n="0.";++t;n+="0");e=n+e}else if(++t>(r=e.length)){for(n="0",t-=r;--t;n+="0");e+=n}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}function A(e){return(e=parseFloat(e))<0?a(e):c(e)}if(n=function e(t){var r,n,T,P,R,x,N,O,I=0,j=Y.prototype,L=new Y(1),U=20,B=4,D=-7,F=21,q=-1e7,H=1e7,K=!0,$=Q,G=!1,V=1,z=100,W={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:"",fractionGroupSize:0};function Y(e,t){var r,n,s,a,c,l,u=this;if(!(u instanceof Y))return K&&te(26,"constructor call without new",e),new Y(e,t);if(null!=t&&$(t,2,64,I,"base")){if(l=e+"",10==(t|=0))return re(u=new Y(e instanceof Y?e:l),U+u.e+1,B);if((a="number"==typeof e)&&0*e!=0||!new RegExp("^-?"+(r="["+h.slice(0,t)+"]+")+"(?:\\."+r+")?$",t<37?"i":"").test(l))return o(u,l,a,t);a?(u.s=1/e<0?(l=l.slice(1),-1):1,K&&l.replace(/^0\.0*|\./,"").length>15&&te(I,d,e),a=!1):u.s=45===l.charCodeAt(0)?(l=l.slice(1),-1):1,l=J(l,10,t,u.s)}else{if(e instanceof Y)return u.s=e.s,u.e=e.e,u.c=(e=e.c)?e.slice():e,void(I=0);if((a="number"==typeof e)&&0*e==0){if(u.s=1/e<0?(e=-e,-1):1,e===~~e){for(n=0,s=e;s>=10;s/=10,n++);return u.e=n,u.c=[e],void(I=0)}l=e+""}else{if(!i.test(l=e+""))return o(u,l,a);u.s=45===l.charCodeAt(0)?(l=l.slice(1),-1):1}}for((n=l.indexOf("."))>-1&&(l=l.replace(".","")),(s=l.search(/e/i))>0?(n<0&&(n=s),n+=+l.slice(s+1),l=l.substring(0,s)):n<0&&(n=l.length),s=0;48===l.charCodeAt(s);s++);for(c=l.length;48===l.charCodeAt(--c););if(l=l.slice(s,c+1))if(c=l.length,a&&K&&c>15&&te(I,d,u.s*e),(n=n-s-1)>H)u.c=u.e=null;else if(n<q)u.c=[u.e=0];else{if(u.e=n,u.c=[],s=(n+1)%f,n<0&&(s+=f),s<c){for(s&&u.c.push(+l.slice(0,s)),c-=f;s<c;)u.c.push(+l.slice(s,s+=f));l=l.slice(s),s=f-l.length}else s-=c;for(;s--;l+="0");u.c.push(+l)}else u.c=[u.e=0];I=0}function J(e,t,n,s){var o,i,a,c,l,u,d,p=e.indexOf("."),f=U,m=B;for(n<37&&(e=e.toLowerCase()),p>=0&&(a=z,z=0,e=e.replace(".",""),l=(d=new Y(n)).pow(e.length-p),z=a,d.c=E(M(w(l.c),l.e),10,t),d.e=d.c.length),i=a=(u=E(e,n,t)).length;0==u[--a];u.pop());if(!u[0])return"0";if(p<0?--i:(l.c=u,l.e=i,l.s=s,u=(l=r(l,d,f,m,t)).c,c=l.r,i=l.e),p=u[o=i+f+1],a=t/2,c=c||o<0||null!=u[o+1],c=m<4?(null!=p||c)&&(0==m||m==(l.s<0?3:2)):p>a||p==a&&(4==m||c||6==m&&1&u[o-1]||m==(l.s<0?8:7)),o<1||!u[0])e=c?M("1",-f):"0";else{if(u.length=o,c)for(--t;++u[--o]>t;)u[o]=0,o||(++i,u.unshift(1));for(a=u.length;!u[--a];);for(p=0,e="";p<=a;e+=h.charAt(u[p++]));e=M(e,i)}return e}function X(e,t,r,n){var s,o,i,a,c;if(r=null!=r&&$(r,0,8,n,u)?0|r:B,!e.c)return e.toString();if(s=e.c[0],i=e.e,null==t)c=w(e.c),c=19==n||24==n&&i<=D?S(c,i):M(c,i);else if(o=(e=re(new Y(e),t,r)).e,a=(c=w(e.c)).length,19==n||24==n&&(t<=o||o<=D)){for(;a<t;c+="0",a++);c=S(c,o)}else if(t-=i,c=M(c,o),o+1>a){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=o-a)>0)for(o+1==a&&(c+=".");t--;c+="0");return e.s<0&&s?"-"+c:c}function Z(e,t){var r,n,s=0;for(C(e[0])&&(e=e[0]),r=new Y(e[0]);++s<e.length;){if(!(n=new Y(e[s])).s){r=n;break}t.call(r,n)&&(r=n)}return r}function Q(e,t,r,n,s){return(e<t||e>r||e!=A(e))&&te(n,(s||"decimal places")+(e<t||e>r?" out of range":" not an integer"),e),!0}function ee(e,t,r){for(var n=1,s=t.length;!t[--s];t.pop());for(s=t[0];s>=10;s/=10,n++);return(r=n+r*f-1)>H?e.c=e.e=null:r<q?e.c=[e.e=0]:(e.e=r,e.c=t),e}function te(e,t,r){var n=new Error(["new BigNumber","cmp","config","div","divToInt","eq","gt","gte","lt","lte","minus","mod","plus","precision","random","round","shift","times","toDigits","toExponential","toFixed","toFormat","toFraction","pow","toPrecision","toString","BigNumber"][e]+"() "+t+": "+r);throw n.name="BigNumber Error",I=0,n}function re(e,t,r,n){var s,o,i,l,u,d,h,m=e.c,y=g;if(m){e:{for(s=1,l=m[0];l>=10;l/=10,s++);if((o=t-s)<0)o+=f,i=t,h=(u=m[d=0])/y[s-i-1]%10|0;else if((d=a((o+1)/f))>=m.length){if(!n)break e;for(;m.length<=d;m.push(0));u=h=0,s=1,i=(o%=f)-f+1}else{for(u=l=m[d],s=1;l>=10;l/=10,s++);h=(i=(o%=f)-f+s)<0?0:u/y[s-i-1]%10|0}if(n=n||t<0||null!=m[d+1]||(i<0?u:u%y[s-i-1]),n=r<4?(h||n)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||n||6==r&&(o>0?i>0?u/y[s-i]:0:m[d-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=y[t%f],e.e=-t||0):m[0]=e.e=0,e;if(0==o?(m.length=d,l=1,d--):(m.length=d+1,l=y[f-o],m[d]=i>0?c(u/y[s-i]%y[i])*l:0),n)for(;;){if(0==d){for(o=1,i=m[0];i>=10;i/=10,o++);for(i=m[0]+=l,l=1;i>=10;i/=10,l++);o!=l&&(e.e++,m[0]==p&&(m[0]=1));break}if(m[d]+=l,m[d]!=p)break;m[d--]=0,l=1}for(o=m.length;0===m[--o];m.pop());}e.e>H?e.c=e.e=null:e.e<q&&(e.c=[e.e=0])}return e}return Y.another=e,Y.ROUND_UP=0,Y.ROUND_DOWN=1,Y.ROUND_CEIL=2,Y.ROUND_FLOOR=3,Y.ROUND_HALF_UP=4,Y.ROUND_HALF_DOWN=5,Y.ROUND_HALF_EVEN=6,Y.ROUND_HALF_CEIL=7,Y.ROUND_HALF_FLOOR=8,Y.EUCLID=9,Y.config=function(){var e,t,r=0,n={},o=arguments,i=o[0],a=i&&"object"==typeof i?function(){if(i.hasOwnProperty(t))return null!=(e=i[t])}:function(){if(o.length>r)return null!=(e=o[r++])};return a(t="DECIMAL_PLACES")&&$(e,0,b,2,t)&&(U=0|e),n[t]=U,a(t="ROUNDING_MODE")&&$(e,0,8,2,t)&&(B=0|e),n[t]=B,a(t="EXPONENTIAL_AT")&&(C(e)?$(e[0],-b,0,2,t)&&$(e[1],0,b,2,t)&&(D=0|e[0],F=0|e[1]):$(e,-b,b,2,t)&&(D=-(F=0|(e<0?-e:e)))),n[t]=[D,F],a(t="RANGE")&&(C(e)?$(e[0],-b,-1,2,t)&&$(e[1],1,b,2,t)&&(q=0|e[0],H=0|e[1]):$(e,-b,b,2,t)&&(0|e?q=-(H=0|(e<0?-e:e)):K&&te(2,t+" cannot be zero",e))),n[t]=[q,H],a(t="ERRORS")&&(e===!!e||1===e||0===e?(I=0,$=(K=!!e)?Q:_):K&&te(2,t+l,e)),n[t]=K,a(t="CRYPTO")&&(e===!!e||1===e||0===e?(G=!(!e||!s||"object"!=typeof s),e&&!G&&K&&te(2,"crypto unavailable",s)):K&&te(2,t+l,e)),n[t]=G,a(t="MODULO_MODE")&&$(e,0,9,2,t)&&(V=0|e),n[t]=V,a(t="POW_PRECISION")&&$(e,0,b,2,t)&&(z=0|e),n[t]=z,a(t="FORMAT")&&("object"==typeof e?W=e:K&&te(2,t+" not an object",e)),n[t]=W,n},Y.max=function(){return Z(arguments,j.lt)},Y.min=function(){return Z(arguments,j.gt)},Y.random=(n=9007199254740992,T=Math.random()*n&2097151?function(){return c(Math.random()*n)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,o,i,l=0,u=[],d=new Y(L);if(e=null!=e&&$(e,0,b,14)?0|e:U,o=a(e/f),G)if(s&&s.getRandomValues){for(t=s.getRandomValues(new Uint32Array(o*=2));l<o;)(i=131072*t[l]+(t[l+1]>>>11))>=9e15?(r=s.getRandomValues(new Uint32Array(2)),t[l]=r[0],t[l+1]=r[1]):(u.push(i%1e14),l+=2);l=o/2}else if(s&&s.randomBytes){for(t=s.randomBytes(o*=7);l<o;)(i=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?s.randomBytes(7).copy(t,l):(u.push(i%1e14),l+=7);l=o/7}else K&&te(14,"crypto unavailable",s);if(!l)for(;l<o;)(i=T())<9e15&&(u[l++]=i%1e14);for(o=u[--l],e%=f,o&&e&&(i=g[f-e],u[l]=c(o/i)*i);0===u[l];u.pop(),l--);if(l<0)u=[n=0];else{for(n=-1;0===u[0];u.shift(),n-=f);for(l=1,i=u[0];i>=10;i/=10,l++);l<f&&(n-=f-l)}return d.e=n,d.c=u,d}),r=function(){function e(e,t,r){var n,s,o,i,a=0,c=e.length,l=t%y,u=t/y|0;for(e=e.slice();c--;)a=((s=l*(o=e[c]%y)+(n=u*o+(i=e[c]/y|0)*l)%y*y+a)/r|0)+(n/y|0)+u*i,e[c]=s%r;return a&&e.unshift(a),e}function t(e,t,r,n){var s,o;if(r!=n)o=r>n?1:-1;else for(s=o=0;s<r;s++)if(e[s]!=t[s]){o=e[s]>t[s]?1:-1;break}return o}function r(e,t,r,n){for(var s=0;r--;)e[r]-=s,s=e[r]<t[r]?1:0,e[r]=s*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.shift());}return function(n,s,o,i,a){var l,u,d,h,m,g,y,b,w,k,_,C,E,S,M,A,T,P=n.s==s.s?1:-1,R=n.c,x=s.c;if(!(R&&R[0]&&x&&x[0]))return new Y(n.s&&s.s&&(R?!x||R[0]!=x[0]:x)?R&&0==R[0]||!x?0*P:P/0:NaN);for(w=(b=new Y(P)).c=[],P=o+(u=n.e-s.e)+1,a||(a=p,u=v(n.e/f)-v(s.e/f),P=P/f|0),d=0;x[d]==(R[d]||0);d++);if(x[d]>(R[d]||0)&&u--,P<0)w.push(1),h=!0;else{for(S=R.length,A=x.length,d=0,P+=2,(m=c(a/(x[0]+1)))>1&&(x=e(x,m,a),R=e(R,m,a),A=x.length,S=R.length),E=A,_=(k=R.slice(0,A)).length;_<A;k[_++]=0);(T=x.slice()).unshift(0),M=x[0],x[1]>=a/2&&M++;do{if(m=0,(l=t(x,k,A,_))<0){if(C=k[0],A!=_&&(C=C*a+(k[1]||0)),(m=c(C/M))>1)for(m>=a&&(m=a-1),y=(g=e(x,m,a)).length,_=k.length;1==t(g,k,y,_);)m--,r(g,A<y?T:x,y,a),y=g.length,l=1;else 0==m&&(l=m=1),y=(g=x.slice()).length;if(y<_&&g.unshift(0),r(k,g,_,a),_=k.length,-1==l)for(;t(x,k,A,_)<1;)m++,r(k,A<_?T:x,_,a),_=k.length}else 0===l&&(m++,k=[0]);w[d++]=m,k[0]?k[_++]=R[E]||0:(k=[R[E]],_=1)}while((E++<S||null!=k[0])&&P--);h=null!=k[0],w[0]||w.shift()}if(a==p){for(d=1,P=w[0];P>=10;P/=10,d++);re(b,o+(b.e=d+u*f-1)+1,i,h)}else b.e=u,b.r=+h;return b}}(),P=/^(-?)0([xbo])/i,R=/^([^.]+)\.$/,x=/^\.([^.]+)$/,N=/^-?(Infinity|NaN)$/,O=/^\s*\+|^\s+|\s+$/g,o=function(e,t,r,n){var s,o=r?t:t.replace(O,"");if(N.test(o))e.s=isNaN(o)?null:o<0?-1:1;else{if(!r&&(o=o.replace(P,(function(e,t,r){return s="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=s?e:t})),n&&(s=n,o=o.replace(R,"$1").replace(x,"0.$1")),t!=o))return new Y(o,s);K&&te(I,"not a"+(n?" base "+n:"")+" number",t),e.s=null}e.c=e.e=null,I=0},j.absoluteValue=j.abs=function(){var e=new Y(this);return e.s<0&&(e.s=1),e},j.ceil=function(){return re(new Y(this),this.e+1,2)},j.comparedTo=j.cmp=function(e,t){return I=1,k(this,new Y(e,t))},j.decimalPlaces=j.dp=function(){var e,t,r=this.c;if(!r)return null;if(e=((t=r.length-1)-v(this.e/f))*f,t=r[t])for(;t%10==0;t/=10,e--);return e<0&&(e=0),e},j.dividedBy=j.div=function(e,t){return I=3,r(this,new Y(e,t),U,B)},j.dividedToIntegerBy=j.divToInt=function(e,t){return I=4,r(this,new Y(e,t),0,1)},j.equals=j.eq=function(e,t){return I=5,0===k(this,new Y(e,t))},j.floor=function(){return re(new Y(this),this.e+1,3)},j.greaterThan=j.gt=function(e,t){return I=6,k(this,new Y(e,t))>0},j.greaterThanOrEqualTo=j.gte=function(e,t){return I=7,1===(t=k(this,new Y(e,t)))||0===t},j.isFinite=function(){return!!this.c},j.isInteger=j.isInt=function(){return!!this.c&&v(this.e/f)>this.c.length-2},j.isNaN=function(){return!this.s},j.isNegative=j.isNeg=function(){return this.s<0},j.isZero=function(){return!!this.c&&0==this.c[0]},j.lessThan=j.lt=function(e,t){return I=8,k(this,new Y(e,t))<0},j.lessThanOrEqualTo=j.lte=function(e,t){return I=9,-1===(t=k(this,new Y(e,t)))||0===t},j.minus=j.sub=function(e,t){var r,n,s,o,i=this,a=i.s;if(I=10,t=(e=new Y(e,t)).s,!a||!t)return new Y(NaN);if(a!=t)return e.s=-t,i.plus(e);var c=i.e/f,l=e.e/f,u=i.c,d=e.c;if(!c||!l){if(!u||!d)return u?(e.s=-t,e):new Y(d?i:NaN);if(!u[0]||!d[0])return d[0]?(e.s=-t,e):new Y(u[0]?i:3==B?-0:0)}if(c=v(c),l=v(l),u=u.slice(),a=c-l){for((o=a<0)?(a=-a,s=u):(l=c,s=d),s.reverse(),t=a;t--;s.push(0));s.reverse()}else for(n=(o=(a=u.length)<(t=d.length))?a:t,a=t=0;t<n;t++)if(u[t]!=d[t]){o=u[t]<d[t];break}if(o&&(s=u,u=d,d=s,e.s=-e.s),(t=(n=d.length)-(r=u.length))>0)for(;t--;u[r++]=0);for(t=p-1;n>a;){if(u[--n]<d[n]){for(r=n;r&&!u[--r];u[r]=t);--u[r],u[n]+=p}u[n]-=d[n]}for(;0==u[0];u.shift(),--l);return u[0]?ee(e,u,l):(e.s=3==B?-1:1,e.c=[e.e=0],e)},j.modulo=j.mod=function(e,t){var n,s,o=this;return I=11,e=new Y(e,t),!o.c||!e.s||e.c&&!e.c[0]?new Y(NaN):!e.c||o.c&&!o.c[0]?new Y(o):(9==V?(s=e.s,e.s=1,n=r(o,e,0,3),e.s=s,n.s*=s):n=r(o,e,0,V),o.minus(n.times(e)))},j.negated=j.neg=function(){var e=new Y(this);return e.s=-e.s||null,e},j.plus=j.add=function(e,t){var r,n=this,s=n.s;if(I=12,t=(e=new Y(e,t)).s,!s||!t)return new Y(NaN);if(s!=t)return e.s=-t,n.minus(e);var o=n.e/f,i=e.e/f,a=n.c,c=e.c;if(!o||!i){if(!a||!c)return new Y(s/0);if(!a[0]||!c[0])return c[0]?e:new Y(a[0]?n:0*s)}if(o=v(o),i=v(i),a=a.slice(),s=o-i){for(s>0?(i=o,r=c):(s=-s,r=a),r.reverse();s--;r.push(0));r.reverse()}for((s=a.length)-(t=c.length)<0&&(r=c,c=a,a=r,t=s),s=0;t;)s=(a[--t]=a[t]+c[t]+s)/p|0,a[t]%=p;return s&&(a.unshift(s),++i),ee(e,a,i)},j.precision=j.sd=function(e){var t,r,n=this,s=n.c;if(null!=e&&e!==!!e&&1!==e&&0!==e&&(K&&te(13,"argument"+l,e),e!=!!e&&(e=null)),!s)return null;if(t=(r=s.length-1)*f+1,r=s[r]){for(;r%10==0;r/=10,t--);for(r=s[0];r>=10;r/=10,t++);}return e&&n.e+1>t&&(t=n.e+1),t},j.round=function(e,t){var r=new Y(this);return(null==e||$(e,0,b,15))&&re(r,~~e+this.e+1,null!=t&&$(t,0,8,15,u)?0|t:B),r},j.shift=function(e){var t=this;return $(e,-9007199254740991,m,16,"argument")?t.times("1e"+A(e)):new Y(t.c&&t.c[0]&&(e<-9007199254740991||e>m)?t.s*(e<0?0:1/0):t)},j.squareRoot=j.sqrt=function(){var e,t,n,s,o,i=this,a=i.c,c=i.s,l=i.e,u=U+4,d=new Y("0.5");if(1!==c||!a||!a[0])return new Y(!c||c<0&&(!a||a[0])?NaN:a?i:1/0);if(0==(c=Math.sqrt(+i))||c==1/0?(((t=w(a)).length+l)%2==0&&(t+="0"),c=Math.sqrt(t),l=v((l+1)/2)-(l<0||l%2),n=new Y(t=c==1/0?"1e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):n=new Y(c+""),n.c[0])for((c=(l=n.e)+u)<3&&(c=0);;)if(o=n,n=d.times(o.plus(r(i,o,u,1))),w(o.c).slice(0,c)===(t=w(n.c)).slice(0,c)){if(n.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(s||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(re(n,n.e+U+2,1),e=!n.times(n).eq(i));break}if(!s&&(re(o,o.e+U+2,0),o.times(o).eq(i))){n=o;break}u+=4,c+=4,s=1}return re(n,n.e+U+1,B,e)},j.times=j.mul=function(e,t){var r,n,s,o,i,a,c,l,u,d,h,m,g,b,w,k=this,_=k.c,C=(I=17,e=new Y(e,t)).c;if(!(_&&C&&_[0]&&C[0]))return!k.s||!e.s||_&&!_[0]&&!C||C&&!C[0]&&!_?e.c=e.e=e.s=null:(e.s*=k.s,_&&C?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=v(k.e/f)+v(e.e/f),e.s*=k.s,(c=_.length)<(d=C.length)&&(g=_,_=C,C=g,s=c,c=d,d=s),s=c+d,g=[];s--;g.push(0));for(b=p,w=y,s=d;--s>=0;){for(r=0,h=C[s]%w,m=C[s]/w|0,o=s+(i=c);o>s;)r=((l=h*(l=_[--i]%w)+(a=m*l+(u=_[i]/w|0)*h)%w*w+g[o]+r)/b|0)+(a/w|0)+m*u,g[o--]=l%b;g[o]=r}return r?++n:g.shift(),ee(e,g,n)},j.toDigits=function(e,t){var r=new Y(this);return e=null!=e&&$(e,1,b,18,"precision")?0|e:null,t=null!=t&&$(t,0,8,18,u)?0|t:B,e?re(r,e,t):r},j.toExponential=function(e,t){return X(this,null!=e&&$(e,0,b,19)?1+~~e:null,t,19)},j.toFixed=function(e,t){return X(this,null!=e&&$(e,0,b,20)?~~e+this.e+1:null,t,20)},j.toFormat=function(e,t){var r=X(this,null!=e&&$(e,0,b,21)?~~e+this.e+1:null,t,21);if(this.c){var n,s=r.split("."),o=+W.groupSize,i=+W.secondaryGroupSize,a=W.groupSeparator,c=s[0],l=s[1],u=this.s<0,d=u?c.slice(1):c,h=d.length;if(i&&(n=o,o=i,i=n,h-=n),o>0&&h>0){for(n=h%o||o,c=d.substr(0,n);n<h;n+=o)c+=a+d.substr(n,o);i>0&&(c+=a+d.slice(n)),u&&(c="-"+c)}r=l?c+W.decimalSeparator+((i=+W.fractionGroupSize)?l.replace(new RegExp("\\d{"+i+"}\\B","g"),"$&"+W.fractionGroupSeparator):l):c}return r},j.toFraction=function(e){var t,n,s,o,i,a,c,l,u,d=K,h=this,p=h.c,m=new Y(L),y=n=new Y(L),b=c=new Y(L);if(null!=e&&(K=!1,a=new Y(e),K=d,(d=a.isInt())&&!a.lt(L)||(K&&te(22,"max denominator "+(d?"out of range":"not an integer"),e),e=!d&&a.c&&re(a,a.e+1,1).gte(L)?a:null)),!p)return h.toString();for(u=w(p),o=m.e=u.length-h.e-1,m.c[0]=g[(i=o%f)<0?f+i:i],e=!e||a.cmp(m)>0?o>0?m:y:a,i=H,H=1/0,a=new Y(u),c.c[0]=0;l=r(a,m,0,1),1!=(s=n.plus(l.times(b))).cmp(e);)n=b,b=s,y=c.plus(l.times(s=y)),c=s,m=a.minus(l.times(s=m)),a=s;return s=r(e.minus(n),b,0,1),c=c.plus(s.times(y)),n=n.plus(s.times(b)),c.s=y.s=h.s,t=r(y,b,o*=2,B).minus(h).abs().cmp(r(c,n,o,B).minus(h).abs())<1?[y.toString(),b.toString()]:[c.toString(),n.toString()],H=i,t},j.toNumber=function(){var e=this;return+e||(e.s?0*e.s:NaN)},j.toPower=j.pow=function(e){var t,r,n=c(e<0?-e:+e),s=this;if(!$(e,-9007199254740991,m,23,"exponent")&&(!isFinite(e)||n>m&&(e/=0)||parseFloat(e)!=e&&!(e=NaN)))return new Y(Math.pow(+s,e));for(t=z?a(z/f+2):0,r=new Y(L);;){if(n%2){if(!(r=r.times(s)).c)break;t&&r.c.length>t&&(r.c.length=t)}if(!(n=c(n/2)))break;s=s.times(s),t&&s.c&&s.c.length>t&&(s.c.length=t)}return e<0&&(r=L.div(r)),t?re(r,z,B):r},j.toPrecision=function(e,t){return X(this,null!=e&&$(e,1,b,24,"precision")?0|e:null,t,24)},j.toString=function(e){var t,r=this,n=r.s,s=r.e;return null===s?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(t=w(r.c),t=null!=e&&$(e,2,64,25,"base")?J(M(t,s),0|e,10,n):s<=D||s>=F?S(t,s):M(t,s),n<0&&r.c[0]&&(t="-"+t)),t},j.truncated=j.trunc=function(){return re(new Y(this),this.e+1,1)},j.valueOf=j.toJSON=function(){return this.toString()},null!=t&&Y.config(t),Y}(),"function"==typeof define&&define.amd)define((function(){return n}));else if(void 0!==t&&t.exports){if(t.exports=n,!s)try{s=e("crypto")}catch(e){}}else r.BigNumber=n}(this)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>bignumber.js"}],[5374,{},function(){with(this)return function(){"use strict";return function(e,t,r){!function(e){var n="object"==typeof r&&r,s="object"==typeof t&&t&&t.exports==n&&t,o="object"==typeof global&&global;o.global!==o&&o.window!==o||(e=o);var i,a,c,l=String.fromCharCode;function u(e){for(var t,r,n=[],s=0,o=e.length;s<o;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<o?56320==(64512&(r=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),s--):n.push(t);return n}function d(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function h(e,t){return l(e>>t&63|128)}function p(e){if(0==(4294967168&e))return l(e);var t="";return 0==(4294965248&e)?t=l(e>>6&31|192):0==(4294901760&e)?(d(e),t=l(e>>12&15|224),t+=h(e,6)):0==(4292870144&e)&&(t=l(e>>18&7|240),t+=h(e,12),t+=h(e,6)),t+=l(63&e|128)}function f(){if(c>=a)throw Error("Invalid byte index");var e=255&i[c];if(c++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function m(){var e,t;if(c>a)throw Error("Invalid byte index");if(c==a)return!1;if(e=255&i[c],c++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|f())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|f()<<6|f())>=2048)return d(t),t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(7&e)<<18|f()<<12|f()<<6|f())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}var g={version:"2.1.2",encode:function(e){for(var t=u(e),r=t.length,n=-1,s="";++n<r;)s+=p(t[n]);return s},decode:function(e){i=u(e),a=i.length,c=0;for(var t,r=[];!1!==(t=m());)r.push(t);return function(e){for(var t,r=e.length,n=-1,s="";++n<r;)(t=e[n])>65535&&(s+=l((t-=65536)>>>10&1023|55296),t=56320|1023&t),s+=l(t);return s}(r)}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define((function(){return g}));else if(n&&!n.nodeType)if(s)s.exports=g;else{var y={}.hasOwnProperty;for(var b in g)y.call(g,b)&&(n[b]=g[b])}else e.utf8=g}(this)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>utf8"}],[5378,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,s=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(Error);r.SecurityError=o;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(Error);r.InvalidStateError=i;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(Error);r.NetworkError=a;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(Error);r.SyntaxError=c}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[5379,{"./xml-http-request":5383,"./xml-http-request-event-target":5381},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./xml-http-request"));var n=e("./xml-http-request-event-target");r.XMLHttpRequestEventTarget=n.XMLHttpRequestEventTarget}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[538,{_process:4870,"readable-stream":5063,util:1803,xtend:5385},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,s=e("util").inherits,o=e("xtend");function i(e){n.call(this,e),this._destroyed=!1}function a(e,t,r){r(null,e)}function c(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=a),"function"!=typeof n&&(n=null),e(t,r,n)}}s(i,n),i.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,r){var n=new i(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=c((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=o(e,t),i.call(this,this.options)}return s(n,i),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=c((function(e,t,r){var n=new i(o({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2"}],[5380,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){this.type=e,this.bubbles=!1,this.cancelable=!1,this.loaded=0,this.lengthComputable=!1,this.total=0};r.ProgressEvent=n}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[5381,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){this.listeners={}}return e.prototype.addEventListener=function(e,t){e=e.toLowerCase(),this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t.handleEvent||t)},e.prototype.removeEventListener=function(e,t){if(e=e.toLowerCase(),this.listeners[e]){var r=this.listeners[e].indexOf(t.handleEvent||t);r<0||this.listeners[e].splice(r,1)}},e.prototype.dispatchEvent=function(e){var t=e.type.toLowerCase();if(e.target=this,this.listeners[t])for(var r=0,n=this.listeners[t];r<n.length;r++){n[r].call(this,e)}var s=this["on"+t];return s&&s.call(this,e),!0},e}();r.XMLHttpRequestEventTarget=n}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[5382,{"./xml-http-request-event-target":5381,buffer:1797},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n,s=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=function(e){function r(){var t=e.call(this)||this;return t._contentType=null,t._body=null,t._reset(),t}return s(r,e),r.prototype._reset=function(){this._contentType=null,this._body=null},r.prototype._setData=function(e){if(null!=e)if("string"==typeof e)0!==e.length&&(this._contentType="text/plain;charset=UTF-8"),this._body=new t(e,"utf-8");else if(t.isBuffer(e))this._body=e;else if(e instanceof ArrayBuffer){for(var r=new t(e.byteLength),n=new Uint8Array(e),s=0;s<e.byteLength;s++)r[s]=n[s];this._body=r}else{if(!(e.buffer&&e.buffer instanceof ArrayBuffer))throw new Error("Unsupported send() data "+e);r=new t(e.byteLength);var o=e.byteOffset;for(n=new Uint8Array(e.buffer),s=0;s<e.byteLength;s++)r[s]=n[s+o];this._body=r}},r.prototype._finalizeHeaders=function(e,t){this._contentType&&!t["content-type"]&&(e["Content-Type"]=this._contentType),this._body&&(e["Content-Length"]=this._body.length.toString())},r.prototype._startUpload=function(e){this._body&&e.write(this._body),e.end()},r}(e("./xml-http-request-event-target").XMLHttpRequestEventTarget);r.XMLHttpRequestUpload=o}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[5383,{"./errors":5378,"./progress-event":5380,"./xml-http-request-event-target":5381,"./xml-http-request-upload":5382,_process:4870,buffer:1797,cookiejar:1871,http:5153,https:4522,os:4849,url:5243},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){var s,o=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e};Object.defineProperty(r,"__esModule",{value:!0});var a=e("http"),c=e("https"),l=e("os"),u=e("url"),d=e("./progress-event"),h=e("./errors"),p=e("./xml-http-request-event-target"),f=e("./xml-http-request-upload"),m=e("cookiejar"),g=function(e){function r(n){void 0===n&&(n={});var s=e.call(this)||this;return s.UNSENT=r.UNSENT,s.OPENED=r.OPENED,s.HEADERS_RECEIVED=r.HEADERS_RECEIVED,s.LOADING=r.LOADING,s.DONE=r.DONE,s.onreadystatechange=null,s.readyState=r.UNSENT,s.response=null,s.responseText="",s.responseType="",s.status=0,s.statusText="",s.timeout=0,s.upload=new f.XMLHttpRequestUpload,s.responseUrl="",s.withCredentials=!1,s._method=null,s._url=null,s._sync=!1,s._headers={},s._loweredHeaders={},s._mimeOverride=null,s._request=null,s._response=null,s._responseParts=null,s._responseHeaders=null,s._aborting=null,s._error=null,s._loadedBytes=0,s._totalBytes=0,s._lengthComputable=!1,s._restrictedMethods={CONNECT:!0,TRACE:!0,TRACK:!0},s._restrictedHeaders={"accept-charset":!0,"accept-encoding":!0,"access-control-request-headers":!0,"access-control-request-method":!0,connection:!0,"content-length":!0,cookie:!0,cookie2:!0,date:!0,dnt:!0,expect:!0,host:!0,"keep-alive":!0,origin:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,via:!0},s._privateHeaders={"set-cookie":!0,"set-cookie2":!0},s._userAgent="Mozilla/5.0 ("+l.type()+" "+l.arch()+") node.js/"+t.versions.node+" v8/"+t.versions.v8,s._anonymous=n.anon||!1,s}return o(r,e),r.prototype.open=function(e,t,n,s,o){if(void 0===n&&(n=!0),e=e.toUpperCase(),this._restrictedMethods[e])throw new r.SecurityError("HTTP method "+e+" is not allowed in XHR");var i=this._parseUrl(t,s,o);this.readyState===r.HEADERS_RECEIVED||(this.readyState,r.LOADING),this._method=e,this._url=i,this._sync=!n,this._headers={},this._loweredHeaders={},this._mimeOverride=null,this._setReadyState(r.OPENED),this._request=null,this._response=null,this.status=0,this.statusText="",this._responseParts=[],this._responseHeaders=null,this._loadedBytes=0,this._totalBytes=0,this._lengthComputable=!1},r.prototype.setRequestHeader=function(e,t){if(this.readyState!==r.OPENED)throw new r.InvalidStateError("XHR readyState must be OPENED");var n=e.toLowerCase();this._restrictedHeaders[n]||/^sec-/.test(n)||/^proxy-/.test(n)?console.warn('Refused to set unsafe header "'+e+'"'):(t=t.toString(),null!=this._loweredHeaders[n]?(e=this._loweredHeaders[n],this._headers[e]=this._headers[e]+", "+t):(this._loweredHeaders[n]=e,this._headers[e]=t))},r.prototype.send=function(e){if(this.readyState!==r.OPENED)throw new r.InvalidStateError("XHR readyState must be OPENED");if(this._request)throw new r.InvalidStateError("send() already called");switch(this._url.protocol){case"file:":return this._sendFile(e);case"http:":case"https:":return this._sendHttp(e);default:throw new r.NetworkError("Unsupported protocol "+this._url.protocol)}},r.prototype.abort=function(){null!=this._request&&(this._request.abort(),this._setError(),this._dispatchProgress("abort"),this._dispatchProgress("loadend"))},r.prototype.getResponseHeader=function(e){if(null==this._responseHeaders||null==e)return null;var t=e.toLowerCase();return this._responseHeaders.hasOwnProperty(t)?this._responseHeaders[e.toLowerCase()]:null},r.prototype.getAllResponseHeaders=function(){var e=this;return null==this._responseHeaders?"":Object.keys(this._responseHeaders).map((function(t){return t+": "+e._responseHeaders[t]})).join("\r\n")},r.prototype.overrideMimeType=function(e){if(this.readyState===r.LOADING||this.readyState===r.DONE)throw new r.InvalidStateError("overrideMimeType() not allowed in LOADING or DONE");this._mimeOverride=e.toLowerCase()},r.prototype.nodejsSet=function(e){if(this.nodejsHttpAgent=e.httpAgent||this.nodejsHttpAgent,this.nodejsHttpsAgent=e.httpsAgent||this.nodejsHttpsAgent,e.hasOwnProperty("baseUrl")){if(null!=e.baseUrl)if(!u.parse(e.baseUrl,!1,!0).protocol)throw new r.SyntaxError("baseUrl must be an absolute URL");this.nodejsBaseUrl=e.baseUrl}},r.nodejsSet=function(e){r.prototype.nodejsSet(e)},r.prototype._setReadyState=function(e){this.readyState=e,this.dispatchEvent(new d.ProgressEvent("readystatechange"))},r.prototype._sendFile=function(e){throw new Error("Protocol file: not implemented")},r.prototype._sendHttp=function(e){if(this._sync)throw new Error("Synchronous XHR processing not implemented");!e||"GET"!==this._method&&"HEAD"!==this._method?e=e||"":(console.warn("Discarding entity body for "+this._method+" requests"),e=null),this.upload._setData(e),this._finalizeHeaders(),this._sendHxxpRequest()},r.prototype._sendHxxpRequest=function(){var e=this;if(this.withCredentials){var t=r.cookieJar.getCookies(m.CookieAccessInfo(this._url.hostname,this._url.pathname,"https:"===this._url.protocol)).toValueString();this._headers.cookie=this._headers.cookie2=t}var n="http:"===this._url.protocol?[a,this.nodejsHttpAgent]:[c,this.nodejsHttpsAgent],s=n[0],o=n[1],i=s.request.bind(s)({hostname:this._url.hostname,port:+this._url.port,path:this._url.path,auth:this._url.auth,method:this._method,headers:this._headers,agent:o});this._request=i,this.timeout&&i.setTimeout(this.timeout,(function(){return e._onHttpTimeout(i)})),i.on("response",(function(t){return e._onHttpResponse(i,t)})),i.on("error",(function(t){return e._onHttpRequestError(i,t)})),this.upload._startUpload(i),this._request===i&&this._dispatchProgress("loadstart")},r.prototype._finalizeHeaders=function(){this._headers=i({},this._headers,{Connection:"keep-alive",Host:this._url.host,"User-Agent":this._userAgent},this._anonymous?{Referer:"about:blank"}:{}),this.upload._finalizeHeaders(this._headers,this._loweredHeaders)},r.prototype._onHttpResponse=function(e,t){var n=this;if(this._request===e){if(this.withCredentials&&(t.headers["set-cookie"]||t.headers["set-cookie2"])&&r.cookieJar.setCookies(t.headers["set-cookie"]||t.headers["set-cookie2"]),[301,302,303,307,308].indexOf(t.statusCode)>=0)return this._url=this._parseUrl(t.headers.location),this._method="GET",this._loweredHeaders["content-type"]&&(delete this._headers[this._loweredHeaders["content-type"]],delete this._loweredHeaders["content-type"]),null!=this._headers["Content-Type"]&&delete this._headers["Content-Type"],delete this._headers["Content-Length"],this.upload._reset(),this._finalizeHeaders(),void this._sendHxxpRequest();this._response=t,this._response.on("data",(function(e){return n._onHttpResponseData(t,e)})),this._response.on("end",(function(){return n._onHttpResponseEnd(t)})),this._response.on("close",(function(){return n._onHttpResponseClose(t)})),this.responseUrl=this._url.href.split("#")[0],this.status=t.statusCode,this.statusText=a.STATUS_CODES[this.status],this._parseResponseHeaders(t);var s=this._responseHeaders["content-length"]||"";this._totalBytes=+s,this._lengthComputable=!!s,this._setReadyState(r.HEADERS_RECEIVED)}},r.prototype._onHttpResponseData=function(e,t){this._response===e&&(this._responseParts.push(new n(t)),this._loadedBytes+=t.length,this.readyState!==r.LOADING&&this._setReadyState(r.LOADING),this._dispatchProgress("progress"))},r.prototype._onHttpResponseEnd=function(e){this._response===e&&(this._parseResponse(),this._request=null,this._response=null,this._setReadyState(r.DONE),this._dispatchProgress("load"),this._dispatchProgress("loadend"))},r.prototype._onHttpResponseClose=function(e){if(this._response===e){var t=this._request;this._setError(),t.abort(),this._setReadyState(r.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend")}},r.prototype._onHttpTimeout=function(e){this._request===e&&(this._setError(),e.abort(),this._setReadyState(r.DONE),this._dispatchProgress("timeout"),this._dispatchProgress("loadend"))},r.prototype._onHttpRequestError=function(e,t){this._request===e&&(this._setError(),e.abort(),this._setReadyState(r.DONE),this._dispatchProgress("error"),this._dispatchProgress("loadend"))},r.prototype._dispatchProgress=function(e){var t=new r.ProgressEvent(e);t.lengthComputable=this._lengthComputable,t.loaded=this._loadedBytes,t.total=this._totalBytes,this.dispatchEvent(t)},r.prototype._setError=function(){this._request=null,this._response=null,this._responseHeaders=null,this._responseParts=null},r.prototype._parseUrl=function(e,t,r){var n=null==this.nodejsBaseUrl?e:u.resolve(this.nodejsBaseUrl,e),s=u.parse(n,!1,!0);s.hash=null;var o=(s.auth||"").split(":"),i=o[0],a=o[1];return(i||a||t||r)&&(s.auth=(t||i||"")+":"+(r||a||"")),s},r.prototype._parseResponseHeaders=function(e){for(var t in this._responseHeaders={},e.headers){var r=t.toLowerCase();this._privateHeaders[r]||(this._responseHeaders[r]=e.headers[t])}null!=this._mimeOverride&&(this._responseHeaders["content-type"]=this._mimeOverride)},r.prototype._parseResponse=function(){var e=n.concat(this._responseParts);switch(this._responseParts=null,this.responseType){case"json":this.responseText=null;try{this.response=JSON.parse(e.toString("utf-8"))}catch(e){this.response=null}return;case"buffer":return this.responseText=null,void(this.response=e);case"arraybuffer":this.responseText=null;for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),s=0;s<e.length;s++)r[s]=e[s];return void(this.response=t);default:try{this.responseText=e.toString(this._parseResponseEncoding())}catch(t){this.responseText=e.toString("binary")}this.response=this.responseText}},r.prototype._parseResponseEncoding=function(){return/;\s*charset=(.*)$/.exec(this._responseHeaders["content-type"]||"")[1]||"utf-8"},r.ProgressEvent=d.ProgressEvent,r.InvalidStateError=h.InvalidStateError,r.NetworkError=h.NetworkError,r.SecurityError=h.SecurityError,r.SyntaxError=h.SyntaxError,r.XMLHttpRequestUpload=f.XMLHttpRequestUpload,r.UNSENT=0,r.OPENED=1,r.HEADERS_RECEIVED=2,r.LOADING=3,r.DONE=4,r.cookieJar=m.CookieJar(),r}(p.XMLHttpRequestEventTarget);r.XMLHttpRequest=g,g.prototype.nodejsHttpAgent=a.globalAgent,g.prototype.nodejsHttpsAgent=c.globalAgent,g.prototype.nodejsBaseUrl=null}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>web3>xhr2-cookies"}],[5395,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM=r.AUTO_LOCK_TIMEOUT_ALARM=void 0;r.AUTO_LOCK_TIMEOUT_ALARM="AUTO_LOCK_TIMEOUT_ALARM";r.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM="METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM"}}},{package:"$root$"}],[54,{"../../../shared/constants/app":5397,"../../../shared/constants/metametrics":5402,"../../../shared/modules/random-id":5429,"../metamask-controller":88,"@metamask/obs-store":1217,"eth-rpc-errors":2103,events:1798,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=d(e("events")),s=e("@metamask/obs-store"),o=e("eth-rpc-errors"),i=d(e("loglevel")),a=e("../../../shared/constants/app"),c=e("../../../shared/constants/metametrics"),l=e("../metamask-controller"),u=d(e("../../../shared/modules/random-id"));function d(e){return e&&e.__esModule?e:{default:e}}class h extends n.default{constructor(e){super(),this.memStore=new s.ObservableStore({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}),this.resetState=()=>{this.memStore.updateState({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0})},this.messages=[],this.metricsEvent=e.metricsEvent}get unapprovedEncryptionPublicKeyMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,n)=>{if(!e)return void n(new Error("MetaMask Message: address field is required."));const s=this.addUnapprovedMessage(e,t);this.once(`${s}:finished`,(t=>{switch(t.status){case"received":return void r(t.rawData);case"rejected":return void n(o.ethErrors.provider.userRejectedRequest("MetaMask EncryptionPublicKey: User denied message EncryptionPublicKey."));default:n(new Error(`MetaMask EncryptionPublicKey: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){i.default.debug("EncryptionPublicKeyManager addUnapprovedMessage: address");const r=(new Date).getTime(),n=(0,u.default)(),s={id:n,msgParams:e,time:r,status:"unapproved",type:a.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY};return t&&(s.origin=t.origin),this.addMsg(s),this.emit("update"),n}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForEncryptionPublicKey(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusReceived(e,t){const r=this.getMsg(e);r.rawData=t,this._updateMsg(r),this._setMsgStatus(e,"received")}prepMsgForEncryptionPublicKey(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){t&&this.metricsEvent({event:t,category:c.EVENT.CATEGORIES.MESSAGES,properties:{action:"Encryption public key Request"}}),this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`EncryptionPublicKeyManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"received"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedEncryptionPublicKeyMsgs:e,unapprovedEncryptionPublicKeyMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=h}}},{package:"$root$"}],[5405,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.PHISHING_NEW_ISSUE_URLS=void 0;r.PHISHING_NEW_ISSUE_URLS={MetaMask:"https://github.com/metamask/eth-phishing-detect/issues/new",PhishFort:"https://github.com/phishfort/phishfort-lists/issues/new"}}}},{package:"$root$"}],[5406,{"./time":5408},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME=r.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER=r.FALLBACK_SMART_TRANSACTIONS_DEADLINE=void 0;const n=10*e("./time").SECOND;r.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME=n;r.FALLBACK_SMART_TRANSACTIONS_DEADLINE=180;r.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER=2}}},{package:"$root$"}],[5419,{loglevel:4778,"webextension-polyfill":5375},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.checkForLastError=i,r.checkForLastErrorAndLog=function(){const e=i();e&&s.default.error(e);return e},r.checkForLastErrorAndWarn=function(){const e=i();e&&console.warn(e);return e};var n=o(e("webextension-polyfill")),s=o(e("loglevel"));function o(e){return e&&e.__esModule?e:{default:e}}function i(){const{lastError:e}=n.default.runtime;return e?e.stack&&e.message?e:new Error(e.message):undefined}}}},{package:"$root$"}],[55,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}];r.default=n}}},{package:"$root$"}],[56,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}];r.default=n}}},{package:"$root$"}],[57,{"./contracts/registry":55,"./contracts/resolver":56,"@ensdomains/content-hash":206,"eth-ens-namehash":2025,"ethjs-contract":2610,"ethjs-query":2614},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function({provider:e,name:t}){const r=new s.default(e),l=n.default.hash(t),d=new o.default(r),h=Number.parseInt(await r.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(h);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${h}"`);const f=d(a.default).at(p),m=(await f.resolver(l))[0];if(u(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const g=d(c.default).at(m),y=await g.supportsInterface("0xbc1c58d1"),b=await g.supportsInterface("0xd8389dc5");if(y[0]){const e=(await g.contenthash(l))[0];let t=i.default.decode(e);const r=i.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=i.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(b[0]){const e=(await g.content(l))[0];if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var n=l(e("eth-ens-namehash")),s=l(e("ethjs-query")),o=l(e("ethjs-contract")),i=l(e("@ensdomains/content-hash")),a=l(e("./contracts/registry")),c=l(e("./contracts/resolver"));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$"}],[58,{"../../../../shared/modules/fetch-with-timeout":5423,"./resolver":57,"base32-encode":1702,"base64-js":1703,"webextension-polyfill":5375},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:r}){const i=u.map((e=>`*://*.${e}/*`));return o.default.webRequest.onErrorOccurred.addListener(c,{urls:i,types:["main_frame"]}),{remove(){o.default.webRequest.onErrorOccurred.removeListener(c)}};async function c(i){const{tabId:c,url:d}=i;if(-1===c||"0x1"!==t())return;const{hostname:h,pathname:p,search:f,hash:m}=new URL(d),g=h.split("."),y=g[g.length-1];u.includes(y)&&async function({tabId:t,name:i,pathname:c,search:u,fragment:d}){const h=r();o.default.tabs.update(t,{url:"loading.html"});let p=`https://app.ens.domains/name/${i}`;try{const{type:r,hash:f}=await(0,a.default)({provider:e,name:i});if("ipfs-ns"===r||"ipns-ns"===r){const e=`https://${f}.${r.slice(0,4)}.${h}${c}${u||""}${d||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(p=e)}catch(e){console.warn(e)}}else if("swarm-ns"===r)p=`https://swarm-gateways.net/bzz:/${f}${c}${u||""}${d||""}`;else if("onion"===r||"onion3"===r)p=`http://${f}.onion${c}${u||""}${d||""}`;else if("zeronet"===r)p=`http://127.0.0.1:43110/${f}${c}${u||""}${d||""}`;else if("skynet-ns"===r){const e=f.padEnd(f.length+4-f.length%4,"="),t=s.default.toByteArray(e),r={padding:!1};p=`https://${(0,n.default)(t,"RFC4648-HEX",r).toLowerCase()}.siasky.net${c}${u||""}${d||""}`}}catch(e){console.warn(e)}finally{o.default.tabs.update(t,{url:p})}}({tabId:c,name:h,pathname:p,search:f,fragment:m})}};var n=c(e("base32-encode")),s=c(e("base64-js")),o=c(e("webextension-polyfill")),i=c(e("../../../../shared/modules/fetch-with-timeout")),a=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,i.default)(),u=["eth"]}}},{package:"$root$"}],[61,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return s((0,n.cloneDeep)(e),(e=>null===e?"null":typeof e))};var n=e("lodash");function s(e={},t){return Object.entries(e).forEach((([r,n])=>{e[r]="object"==typeof n&&null!==n?s(n,t):t(n)})),e}}}},{package:"$root$"}],[62,{"./util":87,"@sentry/browser":1293,loglevel:4778,"webextension-polyfill":5375},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=a(e("webextension-polyfill")),s=a(e("loglevel")),o=e("@sentry/browser"),i=e("./util");function a(e){return e&&e.__esModule?e:{default:e}}r.default=class{constructor(){this.isSupported=Boolean(n.default.storage.local),this.isSupported||s.default.error("Storage local API not available."),this.dataPersistenceFailing=!1}setMetadata(e){this.metadata=e}async set(e){if(!this.isSupported)throw new Error("Metamask- cannot persist state to local store as this browser does not support this action");if(!e)throw new Error("MetaMask - updated state is missing");if(!this.metadata)throw new Error('MetaMask - metadata must be set on instance of ExtensionStore before calling "set"');try{await this._set({data:e,meta:this.metadata}),this.dataPersistenceFailing&&(this.dataPersistenceFailing=!1)}catch(e){this.dataPersistenceFailing||(this.dataPersistenceFailing=!0,(0,o.captureException)(e)),s.default.error("error setting state in local store:",e)}}async get(){if(!this.isSupported)return undefined;const e=await this._get();return t=e,0===Object.keys(t).length?undefined:e;var t}_get(){const{local:e}=n.default.storage;return new Promise(((t,r)=>{e.get(null).then((e=>{const n=(0,i.checkForError)();n?r(n):t(e)}))}))}_set(e){const{local:t}=n.default.storage;return new Promise(((r,n)=>{t.set(e).then((()=>{const e=(0,i.checkForError)();e?n(e):r()}))}))}}}}},{package:"$root$"}],[63,{"../../../shared/constants/app":5397,"../../../shared/constants/metametrics":5402,"../../../shared/modules/random-id":5429,"../metamask-controller":88,"@metamask/obs-store":1217,buffer:1797,"eth-rpc-errors":2103,"ethereumjs-util":2178,events:1798},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.normalizeMsgData=p;var n=d(e("events")),s=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),a=e("../../../shared/constants/app"),c=e("../metamask-controller"),l=d(e("../../../shared/modules/random-id")),u=e("../../../shared/constants/metametrics");function d(e){return e&&e.__esModule?e:{default:e}}class h extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new s.ObservableStore({unapprovedMsgs:{},unapprovedMsgCount:0}),this.resetState=()=>{this.memStore.updateState({unapprovedMsgs:{},unapprovedMsgCount:0})},this.messages=[],this.metricsEvent=e}get unapprovedMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}async addUnapprovedMessageAsync(e,t){const r=this.addUnapprovedMessage(e,t);return await new Promise(((t,n)=>{this.once(`${r}:finished`,(r=>{switch(r.status){case"signed":return t(r.rawSig);case"rejected":return n(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return n(new Error(`MetaMask Message Signature: ${r.error}`));default:return n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=p(e.data);const r=(new Date).getTime(),n=(0,l.default)(),s={id:n,msgParams:e,time:r,status:"unapproved",type:a.MESSAGE_TYPE.ETH_SIGN};return this.addMsg(s),this.emit("update"),n}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:u.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`MessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedMsgs:e,unapprovedMsgCount:t}),this.emit(c.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}function p(e){return"0x"===e.slice(0,2)?e:(0,o.bufferToHex)(t.from(e,"utf8"))}r.default=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[65,{events:1798},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,s=(n=e("events"))&&n.__esModule?n:{default:n};class o extends s.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t}catch(t){const n=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${n}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=o}}},{package:"$root$"}],[66,{"../../../shared/modules/fetch-with-timeout":5423,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("loglevel"));function s(e){return e&&e.__esModule?e:{default:e}}const o=(0,s(e("../../../shared/modules/fetch-with-timeout")).default)();r.default=class{constructor(){var e,t,r;r=!0,(t="isSupported")in(e=this)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,this._initialized=!1,this._initializing=this._init(),this._state=undefined}async _init(){try{const e=await o("http://localhost:12345/state.json");e.ok&&(this._state=await e.json())}catch(e){n.default.debug(`Error loading network state: '${e.message}'`)}finally{this._initialized=!0}}async get(){return this._initialized||await this._initializing,this._state}setMetadata(e){this.metadata=e}async set(e){if(!this.isSupported)throw new Error("Metamask- cannot persist state to local store as this browser does not support this action");if(!e)throw new Error("MetaMask - updated state is missing");if(!this.metadata)throw new Error('MetaMask - metadata must be set on instance of ExtensionStore before calling "set"');this._initialized||await this._initializing,this._state={data:e,meta:this._metadata}}}}}},{package:"$root$"}],[67,{"../platforms/extension":167,"safe-event-emitter":5082},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var n=o(e("safe-event-emitter")),s=o(e("../platforms/extension"));function o(e){return e&&e.__esModule?e:{default:e}}const i={POPUP_CLOSED:"onPopupClosed"};r.NOTIFICATION_MANAGER_EVENTS=i;class a extends n.default{constructor(){super(),this.platform=new s.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(){const e=await this._getPopup();if(e)await this.platform.focusWindow(e.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=r.left+(r.width-360)}catch(r){const{screenX:n,screenY:s,outerWidth:o}=window;t=Math.max(s,0),e=Math.max(n+(o-360),0)}const r=await this.platform.openWindow({url:"notification.html",type:"popup",width:360,height:620,left:e,top:t});r.left!==e&&"fullscreen"!==r.state&&await this.platform.updateWindowPosition(r.id,e,t),this._popupId=r.id}}_onWindowClosed(e){e===this._popupId&&(this._popupId=undefined,this.emit(i.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=a}}},{package:"$root$"}],[68,{"../../../shared/constants/app":5397,"../../../shared/constants/metametrics":5402,"../../../shared/modules/hexstring-utils":5425,"../../../shared/modules/random-id":5429,"../../../shared/modules/siwe":5431,"../metamask-controller":88,"./util":87,"@metamask/obs-store":1217,buffer:1797,"eth-rpc-errors":2103,"ethereumjs-util":2178,events:1798,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=m(e("events")),s=e("@metamask/obs-store"),o=e("ethereumjs-util"),i=e("eth-rpc-errors"),a=m(e("loglevel")),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),u=m(e("../../../shared/modules/random-id")),d=e("../../../shared/constants/metametrics"),h=e("../../../shared/modules/siwe"),p=e("../../../shared/modules/hexstring-utils"),f=e("./util");function m(e){return e&&e.__esModule?e:{default:e}}const g=/^[0-9A-Fa-f]+$/gu;class y extends n.default{constructor({metricsEvent:e}){super(),this.memStore=new s.ObservableStore({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0}),this.resetState=()=>{this.memStore.updateState({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0})},this.messages=[],this.metricsEvent=e}get unapprovedPersonalMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,n)=>{if(!e.from)return void n(new Error("MetaMask Message Signature: from field is required."));const s=this.addUnapprovedMessage(e,t);this.once(`${s}:finished`,(t=>{switch(t.status){case"signed":return void r(t.rawSig);case"rejected":return void n(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return void n(new Error(`MetaMask Message Signature: ${t.error}`));default:n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){a.default.debug(`PersonalMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(0,h.detectSIWE)(e);e.siwe=r;const n=(new Date).getTime(),s=(0,u.default)(),o={id:s,msgParams:e,time:n,status:"unapproved",type:c.MESSAGE_TYPE.PERSONAL_SIGN};return this.addMsg(o),this.emit("update"),s}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:d.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`PersonalMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedPersonalMsgs:e,unapprovedPersonalMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,p.stripHexPrefix)(e);if(t.match(g))return(0,f.addHexPrefix)(t)}catch(e){a.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,o.bufferToHex)(t.from(e,"utf8"))}}r.default=y}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[69,{"../../../../shared/constants/network":5403,"./handlers":73,"@metamask/permission-controller":1224,"@metamask/rpc-methods/dist/utils":1242,"eth-rpc-errors":2103,lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createMethodMiddleware=function(e){const t=d.filter((t=>!Object.hasOwnProperty.call(e,t)));if(t.length>0)throw new Error(`Missing expected hooks:\n\n${t.join("\n")}\n`);return async function(t,r,n,s){if(c.UNSUPPORTED_RPC_METHODS.has(t.method))return s(i.ethErrors.rpc.methodNotSupported());const a=u.get(t.method);if(a){const{implementation:i,hookNames:c}=a;try{return await i(t,r,n,s,(0,o.selectHooks)(e,c))}catch(e){return console.error(e),s(e)}}return n()}};var n,s=e("@metamask/permission-controller"),o=e("@metamask/rpc-methods/dist/utils"),i=e("eth-rpc-errors"),a=e("lodash"),c=e("../../../../shared/constants/network");const l=[...((n=e("./handlers"))&&n.__esModule?n:{default:n}).default,...s.permissionRpcMethods.handlers],u=l.reduce(((e,t)=>{for(const r of t.methodNames)e.set(r,t);return e}),new Map),d=Array.from(new Set((0,a.flatten)(l.map((({hookNames:e})=>Object.keys(e))))).values())}}},{package:"$root$"}],[7,{"../../../shared/constants/alerts":5396,"@metamask/obs-store":1217},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/obs-store"),s=e("../../../shared/constants/alerts");const o={alertEnabledness:s.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},preferencesStore:r}=e,s={...o,alertEnabledness:{...o.alertEnabledness,...t.alertEnabledness}};this.store=new n.ObservableStore(s),this.selectedAddress=r.getState().selectedAddress,r.subscribe((({selectedAddress:e})=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e&&(this.selectedAddress=e,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r={...r},r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t={...t},t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,s.WEB3_SHIM_USAGE_ALERT_STATES.RECORDED)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,s.WEB3_SHIM_USAGE_ALERT_STATES.DISMISSED)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r={...r},r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"$root$"}],[70,{"../../../../../shared/constants/app":5397,"../../../../../shared/constants/metametrics":5402,"../../../../../shared/modules/network.utils":5427,"../../../../../shared/modules/rpc.utils":5430,"eth-rpc-errors":2103,lodash:4765,"valid-url":5262},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,s=e("eth-rpc-errors"),o=(n=e("valid-url"))&&n.__esModule?n:{default:n},i=e("lodash"),a=e("../../../../../shared/constants/app"),c=e("../../../../../shared/constants/metametrics"),l=e("../../../../../shared/modules/network.utils"),u=e("../../../../../shared/modules/rpc.utils");var d={methodNames:[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,r,n,{addCustomRpc:d,getCurrentChainId:h,getCurrentRpcUrl:p,findCustomRpcBy:f,updateRpcTarget:m,requestUserApproval:g,sendMetrics:y}){var b;if(null===(b=e.params)||void 0===b||!b[0]||"object"!=typeof e.params[0])return n(s.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:v}=e,{chainId:w,chainName:k=null,blockExplorerUrls:_=null,nativeCurrency:C=null,rpcUrls:E}=e.params[0],S=Object.keys((0,i.omit)(e.params[0],["chainId","chainName","blockExplorerUrls","iconUrls","rpcUrls","nativeCurrency"]));if(S.length>0)return n(s.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${S}`}));const M=e=>{try{const t=new URL(e);return"localhost"===t.hostname||"127.0.0.1"===t.hostname}catch(e){return!1}},A=Array.isArray(E)?E.find((e=>M(e)||o.default.isHttpsUri(e))):null,T=null!==_&&Array.isArray(_)?_.find((e=>M(e)||o.default.isHttpsUri(e))):null;if(!A)return n(s.ethErrors.rpc.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${E}`}));if(null!==_&&!T)return n(s.ethErrors.rpc.invalidParams({message:`Expected null or array with at least one valid string HTTPS URL 'blockExplorerUrl'. Received: ${_}`}));const P="string"==typeof w&&w.toLowerCase();if(!(0,l.isPrefixedFormattedHexString)(P))return n(s.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${w}`}));if(!(0,l.isSafeChainId)(parseInt(P,16)))return n(s.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${P}": numerical value greater than max safe value. Received:\n${w}`}));const R=f({chainId:P});if(R&&R.rpcUrl===A){t.result=null;const e=h(),r=p();if(e===P&&r===A)return n();try{await m(await g({origin:v,type:a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:{rpcUrl:R.rpcUrl,chainId:R.chainId,nickname:R.nickname,ticker:R.ticker}})),t.result=null}catch(e){if(e.code!==s.errorCodes.provider.userRejectedRequest)return n(e)}return n()}let x;try{x=await(0,u.jsonRpcRequest)(A,"eth_chainId")}catch(e){return n(s.ethErrors.rpc.internal({message:`Request for method 'eth_chainId on ${A} failed`,data:{networkErr:e}}))}if(P!==x)return n(s.ethErrors.rpc.invalidParams({message:`Chain ID returned by RPC URL ${A} does not match ${P}`,data:{chainId:x}}));if("string"!=typeof k||!k)return n(s.ethErrors.rpc.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${k}`}));const N=k.length>100?k.substring(0,100):k;if(null!==C){if("object"!=typeof C||Array.isArray(C))return n(s.ethErrors.rpc.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${C}`}));if(18!==C.decimals)return n(s.ethErrors.rpc.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${C.decimals}`}));if(!C.symbol||"string"!=typeof C.symbol)return n(s.ethErrors.rpc.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${C.symbol}`}))}const O=(null==C?void 0:C.symbol)||a.UNKNOWN_TICKER_SYMBOL;if(O!==a.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof O||O.length<2||O.length>6))return n(s.ethErrors.rpc.invalidParams({message:`Expected 2-6 character string 'nativeCurrency.symbol'. Received:\n${O}`}));if(R&&R.chainId===P&&R.ticker!==O)return n(s.ethErrors.rpc.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${O}`}));try{await d(await g({origin:v,type:a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,requestData:{chainId:P,blockExplorerUrl:T,chainName:N,rpcUrl:A,ticker:O}})),y({event:"Custom Network Added",category:c.EVENT.CATEGORIES.NETWORK,referrer:{url:v},properties:{chain_id:P,symbol:O,source:c.EVENT.SOURCE.TRANSACTION.DAPP}}),t.result=null}catch(e){return n(e)}try{await m(await g({origin:v,type:a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:{rpcUrl:A,chainId:P,nickname:N,ticker:O}}))}catch(e){if(e.code!==s.errorCodes.provider.userRejectedRequest)return n(e)}return n()},hookNames:{addCustomRpc:!0,getCurrentChainId:!0,getCurrentRpcUrl:!0,findCustomRpcBy:!0,updateRpcTarget:!0,requestUserApproval:!0,sendMetrics:!0}};r.default=d}}},{package:"$root$"}],[71,{"../../../../../shared/constants/app":5397},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,r,n,{getAccounts:s}){return t.result=await s(),n()},hookNames:{getAccounts:!0}};r.default=n}}},{package:"$root$"}],[72,{"../../../../../shared/constants/app":5397},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,r,n,{getProviderState:s}){return t.result={...await s(e.origin)},n()},hookNames:{getProviderState:!0}};r.default=n}}},{package:"$root$"}],[73,{"./add-ethereum-chain":70,"./eth-accounts":71,"./get-provider-state":72,"./log-web3-shim-usage":74,"./request-accounts":75,"./send-metadata":76,"./switch-ethereum-chain":77,"./watch-asset":78},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=d(e("./add-ethereum-chain")),s=d(e("./eth-accounts")),o=d(e("./get-provider-state")),i=d(e("./log-web3-shim-usage")),a=d(e("./request-accounts")),c=d(e("./send-metadata")),l=d(e("./switch-ethereum-chain")),u=d(e("./watch-asset"));function d(e){return e&&e.__esModule?e:{default:e}}var h=[n.default,s.default,o.default,i.default,a.default,c.default,l.default,u.default];r.default=h}}},{package:"$root$"}],[74,{"../../../../../shared/constants/app":5397,"../../../../../shared/constants/metametrics":5402},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../../../shared/constants/app"),s=e("../../../../../shared/constants/metametrics");var o={methodNames:[n.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,r,n,{sendMetrics:o,getWeb3ShimUsageState:i,setWeb3ShimUsageRecorded:a}){const{origin:c}=e;i(c)===undefined&&(a(c),o({event:"Website Accessed window.web3 Shim",category:s.EVENT.CATEGORIES.INPAGE_PROVIDER,referrer:{url:c}},{excludeMetaMetricsId:!0}));return t.result=!0,n()},hookNames:{sendMetrics:!0,getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};r.default=o}}},{package:"$root$"}],[75,{"../../../../../shared/constants/app":5397,"eth-rpc-errors":2103},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),s=e("../../../../../shared/constants/app");var o={methodNames:[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,r,o,{origin:a,getAccounts:c,getUnlockPromise:l,hasPermission:u,requestAccountsPermission:d}){if(i.has(a))return t.error=n.ethErrors.rpc.resourceUnavailable(`Already processing ${s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),o();if(u(s.MESSAGE_TYPE.ETH_ACCOUNTS)){try{i.add(a),await l(!0),t.result=await c(),o()}catch(e){o(e)}finally{i.delete(a)}return undefined}try{await d()}catch(e){return t.error=e,o()}const h=await c();h.length>0?t.result=h:t.error=n.ethErrors.rpc.internal("Accounts unexpectedly unavailable. Please report this bug.");return o()},hookNames:{origin:!0,getAccounts:!0,getUnlockPromise:!0,hasPermission:!0,requestAccountsPermission:!0}};r.default=o;const i=new Set}}},{package:"$root$"}],[76,{"../../../../../shared/constants/app":5397,"eth-rpc-errors":2103},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors");var s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,r,s,{addSubjectMetadata:o,subjectType:i}){const{origin:a,params:c}=e;if(!c||"object"!=typeof c||Array.isArray(c))return s(n.ethErrors.rpc.invalidParams({data:c}));{const{icon:e=null,name:t=null,...r}=c;o({...r,iconUrl:e,name:t,subjectType:i,origin:a})}return t.result=!0,s()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};r.default=s}}},{package:"$root$"}],[77,{"../../../../../shared/constants/app":5397,"../../../../../shared/constants/network":5403,"../../../../../shared/modules/network.utils":5427,"eth-rpc-errors":2103,lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),s=e("lodash"),o=e("../../../../../shared/constants/app"),i=e("../../../../../shared/constants/network"),a=e("../../../../../shared/modules/network.utils");var c={methodNames:[o.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,r,c,{getCurrentChainId:l,findCustomRpcBy:u,setProviderType:d,updateRpcTarget:h,requestUserApproval:p}){var f;if(null===(f=e.params)||void 0===f||!f[0]||"object"!=typeof e.params[0])return c(n.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:m}=e,{chainId:g}=e.params[0],y=Object.keys((0,s.omit)(e.params[0],["chainId"]));if(y.length>0)return c(n.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${y}`}));const b="string"==typeof g&&g.toLowerCase();if(!(0,a.isPrefixedFormattedHexString)(b))return c(n.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${g}`}));if(!(0,a.isSafeChainId)(parseInt(b,16)))return c(n.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${b}": numerical value greater than max safe value. Received:\n${g}`}));const v=function(e,t){if(e in i.CHAIN_ID_TO_TYPE_MAP)return{chainId:e,ticker:i.CURRENCY_SYMBOLS.ETH,nickname:i.NETWORK_TO_NAME_MAP[e],rpcUrl:i.CHAIN_ID_TO_RPC_URL_MAP[e],type:i.CHAIN_ID_TO_TYPE_MAP[e]};return t({chainId:e})}(b,u);if(v){if(l()===b)return t.result=null,c();try{const e=await p({origin:m,type:o.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:v});g in i.CHAIN_ID_TO_TYPE_MAP&&e.type!==i.NETWORK_TYPES.LOCALHOST?d(e.type):await h(e),t.result=null}catch(e){return c(e)}return c()}return c(n.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${g}". Try adding the chain using ${o.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}))},hookNames:{getCurrentChainId:!0,findCustomRpcBy:!0,setProviderType:!0,updateRpcTarget:!0,requestUserApproval:!0}};r.default=c}}},{package:"$root$"}],[78,{"../../../../../shared/constants/app":5397,"eth-rpc-errors":2103},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),s=e("../../../../../shared/constants/app");var o={methodNames:[s.MESSAGE_TYPE.WATCH_ASSET,s.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,r,s,{handleWatchAssetRequest:o}){try{const{options:r,type:n}=e.params,i=await o(r,n);return await i.result,t.result=!0,s()}catch(e){return"User rejected to watch the asset."===e.message?s(n.ethErrors.provider.userRejectedRequest()):s(e)}},hookNames:{handleWatchAssetRequest:!0}};r.default=o}}},{package:"$root$"}],[79,{"./createMethodMiddleware":69},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./createMethodMiddleware");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))}))}}},{package:"$root$"}],[8,{"../../../shared/constants/alarms":5395,"../../../shared/constants/time":5408,"../../../shared/modules/mv3.utils":5426,"../../../ui/helpers/utils/build-types":6050,"../metamask-controller":88,"@metamask/obs-store":1217,events:1798},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,s=(n=e("events"))&&n.__esModule?n:{default:n},o=e("@metamask/obs-store"),i=e("../metamask-controller"),a=e("../../../shared/constants/time"),c=e("../../../shared/constants/alarms"),l=e("../../../shared/modules/mv3.utils"),u=e("../../../ui/helpers/utils/build-types");class d extends s.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:n,onInactiveTimeout:s,showUnlockRequest:i,preferencesStore:a,qrHardwareStore:c}=e;super(),this.onInactiveTimeout=s||(()=>undefined),this.store=new o.ObservableStore({timeoutMinutes:0,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),collectiblesDetectionNoticeDismissed:!1,enableEIP1559V2NoticeDismissed:!1,showTestnetMessageInDropdown:!0,showPortfolioTooltip:!0,showBetaHeader:(0,u.isBeta)(),trezorModel:null,...n,qrHardware:{},collectiblesDropdownState:{},usedNetworks:{"0x1":!0,"0x5":!0,"0x539":!0}}),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),this._showUnlockRequest=i,a.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),c.subscribe((e=>{this.store.updateState({qrHardware:e})}));const{preferences:l}=a.getState();this._setInactiveTimeout(l.autoLockTimeLimit)}getUnlockPromise(e){return new Promise((t=>{this.isUnlocked()?t():this.waitForUnlock(t,e)}))}waitForUnlock(e,t){this.waitingForUnlock.push({resolve:e}),this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),t&&this._showUnlockRequest()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(i.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();this.timer?clearTimeout(this.timer):l.isManifestV3&&chrome.alarms.clear(c.AUTO_LOCK_TIMEOUT_ALARM),e&&(l.isManifestV3?(chrome.alarms.create(c.AUTO_LOCK_TIMEOUT_ALARM,{delayInMinutes:e,periodInMinutes:e}),chrome.alarms.onAlarm.addListener((e=>{e.name===c.AUTO_LOCK_TIMEOUT_ALARM&&(this.onInactiveTimeout(),chrome.alarms.clear(c.AUTO_LOCK_TIMEOUT_ALARM))}))):this.timer=setTimeout((()=>this.onInactiveTimeout()),e*a.MINUTE))}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}removePollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}setShowPortfolioTooltip(e){this.store.updateState({showPortfolioTooltip:e})}setShowBetaHeader(e){this.store.updateState({showBetaHeader:e})}setTrezorModel(e){this.store.updateState({trezorModel:e})}setCollectiblesDetectionNoticeDismissed(e){this.store.updateState({collectiblesDetectionNoticeDismissed:e})}setEnableEIP1559V2NoticeDismissed(e){this.store.updateState({enableEIP1559V2NoticeDismissed:e})}updateCollectibleDropDownState(e){this.store.updateState({collectiblesDropdownState:e})}setFirstTimeUsedNetwork(e){const t=this.store.getState(),{usedNetworks:r}=t;r[e]=!0,this.store.updateState({usedNetworks:r})}}r.default=d}}},{package:"$root$"}],[80,{"../../../shared/constants/keyrings":5400,"eth-keyring-controller":2081,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("eth-keyring-controller")),s=i(e("loglevel")),o=e("../../../shared/constants/keyrings");function i(e){return e&&e.__esModule?e:{default:e}}var a={async verifyAccounts(e,t){if(!e||e.length<1)throw new Error("No created accounts defined.");const r=new(new n.default({}).getKeyringClassForType(o.KEYRING_TYPES.HD_KEY_TREE))({mnemonic:t,numberOfAccounts:e.length}),i=await r.getAccounts();if(s.default.debug(`Created accounts: ${JSON.stringify(e)}`),s.default.debug(`Restored accounts: ${JSON.stringify(i)}`),i.length!==e.length)throw new Error("Wrong number of accounts");for(let t=0;t<i.length;t++)if(i[t].toLowerCase()!==e[t].toLowerCase())throw new Error(`Not identical accounts! Original: ${e[t]}, Restored: ${i[t]}`)}};r.default=a}}},{package:"$root$"}],[81,{"../util":87,"@segment/loosely-validate-event":1287,buffer:1797,"is-retry-allowed":4543,lodash:4765,"remove-trailing-slash":5073,timers:5181},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=l(e("remove-trailing-slash")),o=l(e("@segment/loosely-validate-event")),i=e("lodash"),a=l(e("is-retry-allowed")),c=e("../util");function l(e){return e&&e.__esModule?e:{default:e}}const u=()=>({});r.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,s.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,o.default)(e,t)}_message(e,t,r){return this._validate(t,e),this.enqueue(e,t,r),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,r=u){if(!this.enable)return void n(r);const s={...t,type:e};if(s.context={...s.context,library:{name:"analytics-node"}},s.timestamp||(s.timestamp=new Date),s.messageId||(s.messageId=(0,c.generateRandomId)()),s.anonymousId&&!(0,i.isString)(s.anonymousId)&&(s.anonymousId=JSON.stringify(s.anonymousId)),s.userId&&!(0,i.isString)(s.userId)&&(s.userId=JSON.stringify(s.userId)),this.queue.push({message:s,callback:r}),!this.flushed)return this.flushed=!0,void this.flush();const o=this.queue.length>=this.flushAt,a=this.queue.reduce(((e,t)=>e+JSON.stringify(t).length),0)>=this.maxQueueSize;(o||a)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=u){if(!this.enable)return n(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return n(e),Promise.resolve();const r=this.queue.splice(0,this.flushAt),s=r.map((e=>e.callback)),o={batch:r.map((e=>e.message)),timestamp:new Date,sentAt:new Date},i={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(o),headers:i},(t=>{n((()=>{s.forEach((e=>e(t,o))),e(t,o)}))}),0)}_retryRequest(e,t,r,n){const s=100*Math.pow(2,n);setTimeout((()=>{this._sendRequest(e,t,r,n+1)}),s)}async _sendRequest(e,t,r,n){return fetch(e,t).then((async s=>{if(s.ok)r();else if(this._isErrorRetryable({response:s})&&n<=this.retryCount)this._retryRequest(e,t,r,n);else{const e=new Error(s.statusText);r(e)}})).catch((s=>{this._isErrorRetryable(s)&&n<=this.retryCount?this._retryRequest(e,t,r,n):r(s)}))}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,a.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$"}],[82,{"../../../../shared/constants/time":5408,"./analytics":81,_process:4870},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,s,o,i=e("../../../../shared/constants/time"),a=(n=e("./analytics"))&&n.__esModule?n:{default:n};const c=null!==(s="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP")?s:null,l=null!==(o=t.env.SEGMENT_HOST)&&void 0!==o?o:null,u=undefined,d=5*i.SECOND,h=(e=u)=>{const t={queue:[],flush(){t.queue.forEach((([e,t])=>{t()})),t.queue=[]},track(r,n=(()=>undefined)){t.queue.push([r,n]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=h;const p=c?new a.default(c,{host:l,flushAt:u,flushInterval:d}):h(u);r.segment=p}).call(this)}).call(this,e("_process"))}}},{package:"$root$"}],[86,{"../../../shared/constants/app":5397,"../../../shared/constants/metametrics":5402,"../../../shared/modules/hexstring-utils":5425,"../../../shared/modules/random-id":5429,"../metamask-controller":88,"@metamask/obs-store":1217,assert:1533,"eth-rpc-errors":2103,"eth-sig-util":2105,events:1798,jsonschema:4571,loglevel:4778},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=m(e("events")),s=e("assert"),o=e("@metamask/obs-store"),i=e("eth-rpc-errors"),a=e("eth-sig-util"),c=m(e("loglevel")),l=m(e("jsonschema")),u=e("../../../shared/constants/app"),d=e("../metamask-controller"),h=m(e("../../../shared/modules/random-id")),p=e("../../../shared/constants/metametrics"),f=e("../../../shared/modules/hexstring-utils");function m(e){return e&&e.__esModule?e:{default:e}}class g extends n.default{constructor({getCurrentChainId:e,metricsEvent:t}){super(),this._getCurrentChainId=e,this.memStore=new o.ObservableStore({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0}),this.resetState=()=>{this.memStore.updateState({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0})},this.messages=[],this.metricsEvent=t}get unapprovedTypedMessagesCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t,r){return new Promise(((n,s)=>{const o=this.addUnapprovedMessage(e,t,r);this.once(`${o}:finished`,(t=>{switch(t.status){case"signed":return n(t.rawSig);case"rejected":return s(i.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return s(new Error(`MetaMask Message Signature: ${t.error}`));default:return s(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,r){e.version=r,t&&(e.origin=t.origin),this.validateParams(e),c.default.debug(`TypedMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`);const n=(new Date).getTime(),s=(0,h.default)(),o={id:s,msgParams:e,time:n,status:"unapproved",type:u.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA};return this.addMsg(o),this.emit("update"),s}validateParams(e){switch(s.strict.ok(e&&"object"==typeof e,"Params must be an object."),s.strict.ok("data"in e,'Params must include a "data" field.'),s.strict.ok("from"in e,'Params must include a "from" field.'),s.strict.ok("string"==typeof e.from&&(0,f.isValidHexAddress)(e.from,{allowNonPrefixed:!1}),'"from" field must be a valid, lowercase, hexadecimal Ethereum address string.'),e.version){case"V1":s.strict.ok(Array.isArray(e.data),'"params.data" must be an array.'),s.strict.doesNotThrow((()=>{(0,a.typedSignatureHash)(e.data)}),"Signing data must be valid EIP-712 typed data.");break;case"V3":case"V4":{let t;s.strict.equal(typeof e.data,"string",'"params.data" must be a string.'),s.strict.doesNotThrow((()=>{t=JSON.parse(e.data)}),'"data" must be a valid JSON string.');const r=l.default.validate(t,a.TYPED_MESSAGE_SCHEMA);if(s.strict.ok(t.primaryType in t.types,`Primary type of "${t.primaryType}" has no type definition.`),0!==r.errors.length)throw i.ethErrors.rpc.invalidParams({message:"Signing data must conform to EIP-712 schema. See https://git.io/fNtcx.",data:r.errors.map((e=>e.message.toString()))});let{chainId:n}=t.domain;if(n){const e=parseInt(this._getCurrentChainId(),16);s.strict.ok(!Number.isNaN(e),`Cannot sign messages for chainId "${n}", because MetaMask is switching networks.`),"string"==typeof n&&(n=parseInt(n,n.startsWith("0x")?16:10)),s.strict.equal(n,e,`Provided chainId "${n}" must match the active chainId "${e}"`)}break}default:s.strict.fail(`Unknown typed data version "${e.version}"`)}}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:p.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",version:r.msgParams.version,type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`TypedMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedTypedMessages:e,unapprovedTypedMessagesCount:t}),this.emit(d.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=g}}},{package:"$root$"}],[88,{"../../shared/constants/app":5397,"../../shared/constants/hardware-wallets":5399,"../../shared/constants/keyrings":5400,"../../shared/constants/metametrics":5402,"../../shared/constants/network":5403,"../../shared/constants/permissions":5404,"../../shared/constants/phishing":5405,"../../shared/constants/swaps":5407,"../../shared/constants/time":5408,"../../shared/constants/tokens":5409,"../../shared/constants/transaction":5410,"../../shared/lib/metamask-controller-utils":5413,"../../shared/modules/hexstring-utils":5425,"../../shared/modules/mv3.utils":5426,"../../shared/modules/string-utils":5432,"../../shared/modules/transaction.utils":5434,"../../shared/notifications":5435,"../../ui/helpers/utils/token-util":6068,"./account-import-strategies":3,"./controllers/alert":7,"./controllers/app-state":8,"./controllers/backup":9,"./controllers/cached-balances":10,"./controllers/detect-tokens":11,"./controllers/ens":13,"./controllers/incoming-transactions":14,"./controllers/metametrics":15,"./controllers/network":19,"./controllers/onboarding":23,"./controllers/permissions":27,"./controllers/preferences":31,"./controllers/swaps":32,"./controllers/transactions":33,"./detect-multiple-instances":39,"./lib/ComposableObservableStore":41,"./lib/account-tracker":42,"./lib/createDupeReqFilterMiddleware":45,"./lib/createLoggerMiddleware":46,"./lib/createMetaRPCHandler":47,"./lib/createOnboardingMiddleware":48,"./lib/createOriginMiddleware":49,"./lib/createRPCMethodTrackingMiddleware":50,"./lib/createTabIdMiddleware":52,"./lib/decrypt-message-manager":53,"./lib/encryption-public-key-manager":54,"./lib/message-manager":63,"./lib/personal-message-manager":68,"./lib/rpc-method-middleware":79,"./lib/seed-phrase-verifier":80,"./lib/segment":82,"./lib/stream-utils":85,"./lib/typed-message-manager":86,"./lib/util":87,"@keystonehq/metamask-airgapped-keyring":529,"@metamask/address-book-controller":965,"@metamask/announcement-controller":971,"@metamask/approval-controller":978,"@metamask/assets-controllers":1e3,"@metamask/base-controller":1007,"@metamask/eth-ledger-bridge-keyring":1141,"@metamask/gas-fee-controller":1197,"@metamask/obs-store":1217,"@metamask/obs-store/dist/asStream":1216,"@metamask/permission-controller":1224,"@metamask/phishing-controller":1237,"@metamask/smart-transactions-controller":1247,"@metamask/subject-metadata-controller":1252,"@sentry/browser":1293,_process:4870,"await-semaphore":1564,buffer:1797,"eth-json-rpc-filters":2032,"eth-json-rpc-filters/subscriptionManager":2038,"eth-json-rpc-middleware":2056,"eth-keyring-controller":2081,"eth-lattice-keyring":2082,"eth-query":2099,"eth-rpc-errors":2103,"eth-trezor-keyring":2118,events:1798,"json-rpc-engine":4561,"json-rpc-middleware-stream/engineStream":4563,lodash:4765,loglevel:4778,nanoid:4827,pump:4885,"webextension-polyfill":5375},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var s=Ue(e("events")),o=Ue(e("pump")),i=e("@metamask/obs-store"),a=e("@metamask/obs-store/dist/asStream"),c=e("json-rpc-engine"),l=e("lodash"),u=Ue(e("json-rpc-middleware-stream/engineStream")),d=Ue(e("eth-json-rpc-filters")),h=Ue(e("eth-json-rpc-filters/subscriptionManager")),p=e("eth-json-rpc-middleware"),f=Ue(e("eth-keyring-controller")),m=e("eth-rpc-errors"),g=e("await-semaphore"),y=Ue(e("loglevel")),b=Ue(e("eth-trezor-keyring")),v=Ue(e("@metamask/eth-ledger-bridge-keyring")),w=Ue(e("eth-lattice-keyring")),k=e("@keystonehq/metamask-airgapped-keyring"),_=Ue(e("eth-query")),C=Ue(e("nanoid")),E=e("@sentry/browser"),S=e("@metamask/address-book-controller"),M=e("@metamask/approval-controller"),A=e("@metamask/base-controller"),T=e("@metamask/assets-controllers"),P=e("@metamask/phishing-controller"),R=e("@metamask/announcement-controller"),x=e("@metamask/gas-fee-controller"),N=e("@metamask/permission-controller"),O=e("@metamask/subject-metadata-controller"),I=Ue(e("@metamask/smart-transactions-controller")),j=Ue(e("webextension-polyfill")),L=e("../../shared/constants/transaction"),U=e("../../shared/constants/phishing"),B=e("../../shared/constants/swaps"),D=e("../../shared/constants/keyrings"),F=e("../../shared/constants/network"),q=e("../../shared/constants/hardware-wallets"),H=e("../../shared/constants/permissions"),K=e("../../shared/notifications"),$=e("../../shared/modules/hexstring-utils"),G=e("../../shared/constants/time"),V=e("../../shared/constants/app"),z=e("../../shared/constants/metametrics"),W=e("../../ui/helpers/utils/token-util"),Y=e("../../shared/modules/string-utils"),J=e("../../shared/modules/transaction.utils"),X=e("../../shared/constants/tokens"),Z=e("../../shared/lib/metamask-controller-utils"),Q=e("../../shared/modules/mv3.utils"),ee=e("./detect-multiple-instances"),te=Ue(e("./lib/ComposableObservableStore")),re=Ue(e("./lib/account-tracker")),ne=Ue(e("./lib/createDupeReqFilterMiddleware")),se=Ue(e("./lib/createLoggerMiddleware")),oe=e("./lib/rpc-method-middleware"),ie=Ue(e("./lib/createOriginMiddleware")),ae=Ue(e("./lib/createTabIdMiddleware")),ce=Ue(e("./lib/createOnboardingMiddleware")),le=e("./lib/stream-utils"),ue=Ue(e("./controllers/ens")),de=Le(e("./controllers/network")),he=Ue(e("./controllers/preferences")),pe=Ue(e("./controllers/app-state")),fe=Ue(e("./controllers/cached-balances")),me=Ue(e("./controllers/alert")),ge=Ue(e("./controllers/onboarding")),ye=Ue(e("./controllers/backup")),be=Ue(e("./controllers/incoming-transactions")),ve=Le(e("./lib/message-manager")),we=Ue(e("./lib/decrypt-message-manager")),ke=Ue(e("./lib/encryption-public-key-manager")),_e=Ue(e("./lib/personal-message-manager")),Ce=Ue(e("./lib/typed-message-manager")),Ee=Ue(e("./controllers/transactions")),Se=Ue(e("./controllers/detect-tokens")),Me=Ue(e("./controllers/swaps")),Ae=Ue(e("./account-import-strategies")),Te=Ue(e("./lib/seed-phrase-verifier")),Pe=Ue(e("./controllers/metametrics")),Re=e("./lib/segment"),xe=Ue(e("./lib/createMetaRPCHandler")),Ne=e("./lib/util"),Oe=e("./controllers/permissions"),Ie=Ue(e("./lib/createRPCMethodTrackingMiddleware"));function je(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(je=function(e){return e?r:t})(e)}function Le(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=je(t);if(r&&r.has(e))return r.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function Ue(e){return e&&e.__esModule?e:{default:e}}function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange"};class De extends s.default{constructor(e){super(),Be(this,"removePermissionsFor",(e=>{try{this.permissionController.revokePermissions(e)}catch(e){if(!(e instanceof N.PermissionsRequestNotFoundError))throw e}})),Be(this,"rejectPermissionsRequest",(e=>{try{this.permissionController.rejectPermissionsRequest(e)}catch(e){if(!(e instanceof N.PermissionsRequestNotFoundError))throw e}})),Be(this,"acceptPermissionsRequest",(e=>{try{this.permissionController.acceptPermissionsRequest(e)}catch(e){if(!(e instanceof N.PermissionsRequestNotFoundError))throw e}})),Be(this,"resolvePendingApproval",((e,t)=>{try{this.approvalController.accept(e,t)}catch(e){if(!(e instanceof M.ApprovalRequestNotFoundError))throw e}})),Be(this,"rejectPendingApproval",((e,t)=>{try{this.approvalController.reject(e,new m.EthereumRpcError(t.code,t.message,t.data))}catch(e){if(!(e instanceof M.ApprovalRequestNotFoundError))throw e}})),this.defaultMaxListeners=20,this.sendUpdate=(0,l.debounce)(this.privateSendUpdate.bind(this),200*G.MILLISECOND),this.opts=e,this.extension=e.browser,this.platform=e.platform,this.notificationManager=e.notificationManager;const r=e.initState||{},n=this.platform.getVersion();this.recordFirstTimeInfo(r),this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new A.ControllerMessenger,this.localStoreApiWrapper=e.localStore,this.store=new te.default({state:r,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new g.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"===e.reason&&"8.1.0"===n&&this.platform.openExtensionInBrowser()})),this.approvalController=new M.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation}),this.networkController=new de.default(r.NetworkController),this.networkController.setInfuraProjectId(e.infuraProjectId),this.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker;const s=this.controllerMessenger.getRestricted({name:"TokenListController"});this.tokenListController=new T.TokenListController({chainId:(0,Z.hexToDecimal)(this.networkController.getCurrentChainId()),preventPollingOnNetworkRestart:!r.TokenListController||r.TokenListController.preventPollingOnNetworkRestart,onNetworkStateChange:e=>{this.networkController.store.subscribe((t=>{const r={...t,providerConfig:{...t.provider,chainId:(0,Z.hexToDecimal)(t.provider.chainId)}};return e(r)}))},messenger:s,state:r.TokenListController}),this.preferencesController=new he.default({initState:r.PreferencesController,initLangCode:e.initLangCode,openPopup:e.openPopup,network:this.networkController,tokenListController:this.tokenListController,provider:this.provider,migrateAddressBookState:this.migrateAddressBookState.bind(this)}),this.tokensController=new T.TokensController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r={...t,providerConfig:{...t.provider}};return e(r)})),config:{provider:this.provider},state:r.TokensController}),this.assetsContractController=new T.AssetsContractController({onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e),onNetworkStateChange:e=>this.networkController.on(de.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{const t=this.networkController.store.getState(),r={...t,providerConfig:{...t.provider,chainId:(0,Z.hexToDecimal)(t.provider.chainId)}};return e(r)}))},{provider:this.provider},r.AssetsContractController),this.nftController=new T.NftController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r={...t,providerConfig:{...t.provider}};return e(r)})),getERC721AssetName:this.assetsContractController.getERC721AssetName.bind(this.assetsContractController),getERC721AssetSymbol:this.assetsContractController.getERC721AssetSymbol.bind(this.assetsContractController),getERC721TokenURI:this.assetsContractController.getERC721TokenURI.bind(this.assetsContractController),getERC721OwnerOf:this.assetsContractController.getERC721OwnerOf.bind(this.assetsContractController),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),getERC1155TokenURI:this.assetsContractController.getERC1155TokenURI.bind(this.assetsContractController),onNftAdded:({address:e,symbol:t,tokenId:r,standard:n,source:s})=>this.metaMetricsController.trackEvent({event:z.EVENT_NAMES.NFT_ADDED,category:z.EVENT.CATEGORIES.WALLET,properties:{token_contract_address:e,token_symbol:t,asset_type:L.ASSET_TYPES.NFT,token_standard:n,source:s},sensitiveProperties:{tokenId:r}})},{},r.NftController),this.nftController.setApiKey(t.env.OPENSEA_KEY),this.metaMetricsController=new Pe.default({segment:Re.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:this.networkController.on.bind(this.networkController,de.NETWORK_EVENTS.NETWORK_DID_CHANGE),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),version:this.platform.getVersion(),environment:"production",extension:this.extension,initState:r.MetaMetricsController,captureException:E.captureException}),this.on("update",(e=>{this.metaMetricsController.handleMetaMaskStateUpdate(e)}));const o=this.controllerMessenger.getRestricted({name:"GasFeeController"}),i=B.GAS_API_BASE_URL;this.gasFeeController=new x.GasFeeController({state:r.GasFeeController,interval:1e4,messenger:o,clientId:B.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkStateChange:this.networkController.on.bind(this.networkController,de.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${i}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${i}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>this.networkController.getCurrentChainId()===F.CHAIN_IDS.MAINNET,getChainId:()=>this.networkController.getCurrentChainId()}),this.qrHardwareKeyring=new k.MetaMaskKeyring,this.appStateController=new pe.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:r.AppStateController,onInactiveTimeout:()=>this.setLocked(),showUnlockRequest:e.showUserConfirmation,preferencesStore:this.preferencesController.store,qrHardwareStore:this.qrHardwareKeyring.getMemStore()});const a=this.controllerMessenger.getRestricted({name:"CurrencyRateController"});this.currencyRateController=new T.CurrencyRateController({includeUsdRate:!0,messenger:a,state:{...r.CurrencyController,nativeCurrency:this.networkController.providerStore.getState().ticker}}),this.phishingController=new P.PhishingController,this.phishingController.updatePhishingLists(),this.announcementController=new R.AnnouncementController({allAnnouncements:K.UI_NOTIFICATIONS},r.AnnouncementController),this.tokenRatesController=new T.TokenRatesController({onTokensStateChange:e=>this.tokensController.subscribe(e),onCurrencyRateStateChange:e=>this.controllerMessenger.subscribe(`${this.currencyRateController.name}:stateChange`,e),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r={...t,providerConfig:{...t.provider,chainId:(0,Z.hexToDecimal)(t.provider.chainId)}};return e(r)}))},{disabled:!this.preferencesController.store.getState().useCurrencyRateCheck},r.TokenRatesController),this.preferencesController.store.subscribe((0,Ne.previousValueComparator)(((e,t)=>{const{useCurrencyRateCheck:r}=e,{useCurrencyRateCheck:n}=t;n&&!r?(this.currencyRateController.start(),this.tokenRatesController.configure({disabled:!1},!1,!1)):!n&&r&&(this.currencyRateController.stop(),this.tokenRatesController.configure({disabled:!0},!1,!1))}),this.preferencesController.store.getState())),this.ensController=new ue.default({provider:this.provider,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),onNetworkDidChange:this.networkController.on.bind(this.networkController,de.NETWORK_EVENTS.NETWORK_DID_CHANGE)}),this.onboardingController=new ge.default({initState:r.OnboardingController}),this.incomingTransactionsController=new be.default({blockTracker:this.blockTracker,onNetworkDidChange:this.networkController.on.bind(this.networkController,de.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesController:this.preferencesController,onboardingController:this.onboardingController,initState:r.IncomingTransactionsController}),this.accountTracker=new re.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),preferencesController:this.preferencesController,onboardingController:this.onboardingController}),this.on("controllerConnectionChanged",(e=>{const{completedOnboarding:t}=this.onboardingController.store.getState();e>0&&t?this.triggerNetworkrequests():this.stopNetworkRequests()})),this.onboardingController.store.subscribe((0,Ne.previousValueComparator)((async(e,t)=>{const{completedOnboarding:r}=e,{completedOnboarding:n}=t;!r&&n&&this.triggerNetworkrequests()}),this.onboardingController.store.getState())),this.cachedBalancesController=new fe.default({accountTracker:this.accountTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),initState:r.CachedBalancesController}),this.tokensController.hub.on("pendingSuggestedAsset",(async()=>{await e.openPopup()}));let c=[];Q.isManifestV3||(c=[b.default,v.default,w.default,k.MetaMaskKeyring]),this.keyringController=new f.default({keyringTypes:c,initState:r.KeyringController,encryptor:e.encryptor||undefined,cacheEncryptionKey:Q.isManifestV3}),this.keyringController.memStore.subscribe((e=>this._onKeyringControllerUpdate(e))),this.keyringController.on("unlock",(()=>this._onUnlock())),this.keyringController.on("lock",(()=>this._onLock()));const u=()=>this.preferencesController.store.getState().identities;this.permissionController=new N.PermissionController({messenger:this.controllerMessenger.getRestricted({name:"PermissionController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:hasRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`]}),state:r.PermissionController,caveatSpecifications:(0,Oe.getCaveatSpecifications)({getIdentities:u}),permissionSpecifications:{...(0,Oe.getPermissionSpecifications)({getIdentities:u,getAllAccounts:this.keyringController.getAccounts.bind(this.keyringController),captureKeyringTypesWithMissingIdentities:(e={},t=[])=>{const r=t.filter((t=>!e[t])).map((e=>{var t;return null===(t=this.keyringController.getKeyringForAccount(e))||void 0===t?void 0:t.type})),n=Object.keys(e||{}).length,s=Object.keys(this.accountTracker.store.getState().accounts||{}).length;(0,E.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${n} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${s} accounts in the account tracker.`))}})},unrestrictedMethods:Oe.unrestrictedMethods}),this.permissionLogController=new Oe.PermissionLogController({restrictedMethods:new Set(Object.keys(H.RestrictedMethods)),initState:r.PermissionLogController}),this.subjectMetadataController=new O.SubjectMetadataController({messenger:this.controllerMessenger.getRestricted({name:"SubjectMetadataController",allowedActions:[`${this.permissionController.name}:hasPermissions`]}),state:r.SubjectMetadataController,subjectCacheLimit:100}),this.detectTokensController=new Se.default({preferences:this.preferencesController,tokensController:this.tokensController,assetsContractController:this.assetsContractController,network:this.networkController,keyringMemStore:this.keyringController.memStore,tokenList:this.tokenListController,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.addressBookController=new S.AddressBookController(undefined,r.AddressBookController),this.alertController=new me.default({initState:r.AlertController,preferencesStore:this.preferencesController.store}),this.backupController=new ye.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.txController=new Ee.default({initState:r.TransactionController||r.TransactionManager,getPermittedAccounts:this.getPermittedAccounts.bind(this),getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),networkStore:this.networkController.networkStore,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesStore:this.preferencesController.store,txHistoryLimit:60,signTransaction:this.keyringController.signTransaction.bind(this.keyringController),provider:this.provider,blockTracker:this.blockTracker,createEventFragment:this.metaMetricsController.createEventFragment.bind(this.metaMetricsController),updateEventFragment:this.metaMetricsController.updateEventFragment.bind(this.metaMetricsController),finalizeEventFragment:this.metaMetricsController.finalizeEventFragment.bind(this.metaMetricsController),getEventFragmentById:this.metaMetricsController.getEventFragmentById.bind(this.metaMetricsController),trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getExternalPendingTransactions:this.getExternalPendingTransactions.bind(this),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getTokenStandardAndDetails:this.assetsContractController.getTokenStandardAndDetails.bind(this.assetsContractController)}),this.txController.on("newUnapprovedTx",(()=>e.showUserConfirmation())),this.txController.on("tx:status-update",(async(e,t)=>{if(t===L.TRANSACTION_STATUSES.CONFIRMED||t===L.TRANSACTION_STATUSES.FAILED){const t=this.txController.txStateManager.getTransaction(e),i=this.preferencesController.getFrequentRpcListDetail();let a={};if(t.chainId){var r;const e=i.find((e=>t.chainId===e.chainId));a=null!==(r=null==e?void 0:e.rpcPrefs)&&void 0!==r?r:{}}this.platform.showTransactionNotification(t,a);const{txReceipt:c}=t;if(t.type===L.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM&&t.txParams!==undefined){var n,s;const{data:e,to:r,from:o}=t.txParams,{chainId:i}=t,a=(0,J.parseStandardTokenTransactionData)(e),c=null!==(n=(0,W.getTokenIdParam)(a))&&void 0!==n?n:(0,Z.getTokenValueParam)(a),{allNfts:l}=this.nftController.state,u=null==l||null===(s=l[o])||void 0===s?void 0:s[i].find((({address:e,tokenId:t})=>(0,Y.isEqualCaseInsensitive)(e,r)&&t===c));u&&this.nftController.checkAndUpdateSingleNftOwnershipStatus(u,!1,{userAddress:o,chainId:i})}const l=this.getState();var o;if(c&&"0x0"===c.status)this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:z.EVENT.CATEGORIES.BACKGROUND,properties:{action:"Transactions",errorMessage:null===(o=t.simulationFails)||void 0===o?void 0:o.reason,numberOfTokens:l.tokens.length,numberOfAccounts:Object.keys(l.accounts).length}},{matomoEvent:!0})}})),this.networkController.on(de.NETWORK_EVENTS.NETWORK_DID_CHANGE,(async()=>{const{ticker:e}=this.networkController.getProviderConfig();try{await this.currencyRateController.setNativeCurrency(e)}catch(e){console.error(e)}})),this.networkController.lookupNetwork(),this.messageManager=new ve.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.personalMessageManager=new _e.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.decryptMessageManager=new we.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyManager=new ke.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.typedMessageManager=new Ce.default({getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.swapsController=new Me.default({getBufferedGasLimit:this.txController.txGasUtil.getBufferedGasLimit.bind(this.txController.txGasUtil),networkController:this.networkController,provider:this.provider,getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.smartTransactionsController=new I.default({onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getNetwork:this.networkController.getNetworkState.bind(this.networkController),getNonceLock:this.txController.nonceTracker.getNonceLock.bind(this.txController.nonceTracker),confirmExternalTransaction:this.txController.confirmExternalTransaction.bind(this.txController),provider:this.provider,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},{supportedChainIds:[F.CHAIN_IDS.MAINNET,F.CHAIN_IDS.GOERLI]},r.SmartTransactionsController),this.networkController.on(de.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{this.accountTracker._updateAccounts()})),this.networkController.on(de.NETWORK_EVENTS.NETWORK_WILL_CHANGE,(()=>{this.txController.txStateManager.clearUnapprovedTxs(),this.encryptionPublicKeyManager.clearUnapproved(),this.personalMessageManager.clearUnapproved(),this.typedMessageManager.clearUnapproved(),this.decryptMessageManager.clearUnapproved(),this.messageManager.clearUnapproved()})),this.on("update",(e=>this._onStateUpdate(e)));const d={AccountTracker:this.accountTracker.store,TxController:this.txController.memStore,TokenRatesController:this.tokenRatesController,MessageManager:this.messageManager.memStore,PersonalMessageManager:this.personalMessageManager.memStore,DecryptMessageManager:this.decryptMessageManager.memStore,EncryptionPublicKeyManager:this.encryptionPublicKeyManager.memStore,TypesMessageManager:this.typedMessageManager.memStore,SwapsController:this.swapsController.store,EnsController:this.ensController.store,ApprovalController:this.approvalController};this.store.updateStructure({AppStateController:this.appStateController.store,TransactionController:this.txController.store,KeyringController:this.keyringController.store,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,BackupController:this.backupController,AnnouncementController:this.announcementController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,...d}),this.memStore=new te.default({config:{AppStateController:this.appStateController.store,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,KeyringController:this.keyringController.memStore,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,BackupController:this.backupController,AnnouncementController:this.announcementController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,...d},controllerMessenger:this.controllerMessenger});const h=[this.accountTracker.resetState,this.txController.resetState,this.messageManager.resetState,this.personalMessageManager.resetState,this.decryptMessageManager.resetState,this.encryptionPublicKeyManager.resetState,this.typedMessageManager.resetState,this.swapsController.resetState,this.ensController.resetState,this.approvalController.clear.bind(this.approvalController)];Q.isManifestV3?!0===globalThis.isFirstTimeProfileLoaded&&this.resetStates(h):this.resetStates(h),!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding?this._loginUser():this._startUISync(),this.extension.runtime.getPlatformInfo().then((({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")})),this.setupControllerEventSubscriptions(),this.publicConfigStore=this.createPublicConfigStore(),this.extension.runtime.onMessageExternal.addListener(ee.onMessageReceived),(0,ee.checkForMultipleVersionsRunning)()}triggerNetworkrequests(){this.accountTracker.start(),this.incomingTransactionsController.start(),this.preferencesController.store.getState().useCurrencyRateCheck&&this.currencyRateController.start(),this.preferencesController.store.getState().useTokenDetection&&this.tokenListController.start()}stopNetworkRequests(){this.accountTracker.stop(),this.incomingTransactionsController.stop(),this.preferencesController.store.getState().useCurrencyRateCheck&&this.currencyRateController.stop(),this.preferencesController.store.getState().useTokenDetection&&this.tokenListController.stop()}resetStates(e){e.forEach((e=>{try{e()}catch(e){console.error(e)}})),globalThis.isFirstTimeProfileLoaded=!1}setupControllerEventSubscriptions(){const e=async(e,t)=>{this.isUnlocked()&&this.notifyConnections(e,{method:Oe.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:await this.getPermittedAccounts(e)}),this.permissionLogController.updateAccountsHistory(e,t)};let t;this.preferencesController.store.subscribe((async({selectedAddress:r})=>{if(r&&r!==t){t=r;const n=(0,Oe.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[t,s]of n.entries())s.includes(r)&&e(t,s)}})),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,(async(t,r)=>{const n=(0,Oe.getChangedAccounts)(t,r);for(const[t,r]of n.entries())e(t,r)}),Oe.getPermittedAccountsByOrigin)}initializeProvider(){const e=this.platform.getVersion(),t={static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`},version:e,getAccounts:async({origin:e},{suppressUnauthorizedError:t=!0}={})=>{if(e===V.ORIGIN_METAMASK){const e=this.preferencesController.getSelectedAddress();return e?[e]:[]}return this.isUnlocked()?await this.getPermittedAccounts(e,{suppressUnauthorizedError:t}):[]},processTransaction:this.newUnapprovedTransaction.bind(this),processEthSignMessage:this.newUnsignedMessage.bind(this),processTypedMessage:this.newUnsignedTypedMessage.bind(this),processTypedMessageV3:this.newUnsignedTypedMessage.bind(this),processTypedMessageV4:this.newUnsignedTypedMessage.bind(this),processPersonalMessage:this.newUnsignedPersonalMessage.bind(this),processDecryptMessage:this.newRequestDecryptMessage.bind(this),processEncryptionPublicKey:this.newRequestEncryptionPublicKey.bind(this),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.getTransactions({searchCriteria:{hash:e,status:L.TRANSACTION_STATUSES.SUBMITTED}})[0]};return this.networkController.initializeProvider(t)}createPublicConfigStore(){const e=new i.ObservableStore,{networkController:t}=this;function r(r){const n=t.getCurrentChainId();"loading"!==r.network&&e.putState(function(e,{isUnlocked:t,network:r}){return{isUnlocked:t,chainId:e,networkVersion:r}}(n,r))}return this.on("update",r),r(this.getState()),e}async getProviderState(e){return{isUnlocked:this.isUnlocked(),...this.getProviderNetworkState(),accounts:await this.getPermittedAccounts(e)}}getProviderNetworkState(e){const{network:t}=e||this.getState();return{chainId:this.networkController.getCurrentChainId(),networkVersion:t}}getState(){const{vault:e}=this.keyringController.store.getState();return{isInitialized:Boolean(e),...this.memStore.getFlatState()}}getApi(){const{addressBookController:e,alertController:t,appStateController:r,nftController:n,nftDetectionController:s,currencyRateController:o,detectTokensController:i,ensController:a,gasFeeController:c,keyringController:l,metaMetricsController:u,networkController:d,announcementController:h,onboardingController:p,permissionController:f,preferencesController:m,qrHardwareKeyring:g,swapsController:y,tokensController:b,smartTransactionsController:v,txController:w,assetsContractController:k,backupController:_}=this;return{getState:this.getState.bind(this),setCurrentCurrency:o.setCurrentCurrency.bind(o),setUseBlockie:m.setUseBlockie.bind(m),setUseNonceField:m.setUseNonceField.bind(m),setUsePhishDetect:m.setUsePhishDetect.bind(m),setUseMultiAccountBalanceChecker:m.setUseMultiAccountBalanceChecker.bind(m),setUseTokenDetection:m.setUseTokenDetection.bind(m),setUseNftDetection:m.setUseNftDetection.bind(m),setUseCurrencyRateCheck:m.setUseCurrencyRateCheck.bind(m),setOpenSeaEnabled:m.setOpenSeaEnabled.bind(m),setIpfsGateway:m.setIpfsGateway.bind(m),setParticipateInMetaMetrics:u.setParticipateInMetaMetrics.bind(u),setCurrentLocale:m.setCurrentLocale.bind(m),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),addNewAccount:this.addNewAccount.bind(this),verifySeedPhrase:this.verifySeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),setLedgerTransportPreference:this.setLedgerTransportPreference.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),establishLedgerTransportPreference:this.establishLedgerTransportPreference.bind(this),submitQRHardwareCryptoHDKey:g.submitCryptoHDKey.bind(g),submitQRHardwareCryptoAccount:g.submitCryptoAccount.bind(g),cancelSyncQRHardware:g.cancelSync.bind(g),submitQRHardwareSignature:g.submitSignature.bind(g),cancelQRHardwareSignRequest:g.cancelSignRequest.bind(g),fetchInfoToSync:this.fetchInfoToSync.bind(this),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setProviderType:d.setProviderType.bind(d),rollbackToPreviousProvider:d.rollbackToPreviousProvider.bind(d),setCustomRpc:this.setCustomRpc.bind(this),updateAndSetCustomRpc:this.updateAndSetCustomRpc.bind(this),delCustomRpc:this.delCustomRpc.bind(this),addCustomNetwork:this.addCustomNetwork.bind(this),requestAddNetworkApproval:this.requestAddNetworkApproval.bind(this),setSelectedAddress:m.setSelectedAddress.bind(m),addToken:b.addToken.bind(b),rejectWatchAsset:b.rejectWatchAsset.bind(b),acceptWatchAsset:b.acceptWatchAsset.bind(b),updateTokenType:b.updateTokenType.bind(b),setAccountLabel:m.setAccountLabel.bind(m),setFeatureFlag:m.setFeatureFlag.bind(m),setPreference:m.setPreference.bind(m),addKnownMethodData:m.addKnownMethodData.bind(m),setDismissSeedBackUpReminder:m.setDismissSeedBackUpReminder.bind(m),setAdvancedGasFee:m.setAdvancedGasFee.bind(m),setEIP1559V2Enabled:m.setEIP1559V2Enabled.bind(m),setTheme:m.setTheme.bind(m),setImprovedTokenAllowanceEnabled:m.setImprovedTokenAllowanceEnabled.bind(m),setTransactionSecurityCheckEnabled:m.setTransactionSecurityCheckEnabled.bind(m),getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),addNft:n.addNft.bind(n),addNftVerifyOwnership:n.addNftVerifyOwnership.bind(n),removeAndIgnoreNft:n.removeAndIgnoreNft.bind(n),removeNft:n.removeNft.bind(n),checkAndUpdateAllNftsOwnershipStatus:n.checkAndUpdateAllNftsOwnershipStatus.bind(n),checkAndUpdateSingleNftOwnershipStatus:n.checkAndUpdateSingleNftOwnershipStatus.bind(n),isNftOwner:n.isNftOwner.bind(n),setAddressBook:e.set.bind(e),removeFromAddressBook:e.delete.bind(e),setLastActiveTime:r.setLastActiveTime.bind(r),setDefaultHomeActiveTabName:r.setDefaultHomeActiveTabName.bind(r),setConnectedStatusPopoverHasBeenShown:r.setConnectedStatusPopoverHasBeenShown.bind(r),setRecoveryPhraseReminderHasBeenShown:r.setRecoveryPhraseReminderHasBeenShown.bind(r),setRecoveryPhraseReminderLastShown:r.setRecoveryPhraseReminderLastShown.bind(r),setShowTestnetMessageInDropdown:r.setShowTestnetMessageInDropdown.bind(r),setShowPortfolioTooltip:r.setShowPortfolioTooltip.bind(r),setShowBetaHeader:r.setShowBetaHeader.bind(r),setCollectiblesDetectionNoticeDismissed:r.setCollectiblesDetectionNoticeDismissed.bind(r),setEnableEIP1559V2NoticeDismissed:r.setEnableEIP1559V2NoticeDismissed.bind(r),updateCollectibleDropDownState:r.updateCollectibleDropDownState.bind(r),setFirstTimeUsedNetwork:r.setFirstTimeUsedNetwork.bind(r),tryReverseResolveAddress:a.reverseResolveAddress.bind(a),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),exportAccount:l.exportAccount.bind(l),cancelTransaction:w.cancelTransaction.bind(w),updateTransaction:w.updateTransaction.bind(w),updateAndApproveTransaction:w.updateAndApproveTransaction.bind(w),approveTransactionsWithSameNonce:w.approveTransactionsWithSameNonce.bind(w),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getNextNonce:this.getNextNonce.bind(this),addUnapprovedTransaction:w.addUnapprovedTransaction.bind(w),createTransactionEventFragment:w.createTransactionEventFragment.bind(w),getTransactions:w.getTransactions.bind(w),updateEditableParams:w.updateEditableParams.bind(w),updateTransactionGasFees:w.updateTransactionGasFees.bind(w),updateTransactionSendFlowHistory:w.updateTransactionSendFlowHistory.bind(w),updateSwapApprovalTransaction:w.updateSwapApprovalTransaction.bind(w),updateSwapTransaction:w.updateSwapTransaction.bind(w),updatePreviousGasParams:w.updatePreviousGasParams.bind(w),signMessage:this.signMessage.bind(this),cancelMessage:this.cancelMessage.bind(this),signPersonalMessage:this.signPersonalMessage.bind(this),cancelPersonalMessage:this.cancelPersonalMessage.bind(this),signTypedMessage:this.signTypedMessage.bind(this),cancelTypedMessage:this.cancelTypedMessage.bind(this),decryptMessage:this.decryptMessage.bind(this),decryptMessageInline:this.decryptMessageInline.bind(this),cancelDecryptMessage:this.cancelDecryptMessage.bind(this),encryptionPublicKey:this.encryptionPublicKey.bind(this),cancelEncryptionPublicKey:this.cancelEncryptionPublicKey.bind(this),setSeedPhraseBackedUp:p.setSeedPhraseBackedUp.bind(p),completeOnboarding:p.completeOnboarding.bind(p),setFirstTimeFlowType:p.setFirstTimeFlowType.bind(p),setAlertEnabledness:t.setAlertEnabledness.bind(t),setUnconnectedAccountAlertShown:t.setUnconnectedAccountAlertShown.bind(t),setWeb3ShimUsageAlertDismissed:t.setWeb3ShimUsageAlertDismissed.bind(t),removePermissionsFor:this.removePermissionsFor,approvePermissionsRequest:this.acceptPermissionsRequest,rejectPermissionsRequest:this.rejectPermissionsRequest,...(0,Oe.getPermissionBackgroundApiMethods)(f),fetchAndSetQuotes:y.fetchAndSetQuotes.bind(y),setSelectedQuoteAggId:y.setSelectedQuoteAggId.bind(y),resetSwapsState:y.resetSwapsState.bind(y),setSwapsTokens:y.setSwapsTokens.bind(y),clearSwapsQuotes:y.clearSwapsQuotes.bind(y),setApproveTxId:y.setApproveTxId.bind(y),setTradeTxId:y.setTradeTxId.bind(y),setSwapsTxGasPrice:y.setSwapsTxGasPrice.bind(y),setSwapsTxGasLimit:y.setSwapsTxGasLimit.bind(y),setSwapsTxMaxFeePerGas:y.setSwapsTxMaxFeePerGas.bind(y),setSwapsTxMaxFeePriorityPerGas:y.setSwapsTxMaxFeePriorityPerGas.bind(y),safeRefetchQuotes:y.safeRefetchQuotes.bind(y),stopPollingForQuotes:y.stopPollingForQuotes.bind(y),setBackgroundSwapRouteState:y.setBackgroundSwapRouteState.bind(y),resetPostFetchState:y.resetPostFetchState.bind(y),setSwapsErrorKey:y.setSwapsErrorKey.bind(y),setInitialGasEstimate:y.setInitialGasEstimate.bind(y),setCustomApproveTxData:y.setCustomApproveTxData.bind(y),setSwapsLiveness:y.setSwapsLiveness.bind(y),setSwapsFeatureFlags:y.setSwapsFeatureFlags.bind(y),setSwapsUserFeeLevel:y.setSwapsUserFeeLevel.bind(y),setSwapsQuotesPollingLimitEnabled:y.setSwapsQuotesPollingLimitEnabled.bind(y),setSmartTransactionsOptInStatus:v.setOptInState.bind(v),fetchSmartTransactionFees:v.getFees.bind(v),clearSmartTransactionFees:v.clearFees.bind(v),submitSignedTransactions:v.submitSignedTransactions.bind(v),cancelSmartTransaction:v.cancelSmartTransaction.bind(v),fetchSmartTransactionsLiveness:v.fetchLiveness.bind(v),updateSmartTransaction:v.updateSmartTransaction.bind(v),setStatusRefreshInterval:v.setStatusRefreshInterval.bind(v),trackMetaMetricsEvent:u.trackEvent.bind(u),trackMetaMetricsPage:u.trackPage.bind(u),createEventFragment:u.createEventFragment.bind(u),updateEventFragment:u.updateEventFragment.bind(u),finalizeEventFragment:u.finalizeEventFragment.bind(u),resolvePendingApproval:this.resolvePendingApproval,rejectPendingApproval:this.rejectPendingApproval,updateViewedNotifications:h.updateViewed.bind(h),getGasFeeEstimatesAndStartPolling:c.getGasFeeEstimatesAndStartPolling.bind(c),disconnectGasFeeEstimatePoller:c.disconnectPoller.bind(c),getGasFeeTimeEstimate:c.getTimeEstimate.bind(c),addPollingTokenToAppState:r.addPollingToken.bind(r),removePollingTokenFromAppState:r.removePollingToken.bind(r),backupUserData:_.backupUserData.bind(_),restoreUserData:_.restoreUserData.bind(_),detectNewTokens:i.detectNewTokens.bind(i),detectNfts:null,addDetectedTokens:b.addDetectedTokens.bind(b),addImportedTokens:b.addTokens.bind(b),ignoreTokens:b.ignoreTokens.bind(b),getBalancesInSingleCall:k.getBalancesInSingleCall.bind(k)}}async getTokenStandardAndDetails(e,t,r){var n,s;const o=await this.assetsContractController.getTokenStandardAndDetails(e,t,r);return{...o,decimals:null==o||null===(n=o.decimals)||void 0===n?void 0:n.toString(10),balance:null==o||null===(s=o.balance)||void 0===s?void 0:s.toString(10)}}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{let r;if((await this.keyringController.getAccounts()).length>0)r=await this.keyringController.fullUpdate();else{r=await this.keyringController.createNewVaultAndKeychain(e);const t=await this.keyringController.getAccounts();this.preferencesController.setAddresses(t),this.selectFirstIdentity()}return r}finally{t()}}async requestAddNetworkApproval(e,t){try{await this.approvalController.addAndShowApprovalRequest({origin:"metamask",type:"wallet_addEthereumChain",requestData:{chainId:e.chainId,blockExplorerUrl:e.rpcPrefs.blockExplorerUrl,chainName:e.nickname,rpcUrl:e.rpcUrl,ticker:e.ticker,imageUrl:e.rpcPrefs.imageUrl}})}catch(e){if(!t||"User rejected the request."!==e.message)throw e}}async addCustomNetwork(e,t){const{chainId:r,chainName:n,rpcUrl:s,ticker:o,blockExplorerUrl:i}=e;this.preferencesController.addToFrequentRpcList(s,r,o,n,{blockExplorerUrl:i}),this.metaMetricsController.trackEvent({event:"Custom Network Added",category:z.EVENT.CATEGORIES.NETWORK,referrer:{url:V.ORIGIN_METAMASK},properties:{chain_id:r,symbol:o,source:z.EVENT.SOURCE.NETWORK.POPULAR_NETWORK_LIST},actionId:t})}async createNewVaultAndRestore(e,t){const r=await this.createVaultMutex.acquire();try{let s,o;const i=n.from(t),{keyringController:a}=this;this.preferencesController.setAddresses([]),this.permissionController.clearState(),this.accountTracker.clearAccounts(),this.cachedBalancesController.clearCachedBalances(),this.txController.txStateManager.clearUnapprovedTxs();const c=await a.createNewVaultAndRestore(e,i),l=new _.default(this.provider);s=await a.getAccounts(),o=await this.getBalance(s[s.length-1],l);const[u]=a.getKeyringsByType(D.KEYRING_TYPES.HD_KEY_TREE);if(!u)throw new Error("MetamaskController - No HD Key Tree found");for(;"0x0"!==o;)await a.addNewAccount(u),s=await a.getAccounts(),o=await this.getBalance(s[s.length-1],l);s.length>1&&"0x0"===o&&(await this.removeAccount(s[s.length-1]),s=await a.getAccounts());const d=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(d),this.preferencesController.setAddresses(s),this.selectFirstIdentity(),c}finally{r()}}getBalance(e,t){return new Promise(((r,n)=>{const s=this.accountTracker.store.getState().accounts[e];s&&s.balance?r(s.balance):t.getBalance(e,((e,t)=>{e?(n(e),y.default.error(e)):r(t||"0x0")}))}))}async fetchInfoToSync(){const{currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:n,useTokenDetection:s}=this.preferencesController.store.getState(),o=!s&&this.networkController.store.getState().provider.chainId===F.CHAIN_IDS.MAINNET,{tokenList:i}=this.tokenListController.state,a=o?X.STATIC_MAINNET_TOKEN_LIST:i,c={currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:n},{allTokens:l,allIgnoredTokens:u}=this.tokensController.state,d={};Object.keys(l).forEach((e=>{d[e]={},Object.keys(l[e]).forEach((t=>{const r=(0,$.toChecksumHexAddress)(t);d[e][r]=l[e][r].filter((e=>{var t;if(e.isERC721===undefined){if(a[null===(t=e.address)||void 0===t?void 0:t.toLowerCase()]!==undefined)return!0}else if(!1===e.isERC721)return!0;return!1}))}))}));const[h]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.HD_KEY_TREE),p=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.IMPORTED),f=await h.getAccounts(),m=(await Promise.all(p.map((e=>e.getAccounts())))).reduce(((e,t)=>[...e,...t]),[]),g={hd:f.filter(((e,t)=>f.indexOf(e)===t)).map((e=>(0,$.toChecksumHexAddress)(e))),simpleKeyPair:m.filter(((e,t)=>m.indexOf(e)===t)).map((e=>(0,$.toChecksumHexAddress)(e))),ledger:[],trezor:[],lattice:[]};let{transactions:y}=this.txController.store.getState();return y=Object.values(y).filter((e=>{const t=(0,$.toChecksumHexAddress)(e.txParams.from);return g.hd.includes(t)})),{accounts:g,preferences:c,transactions:y,tokens:{allTokens:d,allIgnoredTokens:u},network:this.networkController.store.getState()}}async submitPassword(e){await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){y.default.error("Error while unlocking extension.",e)}const t=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(t),this.keyringController.fullUpdate()}async _loginUser(){try{var e;const t=null===(e={})||void 0===e?void 0:e.PASSWORD;t?await this.submitPassword(t):Q.isManifestV3&&await this.submitEncryptionKey(),await this.accountTracker._updateAccounts()}finally{this._startUISync()}}_startUISync(){this.emit("startUISync"),this.startUISync=!0,this.memStore.subscribe(this.sendUpdate.bind(this))}async submitEncryptionKey(){try{const{loginToken:e,loginSalt:t}=await j.default.storage.session.get(["loginToken","loginSalt"]);if(e&&t){const{vault:r}=this.keyringController.store.getState();if(r.salt!==t)return console.warn("submitEncryptionKey: Stored salt and vault salt do not match"),void await this.clearLoginArtifacts();await this.keyringController.submitEncryptionKey(e,t)}}catch(e){throw await this.clearLoginArtifacts(),e}}async clearLoginArtifacts(){await j.default.storage.session.remove(["loginToken","loginSalt"])}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstIdentity(){const{identities:e}=this.preferencesController.store.getState(),[t]=Object.keys(e);this.preferencesController.setSelectedAddress(t)}getPrimaryKeyringMnemonic(){const[e]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.HD_KEY_TREE);if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}async getKeyringForDevice(e,t=null){let r=null;switch(e){case q.DEVICE_NAMES.TREZOR:r=b.default.type;break;case q.DEVICE_NAMES.LEDGER:r=v.default.type;break;case q.DEVICE_NAMES.QR:r=k.MetaMaskKeyring.type;break;case q.DEVICE_NAMES.LATTICE:r=w.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let[n]=await this.keyringController.getKeyringsByType(r);if(n||(n=await this.keyringController.addNewKeyring(r)),t&&n.setHdPath&&n.setHdPath(t),e===q.DEVICE_NAMES.LATTICE&&(n.appName="MetaMask"),e===q.DEVICE_NAMES.TREZOR){const e=n.getModel();this.appStateController.setTrezorModel(e)}return n.network=this.networkController.getProviderConfig().type,n}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice(q.DEVICE_NAMES.LEDGER);return await e.attemptMakeApp()}async establishLedgerTransportPreference(){const e=this.preferencesController.getLedgerTransportPreference();return await this.setLedgerTransportPreference(e)}async connectHardware(e,t,r){const n=await this.getKeyringForDevice(e,r);let s=[];switch(t){case-1:s=await n.getPreviousPage();break;case 1:s=await n.getNextPage();break;default:s=await n.getFirstPage()}const o=await this.keyringController.getAccounts(),i=[...new Set(o.concat(s.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(i),s}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){return(await this.getKeyringForDevice(e)).forgetDevice(),!0}async getAccountType(e){switch((await this.keyringController.getKeyringForAccount(e)).type){case D.KEYRING_TYPES.TREZOR:case D.KEYRING_TYPES.LATTICE:case D.KEYRING_TYPES.QR:case D.KEYRING_TYPES.LEDGER:return"hardware";case D.KEYRING_TYPES.IMPORTED:return"imported";default:return"MetaMask"}}async getDeviceModel(e){const t=await this.keyringController.getKeyringForAccount(e);switch(t.type){case D.KEYRING_TYPES.TREZOR:return t.getModel();case D.KEYRING_TYPES.QR:return t.getName();case D.KEYRING_TYPES.LEDGER:return q.DEVICE_NAMES.LEDGER;case D.KEYRING_TYPES.LATTICE:return q.DEVICE_NAMES.LATTICE;default:return"N/A"}}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,n){const s=await this.getKeyringForDevice(t,r);s.setAccountToUnlock(e);const o=await this.keyringController.getAccounts(),i=await this.keyringController.addNewAccount(s),a=await this.keyringController.getAccounts();this.preferencesController.setAddresses(a),a.forEach((r=>{if(!o.includes(r)){const o=this.getAccountLabel(t===q.DEVICE_NAMES.QR?s.getName():t,e,n);this.preferencesController.setAccountLabel(r,o),this.preferencesController.setSelectedAddress(r)}}));const{identities:c}=this.preferencesController.store.getState();return{...i,identities:c}}async addNewAccount(e){const[t]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.HD_KEY_TREE);if(!t)throw new Error("MetamaskController - No HD Key Tree found");const{keyringController:r}=this,{identities:n}=this.preferencesController.store.getState();if(Object.keys(n).length===e){const e=await r.getAccounts(),n=await r.addNewAccount(t),s=await r.getAccounts();await this.verifySeedPhrase(),this.preferencesController.setAddresses(s),s.forEach((t=>{e.includes(t)||this.preferencesController.setSelectedAddress(t)}));const{identities:o}=this.preferencesController.store.getState();return{...n,identities:o}}return{...r.memStore.getState(),identities:n}}async verifySeedPhrase(){const[e]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.HD_KEY_TREE);if(!e)throw new Error("MetamaskController - No HD Key Tree found");const t=await e.serialize(),r=n.from(t.mnemonic),s=await e.getAccounts();if(s.length<1)throw new Error("MetamaskController - No accounts found");try{return await Te.default.verifyAccounts(s,r),Array.from(r.values())}catch(e){throw y.default.error(e.message),e}}async resetAccount(){const e=this.preferencesController.getSelectedAddress();return this.txController.wipeTransactions(e),this.networkController.resetConnection(),e}async getPermittedAccounts(e,{suppressUnauthorizedError:t=!0}={}){try{return await this.permissionController.executeRestrictedMethod(e,H.RestrictedMethods.eth_accounts)}catch(e){if(t&&e.code===m.errorCodes.provider.unauthorized)return[];throw e}}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(H.CaveatTypes.restrictReturnedAccounts,(t=>Oe.CaveatMutatorFactories[H.CaveatTypes.restrictReturnedAccounts].removeAccount(e,t)))}async removeAccount(e){this.removeAllAccountPermissions(e),this.preferencesController.removeAddress(e),this.accountTracker.removeAccount([e]);const t=await this.keyringController.getKeyringForAccount(e);await this.keyringController.removeAccount(e);const r=t?await t.getAccounts():{};var n;0===(null==r?void 0:r.length)&&(null===(n=t.destroy)||void 0===n||n.call(t));return e}async importAccountWithStrategy(e,t){const r=await Ae.default.importAccount(e,t),n=await this.keyringController.addNewKeyring(D.KEYRING_TYPES.IMPORTED,[r]),[s]=await n.getAccounts(),o=await this.keyringController.getAccounts();this.preferencesController.setAddresses(o),this.preferencesController.setSelectedAddress(s)}async newUnapprovedTransaction(e,t){return await this.txController.newUnapprovedTransaction(e,t)}async newUnsignedMessage(e,t){const r=(0,ve.normalizeMsgData)(e.data);let n;if(66!==r.length&&67!==r.length)throw m.ethErrors.rpc.invalidParams("eth_sign requires 32 byte message hash");return n=this.messageManager.addUnapprovedMessageAsync(e,t),this.sendUpdate(),this.opts.showUserConfirmation(),await n}async signMessage(e){y.default.info("MetaMaskController - signMessage");const t=e.metamaskId;try{const r=await this.messageManager.approveMessage(e),n=await this.keyringController.signMessage(r);return this.messageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw y.default.info("MetaMaskController - eth_sign failed",e),this.messageManager.errorMessage(t,e),e}}cancelMessage(e){const{messageManager:t}=this;return t.rejectMsg(e),this.getState()}async newUnsignedPersonalMessage(e,t){const r=this.personalMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async signPersonalMessage(e){y.default.info("MetaMaskController - signPersonalMessage");const t=e.metamaskId;try{const r=await this.personalMessageManager.approveMessage(e),n=await this.keyringController.signPersonalMessage(r);return this.personalMessageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw y.default.info("MetaMaskController - eth_personalSign failed",e),this.personalMessageManager.errorMessage(t,e),e}}cancelPersonalMessage(e){return this.personalMessageManager.rejectMsg(e),this.getState()}async newRequestDecryptMessage(e,t){const r=this.decryptMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async decryptMessageInline(e){y.default.info("MetaMaskController - decryptMessageInline");const t=e.metamaskId,r=this.decryptMessageManager.getMsg(t);try{const t=(0,$.stripHexPrefix)(e.data),s=n.from(t,"hex");e.data=JSON.parse(s.toString("utf8")),r.rawData=await this.keyringController.decryptMessage(e)}catch(e){r.error=e.message}return this.decryptMessageManager._updateMsg(r),this.getState()}async decryptMessage(e){y.default.info("MetaMaskController - decryptMessage");const t=e.metamaskId;try{const r=await this.decryptMessageManager.approveMessage(e),s=(0,$.stripHexPrefix)(r.data),o=n.from(s,"hex");r.data=JSON.parse(o.toString("utf8"));const i=await this.keyringController.decryptMessage(r);this.decryptMessageManager.setMsgStatusDecrypted(t,i)}catch(e){y.default.info("MetaMaskController - eth_decrypt failed.",e),this.decryptMessageManager.errorMessage(t,e)}return this.getState()}cancelDecryptMessage(e){return this.decryptMessageManager.rejectMsg(e),this.getState()}async newRequestEncryptionPublicKey(e,t){const r=e;switch((await this.keyringController.getKeyringForAccount(r)).type){case D.KEYRING_TYPES.LEDGER:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case D.KEYRING_TYPES.TREZOR:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case D.KEYRING_TYPES.LATTICE:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case D.KEYRING_TYPES.QR:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:{const r=this.encryptionPublicKeyManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}}}async encryptionPublicKey(e){y.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),n=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,n)}catch(e){y.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}cancelEncryptionPublicKey(e){return this.encryptionPublicKeyManager.rejectMsg(e),this.getState()}newUnsignedTypedMessage(e,t,r){const n=this.typedMessageManager.addUnapprovedMessageAsync(e,t,r);return this.sendUpdate(),this.opts.showUserConfirmation(),n}async signTypedMessage(e){y.default.info("MetaMaskController - eth_signTypedData");const t=e.metamaskId,{version:r}=e;try{const n=await this.typedMessageManager.approveMessage(e);"V1"!==r&&"string"==typeof n.data&&(n.data=JSON.parse(n.data));const s=await this.keyringController.signTypedMessage(n,{version:r});return this.typedMessageManager.setMsgStatusSigned(t,s),this.getState()}catch(e){throw y.default.info("MetaMaskController - eth_signTypedData failed.",e),this.typedMessageManager.errorMessage(t,e),e}}cancelTypedMessage(e){return this.typedMessageManager.rejectMsg(e),this.getState()}async getCurrentAccountEIP1559Compatibility(){return!0}async createCancelTransaction(e,t,r){await this.txController.createCancelTransaction(e,t,r);return this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.createSpeedUpTransaction(e,t,r);return this.getState()}estimateGas(e){return new Promise(((t,r)=>this.txController.txGasUtil.query.estimateGas(e,((e,n)=>e?r(e):t(n.toString(16))))))}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setupUntrustedCommunication({connectionStream:e,sender:t,subjectType:r}){const{usePhishDetect:n}=this.preferencesController.store.getState();let s;if(s=r||(t.id&&t.id!==this.extension.runtime.id?V.SUBJECT_TYPES.EXTENSION:V.SUBJECT_TYPES.WEBSITE),t.url){const{hostname:r}=new URL(t.url);this.phishingController.isOutOfDate()&&this.phishingController.updatePhishingLists();const s=this.phishingController.test(r);if(n&&null!=s&&s.result)return void this.sendPhishingWarning(e,r,s)}const o=(0,le.setupMultiplex)(e);this.setupProviderConnection(o.createStream("metamask-provider"),t,s),t.url&&this.setupPublicConfig(o.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,le.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,V.SUBJECT_TYPES.INTERNAL)}setupPhishingCommunication({connectionStream:e}){const{usePhishDetect:t}=this.preferencesController.store.getState();if(!t)return;const r=(0,le.setupMultiplex)(e).createStream("metamask-phishing-safelist");r.on("data",(0,xe.default)({safelistPhishingDomain:this.safelistPhishingDomain.bind(this)},r))}sendPhishingWarning(e,t,r){const n=U.PHISHING_NEW_ISSUE_URLS[null==r?void 0:r.name];(0,le.setupMultiplex)(e).createStream("phishing").write({hostname:t,newIssueUrl:n})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,xe.default)(t,e,this.store,this.localStoreApiWrapper));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r);const n=()=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"startUISync"})};this.startUISync?n():this.once("startUISync",n),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){let n,s;n=r===V.SUBJECT_TYPES.INTERNAL?V.ORIGIN_METAMASK:new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:n,extensionId:t.id,subjectType:V.SUBJECT_TYPES.EXTENSION}),t.tab&&t.tab.id&&(s=t.tab.id);const i=this.setupProviderEngine({origin:n,sender:t,subjectType:r,tabId:s}),a=(0,u.default)({engine:i}),c=this.addConnection(n,{engine:i});(0,o.default)(e,a,e,(e=>{i._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),c&&this.removeConnection(n,c),e&&y.default.error(e)}))}setupProviderEngine({origin:e,subjectType:t,sender:r,tabId:n}){const s=new c.JsonRpcEngine,{blockTracker:o,provider:i}=this,a=(0,d.default)({provider:i,blockTracker:o}),l=(0,h.default)({provider:i,blockTracker:o});return l.events.on("notification",(e=>s.emit("notification",e))),Q.isManifestV3&&s.push((0,ne.default)()),s.push((0,ie.default)({origin:e})),n&&s.push((0,ae.default)({tabId:n})),s.push((0,se.default)({origin:e})),s.push(this.permissionLogController.createMiddleware()),s.push((0,Ie.default)({trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getMetricsState:this.metaMetricsController.store.getState.bind(this.metaMetricsController.store)})),t===V.SUBJECT_TYPES.WEBSITE&&s.push((0,ce.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding})),s.push((0,oe.createMethodMiddleware)({origin:e,subjectType:t,addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),getProviderState:this.getProviderState.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),handleWatchAssetRequest:this.tokensController.watchAsset.bind(this.tokensController),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),requestAccountsPermission:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e},{eth_accounts:{}}),requestPermissionsForOrigin:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e}),addCustomRpc:async({chainId:e,blockExplorerUrl:t,ticker:r,chainName:n,rpcUrl:s}={})=>{await this.preferencesController.addToFrequentRpcList(s,e,r,n,{blockExplorerUrl:t})},findCustomRpcBy:this.findCustomRpcBy.bind(this),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getCurrentRpcUrl:this.networkController.getCurrentRpcUrl.bind(this.networkController),setProviderType:this.networkController.setProviderType.bind(this.networkController),updateRpcTarget:({rpcUrl:e,chainId:t,ticker:r,nickname:n})=>{this.networkController.setRpcTarget(e,t,r,n)},getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController)})),s.push(a),s.push(l.middleware),t!==V.SUBJECT_TYPES.INTERNAL&&s.push(this.permissionController.createPermissionMiddleware({origin:e})),s.push((0,p.providerAsMiddleware)(i)),s}setupPublicConfig(e){const t=(0,a.storeAsStream)(this.publicConfigStore);(0,o.default)(t,e,(e=>{t.destroy(),e&&y.default.error(e)}))}addConnection(e,{engine:t}){if(e===V.ORIGIN_METAMASK)return null;this.connections[e]||(this.connections[e]={});const r=(0,C.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach((t=>{this.removeConnection(e,t)}))}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{r.engine&&r.engine.emit("notification",await t(e))}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t,encryptionKey:r,encryptionSalt:n}=e,s=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);Q.isManifestV3&&await j.default.storage.session.set({loginToken:r,loginSalt:n}),s.length&&(this.preferencesController.syncAddresses(s),this.accountTracker.syncWithAddresses(s))}_onUnlock(){this.notifyAllConnections((async e=>({method:Oe.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.getPermittedAccounts(e)}}))),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:Oe.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this.notifyAllConnections({method:Oe.NOTIFICATION_NAMES.chainChanged,params:this.getProviderNetworkState(e)})}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.memStore.getState().isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async getPendingNonce(e){const{nonceDetails:t,releaseLock:r}=await this.txController.nonceTracker.getNonceLock(e),n=t.params.highestSuggested;return r(),n}async getNextNonce(e){const t=await this.txController.nonceTracker.getNonceLock(e);return t.releaseLock(),t.nextNonce}async migrateAddressBookState(e,t,r=!1){const{addressBook:n}=this.addressBookController.state;if(n[e])for(const s of Object.keys(n[e])){const o=n[e][s];this.addressBookController.set(s,o.name,t,o.memo),r||this.addressBookController.delete(e,s)}}async updateAndSetCustomRpc(e,t,r="ETH",n,s){return this.networkController.setRpcTarget(e,t,r,n,s),await this.preferencesController.updateRpc({rpcUrl:e,chainId:t,ticker:r,nickname:n,rpcPrefs:s}),e}async setCustomRpc(e,t,r="ETH",n="",s={}){const o=this.preferencesController.getFrequentRpcListDetail().find((t=>e===t.rpcUrl));return o?this.networkController.setRpcTarget(o.rpcUrl,o.chainId,o.ticker,o.nickname,s):(this.networkController.setRpcTarget(e,t,r,n,s),await this.preferencesController.addToFrequentRpcList(e,t,r,n,s)),e}async delCustomRpc(e){await this.preferencesController.removeFromFrequentRpcList(e)}findCustomRpcBy(e){const t=this.preferencesController.getFrequentRpcListDetail();for(const r of t)for(const t of Object.keys(e))if(r[t]===e[t])return r;return null}async setLedgerTransportPreference(e){const t=this.preferencesController.getLedgerTransportPreference(),r=this.preferencesController.setLedgerTransportPreference(e),n=await this.getKeyringForDevice(q.DEVICE_NAMES.LEDGER);return null!=n&&n.updateTransportMethod?n.updateTransportMethod(r).catch((e=>{throw this.preferencesController.setLedgerTransportPreference(t),e})):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e,this.detectTokensController.isOpen=e}onClientClosed(){try{this.gasFeeController.stopPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=V.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.disconnectPoller(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}setLocked(){var e;const[t]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.TREZOR);t&&t.dispose();const[r]=this.keyringController.getKeyringsByType(D.KEYRING_TYPES.LEDGER);return null==r||null===(e=r.destroy)||void 0===e||e.call(r),Q.isManifestV3&&this.clearLoginArtifacts(),this.keyringController.setLocked()}}r.default=De}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"$root$"}],[89,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:2,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[9,{"../../../shared/modules/string-utils":5432},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../shared/modules/string-utils");r.default=class{constructor(e={}){const{preferencesController:t,addressBookController:r,trackMetaMetricsEvent:n}=e;this.preferencesController=t,this.addressBookController=r,this._trackMetaMetricsEvent=n}async restoreUserData(e){const t=this.preferencesController.store.getState(),{preferences:r,addressBook:n}=JSON.parse(e);r&&(r.identities=t.identities,r.lostIdentities=t.lostIdentities,r.selectedAddress=t.selectedAddress,this.preferencesController.store.updateState(r)),n&&this.addressBookController.update(n,!0),r&&n&&this._trackMetaMetricsEvent({event:"User Data Imported",category:"Backup"})}async backupUserData(){const e={preferences:{...this.preferencesController.store.getState()},addressBook:{...this.addressBookController.state}};delete e.preferences.identities,delete e.preferences.lostIdentities,delete e.preferences.selectedAddress;const t=JSON.stringify(e),r=new Date,s=e=>(0,n.prependZero)(e,2);return{fileName:`MetaMaskUserData.${r.getFullYear()}_${s(r.getMonth()+1)}_${s(r.getDay())}_${s(r.getHours())}_${s(r.getMinutes())}_${s(r.getDay())}.json`,data:t}}}}}},{package:"$root$"}],[90,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:3,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[91,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:4,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[92,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:5,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r={...e,KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}};return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[93,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:6,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r={...e,PreferencesController:{selectedAddress:t.selectedAccount}};return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[94,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:7,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t={...e,TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}};return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[95,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:8,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t={...e,NoticeController:{noticesList:e.noticesList||[]}};return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[96,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:9,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,n.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[964,{"@metamask/base-controller":969,"@metamask/controller-utils":1024},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.AddressBookController=void 0;const n=e("@metamask/controller-utils"),s=e("@metamask/base-controller");class o extends s.BaseController{constructor(e,t){super(e,t),this.name="AddressBookController",this.defaultState={addressBook:{}},this.initialize()}clear(){this.update({addressBook:{}})}delete(e,t){if(t=(0,n.toChecksumHexAddress)(t),!(0,n.isValidHexAddress)(t)||!this.state.addressBook[e]||!this.state.addressBook[e][t])return!1;const r=Object.assign({},this.state.addressBook);return delete r[e][t],0===Object.keys(r[e]).length&&delete r[e],this.update({addressBook:r}),!0}set(e,t,r="1",s=""){if(e=(0,n.toChecksumHexAddress)(e),!(0,n.isValidHexAddress)(e))return!1;const o={address:e,chainId:r,isEns:!1,memo:s,name:t},i=(0,n.normalizeEnsName)(t);return i&&(o.name=i,o.isEns=!0),this.update({addressBook:Object.assign(Object.assign({},this.state.addressBook),{[r]:Object.assign(Object.assign({},this.state.addressBook[r]),{[e]:o})})}),!0}}r.AddressBookController=o,r.default=o}}},{package:"@metamask/address-book-controller"}],[965,{"./AddressBookController":964},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./AddressBookController"),r)}}},{package:"@metamask/address-book-controller"}],[966,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BaseController=void 0;class n{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,r=!0){if(r){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e in this.internalConfig)void 0!==this.internalConfig[e]&&(this[e]=this.internalConfig[e])}else for(const t in e)void 0!==this.internalConfig[t]&&(this.internalConfig[t]=e[t],this[t]=e[t])}notify(){this.disabled||this.internalListeners.forEach((e=>{e(this.internalState)}))}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex((t=>e===t));return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}r.BaseController=n,r.default=n}}},{package:"@metamask/address-book-controller>@metamask/base-controller"}],[967,{immer:4530},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseController=void 0;const n=e("immer");(0,n.enablePatches)();function s(e,t,r){return Object.keys(e).reduce(((n,s)=>{const o=t[s][r],i=e[s];return"function"==typeof o?n[s]=o(i):o&&(n[s]=i),n}),{})}r.BaseController=class{constructor({messenger:e,metadata:t,name:r,state:n}){this.messagingSystem=e,this.name=r,this.internalState=n,this.metadata=t,this.messagingSystem.registerActionHandler(`${r}:getState`,(()=>this.state))}get state(){return this.internalState}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,r]=n.produceWithPatches(this.internalState,e);this.internalState=t,this.messagingSystem.publish(`${this.name}:stateChange`,t,r)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},r.getAnonymizedState=function(e,t){return s(e,t,"anonymous")},r.getPersistentState=function(e,t){return s(e,t,"persist")}}}},{package:"@metamask/address-book-controller>@metamask/base-controller"}],[968,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ControllerMessenger=r.RestrictedControllerMessenger=void 0;class n{constructor({controllerMessenger:e,name:t,allowedActions:r,allowedEvents:n}){this.controllerMessenger=e,this.controllerName=t,this.allowedActions=r||null,this.allowedEvents=n||null}registerActionHandler(e,t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed registering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.registerActionHandler(e,t)}unregisterActionHandler(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed unregistering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.unregisterActionHandler(e)}call(e,...t){if(null===this.allowedActions)throw new Error("No actions allowed");if(!this.allowedActions.includes(e))throw new Error(`Action missing from allow list: ${e}`);return this.controllerMessenger.call(e,...t)}publish(e,...t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed publishing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.publish(e,...t)}subscribe(e,t,r){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);return r?this.controllerMessenger.subscribe(e,t,r):this.controllerMessenger.subscribe(e,t)}unsubscribe(e,t){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);this.controllerMessenger.unsubscribe(e,t)}clearEventSubscriptions(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed clearing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.clearEventSubscriptions(e)}}r.RestrictedControllerMessenger=n;r.ControllerMessenger=class{constructor(){this.actions=new Map,this.events=new Map,this.eventPayloadCache=new Map}registerActionHandler(e,t){if(this.actions.has(e))throw new Error(`A handler for ${e} has already been registered`);this.actions.set(e,t)}unregisterActionHandler(e){this.actions.delete(e)}clearActions(){this.actions.clear()}call(e,...t){const r=this.actions.get(e);if(!r)throw new Error(`A handler for ${e} has not been registered`);return r(...t)}publish(e,...t){const r=this.events.get(e);if(r)for(const[e,n]of r.entries())if(n){const r=this.eventPayloadCache.get(e),s=n(...t);s!==r&&(this.eventPayloadCache.set(e,s),e(s,r))}else e(...t)}subscribe(e,t,r){let n=this.events.get(e);n||(n=new Map,this.events.set(e,n)),n.set(t,r)}unsubscribe(e,t){const r=this.events.get(e);if(!r||!r.has(t))throw new Error(`Subscription not found for event: ${e}`);r.get(t)&&this.eventPayloadCache.delete(t),r.delete(t)}clearEventSubscriptions(e){this.events.delete(e)}clearSubscriptions(){this.events.clear()}getRestricted({name:e,allowedActions:t,allowedEvents:r}){return new n({controllerMessenger:this,name:e,allowedActions:t,allowedEvents:r})}}}}},{package:"@metamask/address-book-controller>@metamask/base-controller"}],[969,{"./BaseController":966,"./BaseControllerV2":967,"./ControllerMessenger":968},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseControllerV2=r.BaseController=void 0;var o=e("./BaseController");Object.defineProperty(r,"BaseController",{enumerable:!0,get:function(){return o.BaseController}});var i=e("./BaseControllerV2");Object.defineProperty(r,"BaseControllerV2",{enumerable:!0,get:function(){return i.BaseController}}),Object.defineProperty(r,"getAnonymizedState",{enumerable:!0,get:function(){return i.getAnonymizedState}}),Object.defineProperty(r,"getPersistentState",{enumerable:!0,get:function(){return i.getPersistentState}}),s(e("./ControllerMessenger"),r)}}},{package:"@metamask/address-book-controller>@metamask/base-controller"}],[97,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:10,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,n.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[970,{"@metamask/base-controller":975},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.AnnouncementController=void 0;const n=e("@metamask/base-controller"),s={announcements:{}};class o extends n.BaseController{constructor(e,t){super(e,t||s),this.initialize(),this._addAnnouncements()}_addAnnouncements(){const e={},{allAnnouncements:t}=this.config;Object.values(t).forEach((t=>{e[t.id]=this.state.announcements[t.id]?this.state.announcements[t.id]:Object.assign(Object.assign({},t),{isShown:!1})})),this.update({announcements:e})}updateViewed(e){const t=this.state.announcements;for(const r of Object.keys(e).map(Number))t[r].isShown=e[r];this.update({announcements:t},!0)}}r.AnnouncementController=o}}},{package:"@metamask/announcement-controller"}],[971,{"./AnnouncementController":970},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./AnnouncementController"),r)}}},{package:"@metamask/announcement-controller"}],[972,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BaseController=void 0;class n{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,r=!0){if(r){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e in this.internalConfig)void 0!==this.internalConfig[e]&&(this[e]=this.internalConfig[e])}else for(const t in e)void 0!==this.internalConfig[t]&&(this.internalConfig[t]=e[t],this[t]=e[t])}notify(){this.disabled||this.internalListeners.forEach((e=>{e(this.internalState)}))}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex((t=>e===t));return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}r.BaseController=n,r.default=n}}},{package:"@metamask/announcement-controller>@metamask/base-controller"}],[973,{immer:4530},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseController=void 0;const n=e("immer");(0,n.enablePatches)();function s(e,t,r){return Object.keys(e).reduce(((n,s)=>{const o=t[s][r],i=e[s];return"function"==typeof o?n[s]=o(i):o&&(n[s]=i),n}),{})}r.BaseController=class{constructor({messenger:e,metadata:t,name:r,state:n}){this.messagingSystem=e,this.name=r,this.internalState=n,this.metadata=t,this.messagingSystem.registerActionHandler(`${r}:getState`,(()=>this.state))}get state(){return this.internalState}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,r]=n.produceWithPatches(this.internalState,e);this.internalState=t,this.messagingSystem.publish(`${this.name}:stateChange`,t,r)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},r.getAnonymizedState=function(e,t){return s(e,t,"anonymous")},r.getPersistentState=function(e,t){return s(e,t,"persist")}}}},{package:"@metamask/announcement-controller>@metamask/base-controller"}],[974,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ControllerMessenger=r.RestrictedControllerMessenger=void 0;class n{constructor({controllerMessenger:e,name:t,allowedActions:r,allowedEvents:n}){this.controllerMessenger=e,this.controllerName=t,this.allowedActions=r||null,this.allowedEvents=n||null}registerActionHandler(e,t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed registering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.registerActionHandler(e,t)}unregisterActionHandler(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed unregistering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.unregisterActionHandler(e)}call(e,...t){if(null===this.allowedActions)throw new Error("No actions allowed");if(!this.allowedActions.includes(e))throw new Error(`Action missing from allow list: ${e}`);return this.controllerMessenger.call(e,...t)}publish(e,...t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed publishing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.publish(e,...t)}subscribe(e,t,r){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);return r?this.controllerMessenger.subscribe(e,t,r):this.controllerMessenger.subscribe(e,t)}unsubscribe(e,t){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);this.controllerMessenger.unsubscribe(e,t)}clearEventSubscriptions(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed clearing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.clearEventSubscriptions(e)}}r.RestrictedControllerMessenger=n;r.ControllerMessenger=class{constructor(){this.actions=new Map,this.events=new Map,this.eventPayloadCache=new Map}registerActionHandler(e,t){if(this.actions.has(e))throw new Error(`A handler for ${e} has already been registered`);this.actions.set(e,t)}unregisterActionHandler(e){this.actions.delete(e)}clearActions(){this.actions.clear()}call(e,...t){const r=this.actions.get(e);if(!r)throw new Error(`A handler for ${e} has not been registered`);return r(...t)}publish(e,...t){const r=this.events.get(e);if(r)for(const[e,n]of r.entries())if(n){const r=this.eventPayloadCache.get(e),s=n(...t);s!==r&&(this.eventPayloadCache.set(e,s),e(s,r))}else e(...t)}subscribe(e,t,r){let n=this.events.get(e);n||(n=new Map,this.events.set(e,n)),n.set(t,r)}unsubscribe(e,t){const r=this.events.get(e);if(!r||!r.has(t))throw new Error(`Subscription not found for event: ${e}`);r.get(t)&&this.eventPayloadCache.delete(t),r.delete(t)}clearEventSubscriptions(e){this.events.delete(e)}clearSubscriptions(){this.events.clear()}getRestricted({name:e,allowedActions:t,allowedEvents:r}){return new n({controllerMessenger:this,name:e,allowedActions:t,allowedEvents:r})}}}}},{package:"@metamask/announcement-controller>@metamask/base-controller"}],[975,{"./BaseController":972,"./BaseControllerV2":973,"./ControllerMessenger":974},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseControllerV2=r.BaseController=void 0;var o=e("./BaseController");Object.defineProperty(r,"BaseController",{enumerable:!0,get:function(){return o.BaseController}});var i=e("./BaseControllerV2");Object.defineProperty(r,"BaseControllerV2",{enumerable:!0,get:function(){return i.BaseController}}),Object.defineProperty(r,"getAnonymizedState",{enumerable:!0,get:function(){return i.getAnonymizedState}}),Object.defineProperty(r,"getPersistentState",{enumerable:!0,get:function(){return i.getPersistentState}}),s(e("./ControllerMessenger"),r)}}},{package:"@metamask/announcement-controller>@metamask/base-controller"}],[976,{"./errors":977,"@metamask/base-controller":982,"eth-rpc-errors":2103,nanoid:983},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ApprovalController=void 0;const n=e("eth-rpc-errors"),s=e("nanoid"),o=e("@metamask/base-controller"),i=e("./errors"),a="ApprovalController",c={pendingApprovals:{persist:!1,anonymous:!0},pendingApprovalCount:{persist:!1,anonymous:!1}};class l extends o.BaseControllerV2{constructor({messenger:e,showApprovalRequest:t,state:r={}}){super({name:a,metadata:c,messenger:e,state:Object.assign(Object.assign({},{pendingApprovals:{},pendingApprovalCount:0}),r)}),this._approvals=new Map,this._origins=new Map,this._showApprovalRequest=t,this.registerMessageHandlers()}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${a}:clearRequests`,this.clear.bind(this)),this.messagingSystem.registerActionHandler(`${a}:addRequest`,((e,t)=>t?this.addAndShowApprovalRequest(e):this.add(e))),this.messagingSystem.registerActionHandler(`${a}:hasRequest`,this.has.bind(this)),this.messagingSystem.registerActionHandler(`${a}:acceptRequest`,this.accept.bind(this)),this.messagingSystem.registerActionHandler(`${a}:rejectRequest`,this.reject.bind(this))}addAndShowApprovalRequest(e){const t=this._add(e.origin,e.type,e.id,e.requestData);return this._showApprovalRequest(),t}add(e){return this._add(e.origin,e.type,e.id,e.requestData)}get(e){return this.state.pendingApprovals[e]}getApprovalCount(e={}){var t,r;if(!e.origin&&!e.type)throw new Error("Must specify origin, type, or both.");const{origin:n,type:s}=e;if(n&&s)return Number(Boolean(null===(t=this._origins.get(n))||void 0===t?void 0:t.has(s)));if(n)return(null===(r=this._origins.get(n))||void 0===r?void 0:r.size)||0;let o=0;for(const e of Object.values(this.state.pendingApprovals))e.type===s&&(o+=1);return o}getTotalApprovalCount(){return this.state.pendingApprovalCount}has(e={}){var t;const{id:r,origin:n,type:s}=e;if(r){if("string"!=typeof r)throw new Error("May not specify non-string id.");return this._approvals.has(r)}if(s&&"string"!=typeof s)throw new Error("May not specify non-string type.");if(n){if("string"!=typeof n)throw new Error("May not specify non-string origin.");return s?Boolean(null===(t=this._origins.get(n))||void 0===t?void 0:t.has(s)):this._origins.has(n)}if(s){for(const e of Object.values(this.state.pendingApprovals))if(e.type===s)return!0;return!1}throw new Error("Must specify a valid combination of id, origin, and type.")}accept(e,t){this._deleteApprovalAndGetCallbacks(e).resolve(t)}reject(e,t){this._deleteApprovalAndGetCallbacks(e).reject(t)}clear(e){for(const t of this._approvals.keys())this.reject(t,e);this._origins.clear(),this.update((()=>({pendingApprovals:{},pendingApprovalCount:0})))}_add(e,t,r=(0,s.nanoid)(),o){var i;if(this._validateAddParams(r,e,t,o),null===(i=this._origins.get(e))||void 0===i?void 0:i.has(t))throw n.ethErrors.rpc.resourceUnavailable(((e,t)=>`Request of type '${t}' already pending for origin ${e}. Please wait.`)(e,t));return new Promise(((n,s)=>{this._approvals.set(r,{resolve:n,reject:s}),this._addPendingApprovalOrigin(e,t),this._addToStore(r,e,t,o)}))}_validateAddParams(e,t,r,s){let o=null;if(e&&"string"==typeof e?this._approvals.has(e)?o=`Approval request with id '${e}' already exists.`:t&&"string"==typeof t?r&&"string"==typeof r?s&&("object"!=typeof s||Array.isArray(s))&&(o="Request data must be a plain object if specified."):o="Must specify non-empty string type.":o="Must specify non-empty string origin.":o="Must specify non-empty string id.",o)throw n.ethErrors.rpc.internal(o)}_addPendingApprovalOrigin(e,t){const r=this._origins.get(e)||new Set;r.add(t),this._origins.has(e)||this._origins.set(e,r)}_addToStore(e,t,r,n){const s={id:e,origin:t,type:r,time:Date.now(),requestData:n||null};this.update((t=>{t.pendingApprovals[e]=s,t.pendingApprovalCount=Object.keys(t.pendingApprovals).length}))}_delete(e){this._approvals.delete(e);const{origin:t,type:r}=this.state.pendingApprovals[e];this._origins.get(t).delete(r),this._isEmptyOrigin(t)&&this._origins.delete(t),this.update((t=>{delete t.pendingApprovals[e],t.pendingApprovalCount=Object.keys(t.pendingApprovals).length}))}_deleteApprovalAndGetCallbacks(e){const t=this._approvals.get(e);if(!t)throw new i.ApprovalRequestNotFoundError(e);return this._delete(e),t}_isEmptyOrigin(e){var t;return!(null===(t=this._origins.get(e))||void 0===t?void 0:t.size)}}r.ApprovalController=l,r.default=l}}},{package:"@metamask/approval-controller"}],[977,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ApprovalRequestNotFoundError=void 0;class n extends Error{constructor(e){super(`Approval request with id '${e}' not found.`)}}r.ApprovalRequestNotFoundError=n}}},{package:"@metamask/approval-controller"}],[978,{"./ApprovalController":976,"./errors":977},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./ApprovalController"),r),s(e("./errors"),r)}}},{package:"@metamask/approval-controller"}],[979,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.BaseController=void 0;class n{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,r=!0){if(r){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e in this.internalConfig)void 0!==this.internalConfig[e]&&(this[e]=this.internalConfig[e])}else for(const t in e)void 0!==this.internalConfig[t]&&(this.internalConfig[t]=e[t],this[t]=e[t])}notify(){this.disabled||this.internalListeners.forEach((e=>{e(this.internalState)}))}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex((t=>e===t));return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}r.BaseController=n,r.default=n}}},{package:"@metamask/approval-controller>@metamask/base-controller"}],[98,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:11,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[980,{immer:4530},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseController=void 0;const n=e("immer");(0,n.enablePatches)();function s(e,t,r){return Object.keys(e).reduce(((n,s)=>{const o=t[s][r],i=e[s];return"function"==typeof o?n[s]=o(i):o&&(n[s]=i),n}),{})}r.BaseController=class{constructor({messenger:e,metadata:t,name:r,state:n}){this.messagingSystem=e,this.name=r,this.internalState=n,this.metadata=t,this.messagingSystem.registerActionHandler(`${r}:getState`,(()=>this.state))}get state(){return this.internalState}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,r]=n.produceWithPatches(this.internalState,e);this.internalState=t,this.messagingSystem.publish(`${this.name}:stateChange`,t,r)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},r.getAnonymizedState=function(e,t){return s(e,t,"anonymous")},r.getPersistentState=function(e,t){return s(e,t,"persist")}}}},{package:"@metamask/approval-controller>@metamask/base-controller"}],[981,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ControllerMessenger=r.RestrictedControllerMessenger=void 0;class n{constructor({controllerMessenger:e,name:t,allowedActions:r,allowedEvents:n}){this.controllerMessenger=e,this.controllerName=t,this.allowedActions=r||null,this.allowedEvents=n||null}registerActionHandler(e,t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed registering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.registerActionHandler(e,t)}unregisterActionHandler(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed unregistering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.unregisterActionHandler(e)}call(e,...t){if(null===this.allowedActions)throw new Error("No actions allowed");if(!this.allowedActions.includes(e))throw new Error(`Action missing from allow list: ${e}`);return this.controllerMessenger.call(e,...t)}publish(e,...t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed publishing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.publish(e,...t)}subscribe(e,t,r){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);return r?this.controllerMessenger.subscribe(e,t,r):this.controllerMessenger.subscribe(e,t)}unsubscribe(e,t){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);this.controllerMessenger.unsubscribe(e,t)}clearEventSubscriptions(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed clearing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.clearEventSubscriptions(e)}}r.RestrictedControllerMessenger=n;r.ControllerMessenger=class{constructor(){this.actions=new Map,this.events=new Map,this.eventPayloadCache=new Map}registerActionHandler(e,t){if(this.actions.has(e))throw new Error(`A handler for ${e} has already been registered`);this.actions.set(e,t)}unregisterActionHandler(e){this.actions.delete(e)}clearActions(){this.actions.clear()}call(e,...t){const r=this.actions.get(e);if(!r)throw new Error(`A handler for ${e} has not been registered`);return r(...t)}publish(e,...t){const r=this.events.get(e);if(r)for(const[e,n]of r.entries())if(n){const r=this.eventPayloadCache.get(e),s=n(...t);s!==r&&(this.eventPayloadCache.set(e,s),e(s,r))}else e(...t)}subscribe(e,t,r){let n=this.events.get(e);n||(n=new Map,this.events.set(e,n)),n.set(t,r)}unsubscribe(e,t){const r=this.events.get(e);if(!r||!r.has(t))throw new Error(`Subscription not found for event: ${e}`);r.get(t)&&this.eventPayloadCache.delete(t),r.delete(t)}clearEventSubscriptions(e){this.events.delete(e)}clearSubscriptions(){this.events.clear()}getRestricted({name:e,allowedActions:t,allowedEvents:r}){return new n({controllerMessenger:this,name:e,allowedActions:t,allowedEvents:r})}}}}},{package:"@metamask/approval-controller>@metamask/base-controller"}],[982,{"./BaseController":979,"./BaseControllerV2":980,"./ControllerMessenger":981},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.getPersistentState=r.getAnonymizedState=r.BaseControllerV2=r.BaseController=void 0;var o=e("./BaseController");Object.defineProperty(r,"BaseController",{enumerable:!0,get:function(){return o.BaseController}});var i=e("./BaseControllerV2");Object.defineProperty(r,"BaseControllerV2",{enumerable:!0,get:function(){return i.BaseController}}),Object.defineProperty(r,"getAnonymizedState",{enumerable:!0,get:function(){return i.getAnonymizedState}}),Object.defineProperty(r,"getPersistentState",{enumerable:!0,get:function(){return i.getPersistentState}}),s(e("./ControllerMessenger"),r)}}},{package:"@metamask/approval-controller>@metamask/base-controller"}],[983,{"./url-alphabet/index.cjs":984},function(){with(this)return function(){"use strict";return function(e,t,r){let{urlAlphabet:n}=e("./url-alphabet/index.cjs"),s=e=>crypto.getRandomValues(new Uint8Array(e)),o=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*n*t/e.length);return(o=t)=>{let i="";for(;;){let t=r(s),a=s;for(;a--;)if(i+=e[t[a]&n]||"",i.length===o)return i}}};t.exports={nanoid:(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),""),customAlphabet:(e,t=21)=>o(e,t,s),customRandom:o,urlAlphabet:n,random:s}}}},{package:"@metamask/approval-controller>nanoid"}],[984,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"@metamask/approval-controller>nanoid"}],[99,{lodash:4765},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var s={version:12,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=s}}},{package:"$root$"}],[4,{"../../shared/constants/app":5397,"../../shared/constants/metametrics":5402,"../../shared/constants/time":5408,"../../shared/modules/browser-runtime.utils":5419,"../../shared/modules/mv3.utils":5426,"../../shared/modules/object.utils":5428,"./first-time-state":40,"./lib/createStreamSink":51,"./lib/ens-ipfs/setup":58,"./lib/get-first-preferred-lang-code":60,"./lib/getObjStructure":61,"./lib/local-store":62,"./lib/migrator":65,"./lib/network-store":66,"./lib/notification-manager":67,"./lib/setupSentry":84,"./lib/util":87,"./metamask-controller":88,"./migrations":166,"./platforms/extension":167,"@metamask/obs-store":1217,"debounce-stream":1946,"end-of-stream":2012,"eth-rpc-errors":2103,"extension-port-stream":2627,loglevel:4778,pump:4885,"webextension-polyfill":5375},function(){with(this)return function(){"use strict";return function(e,t,r){var n=N(e("end-of-stream")),s=N(e("pump")),o=N(e("debounce-stream")),i=N(e("loglevel")),a=N(e("webextension-polyfill")),c=e("@metamask/obs-store"),l=N(e("extension-port-stream")),u=e("eth-rpc-errors"),d=e("../../shared/constants/app"),h=e("../../shared/constants/time"),p=e("../../shared/constants/metametrics"),f=e("../../shared/modules/browser-runtime.utils"),m=e("../../shared/modules/mv3.utils"),g=e("../../shared/modules/object.utils"),y=N(e("./migrations")),b=N(e("./lib/migrator")),v=N(e("./platforms/extension")),w=N(e("./lib/local-store")),k=(N(e("./lib/network-store")),e("./lib/setupSentry")),_=N(e("./lib/createStreamSink")),C=x(e("./lib/notification-manager")),E=x(e("./metamask-controller")),S=N(e("./first-time-state")),M=N(e("./lib/get-first-preferred-lang-code")),A=N(e("./lib/getObjStructure")),T=N(e("./lib/ens-ipfs/setup")),P=e("./lib/util");function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(R=function(e){return e?r:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=R(t);if(r&&r.has(e))return r.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function N(e){return e&&e.__esModule?e:{default:e}}const{sentry:O}=global,I={...S.default},j={[d.ENVIRONMENT_TYPE_POPUP]:!0,[d.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[d.ENVIRONMENT_TYPE_FULLSCREEN]:!0},L=["trezor-connect"];i.default.setDefaultLevel("info");const U=new v.default,B=new C.default;global.METAMASK_NOTIFIER=B;let D=!1,F=!1,q=!1;const H={},K={};let $;const G=new w.default;let V;const z=new URL("https://metamask.github.io/phishing-warning/v1.2.1/"),W="ACK_KEEP_ALIVE_MESSAGE",Y="WORKER_KEEP_ALIVE_MESSAGE",{promise:J,resolve:X,reject:Z}=(0,P.deferredPromise)();let Q,ee;a.default.runtime.onConnect.addListener((async(...e)=>{await J,Q(...e)})),a.default.runtime.onConnectExternal.addListener((async(...e)=>{await J,ee(...e)})),async function(){try{const e=await async function(){const e=new b.default({migrations:y.default});e.on("error",console.warn),V=await G.get()||e.generateInitialState(I),V&&!V.data&&(V=e.generateInitialState(I),O.captureMessage("MetaMask - Empty vault found - unable to recover"));if(e.on("error",(e=>{const t=(0,A.default)(V);O.captureException(e,{extra:{vaultStructure:t}})})),V=await e.migrateData(V),!V)throw new Error("MetaMask - migrator returned undefined");return G.setMetadata(V.meta),G.set(V.data),V.data}(),t=await(0,M.default)();!function(e,t){$=new E.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:re,openPopup:ne,initState:e,initLangCode:t,platform:U,notificationManager:B,browser:a.default,getRequestAccountTabIds:()=>K,getOpenMetamaskTabsIds:()=>H,localStore:G}),(0,T.default)({getCurrentChainId:$.networkController.getCurrentChainId.bind($.networkController),getIpfsGateway:$.preferencesController.getIpfsGateway.bind($.preferencesController),provider:$.provider}),(0,s.default)((0,c.storeAsStream)($.store),(0,o.default)(1e3),(0,_.default)((e=>G.set(e))),(e=>{i.default.error("MetaMask - Persistence pipeline failed",e)})),r=$,global.stateHooks.getSentryState=function(){const e=r.getState(),t=(0,g.maskObject)({metamask:e},k.SENTRY_STATE);return{browser:window.navigator.userAgent,store:t,version:U.getVersion()}};var r;const h=()=>D||Boolean(Object.keys(H).length)||F,f=(e,t)=>{if(!1===e)$.onClientClosed();else{if(t===d.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(H).length))return;$.onEnvironmentTypeClosed(t)}};function y(){let e="";const t=b();t&&(e=String(t)),m.isManifestV3?(a.default.action.setBadgeText({text:e}),a.default.action.setBadgeBackgroundColor({color:"#037DD6"})):(a.default.browserAction.setBadgeText({text:e}),a.default.browserAction.setBadgeBackgroundColor({color:"#037DD6"}))}function b(){const e=$.txController.getUnapprovedTxCount(),{unapprovedMsgCount:t}=$.messageManager,{unapprovedPersonalMsgCount:r}=$.personalMessageManager,{unapprovedDecryptMsgCount:n}=$.decryptMessageManager,{unapprovedEncryptionPublicKeyMsgCount:s}=$.encryptionPublicKeyManager,{unapprovedTypedMessagesCount:o}=$.typedMessageManager;return e+t+r+n+s+o+$.approvalController.getTotalApprovalCount()+$.appStateController.waitingForUnlock.length}function v(){Object.keys($.txController.txStateManager.getUnapprovedTxList()).forEach((e=>$.txController.txStateManager.setTxStatusRejected(e))),$.messageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>$.messageManager.rejectMsg(e.id,p.REJECT_NOTFICIATION_CLOSE_SIG))),$.personalMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>$.personalMessageManager.rejectMsg(e.id,p.REJECT_NOTFICIATION_CLOSE_SIG))),$.typedMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>$.typedMessageManager.rejectMsg(e.id,p.REJECT_NOTFICIATION_CLOSE_SIG))),$.decryptMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>$.decryptMessageManager.rejectMsg(e.id,p.REJECT_NOTFICIATION_CLOSE))),$.encryptionPublicKeyManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>$.encryptionPublicKeyManager.rejectMsg(e.id,p.REJECT_NOTFICIATION_CLOSE))),$.approvalController.clear(u.ethErrors.provider.userRejectedRequest()),y()}Q=async e=>{var t;const r=e.name;if(L.includes(e.name))return;let s=!1;s=(0,P.getPlatform)()===d.PLATFORM_FIREFOX?j[r]:e.sender.origin===`chrome-extension://${a.default.runtime.id}`;const o=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(s){const t=new l.default(e);if($.isClientOpen=!0,$.setupTrustedCommunication(t,e.sender),m.isManifestV3&&e.onMessage.addListener((t=>{t.name===Y&&e.postMessage({name:W})})),r===d.ENVIRONMENT_TYPE_POPUP&&(D=!0,(0,n.default)(t,(()=>{D=!1;const e=h();$.isClientOpen=e,f(e,d.ENVIRONMENT_TYPE_POPUP)}))),r===d.ENVIRONMENT_TYPE_NOTIFICATION&&(F=!0,(0,n.default)(t,(()=>{F=!1;const e=h();$.isClientOpen=e,f(e,d.ENVIRONMENT_TYPE_NOTIFICATION)}))),r===d.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;H[r]=!0,(0,n.default)(t,(()=>{delete H[r];const e=h();$.isClientOpen=e,f(e,d.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(o&&o.origin===z.origin&&o.pathname===z.pathname){const t=new l.default(e);$.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;e.onMessage.addListener((e=>{e.data&&"eth_requestAccounts"===e.data.method&&(K[n]=t)}))}ee(e)}},ee=e=>{const t=new l.default(e);$.setupUntrustedCommunication({connectionStream:t,sender:e.sender})},y(),$.txController.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.messageManager.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.personalMessageManager.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.decryptMessageManager.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.encryptionPublicKeyManager.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.typedMessageManager.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.appStateController.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,y),$.controllerMessenger.subscribe(E.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,y),B.on(C.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?b()>0&&re():v()}))}(e,t),m.isManifestV3||await async function(){let e;try{const t=new URL("https://metamask.github.io/phishing-warning/v1.2.1/");let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const s=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new te)),1e3),await s}catch(e){e instanceof te?console.warn("Phishing warning page timeout; page not guaraneteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await(async()=>{const e=await a.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,f.checkForLastErrorAndLog)(),e))).catch((()=>{(0,f.checkForLastErrorAndLog)()}));for(const t of e)a.default.tabs.sendMessage(t.id,{name:d.EXTENSION_MESSAGES.READY}).then((()=>{(0,f.checkForLastErrorAndLog)()})).catch((()=>{(0,f.checkForLastErrorAndLog)()}))})(),i.default.info("MetaMask initialization complete."),X()}catch(e){Z(e)}}().catch(i.default.error);class te extends Error{constructor(){super("Timeout failed")}}async function re(){const e=await U.getActiveTabs(),t=Boolean(e.find((e=>H[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!q&&(r||!D)&&!t){q=!0;try{await B.showPopup()}finally{q=!1}}}async function ne(){await re(),await new Promise((e=>{const t=setInterval((()=>{F||(clearInterval(t),e())}),h.SECOND)}))}const se=()=>{if($)return $.metaMetricsController.updateTraits({[p.TRAITS.INSTALL_DATE_EXT]:(new Date).toISOString().split("T")[0]}),void $.metaMetricsController.addEventBeforeMetricsOptIn({category:p.EVENT.CATEGORIES.APP,event:p.EVENT_NAMES.APP_INSTALLED,properties:{}});setTimeout((()=>{se()}),1e3)};a.default.runtime.onInstalled.addListener((({reason:e})=>{"install"===e&&(se(),U.openExtensionInBrowser())}))}}},{package:"$root$"}]],[4],{});