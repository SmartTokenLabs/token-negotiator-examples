"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[70],{8070:(e,n,t)=>{t.r(n),t.d(n,{Web3WalletProvider:()=>c,default:()=>l});var o=t(7338),i=t(723),r=t(7591),s=function(e,n,t,o){return new(t||(t=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(n){r(n)}}function c(e){try{l(o.throw(e))}catch(n){r(n)}}function l(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,c)}l((o=o.apply(e,n||[])).next())}))};class c{constructor(e,n,t){this.client=e,this.walletOptions=n,this.safeConnectOptions=t,this.connections={}}saveConnections(){let e={};for(let n in this.connections){let t=this.connections[n];e[n]={address:t.address,chainId:t.chainId,providerType:t.providerType,blockchain:t.blockchain}}localStorage.setItem(c.LOCAL_STORAGE_KEY,JSON.stringify(e))}emitSavedConnection(e){return Object.keys(this.connections).length&&e?(this.client.eventSender("connected-wallet",this.connections[e.toLocaleLowerCase()]),this.connections[e.toLocaleLowerCase()]):null}emitNetworkChange(e){if(e)return this.client.eventSender("network-change",e),e}deleteConnections(){this.connections={},localStorage.removeItem(c.LOCAL_STORAGE_KEY),localStorage.removeItem("walletconnect"),sessionStorage.removeItem("CURRENT_USER")}loadConnections(){return s(this,void 0,void 0,(function*(){let e=localStorage.getItem(c.LOCAL_STORAGE_KEY);if(!e)return;let n=JSON.parse(e);if(n)for(let o in n){let e=n[o];try{yield this.connectWith(e.providerType,!0)}catch(t){console.log("Wallet couldn't connect: "+t.message),delete n[o],this.saveConnections(),this.emitSavedConnection(o)}}}))}connectWith(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s(this,void 0,void 0,(function*(){if(!e)throw new Error("Please provide a Wallet type to connect with.");if(this[e]){const t=yield this[e](n);return(0,r.kg)(2,"address",t),this.saveConnections(),this.emitSavedConnection(t),t}throw new Error("Wallet type not found")}))}signMessage(e,n){return s(this,void 0,void 0,(function*(){let t=this.getWalletProvider(e).getSigner(e);return yield t.signMessage(n)}))}getWalletProvider(e){var n;if(e=e.toLowerCase(),!(null===(n=this.connections[e])||void 0===n?void 0:n.provider))throw new Error("Wallet provider not found for address");return this.connections[e].provider}getConnectedWalletData(){return Object.values(this.connections)}registerNewWalletAddress(e,n,t,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"evm";return this.connections[e.toLowerCase()]={address:e,chainId:n,providerType:t,provider:i,blockchain:r,ethers:o},e}registerProvider(e,n){return s(this,void 0,void 0,(function*(){const t=yield e.listAccounts(),o=(yield e.detectNetwork()).chainId;if(0===t.length)throw new Error("No accounts found via wallet-connect.");let i=t[0];return this.registerNewWalletAddress(i,o,n,e),e.provider.on("accountsChanged",(t=>{t&&0!==t.length?i!==t[0]&&(delete this.connections[i.toLowerCase()],i=t[0],this.registerNewWalletAddress(i,o,n,e),this.saveConnections(),this.emitSavedConnection(i),this.client.getTokenStore().clearCachedTokens(),this.client.enrichTokenLookupDataOnChainTokens()):this.client.disconnectWallet()})),e.provider.on("chainChanged",(o=>{this.registerNewWalletAddress(t[0],o,n,e),this.saveConnections(),this.emitNetworkChange(o)})),e.provider.on("disconnect",(e=>{(null===e||void 0===e?void 0:e.message)&&e.message.indexOf("MetaMask: Disconnected from chain")>-1||this.client.disconnectWallet()})),t[0]}))}MetaMask(e){return s(this,void 0,void 0,(function*(){if((0,r.kg)(2,"connect MetaMask"),"undefined"!==typeof window.ethereum){yield window.ethereum.enable();const e=new i.Q(window.ethereum,"any");return this.registerProvider(e,"MetaMask")}throw new Error("MetaMask is not available. Please check the extension is supported and active.")}))}WalletConnect(e){return s(this,void 0,void 0,(function*(){(0,r.kg)(2,"connect Wallet Connect");const n=yield Promise.all([t.e(38),t.e(401),t.e(883)]).then(t.bind(t,3401)),o=yield n.getWalletConnectProviderInstance(e);return new Promise(((n,t)=>{e&&o.connector.on("display_uri",((e,n)=>{t(new Error("Connection expired"))})),o.enable().then((()=>{const e=new i.Q(o,"any");n(this.registerProvider(e,"WalletConnect"))})).catch((e=>t(e)))}))}))}WalletConnectV2(e){var n,o,c,l,a,d;return s(this,void 0,void 0,(function*(){(0,r.kg)(2,"connect Wallet Connect V2");const h=yield Promise.all([t.e(38),t.e(403)]).then(t.bind(t,8038)),v=yield h.getWalletConnectV2ProviderInstance();let u;if(v.on("display_uri",(e=>s(this,void 0,void 0,(function*(){console.log("EVENT","QR Code Modal open"),u=(yield t.e(974).then(t.t.bind(t,1974,23))).default,u.open(e,(()=>{this.client.getUi().showError("User closed modal")}))})))),v.on("session_delete",(e=>{let{id:n,topic:t}=e;console.log("WC V2 EVENT","session_deleted"),this.client.disconnectWallet()})),!e){let e;yield v.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:null!==(c=null===(o=null===(n=this.walletOptions)||void 0===n?void 0:n.walletConnectV2)||void 0===o?void 0:o.chains)&&void 0!==c?c:h.WC_V2_DEFAULT_CHAINS,events:["chainChanged","accountsChanged"],rpcMap:null!==(d=null===(a=null===(l=this.walletOptions)||void 0===l?void 0:l.walletConnectV2)||void 0===a?void 0:a.rpcMap)&&void 0!==d?d:h.WC_DEFAULT_RPC_MAP}},pairingTopic:null===e||void 0===e?void 0:e.topic}),u.close()}return new Promise(((e,n)=>{v.enable().then((()=>{const n=new i.Q(v,"any");e(this.registerProvider(n,"WalletConnectV2"))})).catch((e=>{n(e)}))}))}))}Torus(e){return s(this,void 0,void 0,(function*(){const e=yield t.e(514).then(t.bind(t,2514)),n=yield e.getTorusProviderInstance();yield n.init(),yield n.login();const o=new i.Q(n.provider,"any");return this.registerProvider(o,"Torus")}))}Phantom(e){return s(this,void 0,void 0,(function*(){if((0,r.kg)(2,"connect Phantom"),"undefined"!==typeof window.solana){const e=(yield window.solana.connect()).publicKey.toBase58();return this.registerNewWalletAddress(e,"mainnet-beta","phantom",window.solana,"solana")}throw new Error("Phantom is not available. Please check the extension is supported and active.")}))}SafeConnect(e){return s(this,void 0,void 0,(function*(){(0,r.kg)(2,"connect SafeConnect");const e=yield this.getSafeConnectProvider(),n=yield e.initSafeConnect();return this.registerNewWalletAddress(n,1,"SafeConnect",e),n}))}Flow(e){return s(this,void 0,void 0,(function*(){const e=(yield t.e(578).then(t.bind(t,1578))).getFlowProvider();yield e.currentUser.authenticate();let n=yield e.currentUser.snapshot();if(!n.addr)throw new Error("Failed to connect Flow wallet");return this.registerNewWalletAddress(n.addr,1,"flow",e),n.addr}))}safeConnectAvailable(){return void 0!==this.safeConnectOptions}getSafeConnectProvider(){return s(this,void 0,void 0,(function*(){const{SafeConnectProvider:e}=yield Promise.resolve().then(t.bind(t,8421));return new e(this.client.getUi(),this.safeConnectOptions)}))}}c.LOCAL_STORAGE_KEY="tn-wallet-connections";const l=c}}]);
//# sourceMappingURL=70.f1a01b2b.chunk.js.map